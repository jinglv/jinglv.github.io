<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jinglv.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="学习人工智能学习笔记第三讲">
<meta property="og:type" content="article">
<meta property="og:title" content="业务场景">
<meta property="og:url" content="https://jinglv.github.io/2025/07/18/ai/ai-basic/3-business-scenario/index.html">
<meta property="og:site_name" content="Jean&#39;s Blog">
<meta property="og:description" content="学习人工智能学习笔记第三讲">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250718111929289.png">
<meta property="og:image" content="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250718151944852.png">
<meta property="article:published_time" content="2025-07-17T16:00:00.000Z">
<meta property="article:modified_time" content="2025-07-18T03:18:00.000Z">
<meta property="article:author" content="Jean Lv">
<meta property="article:tag" content="人工智能学习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250718111929289.png">

<link rel="canonical" href="https://jinglv.github.io/2025/07/18/ai/ai-basic/3-business-scenario/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>业务场景 | Jean's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Jean's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Jean's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一个专注软件测试开发技术的个人博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jinglv.github.io/2025/07/18/ai/ai-basic/3-business-scenario/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Jean Lv">
      <meta itemprop="description" content="涉猎的主要编程语言Java、Python, 领域软件测试、AI测试开发相关">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jean's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          业务场景
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-07-18 00:00:00 / 修改时间：11:18:00" itemprop="dateCreated datePublished" datetime="2025-07-18T00:00:00+08:00">2025-07-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">人工智能学习</span></a>
                </span>
            </span>

          
            <div class="post-description">学习人工智能学习笔记第三讲</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="信用卡反欺诈"><a href="#信用卡反欺诈" class="headerlink" title="信用卡反欺诈"></a>信用卡反欺诈</h1><h2 id="如何展开信用卡反欺诈"><a href="#如何展开信用卡反欺诈" class="headerlink" title="如何展开信用卡反欺诈"></a>如何展开信用卡反欺诈</h2><p>我们已经可以了解了信用卡反欺诈的运作原理了。只不过需要注意的是我们常用的算法都为监督学习算法。什么是<strong>监督学习</strong>呢，就是我们用来训练的数据必须有label（y值，标注，真实值），这样才可以指导损失函数和梯度下降算法进行迭代。 用通俗的语言说，我们需要从数据中学习到一些规律去判断用户的行为。 但用来学习的这些数据得有标准答案才行，这样我才能知道什么规律是正确的。</p>
<p>所以一个人工智能模型想要训练出来， 需要海量的已标注的数据（已经有答案的数据），而已标注的数据往往不是自动从系统中抓取出来的，而是由人工处理而成。</p>
<p>比如反欺诈系统中，往往需要业务专家人工的去排查每一条用户的数据并标记其label（是否是盗刷行为），经过这样大量的人工标注工作后，才可以收集到训练所需的海量数据。</p>
<p>或者换一个比较容易里理解的场景， 我们有一个图片分类的场景，可以识别人，猫，狗，老鼠。 为了训练出能够识别出这4种分类的模型，需要标注人员对海量的图片进行标注，这样算法才能学习到这4中类别的特征权重。网络上曾经有个段子，人工智能是有多少人工， 就有多少智能， 虽然是个段子，但其实也侧面说明了， 人工智能确实是建立在大量的人工基础上的场景。</p>
<h2 id="建模流程"><a href="#建模流程" class="headerlink" title="建模流程"></a>建模流程</h2><p>使用spark ml库写了一段代码来表示一个建模流程，我们就来模拟一下信用卡反欺诈模型是如何训练的. 这里我们的测试数据是我自己构建的。就不展示数据标注的工作了。</p>
<p>建模流程如下：</p>
<ol>
<li>获取用户数据。</li>
<li>根据用户数据提取特征（拼表，计算时序特征等等），经过此步骤后一般会产出一张宽表。</li>
<li>当所有特征都计算好后，需要进行一定的特征转换，比如把离散特征进行独热编码，转换成计算机可以理解的形式。</li>
<li>将数据拆分为训练和验证两份数据，训练集交给算法进行建模。</li>
<li>模型训练好后，使用验证数据进行评估效果工作。</li>
<li>模型保存。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Time：2025/7/18 11:01</span></span><br><span class="line"><span class="comment"># @Author：jinglv</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">建模流程如下：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 获取用户数据。</span></span><br><span class="line"><span class="string">2. 根据用户数据提取特征（拼表，计算时序特征等等），经过此步骤后一般会产出一张宽表。</span></span><br><span class="line"><span class="string">3. 当所有特征都计算好后，需要进行一定的特征转换，比如把离散特征进行独热编码，转换成计算机可以理解的形式。</span></span><br><span class="line"><span class="string">4. 将数据拆分为训练和验证两份数据，训练集交给算法进行建模。</span></span><br><span class="line"><span class="string">5. 模型训练好后，使用验证数据进行评估效果工作。</span></span><br><span class="line"><span class="string">6. 模型保存。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkContext, SparkConf, SQLContext</span><br><span class="line"><span class="keyword">from</span> pyspark.ml.classification <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> pyspark.ml.evaluation <span class="keyword">import</span> BinaryClassificationEvaluator</span><br><span class="line"><span class="keyword">from</span> pyspark.ml.feature <span class="keyword">import</span> StringIndexer, OneHotEncoder, VectorAssembler</span><br><span class="line"><span class="keyword">from</span> pyspark.ml.tuning <span class="keyword">import</span> ParamGridBuilder, TrainValidationSplit</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> functions <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> pyspark.sql.window <span class="keyword">import</span> Window</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化SparkContext</span></span><br><span class="line">conf = SparkConf().setMaster(<span class="string">&quot;local&quot;</span>).setAppName(<span class="string">&quot;Credit card anti-fraud scenario&quot;</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line">sqlContext = SQLContext(sc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------获取用户数据--------------------------------</span></span><br><span class="line"><span class="comment"># 定义用户数据，姓名，性别，年龄，职位，交易额（消费金额），以及最后的label（代表是否是欺诈行为，1.0为欺诈，0.0相反）</span></span><br><span class="line">dicts = [</span><br><span class="line">    [<span class="string">&#x27;frank&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">3600</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;alex&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">26</span>, <span class="string">&#x27;项目经理&#x27;</span>, <span class="number">3000</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;frank&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;asdf&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;fragfsnk&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;frasdfgnk&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;frsdfgank&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;frsdfgdfank&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;frsdfgdfankdsaf&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;frsdfgdfank342&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;frsdfgdfank445&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;frsdfgdfank756&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">3600</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;hdfg&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;frsdfncvgdfank&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;wert&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;sdfg&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;frssdffgdfank&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;asdf&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;zxcv&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;frsdfgdfank&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;vzxcv&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">2600</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;zxcv&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">3600</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;frsdfgdcvfank&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">3600</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;frsdfgdcvfankasdf&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">3600</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;asfghffgh&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">3600</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;dfgh&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">3600</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;frsdfgdcvbnmvbvfank&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">3600</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">3600</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;dasdfsadf&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">3600</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;gghg&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;程序员&#x27;</span>, <span class="number">3600</span>, <span class="number">1.0</span>],</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 创建RDD</span></span><br><span class="line">rdd = sc.parallelize(dicts, <span class="number">3</span>)</span><br><span class="line"><span class="comment"># 假设用户数据有名字，性别，年龄，职位，本次交易额，以及最后的label（代表是否是欺诈行为，1.0为欺诈，0.0相反）</span></span><br><span class="line">dataf = sqlContext.createDataFrame(rdd, [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;label&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------计算时序特征--------------------------------</span></span><br><span class="line"><span class="comment"># 通过spark定义一段窗口，计算出用户一段时间内的最大消费额</span></span><br><span class="line">windowSpec = Window.partitionBy(dataf.gender)</span><br><span class="line">windowSpec = windowSpec.orderBy(dataf.age)</span><br><span class="line">windowSpec = windowSpec.rowsBetween(Window.unboundedPreceding, Window.currentRow)</span><br><span class="line">dataf.withColumn(<span class="string">&#x27;max_price&#x27;</span>, F.<span class="built_in">max</span>(dataf.price).over(windowSpec)).show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------转换特征--------------------------------</span></span><br><span class="line"><span class="comment"># 将非数值类型的字段转换为数值类型</span></span><br><span class="line">stringIndexer = StringIndexer(inputCol=<span class="string">&quot;title&quot;</span>, outputCol=<span class="string">&quot;title_num&quot;</span>)</span><br><span class="line">data_indexed = stringIndexer.fit(dataf).transform(dataf)</span><br><span class="line"><span class="comment"># 将类别特征进行独热编码，这是为了把字符串类型的离散特征，转换成计算机可以识别的数字</span></span><br><span class="line">encoder = OneHotEncoder(inputCol=<span class="string">&quot;title_num&quot;</span>, outputCol=<span class="string">&quot;title_onehot&quot;</span>)</span><br><span class="line">data_encoded = encoder.fit(data_indexed).transform(data_indexed)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将所有特征组合成一个特征向量</span></span><br><span class="line">vectorAssembler = VectorAssembler(inputCols=[<span class="string">&quot;age&quot;</span>, <span class="string">&quot;title_onehot&quot;</span>, <span class="string">&quot;price&quot;</span>], outputCol=<span class="string">&quot;feature&quot;</span>)</span><br><span class="line">data_vector = vectorAssembler.transform(data_encoded)</span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------模型训练--------------------------------</span></span><br><span class="line"><span class="comment"># 将数据划分为训练集和验证集，一部分数据用来训练，而一部分数据用来测试模型的效果（randomSplit拆分，80%的数据用来训练，20%的数据用来验证，seed随机种子）</span></span><br><span class="line">(train_data, test_data) = data_vector.randomSplit([<span class="number">0.8</span>, <span class="number">0.2</span>], seed=<span class="number">1234</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------模型调参和交叉验证--------------------------------</span></span><br><span class="line"><span class="comment"># 创建Logistic回归模型，这是最典型的机器学习算法</span></span><br><span class="line">lr = LogisticRegression(labelCol=<span class="string">&quot;label&quot;</span>, featuresCol=<span class="string">&quot;feature&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义模型训练要用的参数</span></span><br><span class="line">paramGrid = ParamGridBuilder().addGrid(lr.regParam, [<span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>]).addGrid(lr.elasticNetParam, [<span class="number">0.0</span>, <span class="number">0.5</span>, <span class="number">1.0</span>]).build()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义评估指标</span></span><br><span class="line">evaluator = BinaryClassificationEvaluator(labelCol=<span class="string">&quot;label&quot;</span>, metricName=<span class="string">&quot;areaUnderROC&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用训练集和验证进行模型调参和交叉验证</span></span><br><span class="line">tvs = TrainValidationSplit(estimator=lr, estimatorParamMaps=paramGrid, evaluator=evaluator, trainRatio=<span class="number">0.8</span>)</span><br><span class="line">tvsModel = tvs.fit(train_data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出最佳参数（特征）组合</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;最佳参数组合: &quot;</span> + <span class="built_in">str</span>(tvsModel.getEstimatorParamMaps()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用最佳参数组合训练模型</span></span><br><span class="line">bestModel = tvsModel.bestModel</span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------模型预测--------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在测试集上评估模型效果，predictions中保存了每一条数据的预测结果</span></span><br><span class="line">predictions = bestModel.transform(test_data)</span><br><span class="line">result = evaluator.evaluate(predictions)</span><br><span class="line">predictions.show()</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------模型保存--------------------------------</span></span><br><span class="line"><span class="comment"># 把模型保存到本地目录</span></span><br><span class="line">tvsModel.write().overwrite().save(<span class="string">&#x27;./model&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>上面代码中predictions中保存了每一条数据的预测结果，如果我们打印它，会展示如下数据：</p>
<p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250718111929289.png" alt="image-20250718111929289"></p>
<p>上面的表格中prediction代表spark训练出的模型最终的识别结果，而probability则代表概率，其中第一条数据是0的概率是0.97498114032739。而最后我们把训练好的模型保存到本地中，以便以后我们后续使用。</p>
<h1 id="推荐系统"><a href="#推荐系统" class="headerlink" title="推荐系统"></a>推荐系统</h1><h2 id="推荐系统的问题"><a href="#推荐系统的问题" class="headerlink" title="推荐系统的问题"></a>推荐系统的问题</h2><p>已经基本了解到了要如何构建一个二分类模型。我们都知道模型大体可以分成，回归，二分类和多分类。但推荐系统是属于哪一种场景呢，比如我们常见的广告推荐或者内容推荐，这些场景都是由系统来判断用户的喜好来推送广告或者视频内容，以追求更高的点击率和转化率。这种场景怎么看都不像跟这三种类型的算法有关系。</p>
<h2 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h2><p>其实解决这个问题的思路也比较简单， 我们可以遵循如下的原则：</p>
<ol>
<li>借助专家系统，根据用户的信息初筛（定义些规则）一个候选的视频集合（比如1000个），比如可以先简单根据用户的年龄，性别，爱好，职业进行推测他喜欢的类型并过滤出候选集合。</li>
<li>训练一个二分类模型，这个模型用于推理出用户是否会点击这个视频。</li>
<li>将候选集合分别输入给模型进行推理。计算出每个视频会被用户点击的概率。</li>
<li>将最终的推理结果进行排序，取top n个概率最高的视频推送给用户。</li>
</ol>
<p>这样我们就把一个推荐系统的问题转换成了一个二分类的问题。</p>
<p>代码实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkContext, SparkConf, SQLContext</span><br><span class="line"><span class="keyword">from</span> pyspark.ml <span class="keyword">import</span> Pipeline</span><br><span class="line"><span class="keyword">from</span> pyspark.ml.classification <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> pyspark.ml.evaluation <span class="keyword">import</span> BinaryClassificationEvaluator</span><br><span class="line"><span class="keyword">from</span> pyspark.ml.feature <span class="keyword">import</span> Tokenizer, StopWordsRemover, CountVectorizer, StringIndexer, OneHotEncoder, \</span><br><span class="line">    VectorAssembler</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> functions <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line">conf = SparkConf().setMaster(<span class="string">&quot;local&quot;</span>).setAppName(<span class="string">&quot;Recommendation system&quot;</span>)</span><br><span class="line">sc = SparkContext(conf=conf)</span><br><span class="line">sqlContext = SQLContext(sc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义数据， 性别，电影名称，label（代表是否是感兴趣行为，1.0为感兴趣，0.0相反）</span></span><br><span class="line">dicts = [</span><br><span class="line">    [<span class="string">&#x27;man&#x27;</span>, <span class="string">&#x27;The Shawshank Redemption&#x27;</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;man&#x27;</span>, <span class="string">&#x27;The Godfather&#x27;</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;man&#x27;</span>, <span class="string">&#x27;Forrest Gump&#x27;</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;woman&#x27;</span>, <span class="string">&#x27;Titanic&#x27;</span>, <span class="number">1.0</span>],</span><br><span class="line">    [<span class="string">&#x27;woman&#x27;</span>, <span class="string">&#x27;Forrest Gump&#x27;</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;woman&#x27;</span>, <span class="string">&#x27;The Godfather&#x27;</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;woman&#x27;</span>, <span class="string">&#x27;The Shawshank Redemption&#x27;</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;man&#x27;</span>, <span class="string">&#x27;Titanic&#x27;</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;man&#x27;</span>, <span class="string">&#x27;A Beautiful Mind&#x27;</span>, <span class="number">0.0</span>],</span><br><span class="line">    [<span class="string">&#x27;woman&#x27;</span>, <span class="string">&#x27;A Beautiful Mind&#x27;</span>, <span class="number">1.0</span>],</span><br><span class="line">]</span><br><span class="line">rdd = sc.parallelize(dicts, <span class="number">3</span>)</span><br><span class="line">dataf = sqlContext.createDataFrame(rdd, [<span class="string">&#x27;gender&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;interested&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将性别进行独热编码，以便把数据转换成算法可以识别的形式（根据性别进行独热编码）</span></span><br><span class="line">stringIndexer = StringIndexer(inputCol=<span class="string">&quot;gender&quot;</span>, outputCol=<span class="string">&quot;gender_num&quot;</span>)</span><br><span class="line">data_indexed = stringIndexer.fit(dataf).transform(dataf)</span><br><span class="line">encoder = OneHotEncoder(inputCol=<span class="string">&quot;gender_num&quot;</span>, outputCol=<span class="string">&quot;gender_onehot&quot;</span>)</span><br><span class="line">data_encoded = encoder.fit(data_indexed).transform(data_indexed)</span><br><span class="line">data = data_encoded.select(<span class="string">&#x27;gender_onehot&#x27;</span>, <span class="string">&#x27;interested&#x27;</span>, <span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">data.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用分词器（根据电影名字进行分词）</span></span><br><span class="line">tokenizer = Tokenizer(inputCol=<span class="string">&quot;title&quot;</span>, outputCol=<span class="string">&quot;words&quot;</span>)</span><br><span class="line"><span class="comment"># 使用停用词（去掉停用词，不需要的词汇，没有意义的词，比如：标点符号、哦、哈的语气词，介词等，一般会有停用词库）</span></span><br><span class="line">remover = StopWordsRemover(inputCol=<span class="string">&quot;words&quot;</span>, outputCol=<span class="string">&quot;filtered_words&quot;</span>)</span><br><span class="line"><span class="comment"># 将文本数据转换成词向量</span></span><br><span class="line">vectorizer = CountVectorizer(inputCol=<span class="string">&quot;filtered_words&quot;</span>, outputCol=<span class="string">&quot;final_words&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将所有特征组合成一个特征向量</span></span><br><span class="line">vectorAssembler = VectorAssembler(inputCols=[<span class="string">&quot;gender_onehot&quot;</span>, <span class="string">&quot;final_words&quot;</span>], outputCol=<span class="string">&quot;features&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义逻辑回归</span></span><br><span class="line">classifier = LogisticRegression(labelCol=<span class="string">&quot;interested&quot;</span>, featuresCol=<span class="string">&quot;features&quot;</span>, maxIter=<span class="number">10</span>)</span><br><span class="line"><span class="comment"># 定义流水线， 当数据来了以后就可以按顺序处理数据</span></span><br><span class="line">pipeline = Pipeline(stages=[tokenizer, remover, vectorizer, vectorAssembler, classifier])</span><br><span class="line"><span class="comment"># 模型训练</span></span><br><span class="line">model = pipeline.fit(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型推理</span></span><br><span class="line">predictions = model.transform(data)</span><br><span class="line">evaluator = BinaryClassificationEvaluator(labelCol=<span class="string">&quot;interested&quot;</span>, rawPredictionCol=<span class="string">&quot;rawPrediction&quot;</span>)</span><br><span class="line">accuracy = evaluator.evaluate(predictions)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Accuracy:&quot;</span>, accuracy)</span><br><span class="line">predictions.show()</span><br><span class="line"></span><br><span class="line">df_desc = predictions.orderBy(F.desc(<span class="string">&quot;probability&quot;</span>))</span><br><span class="line">df_desc.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="词向量"><a href="#词向量" class="headerlink" title="词向量"></a>词向量</h2><p>上面用于训练模型的数据中有一列是电影名称，我们会发现代码中我们使用了一系列NLP（Natural Language Processing，自然语言处理）的算法：</p>
<ul>
<li><p>分词器（tokenizer）：用于在一个句子中提取一个一个的词。</p>
</li>
<li><p>停用词（stop words）：用于去掉一些语义无关的语气词，介词等，比如<code>the</code>或者中文中的语气词<code>啊</code>。 在模型训练中往往需要去掉这些词以去除噪音，优化模型空间，减少索引量等等。</p>
</li>
<li><p>词向量（也叫词嵌入）：可以理解为计算出词与词之间的关联性，从而训练出的围绕中心词的特征向量。</p>
</li>
</ul>
<p>上述概念中可能词向量是最难以理解的，这里尽量尝试用简单易懂的语言来解释这个概念。 我们之前训练反欺诈模型的时候，也遇到过一些离散特征，比如<code>title</code>也是以文本形式存在的数据。</p>
<p>我们在反欺诈中处理这样的使用的one-hot（独热编码），独热编码也是一种处理离散特征常用的方法。假设我们有一群学生，他们可以通过三个特征来形容，分别是：</p>
<ul>
<li><p>性别：[“男”，“女”]</p>
</li>
<li><p>年级：[“初一”，“初二”，“初三”]</p>
</li>
<li><p>学校：[“一中”，“二中”，“三中”，“四中”]</p>
</li>
</ul>
<p>我们用采用N位状态寄存器来对N个状态进行编码，拿上面的例子来说，就是：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>性别</th>
<th>[“男”, “女”]</th>
<th>N=2</th>
<th>男: 1 0 女: 0 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>年级</td>
<td>[“初一”, “初二”, “初三”]</td>
<td>N=3</td>
<td>初一: 1 0 0 初二: 0 1 0 初三: 0 0 1</td>
</tr>
<tr>
<td>学校</td>
<td>[“一中”, “二中”, “三中”, “四中”]</td>
<td>N=4</td>
<td>一中: 1 0 0 0 二中: 0 1 0 0 三中: 0 0 1 0 四中: 0 0 0 1</td>
</tr>
</tbody>
</table>
</div>
<p>因此，当我们再来描述一个学生的时候（男生，初一，来自一中），就可以采用 [1 0 1 0 0 1 0 0 0]这样的形式来表示。这也一种用于特征组合（特征之间是有关系的）的实现方法之一。</p>
<p>或者我们也可以使用类似bitmap的方法做出一个one—hot向量来表示离散特征。 我们可以用类似下面的形式表达：</p>
<p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250718151944852.png" alt="image-20250718151944852" style="zoom:50%;" /></p>
<p>假设职业这一列一共有100个值， 假设教师在编号6这个位置上，编号6所在位置ide值就是1，其他的值都是0，我们以这个向量来代表教师这个特征. 以此类推，如果学生代表的编号是10，那么10这个位置所在的值是1，其他位置的值都是0，用词向量来代表学生。 这样最后我们就有100个100维度的向量来表示这些特征（特征之间是没有关系）。</p>
<p>上面两种方法都是很常见的用来用来表达文本特征的方法，但它们的问题是词与词之间是独立的，互相没有关联。 比如我们的训练数据中有一个句子<code>this is apple juice</code>，我们期望当出现 <code>this is orange __</code> 的时候，模型能够为我们推测出这个空白处也应该填写单词<code>juice</code>。 也就是我们希望模型能通过之前针对第一个句子的训练就能找到单词与单词之间的关系，模型能够知道<code>apple</code>和<code>orange</code>是含义相似的词，从而能推测出<code>orange</code>后面也可以填写<code>juice</code>。 而这正是词向量要做的事情（词与词之间的关系）。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>男人</th>
<th>女人</th>
<th>国王</th>
<th>王后</th>
<th>苹果</th>
<th>橘子</th>
</tr>
</thead>
<tbody>
<tr>
<td>性别</td>
<td>-1</td>
<td>1</td>
<td>-0.95</td>
<td>0.97</td>
<td>0</td>
<td>0.01</td>
</tr>
<tr>
<td>食物</td>
<td>-0.01</td>
<td>0.01</td>
<td>-0.02</td>
<td>0.01</td>
<td>0.95</td>
<td>0.97</td>
</tr>
<tr>
<td>高贵程度</td>
<td>0.01</td>
<td>0.01</td>
<td>0.9</td>
<td>0.87</td>
<td>0.01</td>
<td>0</td>
</tr>
<tr>
<td>…</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>词向量可找到现有的，也可以自己训练。</p>
<p>如上图，词向量围绕这一些中心词（性别，事务，高贵程度）,计算出每一个词与这些中心词的相关程度。而要得到这个词向量本身就需要相关算法训练出来，比如world2vec（词向量的一种算法）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Time：2025/7/18 15:29</span></span><br><span class="line"><span class="comment"># @Author：jinglv</span></span><br><span class="line"><span class="keyword">from</span> pyspark.ml.feature <span class="keyword">import</span> Word2Vec</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化SparkSession</span></span><br><span class="line">spark = SparkSession \</span><br><span class="line">    .builder \</span><br><span class="line">    .appName(<span class="string">&quot;dataFrame&quot;</span>) \</span><br><span class="line">    .getOrCreate()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文本数据，进行切词</span></span><br><span class="line">documentDF = spark.createDataFrame([</span><br><span class="line">    (<span class="string">&quot;Hi I heard about Spark&quot;</span>.split(<span class="string">&quot; &quot;</span>),),</span><br><span class="line">    (<span class="string">&quot;I wish Java could use case classes&quot;</span>.split(<span class="string">&quot; &quot;</span>),),</span><br><span class="line">    (<span class="string">&quot;Logistic regression models are neat&quot;</span>.split(<span class="string">&quot; &quot;</span>),)</span><br><span class="line">], [<span class="string">&quot;text&quot;</span>])</span><br><span class="line"></span><br><span class="line">documentDF.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Learn a mapping from words to Vectors.进行词向量映射训练，训练出5个中心词</span></span><br><span class="line">word2Vec = Word2Vec(vectorSize=<span class="number">5</span>, minCount=<span class="number">0</span>, inputCol=<span class="string">&quot;text&quot;</span>, outputCol=<span class="string">&quot;result&quot;</span>)</span><br><span class="line">model = word2Vec.fit(documentDF)</span><br><span class="line"></span><br><span class="line">result = model.transform(documentDF)</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> result.collect():</span><br><span class="line">    text, vector = row</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Text: [%s] =&gt; \nVector: %s\n&quot;</span> % (<span class="string">&quot;, &quot;</span>.join(text), <span class="built_in">str</span>(vector)))</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Text: [Hi, I, heard, about, Spark] =&gt; </span><br><span class="line">Vector: [-0.044043296948075294,0.0017202366143465042,-0.04031781677622348,-0.030211083777248862,-0.04166501020081342]</span><br><span class="line"></span><br><span class="line">Text: [I, wish, Java, could, use, case, classes] =&gt; </span><br><span class="line">Vector: [-0.01309338877243655,0.027492987191570655,0.028597419682357992,-0.02514699660241604,0.007802080828696489]</span><br><span class="line"></span><br><span class="line">Text: [Logistic, regression, models, are, neat] =&gt; </span><br><span class="line">Vector: [0.01408876907080412,-0.03434107899665833,-0.011755409836769105,-0.012410750263370574,0.009409739542752505]</span><br></pre></td></tr></table></figure>
<p>上面是一个训练词向量的代码，它的计算原理大概可以描述为：在文本中选取中心词并选取中心词前后数个单词，并训练出这些词会出现在中心词周围的概率。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E5%AD%A6%E4%B9%A0/" rel="tag"># 人工智能学习</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/07/16/ai/ai-test/midscene/1-introduce/" rel="prev" title="Midscene.js介绍">
      <i class="fa fa-chevron-left"></i> Midscene.js介绍
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/07/23/ai/ai-basic/5-data-quality/" rel="next" title="数据质量">
      数据质量 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BF%A1%E7%94%A8%E5%8D%A1%E5%8F%8D%E6%AC%BA%E8%AF%88"><span class="nav-number">1.</span> <span class="nav-text">信用卡反欺诈</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%B1%95%E5%BC%80%E4%BF%A1%E7%94%A8%E5%8D%A1%E5%8F%8D%E6%AC%BA%E8%AF%88"><span class="nav-number">1.1.</span> <span class="nav-text">如何展开信用卡反欺诈</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BB%BA%E6%A8%A1%E6%B5%81%E7%A8%8B"><span class="nav-number">1.2.</span> <span class="nav-text">建模流程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F"><span class="nav-number">2.</span> <span class="nav-text">推荐系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">2.1.</span> <span class="nav-text">推荐系统的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="nav-number">2.2.</span> <span class="nav-text">实现思路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%8D%E5%90%91%E9%87%8F"><span class="nav-number">2.3.</span> <span class="nav-text">词向量</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jean Lv"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Jean Lv</p>
  <div class="site-description" itemprop="description">涉猎的主要编程语言Java、Python, 领域软件测试、AI测试开发相关</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">159</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jean Lv</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

  

    </div>
</body>
</html>
