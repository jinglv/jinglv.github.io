<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jean&#39;s Blog</title>
  
  <subtitle>ä¸€ä¸ªä¸“æ³¨è½¯ä»¶æµ‹è¯•å¼€å‘æŠ€æœ¯çš„ä¸ªäººåšå®¢</subtitle>
  <link href="https://jinglv.github.io/atom.xml" rel="self"/>
  
  <link href="https://jinglv.github.io/"/>
  <updated>2025-09-18T09:00:00.000Z</updated>
  <id>https://jinglv.github.io/</id>
  
  <author>
    <name>Jean Lv</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>LangGraphæ ¸å¿ƒç»„ä»¶æµå¼è¾“å‡º</title>
    <link href="https://jinglv.github.io/2025/09/18/ai/langchain/langgraph/6-langgraph-stream/"/>
    <id>https://jinglv.github.io/2025/09/18/ai/langchain/langgraph/6-langgraph-stream/</id>
    <published>2025-09-17T16:00:00.000Z</published>
    <updated>2025-09-18T09:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>LangGraphå¯¹æµå¼è¾“å‡ºè¿›è¡Œäº†æ”¹è¿›ï¼Œç»†åŒ–äº†è¾“å‡ºæ¨¡å¼ï¼ˆå¦‚Valuesã€Updatesã€Debugã€Messagesï¼‰ï¼Œæå‡ç”¨æˆ·ä½“éªŒå’Œè°ƒè¯•æ•ˆç‡ï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒAIåº”ç”¨ã€‚</p><p>æµå¼è¾“å‡ºé›†ä¸­æ¨¡å¼ï¼ˆstream_mode=â€â€ï¼‰</p><ul><li>valuesï¼šåœ¨å›¾è¡¨çš„æ¯ä¸ªæ­¥éª¤ä¹‹åä¼ è¾“çŠ¶æ€çš„å®Œæ•´å€¼</li><li>updatesï¼šå°†å›¾è¡¨æ¯ä¸€æ­¥ä¹‹åçš„æ›´æ–°æµå¼ä¼ è¾“åˆ°çŠ¶æ€</li><li>customï¼šä»å›¾å½¢èŠ‚ç‚¹å†…éƒ¨ä¼ è¾“è‡ªå®šä¹‰æ•°æ®</li><li>messagesï¼šä¸ºè°ƒç”¨LLMçš„å›¾å½¢èŠ‚ç‚¹ä¼ è¾“LLMä»¤ç‰Œå’Œå…ƒæ•°æ®</li><li>debugï¼šåœ¨å›¾è¡¨çš„æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸­ä¼ è¾“å°½å¯èƒ½å¤šçš„ä¿¡æ¯</li></ul><p>å®šä¹‰ä¸€ä¸ªå¸¸è§çš„å›¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    topic: <span class="built_in">str</span></span><br><span class="line">    joke: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">refine_topic</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;topic&quot;</span>: state[<span class="string">&quot;topic&quot;</span>] + <span class="string">&quot;å’Œå°ç‹—&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_joke</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;joke&quot;</span>: <span class="string">f&quot;è¿™æ˜¯ä¸€ä¸ªå…³äº<span class="subst">&#123;state[<span class="string">&#x27;topic&#x27;</span>]&#125;</span>çš„ç¬‘è¯&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph = (</span><br><span class="line">    StateGraph(State)</span><br><span class="line">    .add_node(refine_topic)</span><br><span class="line">    .add_node(generate_joke)</span><br><span class="line">    .add_edge(START, <span class="string">&quot;refine_topic&quot;</span>)</span><br><span class="line">    .add_edge(<span class="string">&quot;refine_topic&quot;</span>, <span class="string">&quot;generate_joke&quot;</span>)</span><br><span class="line">    .<span class="built_in">compile</span>()</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h1 id="stream-mode-â€valuesâ€"><a href="#stream-mode-â€valuesâ€" class="headerlink" title="stream_mode=â€valuesâ€"></a>stream_mode=â€valuesâ€</h1><p>åœ¨å›¾è¡¨çš„æ¯ä¸ªæ­¥éª¤ä¹‹åä¼ è¾“çŠ¶æ€çš„å®Œæ•´å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> graph.stream(</span><br><span class="line">    &#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;å†°æ¿€å‡Œ&quot;</span>&#125;,</span><br><span class="line">    stream_mode=<span class="string">&quot;values&quot;</span>,</span><br><span class="line">):</span><br><span class="line">    <span class="built_in">print</span>(chunk)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;topic&#x27;</span>: <span class="string">&#x27;å†°æ¿€å‡Œ&#x27;</span>&#125;</span><br><span class="line">&#123;<span class="string">&#x27;topic&#x27;</span>: <span class="string">&#x27;å†°æ¿€å‡Œå’Œå°ç‹—&#x27;</span>&#125;</span><br><span class="line">&#123;<span class="string">&#x27;topic&#x27;</span>: <span class="string">&#x27;å†°æ¿€å‡Œå’Œå°ç‹—&#x27;</span>, <span class="string">&#x27;joke&#x27;</span>: <span class="string">&#x27;è¿™æ˜¯ä¸€ä¸ªå…³äºå†°æ¿€å‡Œå’Œå°ç‹—çš„ç¬‘è¯&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h1 id="stream-mode-â€updatesâ€"><a href="#stream-mode-â€updatesâ€" class="headerlink" title="stream_mode=â€updatesâ€"></a>stream_mode=â€updatesâ€</h1><p>å°†å›¾è¡¨æ¯ä¸€æ­¥ä¹‹åçš„æ›´æ–°æµå¼ä¼ è¾“åˆ°çŠ¶æ€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> graph.stream(</span><br><span class="line">    &#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;å†°æ¿€å‡Œ&quot;</span>&#125;,</span><br><span class="line">    stream_mode=<span class="string">&quot;updates&quot;</span>,</span><br><span class="line">):</span><br><span class="line">    <span class="built_in">print</span>(chunk)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;refine_topic&#x27;</span>: &#123;<span class="string">&#x27;topic&#x27;</span>: <span class="string">&#x27;å†°æ¿€å‡Œå’Œå°ç‹—&#x27;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&#x27;generate_joke&#x27;</span>: &#123;<span class="string">&#x27;joke&#x27;</span>: <span class="string">&#x27;è¿™æ˜¯ä¸€ä¸ªå…³äºå†°æ¿€å‡Œå’Œå°ç‹—çš„ç¬‘è¯&#x27;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><h1 id="stream-mode-â€debugâ€"><a href="#stream-mode-â€debugâ€" class="headerlink" title="stream_mode=â€debugâ€"></a>stream_mode=â€debugâ€</h1><p>åœ¨å›¾è¡¨çš„æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸­ä¼ è¾“å°½å¯èƒ½å¤šçš„ä¿¡æ¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> graph.stream(</span><br><span class="line">    &#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;å†°æ¿€å‡Œ&quot;</span>&#125;,</span><br><span class="line">    stream_mode=<span class="string">&quot;debug&quot;</span>,</span><br><span class="line">):</span><br><span class="line">    <span class="built_in">print</span>(chunk)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;step&#x27;</span>: 1, <span class="string">&#x27;timestamp&#x27;</span>: <span class="string">&#x27;2025-09-18T08:51:31.478123+00:00&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;task&#x27;</span>, <span class="string">&#x27;payload&#x27;</span>: &#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;671c3949-69b8-8e90-b997-e76a1f711f5f&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;refine_topic&#x27;</span>, <span class="string">&#x27;input&#x27;</span>: &#123;<span class="string">&#x27;topic&#x27;</span>: <span class="string">&#x27;å†°æ¿€å‡Œ&#x27;</span>&#125;, <span class="string">&#x27;triggers&#x27;</span>: (<span class="string">&#x27;branch:to:refine_topic&#x27;</span>,)&#125;&#125;</span><br><span class="line">&#123;<span class="string">&#x27;step&#x27;</span>: 1, <span class="string">&#x27;timestamp&#x27;</span>: <span class="string">&#x27;2025-09-18T08:51:31.478680+00:00&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;task_result&#x27;</span>, <span class="string">&#x27;payload&#x27;</span>: &#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;671c3949-69b8-8e90-b997-e76a1f711f5f&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;refine_topic&#x27;</span>, <span class="string">&#x27;error&#x27;</span>: None, <span class="string">&#x27;result&#x27;</span>: [(<span class="string">&#x27;topic&#x27;</span>, <span class="string">&#x27;å†°æ¿€å‡Œå’Œå°ç‹—&#x27;</span>)], <span class="string">&#x27;interrupts&#x27;</span>: []&#125;&#125;</span><br><span class="line">&#123;<span class="string">&#x27;step&#x27;</span>: 2, <span class="string">&#x27;timestamp&#x27;</span>: <span class="string">&#x27;2025-09-18T08:51:31.478828+00:00&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;task&#x27;</span>, <span class="string">&#x27;payload&#x27;</span>: &#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;b7f1816a-7dab-4847-e8e6-78ae4d691a8e&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;generate_joke&#x27;</span>, <span class="string">&#x27;input&#x27;</span>: &#123;<span class="string">&#x27;topic&#x27;</span>: <span class="string">&#x27;å†°æ¿€å‡Œå’Œå°ç‹—&#x27;</span>&#125;, <span class="string">&#x27;triggers&#x27;</span>: (<span class="string">&#x27;branch:to:generate_joke&#x27;</span>,)&#125;&#125;</span><br><span class="line">&#123;<span class="string">&#x27;step&#x27;</span>: 2, <span class="string">&#x27;timestamp&#x27;</span>: <span class="string">&#x27;2025-09-18T08:51:31.479006+00:00&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;task_result&#x27;</span>, <span class="string">&#x27;payload&#x27;</span>: &#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;b7f1816a-7dab-4847-e8e6-78ae4d691a8e&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;generate_joke&#x27;</span>, <span class="string">&#x27;error&#x27;</span>: None, <span class="string">&#x27;result&#x27;</span>: [(<span class="string">&#x27;joke&#x27;</span>, <span class="string">&#x27;è¿™æ˜¯ä¸€ä¸ªå…³äºå†°æ¿€å‡Œå’Œå°ç‹—çš„ç¬‘è¯&#x27;</span>)], <span class="string">&#x27;interrupts&#x27;</span>: []&#125;&#125;</span><br></pre></td></tr></table></figure><h1 id="stream-mode-â€messagesâ€"><a href="#stream-mode-â€messagesâ€" class="headerlink" title="stream_mode=â€messagesâ€"></a>stream_mode=â€messagesâ€</h1><p>ä¸ºè°ƒç”¨LLMçš„å›¾å½¢èŠ‚ç‚¹ä¼ è¾“LLMä»¤ç‰Œå’Œå…ƒæ•°æ®</p><p>éœ€è¦æ¥å…¥å¤§æ¨¡å‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_deepseek <span class="keyword">import</span> ChatDeepSeek</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">llm = ChatDeepSeek(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    api_key=os.environ.get(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">    base_url=os.environ.get(<span class="string">&quot;DEEPSEEK_API_BASE&quot;</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_joke</span>(<span class="params">state: State</span>):</span><br><span class="line">    llm_response = llm.invoke(</span><br><span class="line">        [</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">f&quot;ç”Ÿæˆä¸€ä¸ªå…³äº <span class="subst">&#123;state[<span class="string">&#x27;topic&#x27;</span>]&#125;</span>çš„ç¬‘è¯&quot;</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;joke&quot;</span>: llm_response.content&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph = (</span><br><span class="line">    StateGraph(State)</span><br><span class="line">    .add_node(refine_topic)</span><br><span class="line">    .add_node(generate_joke)</span><br><span class="line">    .add_edge(START, <span class="string">&quot;refine_topic&quot;</span>)</span><br><span class="line">    .add_edge(<span class="string">&quot;refine_topic&quot;</span>, <span class="string">&quot;generate_joke&quot;</span>)</span><br><span class="line">    .<span class="built_in">compile</span>()</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> message_chunk, metadata <span class="keyword">in</span> graph.stream(</span><br><span class="line">    &#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;å†°æ¿€å‡Œ&quot;</span>&#125;,</span><br><span class="line">    stream_mode=<span class="string">&quot;messages&quot;</span>,</span><br><span class="line">):</span><br><span class="line">    <span class="keyword">if</span> message_chunk.content:</span><br><span class="line">        <span class="built_in">print</span>(message_chunk.content, end=<span class="string">&quot;|&quot;</span>, flush=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ(æµå¼è¾“å‡ºçš„)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å°ç‹—|èµ°è¿›|ä¸€å®¶|å†°|æ¿€|å‡Œ|åº—|ï¼Œ|åº—å‘˜|é—®|ï¼šâ€œ|æƒ³è¦|ä»€ä¹ˆ|å£|å‘³çš„|ï¼Ÿâ€</span><br><span class="line">|å°ç‹—|è¯´|ï¼šâ€œ|æ±ª|è‰|å‘³çš„|ï¼â€</span><br><span class="line">|åº—å‘˜|æ„£|ä½|ï¼šâ€œ|æŠ±æ­‰|â€¦|æˆ‘ä»¬æ²¡æœ‰|æ±ª|è‰|å£å‘³|ã€‚â€</span><br><span class="line">|å°ç‹—|å¹æ°”|ï¼šâ€œ|é‚£|å¥½å§|ï¼Œ|ç»™æˆ‘|ä¸€ä¸ª|â€˜|çˆªå­|â€™|é¥¼å¹²|ç­’|è£…|é¦™|è‰|å‘³|â€”â€”|ä½†|è®°ä½|ï¼Œ|è¿™æ¬¡|åˆ«|å†æŠŠ|æˆ‘çš„|çƒ|è—|è¿›|å†°|æ¿€|å‡Œ|é‡Œ|äº†|ï¼Œ|ä¸Šæ¬¡|æˆ‘|æŒ–|äº†|åŠå°æ—¶|ï¼â€|ğŸ¦|ğŸ¶|</span><br><span class="line"></span><br><span class="line">|ï¼ˆ|æ³¨|ï¼š|è°|éŸ³|æ¢—|ï¼š|æ±ª|è‰|=|é¦™|è‰|ï¼Œ|çˆªå­|=|ç”œ|ç­’|å“ç‰Œ|â€œ|å¯çˆ±|å¤š|â€|çš„|ç»å…¸|ç­’|èº«|è®¾è®¡|ï¼‰|</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å­¦ä¹ LangGraphå­¦ä¹ ç¬”è®°ç¬¬å…­è®²</summary>
    
    
    
    <category term="LangChain" scheme="https://jinglv.github.io/categories/LangChain/"/>
    
    
    <category term="LangGraph" scheme="https://jinglv.github.io/tags/LangGraph/"/>
    
  </entry>
  
  <entry>
    <title>LangGraphæ ¸å¿ƒç»„ä»¶æ—¶å…‰æ—…è¡Œ</title>
    <link href="https://jinglv.github.io/2025/09/18/ai/langchain/langgraph/5-langgraph-time-travel/"/>
    <id>https://jinglv.github.io/2025/09/18/ai/langchain/langgraph/5-langgraph-time-travel/</id>
    <published>2025-09-17T16:00:00.000Z</published>
    <updated>2025-09-18T07:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ—¶å…‰æ—…è¡Œï¼ˆTime Travelï¼‰åŠŸèƒ½é€šè¿‡çŠ¶æ€æœºç®¡ç†å®ç°æ•°æ®æµå›æº¯ä¸ä¿®æ”¹ï¼Œæ”¯æŒé‡æ”¾å’Œåˆ†å‰æ“ä½œã€‚é‡æ”¾å¯å›é¡¾æ™ºèƒ½ä½“æ‰§è¡Œæµç¨‹ï¼Œåˆ†å‰åˆ™å…è®¸åœ¨ç‰¹å®šèŠ‚ç‚¹æ›´æ”¹æ•°æ®å¹¶æ¢ç´¢æ›¿ä»£è·¯å¾„ï¼Œæå‡è°ƒè¯•ä¸ä¼˜åŒ–æ•ˆç‡ã€‚</p><ul><li>é‡æ”¾ï¼ˆReplayï¼‰<ul><li>åº”ç”¨åœºæ™¯ï¼šå¦‚å¤šæ­¥éª¤æ™ºèƒ½ä½“ä»»åŠ¡å›æº¯å’Œåˆ†äº«</li></ul></li><li>åˆ†å‰ï¼ˆForkï¼‰<ul><li>åº”ç”¨åœºæ™¯ï¼šå¦‚åœ¨ç‰¹å®šèŠ‚ç‚¹ä¿®æ”¹æµç¨‹è·¯å¾„</li></ul></li></ul><p>åŸºç¡€ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®å·¥å…·</span></span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> MessagesState, START</span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> END, StateGraph</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play_song_on_qq</span>(<span class="params">song: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åœ¨qqéŸ³ä¹ä¸Šæ’­æ”¾æ­Œæ›²&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># è°ƒç”¨QQéŸ³ä¹ API...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;æˆåŠŸåœ¨QQéŸ³ä¹ä¸Šæ’­æ”¾äº†<span class="subst">&#123;song&#125;</span>ï¼&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play_song_on_163</span>(<span class="params">song: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åœ¨ç½‘æ˜“äº‘ä¸Šæ’­æ”¾æ­Œæ›²&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># è°ƒç”¨ç½‘æ˜“äº‘ API...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;æˆåŠŸåœ¨ç½‘æ˜“äº‘ä¸Šæ’­æ”¾äº†<span class="subst">&#123;song&#125;</span>ï¼&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tools = [play_song_on_qq, play_song_on_163]</span><br><span class="line">tool_node = ToolNode(tools)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ¨¡å‹</span></span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">deepseek = ChatOpenAI(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    api_key=os.environ.get(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">    base_url=os.environ.get(<span class="string">&quot;DEEPSEEK_API_BASE&quot;</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">model = deepseek.bind_tools(tools, parallel_tool_calls=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰èŠ‚ç‚¹å’Œæ¡ä»¶è¾¹</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ç¡®å®šæ˜¯å¦ç»§ç»­çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">should_continue</span>(<span class="params">state</span>):</span><br><span class="line">    messages = state[<span class="string">&quot;messages&quot;</span>]</span><br><span class="line">    last_message = messages[-<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># å¦‚æœæ²¡æœ‰å‡½æ•°è°ƒç”¨ï¼Œåˆ™ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> last_message.tool_calls:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;end&quot;</span></span><br><span class="line">    <span class="comment"># å¦åˆ™å¦‚æœæœ‰ï¼Œæˆ‘ä»¬ç»§ç»­</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;continue&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰è°ƒç”¨æ¨¡å‹çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">call_model</span>(<span class="params">state</span>):</span><br><span class="line">    messages = state[<span class="string">&quot;messages&quot;</span>]</span><br><span class="line">    response = model.invoke(messages)</span><br><span class="line">    <span class="comment"># æˆ‘ä»¬è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå› ä¸ºè¿™å°†è¢«æ·»åŠ åˆ°ç°æœ‰åˆ—è¡¨ä¸­</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [response]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªæ–°å›¾</span></span><br><span class="line">workflow = StateGraph(MessagesState)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æˆ‘ä»¬å°†å¾ªç¯çš„ä¸¤ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">workflow.add_node(<span class="string">&quot;agent&quot;</span>, call_model)</span><br><span class="line">workflow.add_node(<span class="string">&quot;action&quot;</span>, tool_node)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å…¥å£ç‚¹è®¾ç½®ä¸º`agent`</span></span><br><span class="line"><span class="comment"># è¿™æ„å‘³ç€è¿™ä¸ªèŠ‚ç‚¹æ˜¯ç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„</span></span><br><span class="line">workflow.add_edge(START, <span class="string">&quot;agent&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç°åœ¨æ·»åŠ ä¸€ä¸ªæ¡ä»¶è¾¹</span></span><br><span class="line">workflow.add_conditional_edges(</span><br><span class="line">    <span class="comment"># é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰èµ·å§‹èŠ‚ç‚¹ã€‚æˆ‘ä»¬ä½¿ç”¨`agent`ã€‚</span></span><br><span class="line">    <span class="comment"># è¿™æ„å‘³ç€è¿™äº›æ˜¯åœ¨è°ƒç”¨`agent`èŠ‚ç‚¹åé‡‡å–çš„è¾¹ã€‚</span></span><br><span class="line">    <span class="string">&quot;agent&quot;</span>,</span><br><span class="line">    <span class="comment"># æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼ å…¥å°†ç¡®å®šä¸‹ä¸€ä¸ªè°ƒç”¨å“ªä¸ªèŠ‚ç‚¹çš„å‡½æ•°ã€‚</span></span><br><span class="line">    should_continue,</span><br><span class="line">    <span class="comment"># æœ€åæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªæ˜ å°„ã€‚</span></span><br><span class="line">    <span class="comment"># é”®æ˜¯å­—ç¬¦ä¸²ï¼Œå€¼æ˜¯å…¶ä»–èŠ‚ç‚¹ã€‚</span></span><br><span class="line">    <span class="comment"># ENDæ˜¯ä¸€ä¸ªç‰¹æ®ŠèŠ‚ç‚¹ï¼Œæ ‡è®°å›¾åº”è¯¥ç»“æŸã€‚</span></span><br><span class="line">    <span class="comment"># å°†ä¼šå‘ç”Ÿçš„æ˜¯æˆ‘ä»¬è°ƒç”¨`should_continue`ï¼Œç„¶åè¯¥å‡½æ•°çš„è¾“å‡º</span></span><br><span class="line">    <span class="comment"># å°†ä¸æ­¤æ˜ å°„ä¸­çš„é”®åŒ¹é…ã€‚</span></span><br><span class="line">    <span class="comment"># æ ¹æ®åŒ¹é…çš„é”®ï¼Œç„¶åè°ƒç”¨ç›¸åº”çš„èŠ‚ç‚¹ã€‚</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># å¦‚æœæ˜¯`tools`ï¼Œåˆ™è°ƒç”¨å·¥å…·èŠ‚ç‚¹ã€‚</span></span><br><span class="line">        <span class="string">&quot;continue&quot;</span>: <span class="string">&quot;action&quot;</span>,</span><br><span class="line">        <span class="comment"># å¦åˆ™æˆ‘ä»¬ç»“æŸã€‚</span></span><br><span class="line">        <span class="string">&quot;end&quot;</span>: END,</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç°åœ¨æˆ‘ä»¬ä»`tools`åˆ°`agent`æ·»åŠ ä¸€ä¸ªæ™®é€šè¾¹ã€‚</span></span><br><span class="line"><span class="comment"># è¿™æ„å‘³ç€åœ¨è°ƒç”¨`tools`ä¹‹åï¼Œä¸‹ä¸€æ­¥è°ƒç”¨`agent`èŠ‚ç‚¹ã€‚</span></span><br><span class="line">workflow.add_edge(<span class="string">&quot;action&quot;</span>, <span class="string">&quot;agent&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å†…å­˜</span></span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åï¼Œæˆ‘ä»¬ç¼–è¯‘å®ƒï¼</span></span><br><span class="line"><span class="comment"># è¿™å°†å®ƒç¼–è¯‘æˆä¸€ä¸ªLangChain Runnableï¼Œ</span></span><br><span class="line"><span class="comment"># æ„å‘³ç€ä½ å¯ä»¥åƒä½¿ç”¨ä»»ä½•å…¶ä»–runnableä¸€æ ·ä½¿ç”¨å®ƒ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬æ·»åŠ `interrupt_before=[&quot;action&quot;]`</span></span><br><span class="line"><span class="comment"># è¿™å°†åœ¨è°ƒç”¨`action`èŠ‚ç‚¹ä¹‹å‰æ·»åŠ ä¸€ä¸ªæ–­ç‚¹</span></span><br><span class="line">app = workflow.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›è¡Œç®€å•è°ƒç”¨ï¼Œè¦æ±‚æ’­æ”¾å‘¨æ°ä¼¦çš„æ­Œæ›²</span></span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage</span><br><span class="line"></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line">input_message = HumanMessage(content=<span class="string">&quot;ä½ èƒ½æ’­æ”¾ä¸€é¦–å‘¨æ°ä¼¦æ’­æ”¾é‡æœ€é«˜çš„æ­Œæ›²å—?&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> app.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è®°å½•å¹¶é‡æ”¾ï¼Œget_stateè·å–å½“å‰çš„çŠ¶æ€ï¼ŒæŸ¥çœ‹ä¿¡æ¯</span></span><br><span class="line">app.get_state(config).values[<span class="string">&quot;messages&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨get_state_historyå°†å†å²è®°å½•æ‰“å°å‡ºæ¥</span></span><br><span class="line">all_states = []</span><br><span class="line"><span class="keyword">for</span> state <span class="keyword">in</span> app.get_state_history(config):</span><br><span class="line">    <span class="built_in">print</span>(state)</span><br><span class="line">    all_states.append(state)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;--&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="é‡æ”¾"><a href="#é‡æ”¾" class="headerlink" title="é‡æ”¾"></a>é‡æ”¾</h1><p>æ ¹æ®ä»¥ä¸Šä»£ç æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›ä»»ä½•ä¸€ä¸ªçŠ¶æ€èŠ‚ç‚¹ï¼Œå¹¶ä»é‚£ä¸ªæ—¶å€™é‡æ–°å¼€å§‹æ“ä½œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">to_replay = all_states[<span class="number">2</span>] <span class="comment"># ä»ç¬¬äºŒçŠ¶æ€å¼€å§‹ï¼Œé‡æ–°æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">to_replay.values</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œä»€ä¹ˆ</span></span><br><span class="line">to_replay.<span class="built_in">next</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæƒ³ä»è¿™ä¸ªçŠ¶æ€èŠ‚ç‚¹é‡æ’­ï¼Œåªéœ€è¿™æ ·</span></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> app.stream(<span class="literal">None</span>, to_replay.config):</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> event.values():</span><br><span class="line">        <span class="built_in">print</span>(v)</span><br></pre></td></tr></table></figure><h1 id="åˆ†å‰"><a href="#åˆ†å‰" class="headerlink" title="åˆ†å‰"></a>åˆ†å‰</h1><p>æ ¹æ®é‡æ”¾ä¸­çš„ä»£ç ï¼Œä»æŸä¸ªèŠ‚ç‚¹å¼€å§‹ï¼Œå¯¹æ‰§è¡Œçš„æ•°æ®è¿›è¡Œåˆ†å‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹æœ€åä¸€ä¸ªæ¶ˆæ¯çš„å·¥å…·è°ƒç”¨</span></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å°†å…¶ä»`play_song_on_qq`æ›´æ”¹ä¸º`play_song_on_163`</span></span><br><span class="line">last_message = to_replay.values[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>]</span><br><span class="line">last_message.tool_calls[<span class="number">0</span>][<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;play_song_on_163&quot;</span></span><br><span class="line"></span><br><span class="line">branch_config = app.update_state(</span><br><span class="line">    to_replay.config,</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [last_message]&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶æ•´ä¸ªå›¾çš„æµå°±è¿›è¡Œäº†åˆ†å‰å¤„ç†</span></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> app.stream(<span class="literal">None</span>, branch_config):</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> event.values():</span><br><span class="line">        <span class="built_in">print</span>(v)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å­¦ä¹ LangGraphå­¦ä¹ ç¬”è®°ç¬¬äº”è®²</summary>
    
    
    
    <category term="LangChain" scheme="https://jinglv.github.io/categories/LangChain/"/>
    
    
    <category term="LangGraph" scheme="https://jinglv.github.io/tags/LangGraph/"/>
    
  </entry>
  
  <entry>
    <title>LangGraphæ ¸å¿ƒç»„ä»¶å·¥å…·è°ƒç”¨</title>
    <link href="https://jinglv.github.io/2025/09/18/ai/langchain/langgraph/7-langgraph-tools/"/>
    <id>https://jinglv.github.io/2025/09/18/ai/langchain/langgraph/7-langgraph-tools/</id>
    <published>2025-09-17T16:00:00.000Z</published>
    <updated>2025-09-18T09:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>Langgraphæ ¸å¿ƒç»„ä»¶ä¸­çš„å·¥å…·è°ƒç”¨åˆ†ä¸ºå››æ­¥ï¼šå®šä¹‰å·¥å…·ã€ç»‘å®šå·¥å…·ã€ç”Ÿæˆå·¥å…·è°ƒç”¨ï¼ˆ2coinï¼‰å’Œæ‰§è¡Œå·¥å…·ã€‚é€šè¿‡æ‹†è§£è¿‡ç¨‹ï¼Œç”¨æˆ·å¯å¹²é¢„æ¯ä¸ªæ­¥éª¤ï¼Œå°¤å…¶åœ¨å¤šæ™ºèƒ½ä½“æ¨¡å¼ä¸‹ï¼Œå¯åŠ å…¥äººå·¥èŠ‚ç‚¹æ£€æŸ¥è°ƒç”¨å‡†ç¡®æ€§ï¼Œæå‡å·¥å…·ä½¿ç”¨çš„çµæ´»æ€§ä¸æ§åˆ¶åŠ›ã€‚</p><p>ä»å·¥å…·æ‰§è¡Œæµç¨‹å›¾çœ‹</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250918170343628.png" alt="image-20250918170343628" style="zoom:67%;" /></p><p>æœ‰ä»¥ä¸‹å››æ­¥ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼šä½¿ç”¨@toolä¿®é¥°ç¬¦åˆ›å»ºå·¥å…·</li><li>ç¬¬äºŒæ­¥ï¼šç»‘å®šå·¥å…·åˆ°æ¨¡å‹ï¼ˆæ³¨æ„ï¼šå¹¶ä¸æ˜¯æ‰€æœ‰å¤§æ¨¡å‹éƒ½æ”¯æŒå·¥å…·ç»‘å®šï¼‰</li><li>ç¬¬ä¸‰æ­¥ï¼šå·¥å…·è°ƒç”¨ï¼šå°†è‡ªç„¶è¯­è¨€è½¬ä¸ºæ­£ç¡®çš„å‚æ•°</li><li>ç¬¬å››æ­¥ï¼šå·¥å…·æ‰§è¡Œï¼šå°†å·¥å…·æ‰§è¡Œå¹¶å°†ç»“æœä¼ é€’ç»™ä¸‹ä¸€æ­¥</li></ul><p>æ ¹æ®ä»¥ä¸Šè¯´æ˜ï¼Œä¸‹é¢æ ¹æ®è¿™å››æ­¥è¿›è¡Œä»£ç ç¤ºä¾‹</p><h1 id="ç¬¬ä¸€æ­¥ï¼šå·¥å…·å®šä¹‰"><a href="#ç¬¬ä¸€æ­¥ï¼šå·¥å…·å®šä¹‰" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå·¥å…·å®šä¹‰"></a>ç¬¬ä¸€æ­¥ï¼šå·¥å…·å®šä¹‰</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode</span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_weather</span>(<span class="params">location: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è°ƒç”¨æ­¤å‡½æ•°è·å–å½“å‰å¤©æ°”ã€‚&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> location.lower() <span class="keyword">in</span> [<span class="string">&quot;åŒ—äº¬&quot;</span>, <span class="string">&quot;æ·±åœ³&quot;</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ç°åœ¨æ˜¯20åº¦ï¼Œæœ‰é›¾ã€‚&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ç°åœ¨æ˜¯10åº¦ï¼Œæ™´æœ—ã€‚&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_coolest_cities</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è·å–æœ€å†·åŸå¸‚åˆ—è¡¨&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;åŒ—äº¬ï¼Œå“ˆå°”æ»¨&quot;</span></span><br><span class="line"></span><br><span class="line">tools = [get_weather, get_coolest_cities]</span><br><span class="line">tool_node = ToolNode(tools) <span class="comment"># ToolNodeæ˜¯langgraphä¸­è¿è¡Œå·¥å…·çš„èŠ‚ç‚¹</span></span><br></pre></td></tr></table></figure><p>langgraphæä¾›äº†ä½å±‚é¢çš„å°è£…ï¼Œå¯ä»¥ç›´æ¥æ‰‹åŠ¨æ‰§è¡Œå·¥å…·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> AIMessage</span><br><span class="line"></span><br><span class="line">message_with_single_tool_call = AIMessage(</span><br><span class="line">    content=<span class="string">&quot;&quot;</span>,</span><br><span class="line">    tool_calls=[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;get_weather&quot;</span>,</span><br><span class="line">            <span class="string">&quot;args&quot;</span>: &#123;<span class="string">&quot;location&quot;</span>: <span class="string">&quot;åŒ—äº¬&quot;</span>&#125;,</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="string">&quot;tool_call_id&quot;</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;tool_call&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">tool_node.invoke(&#123;<span class="string">&quot;messages&quot;</span>: [message_with_single_tool_call]&#125;)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;messages&#x27;</span>: [ToolMessage(content=<span class="string">&#x27;ç°åœ¨æ˜¯20åº¦ï¼Œæœ‰é›¾ã€‚&#x27;</span>, name=<span class="string">&#x27;get_weather&#x27;</span>, tool_call_id=<span class="string">&#x27;tool_call_id&#x27;</span>)]&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬äºŒæ­¥ï¼šå·¥å…·ç»‘å®š"><a href="#ç¬¬äºŒæ­¥ï¼šå·¥å…·ç»‘å®š" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šå·¥å…·ç»‘å®š"></a>ç¬¬äºŒæ­¥ï¼šå·¥å…·ç»‘å®š</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_deepseek <span class="keyword">import</span> ChatDeepSeek</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model_with_tools = ChatDeepSeek(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    api_key=os.environ.get(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">    base_url=os.environ.get(<span class="string">&quot;DEEPSEEK_API_BASE&quot;</span>),</span><br><span class="line">).bind_tools(tools)</span><br><span class="line"></span><br><span class="line">model_with_tools.invoke(<span class="string">&quot;æ·±åœ³çš„å¤©æ°”å¦‚ä½•?&quot;</span>).tool_calls</span><br></pre></td></tr></table></figure><h1 id="ç¬¬ä¸‰æ­¥ï¼šå·¥å…·è°ƒç”¨"><a href="#ç¬¬ä¸‰æ­¥ï¼šå·¥å…·è°ƒç”¨" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šå·¥å…·è°ƒç”¨"></a>ç¬¬ä¸‰æ­¥ï¼šå·¥å…·è°ƒç”¨</h1><p>è¿”å›ToolMessage</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tool_node.invoke(&#123;<span class="string">&quot;messages&quot;</span>: [model_with_tools.invoke(<span class="string">&quot;æ·±åœ³çš„å¤©æ°”å¦‚ä½•?&quot;</span>)]&#125;)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;messages&#x27;</span>: [ToolMessage(content=<span class="string">&#x27;ç°åœ¨æ˜¯20åº¦ï¼Œæœ‰é›¾ã€‚&#x27;</span>, name=<span class="string">&#x27;get_weather&#x27;</span>, tool_call_id=<span class="string">&#x27;call_00_0vppp9Iy24ryGv9a89hsxVHk&#x27;</span>)]&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬å››æ­¥ï¼šå·¥å…·æ‰§è¡Œ"><a href="#ç¬¬å››æ­¥ï¼šå·¥å…·æ‰§è¡Œ" class="headerlink" title="ç¬¬å››æ­¥ï¼šå·¥å…·æ‰§è¡Œ"></a>ç¬¬å››æ­¥ï¼šå·¥å…·æ‰§è¡Œ</h1><p>åœ¨ReActæ™ºèƒ½ä½“ä¸­æ‰§è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, MessagesState, START, END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">should_continue</span>(<span class="params">state: MessagesState</span>):</span><br><span class="line">    messages = state[<span class="string">&quot;messages&quot;</span>]</span><br><span class="line">    last_message = messages[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> last_message.tool_calls:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;tools&quot;</span></span><br><span class="line">    <span class="keyword">return</span> END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">call_model</span>(<span class="params">state: MessagesState</span>):</span><br><span class="line">    messages = state[<span class="string">&quot;messages&quot;</span>]</span><br><span class="line">    response = model_with_tools.invoke(messages)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [response]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">workflow = StateGraph(MessagesState)</span><br><span class="line"></span><br><span class="line">workflow.add_node(<span class="string">&quot;agent&quot;</span>, call_model)</span><br><span class="line">workflow.add_node(<span class="string">&quot;tools&quot;</span>, tool_node) <span class="comment"># Add the tool node to the graph</span></span><br><span class="line"></span><br><span class="line">workflow.add_edge(START, <span class="string">&quot;agent&quot;</span>)</span><br><span class="line">workflow.add_conditional_edges(<span class="string">&quot;agent&quot;</span>, should_continue, [<span class="string">&quot;tools&quot;</span>, END])</span><br><span class="line">workflow.add_edge(<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;agent&quot;</span>)</span><br><span class="line"></span><br><span class="line">app = workflow.<span class="built_in">compile</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image, display</span><br><span class="line"></span><br><span class="line">display(Image(app.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ„æˆçš„å›¾</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250918172526485.png" alt="image-20250918172526485"></p><p>æ‰§è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> app.stream(</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;human&quot;</span>, <span class="string">&quot;æ·±åœ³çš„å¤©æ°”å¦‚ä½•?&quot;</span>)]&#125;, stream_mode=<span class="string">&quot;values&quot;</span></span><br><span class="line">):</span><br><span class="line">    chunk[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">æ·±åœ³çš„å¤©æ°”å¦‚ä½•?</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">æˆ‘æ¥å¸®æ‚¨æŸ¥è¯¢æ·±åœ³çš„å¤©æ°”æƒ…å†µã€‚</span><br><span class="line">Tool Calls:</span><br><span class="line">  get_weather (call_00_a1KyKFbzutzxaD52Q9BHy4ep)</span><br><span class="line"> Call ID: call_00_a1KyKFbzutzxaD52Q9BHy4ep</span><br><span class="line">  Args:</span><br><span class="line">    location: æ·±åœ³</span><br><span class="line">================================= Tool Message =================================</span><br><span class="line">Name: get_weather</span><br><span class="line"></span><br><span class="line">ç°åœ¨æ˜¯20åº¦ï¼Œæœ‰é›¾ã€‚</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">æ ¹æ®æŸ¥è¯¢ç»“æœï¼Œæ·±åœ³ç›®å‰çš„å¤©æ°”æƒ…å†µæ˜¯ï¼š</span><br><span class="line">- æ¸©åº¦ï¼š20Â°C</span><br><span class="line">- å¤©æ°”çŠ¶å†µï¼šæœ‰é›¾</span><br><span class="line"></span><br><span class="line">è¿™æ ·çš„å¤©æ°”æ¯”è¾ƒæ½®æ¹¿ï¼Œå»ºè®®æ‚¨å¤–å‡ºæ—¶æ³¨æ„å®‰å…¨ï¼Œèƒ½è§åº¦å¯èƒ½è¾ƒä½ã€‚</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å­¦ä¹ LangGraphå­¦ä¹ ç¬”è®°ç¬¬ä¸ƒè®²</summary>
    
    
    
    <category term="LangChain" scheme="https://jinglv.github.io/categories/LangChain/"/>
    
    
    <category term="LangGraph" scheme="https://jinglv.github.io/tags/LangGraph/"/>
    
  </entry>
  
  <entry>
    <title>LangGraphæ ¸å¿ƒç»„ä»¶äººæœºäº¤äº’</title>
    <link href="https://jinglv.github.io/2025/09/18/ai/langchain/langgraph/4-langgraph-human-ai/"/>
    <id>https://jinglv.github.io/2025/09/18/ai/langchain/langgraph/4-langgraph-human-ai/</id>
    <published>2025-09-17T16:00:00.000Z</published>
    <updated>2025-09-18T01:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¼ºè°ƒåœ¨AIç³»ç»Ÿä¸­åŠ å…¥äººå·¥å®¡æ ¸ç¯èŠ‚ä»¥æå‡ç³»ç»Ÿæˆç†Ÿåº¦å’Œç¨³å®šæ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨å¯¹é”™è¯¯å®¹å¿åº¦ä½çš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡äººå·¥å®¡æ‰¹ã€çŠ¶æ€ç¼–è¾‘ã€å·¥å…·è°ƒç”¨å®¡æŸ¥ç­‰æ–¹å¼ä¿éšœå†³ç­–æ­£ç¡®æ€§ä¸ç³»ç»Ÿå®‰å…¨ã€‚</p><ul><li>å®¡æŸ¥å·¥å…·è°ƒç”¨æƒ…å†µï¼ˆæ˜¯å¦æ­£ç¡®ç­‰ï¼‰</li><li>å®¡æŸ¥å’ŒéªŒè¯LLMè¾“å‡º</li><li>äººå·¥æä¾›æ›´å¥½çš„ä¸Šä¸‹æ–‡èƒŒæ™¯</li></ul><p>äººæœºäº¤äº’çš„åœºæ™¯ï¼š</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250918090250968.png" alt="image-20250918090250968"></p><h1 id="åŸºæœ¬è¿ç”¨ï¼šç­‰å¾…ç”¨æˆ·æ•°æ®"><a href="#åŸºæœ¬è¿ç”¨ï¼šç­‰å¾…ç”¨æˆ·æ•°æ®" class="headerlink" title="åŸºæœ¬è¿ç”¨ï¼šç­‰å¾…ç”¨æˆ·æ•°æ®"></a>åŸºæœ¬è¿ç”¨ï¼šç­‰å¾…ç”¨æˆ·æ•°æ®</h1><p>ç­‰å¾…ç”¨æˆ·è¾“å…¥çš„æœ¬è´¨æ˜¯åœ¨èŠ‚ç‚¹é—´å¢åŠ äººç±»åé¦ˆèŠ‚ç‚¹ï¼Œå®šä¹‰åŒ…å«inputå’Œuser feedbackå±æ€§çš„çŠ¶æ€å¯¹è±¡ï¼Œå¼•å…¥interruptç»„ä»¶æ¥æ‰“æ–­æµç¨‹å¹¶ç­‰å¾…ç”¨æˆ·åé¦ˆï¼Œé€šè¿‡Commandç»„ä»¶æ¢å¤è¢«æ‰“æ–­çš„æµç¨‹</p><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START, END</span><br><span class="line"><span class="keyword">from</span> langgraph.types <span class="keyword">import</span> interrupt</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image, display</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰èŠ‚ç‚¹é—´é€šè®¯çš„æ¶ˆæ¯ç±»å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    <span class="built_in">input</span>: <span class="built_in">str</span></span><br><span class="line">    user_feedback: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step_1</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---Step 1---&quot;</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æˆ·åé¦ˆèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">human_feedback</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---human_feedback---&quot;</span>)</span><br><span class="line">    feedback = interrupt(<span class="string">&quot;Please provide feedback:&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;user_feedback&quot;</span>: feedback&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step_3</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---Step 3---&quot;</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">builder = StateGraph(State)</span><br><span class="line">builder.add_node(<span class="string">&quot;step_1&quot;</span>, step_1)</span><br><span class="line">builder.add_node(<span class="string">&quot;human_feedback&quot;</span>, human_feedback)</span><br><span class="line">builder.add_node(<span class="string">&quot;step_3&quot;</span>, step_3)</span><br><span class="line">builder.add_edge(START, <span class="string">&quot;step_1&quot;</span>)</span><br><span class="line">builder.add_edge(<span class="string">&quot;step_1&quot;</span>, <span class="string">&quot;human_feedback&quot;</span>)</span><br><span class="line">builder.add_edge(<span class="string">&quot;human_feedback&quot;</span>, <span class="string">&quot;step_3&quot;</span>)</span><br><span class="line">builder.add_edge(<span class="string">&quot;step_3&quot;</span>, END)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾è®¡è®°å¿†å†…å­˜</span></span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›¾çš„ç¼–è¯‘</span></span><br><span class="line">graph = builder.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</span></span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨</span></span><br><span class="line"><span class="comment"># Input</span></span><br><span class="line">initial_input = &#123;<span class="string">&quot;input&quot;</span>: <span class="string">&quot;ä½ å¥½&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Thread</span></span><br><span class="line">thread = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run the graph until the first interruption</span></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(initial_input, thread, stream_mode=<span class="string">&quot;updates&quot;</span>):</span><br><span class="line">    <span class="built_in">print</span>(event)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># æ·»åŠ humanåé¦ˆ</span></span><br><span class="line"><span class="keyword">from</span> langgraph.types <span class="keyword">import</span> Command</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(</span><br><span class="line">    <span class="comment"># äººç±»åé¦ˆå†…å®¹ï¼šresume=&quot;go to step 3!&quot;</span></span><br><span class="line">    Command(resume=<span class="string">&quot;go to step 3!&quot;</span>), thread, stream_mode=<span class="string">&quot;updates&quot;</span></span><br><span class="line">):</span><br><span class="line">    <span class="built_in">print</span>(event)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure><p>åœ¨æ™ºèƒ½ä½“ä¸­å¼•å…¥äººå·¥ä»‹å…¥ç¯èŠ‚ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> ToolMessage</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image, display</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> MessagesState, START, END, StateGraph</span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"><span class="keyword">from</span> langchain_deepseek <span class="keyword">import</span> ChatDeepSeek</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 1. è®¾ç½®çŠ¶æ€ ---</span></span><br><span class="line"><span class="comment"># MessagesState æ˜¯ä¸€ä¸ªå†…ç½®çš„çŠ¶æ€ç±»å‹ï¼Œå®ƒç®€å•åœ°å°†æ‰€æœ‰æ¶ˆæ¯ç´¯åŠ èµ·æ¥ã€‚</span></span><br><span class="line"><span class="comment"># è¿™å¯¹äºå¤§å¤šæ•°èŠå¤©æœºå™¨äººåº”ç”¨æ¥è¯´éƒ½éå¸¸æ–¹ä¾¿ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 2. è®¾ç½®å·¥å…· ---</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">query: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è°ƒç”¨æ­¤å‡½æ•°æ¥æµè§ˆç½‘ç»œä»¥æŸ¥æ‰¾ä¿¡æ¯ã€‚&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># è¿™æ˜¯ä¸€ä¸ªå®é™…å·¥å…·å®ç°çš„å ä½ç¬¦</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;---æ­£åœ¨æ‰§è¡Œæœç´¢: <span class="subst">&#123;query&#125;</span>---&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;æˆ‘æŸ¥è¯¢äº†ï¼š<span class="subst">&#123;query&#125;</span>ã€‚ç»“æœï¼šåŒ—äº¬å¤©æ°”æ™´æœ—ï¼Œæ¸©åº¦25åº¦ã€‚&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å°†æœ‰ä¸€ä¸ªçœŸå®å·¥å…·å’Œä¸€ä¸ª&quot;å‡&quot;å·¥å…·&quot;ask_human&quot;</span></span><br><span class="line">tools = [search]</span><br><span class="line">tool_node = ToolNode(tools)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬ä¸º&quot;ask_human&quot;å·¥å…·å®šä¹‰ä¸€ä¸ªPydanticæ¨¡å‹ï¼Œä»¥ä¾¿æ¨¡å‹çŸ¥é“å®ƒçš„ç­¾å</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AskHuman</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å½“ä½ éœ€è¦ç”¨æˆ·çš„æ¾„æ¸…æˆ–é¢å¤–ä¿¡æ¯æ—¶ï¼Œè°ƒç”¨æ­¤å·¥å…·å‘äººç±»æé—®ã€‚&quot;&quot;&quot;</span></span><br><span class="line">    question: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 3. è®¾ç½®æ¨¡å‹ ---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–æ¨¡å‹</span></span><br><span class="line">model = ChatDeepSeek(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    api_key=os.environ.get(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">    base_url=os.environ.get(<span class="string">&quot;DEEPSEEK_API_BASE&quot;</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ‰€æœ‰å·¥å…·ï¼ˆçœŸå®çš„å’Œæ¨¡æ‹Ÿçš„ï¼‰ç»‘å®šåˆ°æ¨¡å‹ä¸Š</span></span><br><span class="line">model = model.bind_tools(tools + [AskHuman])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 4. å®šä¹‰å›¾çš„èŠ‚ç‚¹å’Œè¾¹ ---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰è°ƒç”¨æ¨¡å‹çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">call_model</span>(<span class="params">state: MessagesState</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---è°ƒç”¨å¤§æ¨¡å‹---&quot;</span>)</span><br><span class="line">    messages = state[<span class="string">&quot;messages&quot;</span>]</span><br><span class="line">    response = model.invoke(messages)</span><br><span class="line">    <span class="comment"># æˆ‘ä»¬è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå› ä¸ºè¿™å°†è¢«æ·»åŠ åˆ°ç°æœ‰åˆ—è¡¨ä¸­</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [response]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹æ¥å¤„ç†&quot;ask_human&quot;å·¥å…·è°ƒç”¨</span></span><br><span class="line"><span class="comment"># è¿™ä¸ªèŠ‚ç‚¹ä¼šæš‚åœæµç¨‹å¹¶ç­‰å¾…ç”¨æˆ·è¾“å…¥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">interrupt</span>(<span class="params">question: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œç”¨äºåœ¨å‘½ä»¤è¡Œä¸­æš‚åœå¹¶å‘ç”¨æˆ·æé—®ã€‚&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n[éœ€è¦äººç±»è¾“å…¥] é—®é¢˜: <span class="subst">&#123;question&#125;</span>&quot;</span>)</span><br><span class="line">    answer = <span class="built_in">input</span>(<span class="string">&quot;ä½ çš„å›ç­”: &quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> answer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ask_human</span>(<span class="params">state: MessagesState</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---ç­‰å¾…äººç±»è¾“å…¥---&quot;</span>)</span><br><span class="line">    <span class="comment"># è·å–æœ€åä¸€æ¡æ¶ˆæ¯ä¸­çš„å·¥å…·è°ƒç”¨ä¿¡æ¯</span></span><br><span class="line">    last_message = state[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>]</span><br><span class="line">    tool_call = last_message.tool_calls[<span class="number">0</span>]</span><br><span class="line">    tool_call_id = tool_call[<span class="string">&quot;id&quot;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è§£æå·¥å…·è°ƒç”¨çš„å‚æ•°</span></span><br><span class="line">    ask_args = AskHuman.model_validate(tool_call[<span class="string">&quot;args&quot;</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è°ƒç”¨interruptå‡½æ•°æš‚åœå¹¶è·å–ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">    user_response = interrupt(ask_args.question)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°†ç”¨æˆ·çš„å›ç­”æ„é€ æˆä¸€ä¸ªToolMessage</span></span><br><span class="line">    tool_message = ToolMessage(content=user_response, tool_call_id=tool_call_id)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [tool_message]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># â˜…â˜…â˜… ä¿®æ”¹ç‚¹ 1: ä¿®æ”¹æ¡ä»¶å‡½æ•° â˜…â˜…â˜…</span></span><br><span class="line"><span class="comment"># å®šä¹‰å†³å®šæµç¨‹èµ°å‘çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">should_continue</span>(<span class="params">state: MessagesState</span>):</span><br><span class="line">    last_message = state[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¦‚æœæ¨¡å‹æ²¡æœ‰è¿›è¡Œå·¥å…·è°ƒç”¨ï¼Œåˆ™æµç¨‹ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> last_message.tool_calls:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;__end__&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¦‚æœæ¨¡å‹è°ƒç”¨çš„æ˜¯ &quot;AskHuman&quot; å·¥å…·</span></span><br><span class="line">    <span class="keyword">if</span> last_message.tool_calls[<span class="number">0</span>][<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;AskHuman&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ask_human&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¦åˆ™ï¼Œæ‰§è¡Œå¸¸è§„å·¥å…·è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;action&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 5. æ„å»ºå›¾ ---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªæ–°å›¾</span></span><br><span class="line">workflow = StateGraph(MessagesState)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æˆ‘ä»¬å°†å¾ªç¯çš„èŠ‚ç‚¹</span></span><br><span class="line">workflow.add_node(<span class="string">&quot;agent&quot;</span>, call_model)</span><br><span class="line">workflow.add_node(<span class="string">&quot;action&quot;</span>, tool_node)</span><br><span class="line">workflow.add_node(<span class="string">&quot;ask_human&quot;</span>, ask_human)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å…¥å£ç‚¹</span></span><br><span class="line">workflow.add_edge(START, <span class="string">&quot;agent&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># â˜…â˜…â˜… ä¿®æ”¹ç‚¹ 2: æ·»åŠ æ˜¾å¼çš„è·¯å¾„æ˜ å°„ â˜…â˜…â˜…</span></span><br><span class="line"><span class="comment"># æ·»åŠ æ¡ä»¶è¾¹ï¼Œè¿™æ˜¯å›¾çš„æ ¸å¿ƒé€»è¾‘</span></span><br><span class="line">workflow.add_conditional_edges(</span><br><span class="line">    <span class="string">&quot;agent&quot;</span>,</span><br><span class="line">    should_continue,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;action&quot;</span>: <span class="string">&quot;action&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ask_human&quot;</span>: <span class="string">&quot;ask_human&quot;</span>,</span><br><span class="line">        <span class="string">&quot;__end__&quot;</span>: END,</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ ä»å·¥å…·æ‰§è¡ŒèŠ‚ç‚¹è¿”å›åˆ°agentèŠ‚ç‚¹çš„è¾¹</span></span><br><span class="line">workflow.add_edge(<span class="string">&quot;action&quot;</span>, <span class="string">&quot;agent&quot;</span>)</span><br><span class="line"><span class="comment"># æ·»åŠ ä»äººç±»è¾“å…¥èŠ‚ç‚¹è¿”å›åˆ°agentèŠ‚ç‚¹çš„è¾¹</span></span><br><span class="line">workflow.add_edge(<span class="string">&quot;ask_human&quot;</span>, <span class="string">&quot;agent&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å†…å­˜æ£€æŸ¥ç‚¹</span></span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘å›¾ï¼Œä½¿å…¶æˆä¸ºå¯è¿è¡Œçš„åº”ç”¨</span></span><br><span class="line">app = workflow.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 6. å¯è§†åŒ–å’Œè¿è¡Œ ---</span></span><br><span class="line">display(Image(app.get_graph().draw_mermaid_png()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨</span></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªçº¿ç¨‹IDï¼Œç”¨äºä¿æŒå¯¹è¯çŠ¶æ€</span></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;2&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> app.stream(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;messages&quot;</span>: [</span><br><span class="line">            (</span><br><span class="line">                <span class="string">&quot;user&quot;</span>,</span><br><span class="line">                <span class="string">&quot;è¯¢é—®ç”¨æˆ·ä»–ä»¬åœ¨å“ªé‡Œï¼Œç„¶åæŸ¥è¯¢é‚£é‡Œçš„å¤©æ°”&quot;</span>,</span><br><span class="line">            )</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    config,</span><br><span class="line">    stream_mode=<span class="string">&quot;values&quot;</span>,</span><br><span class="line">):</span><br><span class="line">    event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šä¼šå‡ºç°ä¸€ä¸ªè¾“å…¥ç”¨æˆ·åŒºåŸŸåœ°æ–¹ï¼Œç„¶åç­‰å¾…è¾“å…¥ï¼Œè¾“å…¥ä¿¡æ¯åæ‰ä¼šè¿›è¡Œæ¥ç»­å†…å®¹ï¼Œè¾“å…¥å†…å®¹ï¼šæˆ‘åœ¨åŒ—äº¬</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250918100254757.png" alt="image-20250918100254757"></p><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">---Step 1---</span><br><span class="line">&#123;<span class="string">&#x27;step_1&#x27;</span>: None&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---human_feedback---</span><br><span class="line">&#123;<span class="string">&#x27;__interrupt__&#x27;</span>: (Interrupt(value=<span class="string">&#x27;Please provide feedback:&#x27;</span>, <span class="built_in">id</span>=<span class="string">&#x27;e8b5902129c677d43844e5aff7857cc4&#x27;</span>),)&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---human_feedback---</span><br><span class="line">&#123;<span class="string">&#x27;human_feedback&#x27;</span>: &#123;<span class="string">&#x27;user_feedback&#x27;</span>: <span class="string">&#x27;go to step 3!&#x27;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---Step 3---</span><br><span class="line">&#123;<span class="string">&#x27;step_3&#x27;</span>: None&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">è¯¢é—®ç”¨æˆ·ä»–ä»¬åœ¨å“ªé‡Œï¼Œç„¶åæŸ¥è¯¢é‚£é‡Œçš„å¤©æ°”</span><br><span class="line">---è°ƒç”¨å¤§æ¨¡å‹---</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  AskHuman (call_00_TpzUc16Jdly70xacNN1qq9PW)</span><br><span class="line"> Call ID: call_00_TpzUc16Jdly70xacNN1qq9PW</span><br><span class="line">  Args:</span><br><span class="line">    question: è¯·é—®æ‚¨åœ¨å“ªé‡Œï¼Ÿæˆ‘æƒ³ä¸ºæ‚¨æŸ¥è¯¢å½“åœ°çš„å¤©æ°”ä¿¡æ¯ã€‚</span><br><span class="line">---ç­‰å¾…äººç±»è¾“å…¥---</span><br><span class="line"></span><br><span class="line">[éœ€è¦äººç±»è¾“å…¥] é—®é¢˜: è¯·é—®æ‚¨åœ¨å“ªé‡Œï¼Ÿæˆ‘æƒ³ä¸ºæ‚¨æŸ¥è¯¢å½“åœ°çš„å¤©æ°”ä¿¡æ¯ã€‚</span><br><span class="line">================================= Tool Message =================================</span><br><span class="line"></span><br><span class="line">æˆ‘åœ¨åŒ—äº¬</span><br><span class="line">---è°ƒç”¨å¤§æ¨¡å‹---</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  search (call_00_RlGPZ0yP4eioQByUs8rzdZe2)</span><br><span class="line"> Call ID: call_00_RlGPZ0yP4eioQByUs8rzdZe2</span><br><span class="line">  Args:</span><br><span class="line">    query: åŒ—äº¬å¤©æ°”</span><br><span class="line">---æ­£åœ¨æ‰§è¡Œæœç´¢: åŒ—äº¬å¤©æ°”---</span><br><span class="line">================================= Tool Message =================================</span><br><span class="line">...</span><br><span class="line">- å¤©æ°”çŠ¶å†µï¼šæ™´æœ—</span><br><span class="line">- æ¸©åº¦ï¼š25åº¦</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯ä¸€ä¸ªç›¸å½“å®œäººçš„å¤©æ°”ï¼Œé€‚åˆå¤–å‡ºæ´»åŠ¨ï¼</span><br></pre></td></tr></table></figure><h1 id="åŸºæœ¬è¿ç”¨ï¼šå®¡æŸ¥å·¥å…·è°ƒç”¨"><a href="#åŸºæœ¬è¿ç”¨ï¼šå®¡æŸ¥å·¥å…·è°ƒç”¨" class="headerlink" title="åŸºæœ¬è¿ç”¨ï¼šå®¡æŸ¥å·¥å…·è°ƒç”¨"></a>åŸºæœ¬è¿ç”¨ï¼šå®¡æŸ¥å·¥å…·è°ƒç”¨</h1><p>é€šè¿‡äººæœºåä½œå®¡æŸ¥æ™ºèƒ½ä½“çš„å·¥å…·è°ƒç”¨ï¼ŒåŒ…æ‹¬è®¾ç½®å®¡æŸ¥èŠ‚ç‚¹ã€åˆ¤æ–­äººç±»åé¦ˆã€æ‰§è¡Œå·¥å…·åŠç»“æœæ’å…¥ï¼Œå¹¶å±•ç¤ºäº†åœ¨ä¸åŒåé¦ˆï¼ˆç»§ç»­ã€æ›´æ–°ã€åé¦ˆï¼‰ä¸‹æµç¨‹çš„å¯¼èˆªä¸å¤„ç†æ–¹å¼ã€‚</p><p>æ ¹æ®ä¸åŒçš„äººç±»åé¦ˆï¼ˆcontinueã€updateã€feedbackï¼‰å¯¼èˆªè‡³ä¸åŒèŠ‚ç‚¹ã€‚</p><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict, <span class="type">Literal</span></span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START, END, MessagesState</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"><span class="keyword">from</span> langgraph.types <span class="keyword">import</span> Command, interrupt</span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> AIMessage</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image, display</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">weather_search</span>(<span class="params">city: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æœç´¢å¤©æ°”&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ­£åœ¨æœç´¢ï¼š<span class="subst">&#123;city&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æ™´æœ—ï¼&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ¨¡å‹</span></span><br><span class="line"><span class="keyword">from</span> langchain_deepseek <span class="keyword">import</span> ChatDeepSeek</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">deepseek = ChatDeepSeek(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    api_key=os.environ.get(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">    base_url=os.environ.get(<span class="string">&quot;DEEPSEEK_API_BASE&quot;</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">model = deepseek.bind_tools(</span><br><span class="line">    [weather_search]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">MessagesState</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç®€å•çŠ¶æ€ã€‚&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">call_llm</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [model.invoke(state[<span class="string">&quot;messages&quot;</span>])]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">human_review_node</span>(<span class="params">state</span>) -&gt; Command[<span class="type">Literal</span>[<span class="string">&quot;call_llm&quot;</span>, <span class="string">&quot;run_tool&quot;</span>]]:</span><br><span class="line">    last_message = state[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>]</span><br><span class="line">    tool_call = last_message.tool_calls[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™æ˜¯æˆ‘ä»¬å°†é€šè¿‡Command(resume=&lt;human_review&gt;)æä¾›çš„å€¼</span></span><br><span class="line">    human_review = interrupt(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;question&quot;</span>: <span class="string">&quot;è¿™æ˜¯æ­£ç¡®çš„å—ï¼Ÿ&quot;</span>,</span><br><span class="line">            <span class="comment"># æ˜¾ç¤ºå·¥å…·è°ƒç”¨ä»¥ä¾›å®¡æ ¸</span></span><br><span class="line">            <span class="string">&quot;tool_call&quot;</span>: tool_call,</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    review_action = human_review[<span class="string">&quot;action&quot;</span>]</span><br><span class="line">    review_data = human_review.get(<span class="string">&quot;data&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœæ‰¹å‡†ï¼Œè°ƒç”¨å·¥å…·</span></span><br><span class="line">    <span class="keyword">if</span> review_action == <span class="string">&quot;continue&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> Command(goto=<span class="string">&quot;run_tool&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ›´æ–°AIæ¶ˆæ¯å¹¶è°ƒç”¨å·¥å…·</span></span><br><span class="line">    <span class="keyword">elif</span> review_action == <span class="string">&quot;update&quot;</span>:</span><br><span class="line">        updated_message = &#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;ai&quot;</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: last_message.content,</span><br><span class="line">            <span class="string">&quot;tool_calls&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;id&quot;</span>: tool_call[<span class="string">&quot;id&quot;</span>],</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: tool_call[<span class="string">&quot;name&quot;</span>],</span><br><span class="line">                    <span class="comment"># è¿™æ˜¯äººç±»æä¾›çš„æ›´æ–°</span></span><br><span class="line">                    <span class="string">&quot;args&quot;</span>: review_data,</span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="comment"># è¿™å¾ˆé‡è¦ - è¿™éœ€è¦ä¸ä½ æ›¿æ¢çš„æ¶ˆæ¯ç›¸åŒï¼</span></span><br><span class="line">            <span class="comment"># å¦åˆ™ï¼Œå®ƒå°†æ˜¾ç¤ºä¸ºä¸€ä¸ªå•ç‹¬çš„æ¶ˆæ¯</span></span><br><span class="line">            <span class="string">&quot;id&quot;</span>: last_message.<span class="built_in">id</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Command(goto=<span class="string">&quot;run_tool&quot;</span>, update=&#123;<span class="string">&quot;messages&quot;</span>: [updated_message]&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å‘LLMæä¾›åé¦ˆ</span></span><br><span class="line">    <span class="keyword">elif</span> review_action == <span class="string">&quot;feedback&quot;</span>:</span><br><span class="line">        <span class="comment"># æ³¨æ„ï¼šæˆ‘ä»¬å°†åé¦ˆæ¶ˆæ¯æ·»åŠ ä¸ºToolMessage</span></span><br><span class="line">        <span class="comment"># ä»¥ä¿æŒæ¶ˆæ¯å†å²ä¸­çš„æ­£ç¡®é¡ºåº</span></span><br><span class="line">        <span class="comment"># ï¼ˆå¸¦æœ‰å·¥å…·è°ƒç”¨çš„AIæ¶ˆæ¯éœ€è¦åè·Ÿå·¥å…·è°ƒç”¨æ¶ˆæ¯ï¼‰</span></span><br><span class="line">        tool_message = &#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;tool&quot;</span>,</span><br><span class="line">            <span class="comment"># è¿™æ˜¯æˆ‘ä»¬çš„è‡ªç„¶è¯­è¨€åé¦ˆ</span></span><br><span class="line">            <span class="string">&quot;content&quot;</span>: review_data,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: tool_call[<span class="string">&quot;name&quot;</span>],</span><br><span class="line">            <span class="string">&quot;tool_call_id&quot;</span>: tool_call[<span class="string">&quot;id&quot;</span>],</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Command(goto=<span class="string">&quot;call_llm&quot;</span>, update=&#123;<span class="string">&quot;messages&quot;</span>: [tool_message]&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾—åˆ°å·¥å…·çš„å…è®¸ç»“æœï¼Œç„¶åæ’å…¥åˆ°æ¶ˆæ¯é‡Œé¢å»</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_tool</span>(<span class="params">state</span>):</span><br><span class="line">    new_messages = []</span><br><span class="line">    tools = &#123;<span class="string">&quot;weather_search&quot;</span>: weather_search&#125;</span><br><span class="line">    tool_calls = state[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].tool_calls</span><br><span class="line">    <span class="keyword">for</span> tool_call <span class="keyword">in</span> tool_calls:</span><br><span class="line">        tool = tools[tool_call[<span class="string">&quot;name&quot;</span>]]</span><br><span class="line">        result = tool.invoke(tool_call[<span class="string">&quot;args&quot;</span>])</span><br><span class="line">        new_messages.append(</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;role&quot;</span>: <span class="string">&quot;tool&quot;</span>,</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: tool_call[<span class="string">&quot;name&quot;</span>],</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: result,</span><br><span class="line">                <span class="string">&quot;tool_call_id&quot;</span>: tool_call[<span class="string">&quot;id&quot;</span>],</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: new_messages&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">route_after_llm</span>(<span class="params">state</span>) -&gt; <span class="type">Literal</span>[END, <span class="string">&quot;human_review_node&quot;</span>]:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(state[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].tool_calls) == <span class="number">0</span>: <span class="comment"># æ‹¿åˆ°æœ€æ–°ä¸€æ¡æ•°æ®çš„tool_calls</span></span><br><span class="line">        <span class="keyword">return</span> END</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;human_review_node&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">builder = StateGraph(State)</span><br><span class="line">builder.add_node(call_llm)</span><br><span class="line">builder.add_node(run_tool)</span><br><span class="line">builder.add_node(human_review_node)</span><br><span class="line">builder.add_edge(START, <span class="string">&quot;call_llm&quot;</span>)</span><br><span class="line">builder.add_conditional_edges(<span class="string">&quot;call_llm&quot;</span>, route_after_llm)</span><br><span class="line">builder.add_edge(<span class="string">&quot;run_tool&quot;</span>, <span class="string">&quot;call_llm&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å†…å­˜</span></span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ </span></span><br><span class="line">graph = builder.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</span></span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250918100530221.png" alt="image-20250918100530221"></p><ul><li><p>å½“ä¸æ¶‰åŠå·¥å…·è°ƒç”¨çš„æ—¶å€™ï¼Œä¸ä¼šè§¦å‘äººå·¥å®¡æ ¸</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Input</span></span><br><span class="line">initial_input = &#123;<span class="string">&quot;messages&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;ä½ å¥½ï¼&quot;</span>&#125;]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Thread</span></span><br><span class="line">thread = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(initial_input, thread, stream_mode=<span class="string">&quot;updates&quot;</span>):</span><br><span class="line">    <span class="built_in">print</span>(event)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;call_llm&#x27;</span>: &#123;<span class="string">&#x27;messages&#x27;</span>: [AIMessage(content=<span class="string">&#x27;ä½ å¥½ï¼å¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ã€‚æˆ‘å¯ä»¥å¸®æ‚¨æŸ¥è¯¢å¤©æ°”ä¿¡æ¯ï¼Œå¦‚æœæ‚¨éœ€è¦äº†è§£æŸä¸ªåŸå¸‚çš„å¤©æ°”æƒ…å†µï¼Œè¯·å‘Šè¯‰æˆ‘åŸå¸‚åç§°ï¼Œæˆ‘ä¼šä¸ºæ‚¨æŸ¥è¯¢æœ€æ–°çš„å¤©æ°”ä¿¡æ¯ã€‚&#x27;</span>, additional_kwargs=&#123;<span class="string">&#x27;refusal&#x27;</span>: None&#125;, response_metadata=&#123;<span class="string">&#x27;token_usage&#x27;</span>: &#123;<span class="string">&#x27;completion_tokens&#x27;</span>: 33, <span class="string">&#x27;prompt_tokens&#x27;</span>: 144, <span class="string">&#x27;total_tokens&#x27;</span>: 177, <span class="string">&#x27;completion_tokens_details&#x27;</span>: None, <span class="string">&#x27;prompt_tokens_details&#x27;</span>: &#123;<span class="string">&#x27;audio_tokens&#x27;</span>: None, <span class="string">&#x27;cached_tokens&#x27;</span>: 0&#125;, <span class="string">&#x27;prompt_cache_hit_tokens&#x27;</span>: 0, <span class="string">&#x27;prompt_cache_miss_tokens&#x27;</span>: 144&#125;, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;deepseek-chat&#x27;</span>, <span class="string">&#x27;system_fingerprint&#x27;</span>: <span class="string">&#x27;fp_08f168e49b_prod0820_fp8_kvcache&#x27;</span>, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;d95943e0-85bc-4aae-a037-393a500e8c7a&#x27;</span>, <span class="string">&#x27;service_tier&#x27;</span>: None, <span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;stop&#x27;</span>, <span class="string">&#x27;logprobs&#x27;</span>: None&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run--b490a400-5a86-403d-b459-3d972a6b1474-0&#x27;</span>, usage_metadata=&#123;<span class="string">&#x27;input_tokens&#x27;</span>: 144, <span class="string">&#x27;output_tokens&#x27;</span>: 33, <span class="string">&#x27;total_tokens&#x27;</span>: 177, <span class="string">&#x27;input_token_details&#x27;</span>: &#123;<span class="string">&#x27;cache_read&#x27;</span>: 0&#125;, <span class="string">&#x27;output_token_details&#x27;</span>: &#123;&#125;&#125;)]&#125;&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>ä¸€æ—¦æ¶‰åŠåˆ°å·¥å…·è°ƒç”¨ å°±ä¼šè§¦å‘äººå·¥ä»‹å…¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Inputï¼Œæé—®åˆ°å¤©æ°”ç›¸å…³çš„é—®é¢˜</span></span><br><span class="line">initial_input = &#123;<span class="string">&quot;messages&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;åŒ—äº¬çš„å¤©æ°”å¦‚ä½•?&quot;</span>&#125;]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Thread</span></span><br><span class="line">thread = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;2&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(initial_input, thread, stream_mode=<span class="string">&quot;updates&quot;</span>):</span><br><span class="line">    <span class="built_in">print</span>(event)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;call_llm&#x27;</span>: &#123;<span class="string">&#x27;messages&#x27;</span>: [AIMessage(content=<span class="string">&#x27;æˆ‘æ¥å¸®æ‚¨æŸ¥è¯¢åŒ—äº¬çš„å¤©æ°”æƒ…å†µã€‚&#x27;</span>, additional_kwargs=&#123;<span class="string">&#x27;tool_calls&#x27;</span>: [&#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;call_00_nrZyXDGPbp73qAdYJ7IpMxHv&#x27;</span>, <span class="string">&#x27;function&#x27;</span>: &#123;<span class="string">&#x27;arguments&#x27;</span>: <span class="string">&#x27;&#123;&quot;city&quot;: &quot;\\u5317\\u4eac&quot;&#125;&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;weather_search&#x27;</span>&#125;, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;function&#x27;</span>, <span class="string">&#x27;index&#x27;</span>: 0&#125;], <span class="string">&#x27;refusal&#x27;</span>: None&#125;, response_metadata=&#123;<span class="string">&#x27;token_usage&#x27;</span>: &#123;<span class="string">&#x27;completion_tokens&#x27;</span>: 27, <span class="string">&#x27;prompt_tokens&#x27;</span>: 146, <span class="string">&#x27;total_tokens&#x27;</span>: 173, <span class="string">&#x27;completion_tokens_details&#x27;</span>: None, <span class="string">&#x27;prompt_tokens_details&#x27;</span>: &#123;<span class="string">&#x27;audio_tokens&#x27;</span>: None, <span class="string">&#x27;cached_tokens&#x27;</span>: 128&#125;, <span class="string">&#x27;prompt_cache_hit_tokens&#x27;</span>: 128, <span class="string">&#x27;prompt_cache_miss_tokens&#x27;</span>: 18&#125;, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;deepseek-chat&#x27;</span>, <span class="string">&#x27;system_fingerprint&#x27;</span>: <span class="string">&#x27;fp_08f168e49b_prod0820_fp8_kvcache&#x27;</span>, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;03bd6516-9777-4042-b4ed-02ea6d6d004f&#x27;</span>, <span class="string">&#x27;service_tier&#x27;</span>: None, <span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;tool_calls&#x27;</span>, <span class="string">&#x27;logprobs&#x27;</span>: None&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run--b4693d60-2881-4ab6-9e96-4670276ec95a-0&#x27;</span>, tool_calls=[&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;weather_search&#x27;</span>, <span class="string">&#x27;args&#x27;</span>: &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;åŒ—äº¬&#x27;</span>&#125;, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;call_00_nrZyXDGPbp73qAdYJ7IpMxHv&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;tool_call&#x27;</span>&#125;], usage_metadata=&#123;<span class="string">&#x27;input_tokens&#x27;</span>: 146, <span class="string">&#x27;output_tokens&#x27;</span>: 27, <span class="string">&#x27;total_tokens&#x27;</span>: 173, <span class="string">&#x27;input_token_details&#x27;</span>: &#123;<span class="string">&#x27;cache_read&#x27;</span>: 128&#125;, <span class="string">&#x27;output_token_details&#x27;</span>: &#123;&#125;&#125;)]&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;__interrupt__&#x27;</span>: (Interrupt(value=&#123;<span class="string">&#x27;question&#x27;</span>: <span class="string">&#x27;è¿™æ˜¯æ­£ç¡®çš„å—ï¼Ÿ&#x27;</span>, <span class="string">&#x27;tool_call&#x27;</span>: &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;weather_search&#x27;</span>, <span class="string">&#x27;args&#x27;</span>: &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;åŒ—äº¬&#x27;</span>&#125;, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;call_00_nrZyXDGPbp73qAdYJ7IpMxHv&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;tool_call&#x27;</span>&#125;&#125;, <span class="built_in">id</span>=<span class="string">&#x27;183597080f78b79c566b124a34223821&#x27;</span>),)&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Commandè¿›è¡Œäººæœºäº¤äº’</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langgraph.types <span class="keyword">import</span> Command</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(</span><br><span class="line">    <span class="comment"># è¾“å…¥å€¼</span></span><br><span class="line">    Command(resume=&#123;<span class="string">&quot;action&quot;</span>: <span class="string">&quot;continue&quot;</span>&#125;),</span><br><span class="line">    thread,</span><br><span class="line">    stream_mode=<span class="string">&quot;updates&quot;</span>,</span><br><span class="line">):</span><br><span class="line">    <span class="built_in">print</span>(event)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;human_review_node&#x27;</span>: None&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----</span><br><span class="line">æ­£åœ¨æœç´¢ï¼šåŒ—äº¬</span><br><span class="line">----</span><br><span class="line">&#123;<span class="string">&#x27;run_tool&#x27;</span>: &#123;<span class="string">&#x27;messages&#x27;</span>: [&#123;<span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;tool&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;weather_search&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;æ™´æœ—ï¼&#x27;</span>, <span class="string">&#x27;tool_call_id&#x27;</span>: <span class="string">&#x27;call_00_nrZyXDGPbp73qAdYJ7IpMxHv&#x27;</span>&#125;]&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;call_llm&#x27;</span>: &#123;<span class="string">&#x27;messages&#x27;</span>: [AIMessage(content=<span class="string">&#x27;æ ¹æ®æŸ¥è¯¢ç»“æœï¼ŒåŒ—äº¬ç›®å‰çš„å¤©æ°”æ˜¯æ™´æœ—çš„ï¼å¤©æ°”çŠ¶å†µå¾ˆå¥½ï¼Œé€‚åˆå¤–å‡ºæ´»åŠ¨ã€‚&#x27;</span>, additional_kwargs=&#123;<span class="string">&#x27;refusal&#x27;</span>: None&#125;, response_metadata=&#123;<span class="string">&#x27;token_usage&#x27;</span>: &#123;<span class="string">&#x27;completion_tokens&#x27;</span>: 19, <span class="string">&#x27;prompt_tokens&#x27;</span>: 172, <span class="string">&#x27;total_tokens&#x27;</span>: 191, <span class="string">&#x27;completion_tokens_details&#x27;</span>: None, <span class="string">&#x27;prompt_tokens_details&#x27;</span>: &#123;<span class="string">&#x27;audio_tokens&#x27;</span>: None, <span class="string">&#x27;cached_tokens&#x27;</span>: 128&#125;, <span class="string">&#x27;prompt_cache_hit_tokens&#x27;</span>: 128, <span class="string">&#x27;prompt_cache_miss_tokens&#x27;</span>: 44&#125;, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;deepseek-chat&#x27;</span>, <span class="string">&#x27;system_fingerprint&#x27;</span>: <span class="string">&#x27;fp_08f168e49b_prod0820_fp8_kvcache&#x27;</span>, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;cd0943c6-f6d0-4228-aa4e-2be23df3a798&#x27;</span>, <span class="string">&#x27;service_tier&#x27;</span>: None, <span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;stop&#x27;</span>, <span class="string">&#x27;logprobs&#x27;</span>: None&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run--d5f3dae7-d3f1-4ee5-98e3-98abc54e7071-0&#x27;</span>, usage_metadata=&#123;<span class="string">&#x27;input_tokens&#x27;</span>: 172, <span class="string">&#x27;output_tokens&#x27;</span>: 19, <span class="string">&#x27;total_tokens&#x27;</span>: 191, <span class="string">&#x27;input_token_details&#x27;</span>: &#123;<span class="string">&#x27;cache_read&#x27;</span>: 128&#125;, <span class="string">&#x27;output_token_details&#x27;</span>: &#123;&#125;&#125;)]&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>æ›´è¿›ä¸€æ­¥ï¼Œå¯¹æ™ºèƒ½ä½“è°ƒç”¨çš„å·¥å…·è¿›è¡Œå‚æ•°ç¼–è¾‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Input</span></span><br><span class="line">initial_input = &#123;<span class="string">&quot;messages&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;æ·±åœ³çš„å¤©æ°”å¦‚ä½•?&quot;</span>&#125;]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Thread</span></span><br><span class="line">thread = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;3&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(initial_input, thread, stream_mode=<span class="string">&quot;updates&quot;</span>):</span><br><span class="line">    <span class="built_in">print</span>(event)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;call_llm&#x27;</span>: &#123;<span class="string">&#x27;messages&#x27;</span>: [AIMessage(content=<span class="string">&#x27;æˆ‘æ¥å¸®æ‚¨æŸ¥è¯¢æ·±åœ³çš„å¤©æ°”æƒ…å†µã€‚&#x27;</span>, additional_kwargs=&#123;<span class="string">&#x27;tool_calls&#x27;</span>: [&#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;call_00_VFXEbMl2mMOo0WXRr3BdKjWP&#x27;</span>, <span class="string">&#x27;function&#x27;</span>: &#123;<span class="string">&#x27;arguments&#x27;</span>: <span class="string">&#x27;&#123;&quot;city&quot;: &quot;\\u6df1\\u5733&quot;&#125;&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;weather_search&#x27;</span>&#125;, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;function&#x27;</span>, <span class="string">&#x27;index&#x27;</span>: 0&#125;], <span class="string">&#x27;refusal&#x27;</span>: None&#125;, response_metadata=&#123;<span class="string">&#x27;token_usage&#x27;</span>: &#123;<span class="string">&#x27;completion_tokens&#x27;</span>: 28, <span class="string">&#x27;prompt_tokens&#x27;</span>: 147, <span class="string">&#x27;total_tokens&#x27;</span>: 175, <span class="string">&#x27;completion_tokens_details&#x27;</span>: None, <span class="string">&#x27;prompt_tokens_details&#x27;</span>: &#123;<span class="string">&#x27;audio_tokens&#x27;</span>: None, <span class="string">&#x27;cached_tokens&#x27;</span>: 128&#125;, <span class="string">&#x27;prompt_cache_hit_tokens&#x27;</span>: 128, <span class="string">&#x27;prompt_cache_miss_tokens&#x27;</span>: 19&#125;, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;deepseek-chat&#x27;</span>, <span class="string">&#x27;system_fingerprint&#x27;</span>: <span class="string">&#x27;fp_08f168e49b_prod0820_fp8_kvcache&#x27;</span>, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;b944f986-9c42-4d99-ac66-1e90ac5d8514&#x27;</span>, <span class="string">&#x27;service_tier&#x27;</span>: None, <span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;tool_calls&#x27;</span>, <span class="string">&#x27;logprobs&#x27;</span>: None&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run--2d7d12ff-727e-4649-a735-44aac3346a5b-0&#x27;</span>, tool_calls=[&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;weather_search&#x27;</span>, <span class="string">&#x27;args&#x27;</span>: &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;æ·±åœ³&#x27;</span>&#125;, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;call_00_VFXEbMl2mMOo0WXRr3BdKjWP&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;tool_call&#x27;</span>&#125;], usage_metadata=&#123;<span class="string">&#x27;input_tokens&#x27;</span>: 147, <span class="string">&#x27;output_tokens&#x27;</span>: 28, <span class="string">&#x27;total_tokens&#x27;</span>: 175, <span class="string">&#x27;input_token_details&#x27;</span>: &#123;<span class="string">&#x27;cache_read&#x27;</span>: 128&#125;, <span class="string">&#x27;output_token_details&#x27;</span>: &#123;&#125;&#125;)]&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;__interrupt__&#x27;</span>: (Interrupt(value=&#123;<span class="string">&#x27;question&#x27;</span>: <span class="string">&#x27;è¿™æ˜¯æ­£ç¡®çš„å—ï¼Ÿ&#x27;</span>, <span class="string">&#x27;tool_call&#x27;</span>: &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;weather_search&#x27;</span>, <span class="string">&#x27;args&#x27;</span>: &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;æ·±åœ³&#x27;</span>&#125;, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;call_00_VFXEbMl2mMOo0WXRr3BdKjWP&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;tool_call&#x27;</span>&#125;&#125;, <span class="built_in">id</span>=<span class="string">&#x27;0f55d9ce7b22cdd30d7d25afd89223ae&#x27;</span>),)&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›´æ¥å¯¹å·¥å…·çš„å‚æ•°è¿›è¡Œç¼–è¾‘</span></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(</span><br><span class="line">    Command(resume=&#123;<span class="string">&quot;action&quot;</span>: <span class="string">&quot;update&quot;</span>, <span class="string">&quot;data&quot;</span>: &#123;<span class="string">&quot;city&quot;</span>: <span class="string">&quot;ä¸Šæµ·,ä¸­å›½&quot;</span>&#125;&#125;),</span><br><span class="line">    thread,</span><br><span class="line">    stream_mode=<span class="string">&quot;updates&quot;</span>,</span><br><span class="line">):</span><br><span class="line">    <span class="built_in">print</span>(event)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;human_review_node&#x27;</span>: &#123;<span class="string">&#x27;messages&#x27;</span>: [&#123;<span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;ai&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;æˆ‘æ¥å¸®æ‚¨æŸ¥è¯¢æ·±åœ³çš„å¤©æ°”æƒ…å†µã€‚&#x27;</span>, <span class="string">&#x27;tool_calls&#x27;</span>: [&#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;call_00_VFXEbMl2mMOo0WXRr3BdKjWP&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;weather_search&#x27;</span>, <span class="string">&#x27;args&#x27;</span>: &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;ä¸Šæµ·,ä¸­å›½&#x27;</span>&#125;&#125;], <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;run--2d7d12ff-727e-4649-a735-44aac3346a5b-0&#x27;</span>&#125;]&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----</span><br><span class="line">æ­£åœ¨æœç´¢ï¼šä¸Šæµ·,ä¸­å›½</span><br><span class="line">----</span><br><span class="line">&#123;<span class="string">&#x27;run_tool&#x27;</span>: &#123;<span class="string">&#x27;messages&#x27;</span>: [&#123;<span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;tool&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;weather_search&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;æ™´æœ—ï¼&#x27;</span>, <span class="string">&#x27;tool_call_id&#x27;</span>: <span class="string">&#x27;call_00_VFXEbMl2mMOo0WXRr3BdKjWP&#x27;</span>&#125;]&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;call_llm&#x27;</span>: &#123;<span class="string">&#x27;messages&#x27;</span>: [AIMessage(content=<span class="string">&#x27;è®©æˆ‘é‡æ–°æŸ¥è¯¢æ·±åœ³çš„å¤©æ°”ï¼š&#x27;</span>, additional_kwargs=&#123;<span class="string">&#x27;tool_calls&#x27;</span>: [&#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;call_00_eY6qquS2SjREeAhv2oD2Q9hL&#x27;</span>, <span class="string">&#x27;function&#x27;</span>: &#123;<span class="string">&#x27;arguments&#x27;</span>: <span class="string">&#x27;&#123;&quot;city&quot;: &quot;æ·±åœ³&quot;&#125;&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;weather_search&#x27;</span>&#125;, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;function&#x27;</span>, <span class="string">&#x27;index&#x27;</span>: 0&#125;], <span class="string">&#x27;refusal&#x27;</span>: None&#125;, response_metadata=&#123;<span class="string">&#x27;token_usage&#x27;</span>: &#123;<span class="string">&#x27;completion_tokens&#x27;</span>: 20, <span class="string">&#x27;prompt_tokens&#x27;</span>: 176, <span class="string">&#x27;total_tokens&#x27;</span>: 196, <span class="string">&#x27;completion_tokens_details&#x27;</span>: None, <span class="string">&#x27;prompt_tokens_details&#x27;</span>: &#123;<span class="string">&#x27;audio_tokens&#x27;</span>: None, <span class="string">&#x27;cached_tokens&#x27;</span>: 128&#125;, <span class="string">&#x27;prompt_cache_hit_tokens&#x27;</span>: 128, <span class="string">&#x27;prompt_cache_miss_tokens&#x27;</span>: 48&#125;, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;deepseek-chat&#x27;</span>, <span class="string">&#x27;system_fingerprint&#x27;</span>: <span class="string">&#x27;fp_08f168e49b_prod0820_fp8_kvcache&#x27;</span>, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;73984e27-0ca3-421b-9d35-348907eabdf3&#x27;</span>, <span class="string">&#x27;service_tier&#x27;</span>: None, <span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;tool_calls&#x27;</span>, <span class="string">&#x27;logprobs&#x27;</span>: None&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run--ae52f621-4c85-4e13-95a4-673939846f23-0&#x27;</span>, tool_calls=[&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;weather_search&#x27;</span>, <span class="string">&#x27;args&#x27;</span>: &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;æ·±åœ³&#x27;</span>&#125;, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;call_00_eY6qquS2SjREeAhv2oD2Q9hL&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;tool_call&#x27;</span>&#125;], usage_metadata=&#123;<span class="string">&#x27;input_tokens&#x27;</span>: 176, <span class="string">&#x27;output_tokens&#x27;</span>: 20, <span class="string">&#x27;total_tokens&#x27;</span>: 196, <span class="string">&#x27;input_token_details&#x27;</span>: &#123;<span class="string">&#x27;cache_read&#x27;</span>: 128&#125;, <span class="string">&#x27;output_token_details&#x27;</span>: &#123;&#125;&#125;)]&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;__interrupt__&#x27;</span>: (Interrupt(value=&#123;<span class="string">&#x27;question&#x27;</span>: <span class="string">&#x27;è¿™æ˜¯æ­£ç¡®çš„å—ï¼Ÿ&#x27;</span>, <span class="string">&#x27;tool_call&#x27;</span>: &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;weather_search&#x27;</span>, <span class="string">&#x27;args&#x27;</span>: &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;æ·±åœ³&#x27;</span>&#125;, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;call_00_eY6qquS2SjREeAhv2oD2Q9hL&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;tool_call&#x27;</span>&#125;&#125;, <span class="built_in">id</span>=<span class="string">&#x27;5d83228c73ed5e60fe886c76117d2402&#x27;</span>),)&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h1 id="åŸºæœ¬ä½¿ç”¨ï¼šç¼–è¾‘å›¾çš„çŠ¶æ€"><a href="#åŸºæœ¬ä½¿ç”¨ï¼šç¼–è¾‘å›¾çš„çŠ¶æ€" class="headerlink" title="åŸºæœ¬ä½¿ç”¨ï¼šç¼–è¾‘å›¾çš„çŠ¶æ€"></a>åŸºæœ¬ä½¿ç”¨ï¼šç¼–è¾‘å›¾çš„çŠ¶æ€</h1><p>é€šè¿‡è®¾ç½®ä¸­æ–­ç‚¹å’Œäººå·¥å¹²é¢„ï¼Œå¯ä»¥åœ¨æµç¨‹æ‰§è¡Œä¸­ä¿®æ”¹çŠ¶æ€å€¼ï¼Œå®ç°å¯¹æ™ºèƒ½ä½“å·¥å…·é€‰æ‹©æˆ–åŠ¨ä½œçš„å®¡æ ¸ç¼–è¾‘ã€‚</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250918101102384.png" alt="image-20250918101102384" style="zoom:50%;" /></p><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START, END</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image, display</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    <span class="built_in">input</span>: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step_1</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---Step 1---&quot;</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step_2</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---Step 2---&quot;</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step_3</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---Step 3---&quot;</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">builder = StateGraph(State)</span><br><span class="line">builder.add_node(<span class="string">&quot;step_1&quot;</span>, step_1)</span><br><span class="line">builder.add_node(<span class="string">&quot;step_2&quot;</span>, step_2)</span><br><span class="line">builder.add_node(<span class="string">&quot;step_3&quot;</span>, step_3)</span><br><span class="line">builder.add_edge(START, <span class="string">&quot;step_1&quot;</span>)</span><br><span class="line">builder.add_edge(<span class="string">&quot;step_1&quot;</span>, <span class="string">&quot;step_2&quot;</span>)</span><br><span class="line">builder.add_edge(<span class="string">&quot;step_2&quot;</span>, <span class="string">&quot;step_3&quot;</span>)</span><br><span class="line">builder.add_edge(<span class="string">&quot;step_3&quot;</span>, END)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up memory</span></span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add æ³¨æ„interrupt_before</span></span><br><span class="line">graph = builder.<span class="built_in">compile</span>(checkpointer=memory, interrupt_before=[<span class="string">&quot;step_2&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># View</span></span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨</span></span><br><span class="line"><span class="comment"># Input</span></span><br><span class="line">initial_input = &#123;<span class="string">&quot;input&quot;</span>: <span class="string">&quot;ä½ å¥½&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Thread</span></span><br><span class="line">thread = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run the graph until the first interruption</span></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(initial_input, thread, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    <span class="built_in">print</span>(event)</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250918101243460.png" alt="image-20250918101243460"></p><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;input&#x27;</span>: <span class="string">&#x27;ä½ å¥½&#x27;</span>&#125;</span><br><span class="line">---Step 1---</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œåˆ°èŠ‚ç‚¹Step 1ï¼Œå°±ä¸­æ–­äº†ï¼Œåœ¨ä»£ç ä¸­ä½¿ç”¨interrupt_beforeå¯¹Step 2è®¾ç½®äº†æ–­ç‚¹ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥è¿›è¡Œäººå·¥å¹²é¢„ï¼Œæ›´æ–°æµçŠ¶æ€å¹¶ä¼ å…¥æ–°å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph.update_state(thread, &#123;<span class="string">&quot;input&quot;</span>: <span class="string">&quot;ä½ å¥½ everybody!&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;---\n---\nUpdated state!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(graph.get_state(thread).values)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">---</span><br><span class="line">Updated state!</span><br><span class="line">&#123;<span class="string">&#x27;input&#x27;</span>: <span class="string">&#x27;ä½ å¥½ everybody!&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(<span class="literal">None</span>, thread, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    <span class="built_in">print</span>(event)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;input&#x27;</span>: <span class="string">&#x27;ä½ å¥½ everybody!&#x27;</span>&#125;</span><br><span class="line">---Step 2---</span><br><span class="line">---Step 3---</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å­¦ä¹ LangGraphå­¦ä¹ ç¬”è®°ç¬¬å››è®²</summary>
    
    
    
    <category term="LangChain" scheme="https://jinglv.github.io/categories/LangChain/"/>
    
    
    <category term="LangGraph" scheme="https://jinglv.github.io/tags/LangGraph/"/>
    
  </entry>
  
  <entry>
    <title>LangGraphæ ¸å¿ƒç»„ä»¶èŠ‚ç‚¹å’Œå¯æ§åˆ¶æ€§</title>
    <link href="https://jinglv.github.io/2025/09/17/ai/langchain/langgraph/2-langgraph-node-control/"/>
    <id>https://jinglv.github.io/2025/09/17/ai/langchain/langgraph/2-langgraph-node-control/</id>
    <published>2025-09-16T16:00:00.000Z</published>
    <updated>2025-09-17T02:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬ä¸€ä¸ªLanggraph"><a href="#ç¬¬ä¸€ä¸ªLanggraph" class="headerlink" title="ç¬¬ä¸€ä¸ªLanggraph"></a>ç¬¬ä¸€ä¸ªLanggraph</h1><h2 id="å®šä¹‰state"><a href="#å®šä¹‰state" class="headerlink" title="å®šä¹‰state"></a>å®šä¹‰state</h2><p>å®šä¹‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>TypedDict:å±äº Python æ ‡å‡†åº“ typing æ¨¡å—çš„ä¸€éƒ¨åˆ†,ä»…æä¾›é™æ€ç±»å‹æ£€æŸ¥ï¼Œè¿è¡Œæ—¶ä¸æ‰§è¡ŒéªŒè¯</li><li>Pydantic:ç¬¬ä¸‰æ–¹åº“ï¼Œéœ€è¦å•ç‹¬å®‰è£…,æä¾›è¿è¡Œæ—¶æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–åŠŸèƒ½</li></ol><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> AnyMessage</span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹é—´é€šè®¯çš„æ¶ˆæ¯ç±»å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: <span class="built_in">list</span>[AnyMessage]</span><br><span class="line">    extra_field: <span class="built_in">int</span></span><br></pre></td></tr></table></figure><h2 id="å®šä¹‰èŠ‚ç‚¹"><a href="#å®šä¹‰èŠ‚ç‚¹" class="headerlink" title="å®šä¹‰èŠ‚ç‚¹"></a>å®šä¹‰èŠ‚ç‚¹</h2><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> AIMessage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">node</span>(<span class="params">state: State</span>):</span><br><span class="line">    messages = state[<span class="string">&quot;messages&quot;</span>]</span><br><span class="line">    new_message = AIMessage(<span class="string">&quot;ä½ å¥½!æˆ‘æ˜¯ä¸€ä¸ªèŠ‚ç‚¹&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: messages + [new_message], <span class="string">&quot;extra_field&quot;</span>: <span class="number">10</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºå›¾"><a href="#åˆ›å»ºå›¾" class="headerlink" title="åˆ›å»ºå›¾"></a>åˆ›å»ºå›¾</h2><ul><li>åŒ…å«ä¸€ä¸ªèŠ‚ç‚¹</li><li>ä½¿ç”¨stateé€šä¿¡</li></ul><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph</span><br><span class="line"></span><br><span class="line">graph_builder = StateGraph(State)</span><br><span class="line">graph_builder.add_node(node)</span><br><span class="line">graph_builder.set_entry_point(<span class="string">&quot;node&quot;</span>) <span class="comment"># è®¾ç½®å…¥å£ï¼Œå…¥å£åç§°ä¸ºnode</span></span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>() <span class="comment"># è¿›è¡Œç¼–è¯‘</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„ï¼ˆå†…ç½®çš„æ–¹æ³•ï¼‰"><a href="#æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„ï¼ˆå†…ç½®çš„æ–¹æ³•ï¼‰" class="headerlink" title="æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„ï¼ˆå†…ç½®çš„æ–¹æ³•ï¼‰"></a>æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„ï¼ˆå†…ç½®çš„æ–¹æ³•ï¼‰</h2><p>Mermaid æ˜¯ä¸€ç§åŸºäºæ–‡æœ¬çš„å›¾è¡¨å’Œå¯è§†åŒ–å·¥å…·ï¼Œå®ƒå…è®¸ç”¨æˆ·é€šè¿‡ç®€å•çš„æ–‡æœ¬è¯­æ³•æ¥åˆ›å»ºå¤æ‚çš„å›¾è¡¨å’Œæµç¨‹å›¾ã€‚å®ƒç‰¹åˆ«é€‚åˆå¼€å‘è€…ã€æ–‡æ¡£ç¼–å†™è€…å’ŒæŠ€æœ¯äººå‘˜åœ¨æ–‡æ¡£ã€ä»£ç åº“æˆ–ç½‘é¡µä¸­åµŒå…¥å¯è§†åŒ–å†…å®¹ã€‚</p><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image, display</span><br><span class="line"></span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœå±•ç¤º</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250917103406179.png" alt="image-20250917103406179"  /></p><h2 id="è°ƒç”¨"><a href="#è°ƒç”¨" class="headerlink" title="è°ƒç”¨"></a>è°ƒç”¨</h2><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage</span><br><span class="line"></span><br><span class="line">result = graph.invoke(&#123;<span class="string">&quot;messages&quot;</span>: [HumanMessage(<span class="string">&quot;ä½ å¥½å•Šï¼Œæˆ‘æ˜¯èŠ±èŠ±ï¼&quot;</span>)]&#125;)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;messages&#x27;</span>: [HumanMessage(content=<span class="string">&#x27;ä½ å¥½å•Šï¼Œæˆ‘æ˜¯èŠ±èŠ±ï¼&#x27;</span>, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;),</span><br><span class="line">  AIMessage(content=<span class="string">&#x27;ä½ å¥½!æˆ‘æ˜¯ä¸€ä¸ªèŠ‚ç‚¹&#x27;</span>, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;)],</span><br><span class="line"> <span class="string">&#x27;extra_field&#x27;</span>: 10&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-pretty-print-æ¥æ ¼å¼åŒ–æ˜¾ç¤º"><a href="#ä½¿ç”¨-pretty-print-æ¥æ ¼å¼åŒ–æ˜¾ç¤º" class="headerlink" title="ä½¿ç”¨ pretty_print æ¥æ ¼å¼åŒ–æ˜¾ç¤º"></a>ä½¿ç”¨ pretty_print æ¥æ ¼å¼åŒ–æ˜¾ç¤º</h2><p>è¾“å‡ºç»“æœæ›´æ¸…æ™°</p><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage</span><br><span class="line"></span><br><span class="line">result = graph.invoke(&#123;<span class="string">&quot;messages&quot;</span>: [HumanMessage(<span class="string">&quot;ä½ å¥½å•Šï¼Œæˆ‘æ˜¯èŠ±èŠ±ï¼&quot;</span>)]&#125;)</span><br><span class="line"><span class="keyword">for</span> message <span class="keyword">in</span> result[<span class="string">&quot;messages&quot;</span>]:</span><br><span class="line">    message.pretty_print()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½å•Šï¼Œæˆ‘æ˜¯èŠ±èŠ±ï¼</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½!æˆ‘æ˜¯ä¸€ä¸ªèŠ‚ç‚¹</span><br></pre></td></tr></table></figure><h1 id="åŸºæœ¬æ§åˆ¶ï¼šä¸²è¡Œæ§åˆ¶"><a href="#åŸºæœ¬æ§åˆ¶ï¼šä¸²è¡Œæ§åˆ¶" class="headerlink" title="åŸºæœ¬æ§åˆ¶ï¼šä¸²è¡Œæ§åˆ¶"></a>åŸºæœ¬æ§åˆ¶ï¼šä¸²è¡Œæ§åˆ¶</h1><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image, display</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> START, END, StateGraph</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰èŠ‚ç‚¹é€šä¿¡æ¶ˆæ¯ç±»å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    value_1: <span class="built_in">str</span></span><br><span class="line">    value_2: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step_1</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;value_1&quot;</span>: <span class="string">&quot;a&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step_2</span>(<span class="params">state: State</span>):</span><br><span class="line">    current_value_1 = state[<span class="string">&quot;value_1&quot;</span>]</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;value_1&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;current_value_1&#125;</span> + b&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step_3</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;value_2&quot;</span>: <span class="number">10</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå›¾</span></span><br><span class="line">graph_builder = StateGraph(State)</span><br><span class="line"><span class="comment"># è®¾ç½®å›¾ä¸­èŠ‚ç‚¹</span></span><br><span class="line">graph_builder.add_node(step_1)</span><br><span class="line">graph_builder.add_node(step_2)</span><br><span class="line">graph_builder.add_node(step_3)</span><br><span class="line"><span class="comment"># è®¾ç½®å›¾ä¸­è¾¹</span></span><br><span class="line">graph_builder.add_edge(START, <span class="string">&quot;step_1&quot;</span>) <span class="comment"># å¼€å§‹çš„è¾¹</span></span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;step_1&quot;</span>, <span class="string">&quot;step_2&quot;</span>)</span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;step_2&quot;</span>, <span class="string">&quot;step_3&quot;</span>)</span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;step_3&quot;</span>, END) <span class="comment"># ç»“æŸçš„è¾¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å›¾çš„ç¼–è¯‘</span></span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</span></span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨</span></span><br><span class="line">res = graph.invoke(&#123;<span class="string">&quot;value_1&quot;</span>: <span class="string">&quot;c&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250917135828786.png" alt="image-20250917135828786" style="zoom:80%;" /></p><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;value_1&#x27;</span>: <span class="string">&#x27;a + b&#x27;</span>, <span class="string">&#x27;value_2&#x27;</span>: 10&#125;</span><br></pre></td></tr></table></figure><h1 id="åŸºæœ¬æ§åˆ¶ï¼šåˆ†æ”¯æ§åˆ¶"><a href="#åŸºæœ¬æ§åˆ¶ï¼šåˆ†æ”¯æ§åˆ¶" class="headerlink" title="åŸºæœ¬æ§åˆ¶ï¼šåˆ†æ”¯æ§åˆ¶"></a>åŸºæœ¬æ§åˆ¶ï¼šåˆ†æ”¯æ§åˆ¶</h1><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, Annotated</span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image, display</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> START, END, StateGraph</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰èŠ‚ç‚¹é€šä¿¡æ¶ˆæ¯ç±»å‹</span></span><br><span class="line"><span class="comment"># Annotatedå…è®¸ä¸ºç±»å‹æä¾›é¢å¤–çš„å…ƒæ•°æ®ï¼Œè€Œä¸å½±å“ç±»å‹æ£€æŸ¥æ—¶å¯¹ç±»å‹æœ¬èº«çš„ç†è§£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    aggregate: Annotated[<span class="built_in">list</span>, operator.add]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">a</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ·»åŠ &#x27;A&#x27;åˆ°<span class="subst">&#123;state[<span class="string">&#x27;aggregate&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;aggregate&quot;</span>: [<span class="string">&quot;A&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ·»åŠ &#x27;B&#x27;åˆ°<span class="subst">&#123;state[<span class="string">&#x27;aggregate&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;aggregate&quot;</span>: [<span class="string">&quot;B&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">c</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ·»åŠ &#x27;C&#x27;åˆ°<span class="subst">&#123;state[<span class="string">&#x27;aggregate&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;aggregate&quot;</span>: [<span class="string">&quot;C&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">d</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ·»åŠ &#x27;D&#x27;åˆ°<span class="subst">&#123;state[<span class="string">&#x27;aggregate&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;aggregate&quot;</span>: [<span class="string">&quot;D&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå›¾</span></span><br><span class="line">graph_builder = StateGraph(State)</span><br><span class="line"><span class="comment"># è®¾ç½®å›¾ä¸­èŠ‚ç‚¹</span></span><br><span class="line">graph_builder.add_node(a)</span><br><span class="line">graph_builder.add_node(b)</span><br><span class="line">graph_builder.add_node(c)</span><br><span class="line">graph_builder.add_node(d)</span><br><span class="line"><span class="comment"># è®¾ç½®å›¾ä¸­è¾¹</span></span><br><span class="line">graph_builder.add_edge(START, <span class="string">&quot;a&quot;</span>) <span class="comment"># å¼€å§‹çš„è¾¹</span></span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>)</span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;d&quot;</span>)</span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>)</span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;d&quot;</span>, END) <span class="comment"># ç»“æŸçš„è¾¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å›¾çš„ç¼–è¯‘</span></span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</span></span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨</span></span><br><span class="line">res = graph.invoke(&#123;<span class="string">&quot;aggregate&quot;</span>: []&#125;, &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;foo&quot;</span>&#125;&#125;)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250917140002989.png" alt="image-20250917140002989" style="zoom:67%;" /></p><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æ·»åŠ <span class="string">&#x27;A&#x27;</span>åˆ°[]</span><br><span class="line">æ·»åŠ <span class="string">&#x27;B&#x27;</span>åˆ°[<span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">æ·»åŠ <span class="string">&#x27;C&#x27;</span>åˆ°[<span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">æ·»åŠ <span class="string">&#x27;D&#x27;</span>åˆ°[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>]</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;aggregate&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>]&#125;</span><br></pre></td></tr></table></figure><h1 id="åŸºæœ¬æ§åˆ¶ï¼šæ¡ä»¶åˆ†æ”¯ä¸å¾ªç¯"><a href="#åŸºæœ¬æ§åˆ¶ï¼šæ¡ä»¶åˆ†æ”¯ä¸å¾ªç¯" class="headerlink" title="åŸºæœ¬æ§åˆ¶ï¼šæ¡ä»¶åˆ†æ”¯ä¸å¾ªç¯"></a>åŸºæœ¬æ§åˆ¶ï¼šæ¡ä»¶åˆ†æ”¯ä¸å¾ªç¯</h1><h2 id="åˆ†æ”¯æ¡ä»¶"><a href="#åˆ†æ”¯æ¡ä»¶" class="headerlink" title="åˆ†æ”¯æ¡ä»¶"></a>åˆ†æ”¯æ¡ä»¶</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated, <span class="type">Literal</span></span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image, display</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START, END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰èŠ‚ç‚¹é€šä¿¡æ¶ˆæ¯ç±»å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    aggregate: Annotated[<span class="built_in">list</span>, operator.add]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">a</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Node A sees <span class="subst">&#123;state[<span class="string">&quot;aggregate&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;aggregate&quot;</span>: [<span class="string">&quot;A&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Node B sees <span class="subst">&#123;state[<span class="string">&quot;aggregate&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;aggregate&quot;</span>: [<span class="string">&quot;B&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå›¾</span></span><br><span class="line">builder = StateGraph(State)</span><br><span class="line">builder.add_node(a)</span><br><span class="line">builder.add_node(b)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®è¾¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">route</span>(<span class="params">state: State</span>) -&gt; <span class="type">Literal</span>[<span class="string">&quot;b&quot;</span>, END]:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(state[<span class="string">&quot;aggregate&quot;</span>]) &lt; <span class="number">7</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;b&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">builder.add_edge(START, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">builder.add_conditional_edges(<span class="string">&quot;a&quot;</span>, route) <span class="comment"># æ¡ä»¶è¾¹</span></span><br><span class="line">builder.add_edge(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›¾çš„ç¼–è¯‘</span></span><br><span class="line">graph = builder.<span class="built_in">compile</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</span></span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨</span></span><br><span class="line">res = graph.invoke(&#123;<span class="string">&quot;aggregate&quot;</span>: []&#125;)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250917140318708.png" alt="image-20250917140318708" /></p><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Node A sees []</span><br><span class="line">Node B sees [<span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">Node A sees [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]</span><br><span class="line">Node B sees [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">Node A sees [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]</span><br><span class="line">Node B sees [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">Node A sees [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;aggregate&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>]&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä½¿ç”¨é€’å½’é™åˆ¶recursion_limitï¼Œé˜²æ­¢å¼‚å¸¸æƒ…å†µä¸‹çš„å¤§é‡æ— ç”¨è°ƒç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langgraph.errors <span class="keyword">import</span> GraphRecursionError</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    graph.invoke(&#123;<span class="string">&quot;aggregate&quot;</span>: []&#125;, &#123;<span class="string">&quot;recursion_limit&quot;</span>: <span class="number">4</span>&#125;)</span><br><span class="line"><span class="keyword">except</span> GraphRecursionError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Recursion Error&quot;</span>) <span class="comment"># é€’å½’é”™è¯¯ è¶…å‡ºé™åˆ¶</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Node A sees []</span><br><span class="line">Node B sees [<span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">Node A sees [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]</span><br><span class="line">Node B sees [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">Recursion Error</span><br></pre></td></tr></table></figure><h2 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h2><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated, <span class="type">Literal</span></span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START, END</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image, display</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰èŠ‚ç‚¹é€šä¿¡æ¶ˆæ¯ç±»å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    aggregate: Annotated[<span class="built_in">list</span>, operator.add]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">a</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Node A sees <span class="subst">&#123;state[<span class="string">&quot;aggregate&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;aggregate&quot;</span>: [<span class="string">&quot;A&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Node B sees <span class="subst">&#123;state[<span class="string">&quot;aggregate&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;aggregate&quot;</span>: [<span class="string">&quot;B&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">c</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Node C sees <span class="subst">&#123;state[<span class="string">&quot;aggregate&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;aggregate&quot;</span>: [<span class="string">&quot;C&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">d</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Node D sees <span class="subst">&#123;state[<span class="string">&quot;aggregate&quot;</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;aggregate&quot;</span>: [<span class="string">&quot;D&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå›¾</span></span><br><span class="line">builder = StateGraph(State)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®èŠ‚ç‚¹</span></span><br><span class="line">builder.add_node(a)</span><br><span class="line">builder.add_node(b)</span><br><span class="line">builder.add_node(c)</span><br><span class="line">builder.add_node(d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®è¾¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">route</span>(<span class="params">state: State</span>) -&gt; <span class="type">Literal</span>[<span class="string">&quot;b&quot;</span>, END]:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(state[<span class="string">&quot;aggregate&quot;</span>]) &lt; <span class="number">7</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;b&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> END</span><br><span class="line"></span><br><span class="line">builder.add_edge(START, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">builder.add_conditional_edges(<span class="string">&quot;a&quot;</span>, route)</span><br><span class="line">builder.add_edge(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">builder.add_edge(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;d&quot;</span>)</span><br><span class="line">builder.add_edge([<span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>], <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›¾çš„ç¼–è¯‘</span></span><br><span class="line">graph = builder.<span class="built_in">compile</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</span></span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨</span></span><br><span class="line">res = graph.invoke(&#123;<span class="string">&quot;aggregate&quot;</span>: []&#125;)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250917140631860.png" alt="image-20250917140631860"></p><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Node A sees []</span><br><span class="line">Node B sees [<span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">Node C sees [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]</span><br><span class="line">Node D sees [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]</span><br><span class="line">Node A sees [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>]</span><br><span class="line">Node B sees [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">Node C sees [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]</span><br><span class="line">Node D sees [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]</span><br><span class="line">Node A sees [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>]</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;aggregate&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;A&#x27;</span>]&#125;</span><br></pre></td></tr></table></figure><h1 id="ç²¾ç»†æ§åˆ¶ï¼šå›¾çš„è¿è¡Œæ—¶é…ç½®"><a href="#ç²¾ç»†æ§åˆ¶ï¼šå›¾çš„è¿è¡Œæ—¶é…ç½®" class="headerlink" title="ç²¾ç»†æ§åˆ¶ï¼šå›¾çš„è¿è¡Œæ—¶é…ç½®"></a>ç²¾ç»†æ§åˆ¶ï¼šå›¾çš„è¿è¡Œæ—¶é…ç½®</h1><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated, <span class="type">Sequence</span></span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_deepseek <span class="keyword">import</span> ChatDeepSeek</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> BaseMessage, HumanMessage</span><br><span class="line"><span class="keyword">from</span> langchain_core.runnables.config <span class="keyword">import</span> RunnableConfig</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> END, StateGraph, START</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æ¨¡å‹</span></span><br><span class="line">model = ChatDeepSeek(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    api_key=os.environ.get(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">    base_url=os.environ.get(<span class="string">&quot;DEEPSEEK_API_BASE&quot;</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">model1 = ChatOpenAI(</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    api_key=os.environ.get(<span class="string">&quot;OPENAI_API_KEY&quot;</span>),</span><br><span class="line">    base_url=os.environ.get(<span class="string">&quot;OPENAI_API_BASE&quot;</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰è¦åˆ‡æ¢çš„æ¨¡å‹</span></span><br><span class="line">models = &#123;</span><br><span class="line">    <span class="string">&quot;deepseek&quot;</span>: model,</span><br><span class="line">    <span class="string">&quot;openai&quot;</span>: model1,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AgentState</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="type">Sequence</span>[BaseMessage], operator.add]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_call_model</span>(<span class="params">state: AgentState, config: RunnableConfig</span>):</span><br><span class="line">    <span class="comment"># ä½¿ç”¨LCELçš„é…ç½®</span></span><br><span class="line">    model_name = config[<span class="string">&quot;configurable&quot;</span>].get(<span class="string">&quot;model&quot;</span>, <span class="string">&quot;deepseek&quot;</span>) <span class="comment"># è®¾ç½®é»˜è®¤æ¨¡å‹</span></span><br><span class="line">    model = models[model_name]</span><br><span class="line">    response = model.invoke(state[<span class="string">&quot;messages&quot;</span>])</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [response]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå›¾</span></span><br><span class="line">builder = StateGraph(AgentState)</span><br><span class="line"><span class="comment"># å®šä¹‰èŠ‚ç‚¹</span></span><br><span class="line">builder.add_node(<span class="string">&quot;model&quot;</span>, _call_model)</span><br><span class="line"><span class="comment"># å®šä¹‰è¾¹</span></span><br><span class="line">builder.add_edge(START, <span class="string">&quot;model&quot;</span>)</span><br><span class="line">builder.add_edge(<span class="string">&quot;model&quot;</span>, END)</span><br><span class="line"></span><br><span class="line">graph = builder.<span class="built_in">compile</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</span></span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰å¢åŠ è¿è¡Œæ—¶é…ç½®çš„æƒ…å†µä¸‹ï¼Œå®ƒä¼šé»˜è®¤è°ƒç”¨deepseek</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = graph.invoke(&#123;<span class="string">&quot;messages&quot;</span>: [HumanMessage(content=<span class="string">&quot;hi ä½ æ˜¯è°ï¼Ÿ&quot;</span>)]&#125;)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœä¸º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;messages&#x27;</span>: [HumanMessage(content=<span class="string">&#x27;hi ä½ æ˜¯è°ï¼Ÿ&#x27;</span>, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;),</span><br><span class="line">  AIMessage(content=<span class="string">&#x27;å—¨ï¼æˆ‘æ˜¯DeepSeek-V3ï¼Œä½ çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œç”±æ·±åº¦æ±‚ç´¢å…¬å¸åˆ›é€ ã€‚ğŸ˜Š æˆ‘å¯ä»¥å¸®ä½ è§£ç­”é—®é¢˜ã€èŠå¤©ã€æä¾›å»ºè®®ï¼Œç”šè‡³ååŠ©ä½ å¤„ç†å„ç§å­¦ä¹ å’Œå·¥ä½œä¸Šçš„ä»»åŠ¡ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ&#x27;</span>, additional_kwargs=&#123;<span class="string">&#x27;refusal&#x27;</span>: None&#125;, response_metadata=&#123;<span class="string">&#x27;token_usage&#x27;</span>: &#123;<span class="string">&#x27;completion_tokens&#x27;</span>: 49, <span class="string">&#x27;prompt_tokens&#x27;</span>: 8, <span class="string">&#x27;total_tokens&#x27;</span>: 57, <span class="string">&#x27;completion_tokens_details&#x27;</span>: None, <span class="string">&#x27;prompt_tokens_details&#x27;</span>: &#123;<span class="string">&#x27;audio_tokens&#x27;</span>: None, <span class="string">&#x27;cached_tokens&#x27;</span>: 0&#125;, <span class="string">&#x27;prompt_cache_hit_tokens&#x27;</span>: 0, <span class="string">&#x27;prompt_cache_miss_tokens&#x27;</span>: 8&#125;, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;deepseek-chat&#x27;</span>, <span class="string">&#x27;system_fingerprint&#x27;</span>: <span class="string">&#x27;fp_08f168e49b_prod0820_fp8_kvcache&#x27;</span>, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;228c33b4-21f7-4c47-82bd-7417ca36d81d&#x27;</span>, <span class="string">&#x27;service_tier&#x27;</span>: None, <span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;stop&#x27;</span>, <span class="string">&#x27;logprobs&#x27;</span>: None&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run--ff284eca-736c-4b89-bb63-7e5c07ea1786-0&#x27;</span>, usage_metadata=&#123;<span class="string">&#x27;input_tokens&#x27;</span>: 8, <span class="string">&#x27;output_tokens&#x27;</span>: 49, <span class="string">&#x27;total_tokens&#x27;</span>: 57, <span class="string">&#x27;input_token_details&#x27;</span>: &#123;<span class="string">&#x27;cache_read&#x27;</span>: 0&#125;, <span class="string">&#x27;output_token_details&#x27;</span>: &#123;&#125;&#125;)]&#125;</span><br></pre></td></tr></table></figure><p>å¢åŠ è¿è¡Œæ—¶é…ç½®ï¼ŒåŠ¨æ€åˆ‡æ¢æ¨¡å‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;model&quot;</span>: <span class="string">&quot;openai&quot;</span>&#125;&#125;</span><br><span class="line">res = graph.invoke(&#123;<span class="string">&quot;messages&quot;</span>: [HumanMessage(content=<span class="string">&quot;hi ä½ æ˜¯è°ï¼Ÿ&quot;</span>)]&#125;, config=config)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;messages&#x27;</span>: [HumanMessage(content=<span class="string">&#x27;hi ä½ æ˜¯è°ï¼Ÿ&#x27;</span>, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;),</span><br><span class="line">  AIMessage(content=<span class="string">&#x27;ä½ å¥½ï¼Œæˆ‘æ˜¯ä¸€ä¸ªäººå·¥æ™ºèƒ½åŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å›ç­”ä½ çš„é—®é¢˜å’Œæä¾›å¸®åŠ©ã€‚æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ çš„å—ï¼Ÿ&#x27;</span>, additional_kwargs=&#123;<span class="string">&#x27;refusal&#x27;</span>: None&#125;, response_metadata=&#123;<span class="string">&#x27;token_usage&#x27;</span>: &#123;<span class="string">&#x27;completion_tokens&#x27;</span>: 44, <span class="string">&#x27;prompt_tokens&#x27;</span>: 14, <span class="string">&#x27;total_tokens&#x27;</span>: 58, <span class="string">&#x27;completion_tokens_details&#x27;</span>: &#123;<span class="string">&#x27;accepted_prediction_tokens&#x27;</span>: 0, <span class="string">&#x27;audio_tokens&#x27;</span>: 0, <span class="string">&#x27;reasoning_tokens&#x27;</span>: 0, <span class="string">&#x27;rejected_prediction_tokens&#x27;</span>: 0&#125;, <span class="string">&#x27;prompt_tokens_details&#x27;</span>: &#123;<span class="string">&#x27;audio_tokens&#x27;</span>: 0, <span class="string">&#x27;cached_tokens&#x27;</span>: 0&#125;&#125;, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;gpt-3.5-turbo-0125&#x27;</span>, <span class="string">&#x27;system_fingerprint&#x27;</span>: None, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;chatcmpl-CGcvpmH2o6wgubw0PLBymye0uPyzN&#x27;</span>, <span class="string">&#x27;service_tier&#x27;</span>: <span class="string">&#x27;default&#x27;</span>, <span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;stop&#x27;</span>, <span class="string">&#x27;logprobs&#x27;</span>: None&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run--5a5fb090-eae6-4a54-bef8-c877446d5a63-0&#x27;</span>, usage_metadata=&#123;<span class="string">&#x27;input_tokens&#x27;</span>: 14, <span class="string">&#x27;output_tokens&#x27;</span>: 44, <span class="string">&#x27;total_tokens&#x27;</span>: 58, <span class="string">&#x27;input_token_details&#x27;</span>: &#123;<span class="string">&#x27;audio&#x27;</span>: 0, <span class="string">&#x27;cache_read&#x27;</span>: 0&#125;, <span class="string">&#x27;output_token_details&#x27;</span>: &#123;<span class="string">&#x27;audio&#x27;</span>: 0, <span class="string">&#x27;reasoning&#x27;</span>: 0&#125;&#125;)]&#125;</span><br></pre></td></tr></table></figure><h1 id="ç²¾ç»†æ§åˆ¶ï¼šmap-reduceå¹¶è¡Œæ‰§è¡Œ"><a href="#ç²¾ç»†æ§åˆ¶ï¼šmap-reduceå¹¶è¡Œæ‰§è¡Œ" class="headerlink" title="ç²¾ç»†æ§åˆ¶ï¼šmap-reduceå¹¶è¡Œæ‰§è¡Œ"></a>ç²¾ç»†æ§åˆ¶ï¼šmap-reduceå¹¶è¡Œæ‰§è¡Œ</h1><p>ç»™å®šä¸€ä¸ªæ¥è‡ªç”¨æˆ·çš„ä¸€èˆ¬ä¸»é¢˜ï¼Œç”Ÿæˆç›¸å…³ä¸»é¢˜åˆ—è¡¨ï¼Œä¸ºæ¯ä¸ªä¸»é¢˜ç”Ÿæˆä¸€ä¸ªç¬‘è¯ï¼Œå¹¶ä»ç»“æœåˆ—è¡¨ä¸­é€‰æ‹©æœ€ä½³ç¬‘è¯ã€‚</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250917141044009.png" alt="image-20250917141044009"></p><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> langchain_deepseek <span class="keyword">import</span> ChatDeepSeek</span><br><span class="line"><span class="keyword">from</span> langgraph.types <span class="keyword">import</span> Send</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> END, StateGraph, START</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å‹å’Œæç¤ºè¯</span></span><br><span class="line"><span class="comment"># å®šä¹‰æˆ‘ä»¬å°†ä½¿ç”¨çš„æ¨¡å‹å’Œæç¤ºè¯</span></span><br><span class="line">subjects_prompt = <span class="string">&quot;&quot;&quot;ç”Ÿæˆä¸€ä¸ªé€—å·åˆ†éš”çš„åˆ—è¡¨ï¼ŒåŒ…å«2åˆ°5ä¸ªä¸ä»¥ä¸‹ä¸»é¢˜ç›¸å…³çš„ä¾‹å­ï¼š&#123;topic&#125;ã€‚&quot;&quot;&quot;</span></span><br><span class="line">joke_prompt = <span class="string">&quot;&quot;&quot;ç”Ÿæˆä¸€ä¸ªå…³äº&#123;subject&#125;çš„ç¬‘è¯&quot;&quot;&quot;</span></span><br><span class="line">best_joke_prompt = <span class="string">&quot;&quot;&quot;ä»¥ä¸‹æ˜¯ä¸€äº›å…³äº&#123;topic&#125;çš„ç¬‘è¯ã€‚é€‰å‡ºæœ€å¥½çš„ä¸€ä¸ªï¼è¿”å›æœ€ä½³ç¬‘è¯çš„IDã€‚&#123;jokes&#125;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä»¥ä¸‹ä¸‰ä¸ªæ•°æ®æ¨¡å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subjects</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    subjects: <span class="built_in">list</span>[<span class="built_in">str</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Joke</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    joke: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BestJoke</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">int</span> = Field(description=<span class="string">&quot;æœ€ä½³ç¬‘è¯çš„ç´¢å¼•ï¼Œä»0å¼€å§‹&quot;</span>, ge=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å¤§æ¨¡å‹</span></span><br><span class="line">model = ChatDeepSeek(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    api_key=os.environ.get(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">    base_url=os.environ.get(<span class="string">&quot;DEEPSEEK_API_BASE&quot;</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›¾ç»„ä»¶ï¼šå®šä¹‰æ„æˆå›¾çš„ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™å°†æ˜¯ä¸»å›¾çš„æ•´ä½“çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="comment"># å®ƒå°†åŒ…å«ä¸€ä¸ªä¸»é¢˜ï¼ˆæˆ‘ä»¬æœŸæœ›ç”¨æˆ·æä¾›ï¼‰</span></span><br><span class="line"><span class="comment"># ç„¶åå°†ç”Ÿæˆä¸€ä¸ªä¸»é¢˜åˆ—è¡¨ï¼Œå¹¶ä¸ºæ¯ä¸ªä¸»é¢˜ç”Ÿæˆä¸€ä¸ªç¬‘è¯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OverallState</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    topic: <span class="built_in">str</span></span><br><span class="line">    subjects: <span class="built_in">list</span></span><br><span class="line">    <span class="comment"># æ³¨æ„è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨operator.add</span></span><br><span class="line">    <span class="comment"># è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æƒ³æŠŠä»å„ä¸ªèŠ‚ç‚¹ç”Ÿæˆçš„æ‰€æœ‰ç¬‘è¯</span></span><br><span class="line">    <span class="comment"># åˆå¹¶å›ä¸€ä¸ªåˆ—è¡¨ - è¿™æœ¬è´¨ä¸Šæ˜¯&quot;å½’çº¦&quot;éƒ¨åˆ†</span></span><br><span class="line">    jokes: Annotated[<span class="built_in">list</span>, operator.add]</span><br><span class="line">    best_selected_joke: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™å°†æ˜¯æˆ‘ä»¬å°†&quot;æ˜ å°„&quot;æ‰€æœ‰ä¸»é¢˜çš„èŠ‚ç‚¹çš„çŠ¶æ€</span></span><br><span class="line"><span class="comment"># ç”¨äºç”Ÿæˆç¬‘è¯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JokeState</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    subject: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"># è¿™æ˜¯æˆ‘ä»¬ç”¨æ¥ç”Ÿæˆç¬‘è¯ä¸»é¢˜çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_topics</span>(<span class="params">state: OverallState</span>):</span><br><span class="line">    prompt = subjects_prompt.<span class="built_in">format</span>(topic=state[<span class="string">&quot;topic&quot;</span>])</span><br><span class="line">    <span class="comment"># æ¨¡å‹è¿›è¡Œç»“æ„åŒ–è¾“å‡º</span></span><br><span class="line">    response = model.with_structured_output(Subjects).invoke(prompt)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;subjects&quot;</span>: response.subjects&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæˆ‘ä»¬æ ¹æ®ç»™å®šçš„ä¸»é¢˜ç”Ÿæˆç¬‘è¯</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_joke</span>(<span class="params">state: JokeState</span>):</span><br><span class="line">    prompt = joke_prompt.<span class="built_in">format</span>(subject=state[<span class="string">&quot;subject&quot;</span>])</span><br><span class="line">    <span class="comment"># æ¨¡å‹è¿›è¡Œç»“æ„åŒ–è¾“å‡º</span></span><br><span class="line">    response = model.with_structured_output(Joke).invoke(prompt)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;jokes&quot;</span>: [response.joke]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæˆ‘ä»¬å®šä¹‰æ˜ å°„åˆ°ç”Ÿæˆçš„ä¸»é¢˜ä¸Šçš„é€»è¾‘</span></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å°†åœ¨å›¾ä¸­ä½¿ç”¨è¿™ä¸ªä½œä¸ºè¾¹ç¼˜</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">continue_to_jokes</span>(<span class="params">state: OverallState</span>):</span><br><span class="line">    <span class="comment"># æˆ‘ä»¬å°†è¿”å›ä¸€ä¸ª`Send`å¯¹è±¡åˆ—è¡¨</span></span><br><span class="line">    <span class="comment"># æ¯ä¸ª`Send`å¯¹è±¡åŒ…å«å›¾ä¸­èŠ‚ç‚¹çš„åç§°</span></span><br><span class="line">    <span class="comment"># ä»¥åŠè¦å‘é€åˆ°è¯¥èŠ‚ç‚¹çš„çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">return</span> [Send(<span class="string">&quot;generate_joke&quot;</span>, &#123;<span class="string">&quot;subject&quot;</span>: s&#125;) <span class="keyword">for</span> s <span class="keyword">in</span> state[<span class="string">&quot;subjects&quot;</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæˆ‘ä»¬å°†è¯„åˆ¤æœ€ä½³ç¬‘è¯</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">best_joke</span>(<span class="params">state: OverallState</span>):</span><br><span class="line">    jokes = <span class="string">&quot;\n\n&quot;</span>.join(state[<span class="string">&quot;jokes&quot;</span>])</span><br><span class="line">    prompt = best_joke_prompt.<span class="built_in">format</span>(topic=state[<span class="string">&quot;topic&quot;</span>], jokes=jokes)</span><br><span class="line">    response = model.with_structured_output(BestJoke).invoke(prompt)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;best_selected_joke&quot;</span>: state[<span class="string">&quot;jokes&quot;</span>][response.<span class="built_in">id</span>]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºå›¾ï¼šè¿™é‡Œæˆ‘ä»¬å°†æ‰€æœ‰å†…å®¹ç»„åˆåœ¨ä¸€èµ·æ„å»ºæˆ‘ä»¬çš„å›¾</span></span><br><span class="line">graph = StateGraph(OverallState)</span><br><span class="line"><span class="comment"># è®¾ç½®èŠ‚ç‚¹</span></span><br><span class="line">graph.add_node(<span class="string">&quot;generate_topics&quot;</span>, generate_topics)</span><br><span class="line">graph.add_node(<span class="string">&quot;generate_joke&quot;</span>, generate_joke)</span><br><span class="line">graph.add_node(<span class="string">&quot;best_joke&quot;</span>, best_joke)</span><br><span class="line"><span class="comment"># è®¾ç½®è¾¹</span></span><br><span class="line">graph.add_edge(START, <span class="string">&quot;generate_topics&quot;</span>)</span><br><span class="line">graph.add_conditional_edges(<span class="string">&quot;generate_topics&quot;</span>, continue_to_jokes, [<span class="string">&quot;generate_joke&quot;</span>]) <span class="comment"># æ¡ä»¶è¾¹</span></span><br><span class="line">graph.add_edge(<span class="string">&quot;generate_joke&quot;</span>, <span class="string">&quot;best_joke&quot;</span>)</span><br><span class="line">graph.add_edge(<span class="string">&quot;best_joke&quot;</span>, END)</span><br><span class="line">app = graph.<span class="built_in">compile</span>() <span class="comment"># å›¾ç¼–è¯‘</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</span></span><br><span class="line">Image(app.get_graph().draw_mermaid_png())</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> app.stream(&#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;åŠ¨ç‰©&quot;</span>&#125;):</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹èŠ‚ç‚¹ä¸å›¾ç»“æ„</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250917141132825.png" alt="image-20250917141132825"></p><p>æ‰§è¡Œç»“æœä¸º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;generate_topics&#x27;</span>: &#123;<span class="string">&#x27;subjects&#x27;</span>: [<span class="string">&#x27;åŠ¨ç‰©&#x27;</span>]&#125;&#125;</span><br><span class="line">&#123;<span class="string">&#x27;generate_joke&#x27;</span>: &#123;<span class="string">&#x27;jokes&#x27;</span>: [<span class="string">&#x27;ä¸ºä»€ä¹ˆè€è™ä¸å–èŒ¶ï¼Ÿå› ä¸ºå®ƒä»¬å–èŒ¶ä¼šå˜æˆèŒ¶è™ï¼&#x27;</span>]&#125;&#125;</span><br><span class="line">&#123;<span class="string">&#x27;best_joke&#x27;</span>: &#123;<span class="string">&#x27;best_selected_joke&#x27;</span>: <span class="string">&#x27;ä¸ºä»€ä¹ˆè€è™ä¸å–èŒ¶ï¼Ÿå› ä¸ºå®ƒä»¬å–èŒ¶ä¼šå˜æˆèŒ¶è™ï¼&#x27;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å­¦ä¹ LangGraphå­¦ä¹ ç¬”è®°ç¬¬äºŒè®²</summary>
    
    
    
    <category term="LangChain" scheme="https://jinglv.github.io/categories/LangChain/"/>
    
    
    <category term="LangGraph" scheme="https://jinglv.github.io/tags/LangGraph/"/>
    
  </entry>
  
  <entry>
    <title>LangGraphæ ¸å¿ƒç»„ä»¶æŒä¹…åŒ–ç˜€è®°å¿†</title>
    <link href="https://jinglv.github.io/2025/09/17/ai/langchain/langgraph/3-langgraph-memory/"/>
    <id>https://jinglv.github.io/2025/09/17/ai/langchain/langgraph/3-langgraph-memory/</id>
    <published>2025-09-16T16:00:00.000Z</published>
    <updated>2025-09-17T06:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æŒä¹…åŒ–å±‚"><a href="#æŒä¹…åŒ–å±‚" class="headerlink" title="æŒä¹…åŒ–å±‚"></a>æŒä¹…åŒ–å±‚</h1><ul><li>LangGraph çš„å†…ç½®åŠŸèƒ½ï¼Œé€šè¿‡æ£€æŸ¥ç‚¹å™¨å®ç°</li><li>ä¿å­˜å’Œæ¢å¤å›¾æ‰§è¡ŒçŠ¶æ€çš„<strong>æœºåˆ¶</strong></li><li>è®©ä½ çš„ AI åº”ç”¨èƒ½å¤Ÿ â€œè®°ä½â€ ä¹‹å‰çš„äº¤äº’</li><li>æ”¯æŒåº”ç”¨åœ¨ä¸­æ–­åä»ä¸Šæ¬¡åœæ­¢çš„åœ°æ–¹ç»§ç»­</li><li>ä¸ºè°ƒè¯•å’Œäººæœºåä½œæä¾›åŸºç¡€æ”¯æŒ</li></ul><h1 id="è®°å¿†"><a href="#è®°å¿†" class="headerlink" title="è®°å¿†"></a>è®°å¿†</h1><ul><li>æ˜¯ä¸€ç§è®¤çŸ¥åŠŸèƒ½ï¼Œå…è®¸ AI å­˜å‚¨ã€æ£€ç´¢å’Œä½¿ç”¨ä¿¡æ¯</li><li>åœ¨ LangGraph ä¸­åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šçŸ­æœŸè®°å¿†å’Œé•¿æœŸè®°å¿†</li><li>è®°å¿†æ˜¯æŒä¹…åŒ–çš„ä¸€ç§åº”ç”¨åœºæ™¯ï¼Œä½¿ AI èƒ½å¤Ÿåœ¨äº¤äº’ä¸­ä¿æŒä¸Šä¸‹æ–‡</li><li>è®°å¿†æä¾›äº†ç»“æ„åŒ–çš„æ–¹å¼æ¥ç»„ç»‡ä¿¡æ¯</li><li>è®°å¿†æä¾›äº†é«˜æ•ˆçš„æ£€ç´¢æœºåˆ¶</li><li>è®°å¿†å®šä¹‰äº†å¦‚ä½•å°†å­˜å‚¨çš„ä¿¡æ¯èå…¥åˆ°å½“å‰å¯¹è¯ä¸­</li></ul><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250917142203967.png" alt="image-20250917142203967" style="zoom:50%;" /></p><ul><li>æŒä¹…åŒ–å±‚<ul><li>æ— è®ºä½•ç§è®°å¿†æ–¹å¼ï¼Œéƒ½è¦æ¿€æ´»æŒä¹…åŒ–å±‚</li></ul></li><li>ä½¿ç”¨çŸ­æœŸè®°å¿†<ul><li>é€‚åˆç®€å•åº”ç”¨ï¼Œåªéœ€è¦åœ¨ä¼šè¯ä¸­ä¿æŒåŸºæœ¬çŠ¶æ€ï¼Œå¦‚ä¿å­˜ç”¨æˆ·åæˆ–ç®€å•åå¥½</li></ul></li><li>ä½¿ç”¨é•¿æœŸè®°å¿†<ul><li>é€‚åˆéœ€è¦è·¨ä¼šè¯å­¦ä¹ å’Œé€‚åº”çš„é«˜çº§ AI åº”ç”¨ï¼Œå¦‚ä¸ªäººåŠ©ç†æˆ–å®¢æˆ·æœåŠ¡æœºå™¨äºº</li></ul></li></ul><h1 id="åŸºæœ¬è¿ç”¨ï¼šçº¿ç¨‹éš”ç¦»çš„æŒä¹…åŒ–å±‚"><a href="#åŸºæœ¬è¿ç”¨ï¼šçº¿ç¨‹éš”ç¦»çš„æŒä¹…åŒ–å±‚" class="headerlink" title="åŸºæœ¬è¿ç”¨ï¼šçº¿ç¨‹éš”ç¦»çš„æŒä¹…åŒ–å±‚"></a>åŸºæœ¬è¿ç”¨ï¼šçº¿ç¨‹éš”ç¦»çš„æŒä¹…åŒ–å±‚</h1><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> langchain_deepseek <span class="keyword">import</span> ChatDeepSeek</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, MessagesState, START</span><br><span class="line"></span><br><span class="line">model = ChatDeepSeek(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    api_key=os.environ.get(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">    base_url=os.environ.get(<span class="string">&quot;DEEPSEEK_API_BASE&quot;</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">call_model</span>(<span class="params">state: MessagesState</span>):</span><br><span class="line">    response = model.invoke(state[<span class="string">&quot;messages&quot;</span>])</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: response&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå›¾</span></span><br><span class="line">builder = StateGraph(MessagesState)</span><br><span class="line"><span class="comment"># è®¾ç½®èŠ‚ç‚¹</span></span><br><span class="line">builder.add_node(<span class="string">&quot;call_model&quot;</span>, call_model)</span><br><span class="line"><span class="comment"># è®¾ç½®è¾¹</span></span><br><span class="line">builder.add_edge(START, <span class="string">&quot;call_model&quot;</span>)</span><br><span class="line"><span class="comment"># å›¾çš„ç¼–è¯‘</span></span><br><span class="line">graph = builder.<span class="built_in">compile</span>()</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰æ¿€æ´»æŒä¹…åŒ–å±‚ï¼Œæ— æ³•å®ç°å¤šè½®å¯¹è¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">input_message = &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;hi! æˆ‘æ˜¯å°ç¾&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    chunk[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br><span class="line"></span><br><span class="line">input_message = &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;æˆ‘å«ä»€ä¹ˆåå­—?&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    chunk[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">hi! æˆ‘æ˜¯å°ç¾</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½å‘€å°ç¾ï¼ğŸ˜Š å¾ˆé«˜å…´è®¤è¯†ä½ ï½æˆ‘æ˜¯DeepSeek-V3ï¼Œå¯ä»¥å«æˆ‘å°æ·±æˆ–è€…DeepSeekã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿæ— è®ºæ˜¯èŠå¤©ã€è§£ç­”é—®é¢˜è¿˜æ˜¯æä¾›å»ºè®®ï¼Œæˆ‘éƒ½åœ¨è¿™é‡Œå“¦ï¼âœ¨</span><br><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">æˆ‘å«ä»€ä¹ˆåå­—?</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">æˆ‘ä¸çŸ¥é“ä½ çš„åå­—ï¼Œä½†ä½ å¯ä»¥å‘Šè¯‰æˆ‘ï¼å¦‚æœä½ æ„¿æ„çš„è¯ï¼Œæˆ‘å¯ä»¥å¸®ä½ è®°ä½ï¼Œå¹¶åœ¨ä»¥åçš„å¯¹è¯ä¸­ç§°å‘¼ä½ ã€‚ğŸ˜Š</span><br></pre></td></tr></table></figure><p>æ¿€æ´»æŒä¹…åŒ–å±‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"><span class="comment"># ä½¿ç”¨ MemorySaver ä¿å­˜ä¸­é—´çŠ¶æ€</span></span><br><span class="line">memory = MemorySaver()</span><br><span class="line">graph = builder.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125; <span class="comment"># é…ç½®å¯¹è¯çš„çº¿ç¨‹id</span></span><br><span class="line">input_message = &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;hi! æˆ‘æ˜¯å°ç¾&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    chunk[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br><span class="line">input_message = &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;æˆ‘å«ä»€ä¹ˆåå­—?&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    chunk[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">hi! æˆ‘æ˜¯å°ç¾</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½å‘€å°ç¾ï¼ğŸ˜Š å¾ˆé«˜å…´è®¤è¯†ä½ ï½æˆ‘å«DeepSeek-V3ï¼Œæ˜¯ä½ çš„AIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿæ— è®ºæ˜¯èŠå¤©ã€è§£ç­”é—®é¢˜è¿˜æ˜¯æä¾›å»ºè®®ï¼Œæˆ‘éƒ½åœ¨è¿™é‡Œå“¦ï¼âœ¨</span><br><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">æˆ‘å«ä»€ä¹ˆåå­—?</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">å“ˆå“ˆï¼Œä½ åˆšåˆšè¯´ä½ æ˜¯â€œå°ç¾â€å‘€ï½éœ€è¦æˆ‘å¸®ä½ è®°ä½è¿™ä¸ªåå­—å—ï¼Ÿè¿˜æ˜¯è¯´ä½ æœ‰å…¶ä»–å–œæ¬¢çš„ç§°å‘¼å‘¢ï¼ŸğŸ˜Š</span><br></pre></td></tr></table></figure><p>æ³¨æ„å¯¹è¯çº¿ç¨‹thread_idçš„è¾“å…¥ï¼Œè¾“å…¥1å’Œ2çš„åŒºåˆ«</p><p>tread_id:2</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">input_message = &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;æˆ‘å«ä»€ä¹ˆåå­—?&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> graph.stream(</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;2&quot;</span>&#125;&#125;, <span class="comment"># different thread_id</span></span><br><span class="line">    stream_mode=<span class="string">&quot;values&quot;</span>,</span><br><span class="line">):</span><br><span class="line">    chunk[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">input_message = &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;æˆ‘å«ä»€ä¹ˆåå­—?&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> graph.stream(</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;2&quot;</span>&#125;&#125;, <span class="comment"># different thread_id</span></span><br><span class="line">    stream_mode=<span class="string">&quot;values&quot;</span>,</span><br><span class="line">):</span><br><span class="line">    chunk[<span class="string">&quot;messages&quot;</span>][-1].pretty_print()</span><br></pre></td></tr></table></figure><p>thread_id:1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">input_message = &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;æˆ‘å«ä»€ä¹ˆåå­—?&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> graph.stream(</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;, <span class="comment"># different thread_id</span></span><br><span class="line">    stream_mode=<span class="string">&quot;values&quot;</span>,</span><br><span class="line">):</span><br><span class="line">    chunk[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">æˆ‘å«ä»€ä¹ˆåå­—?</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">å“ˆå“ˆï¼Œä½ ä¹‹å‰å‘Šè¯‰æˆ‘ä½ å«â€œå°ç¾â€å‘€ï½éœ€è¦æˆ‘ä»¥åéƒ½è¿™æ ·ç§°å‘¼ä½ å—ï¼Ÿè¿˜æ˜¯æƒ³æ¢ä¸ªæ–°åå­—ï¼Ÿéšæ—¶å¯ä»¥å‘Šè¯‰æˆ‘å“¦ï¼ğŸ˜Š</span><br></pre></td></tr></table></figure><p>ç”±ä»¥ä¸Šçœ‹åˆ°ï¼Œå¯¹è¯æŒä¹…åŒ–å†…å®¹ï¼Œåªèƒ½åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­è·å–ï¼Œå¦‚æœæ¢ä¸€ä¸ªçº¿ç¨‹ï¼Œåˆ™æ˜¯è¯»å–ä¸åˆ°ä¹‹å‰å¯¹è¯å†…å®¹</p><h1 id="åŸºæœ¬è¿ç”¨ï¼šè·¨çº¿ç¨‹æŒä¹…åŒ–è°ƒç”¨"><a href="#åŸºæœ¬è¿ç”¨ï¼šè·¨çº¿ç¨‹æŒä¹…åŒ–è°ƒç”¨" class="headerlink" title="åŸºæœ¬è¿ç”¨ï¼šè·¨çº¿ç¨‹æŒä¹…åŒ–è°ƒç”¨"></a>åŸºæœ¬è¿ç”¨ï¼šè·¨çº¿ç¨‹æŒä¹…åŒ–è°ƒç”¨</h1><p>å¦‚æœæˆ‘ä»¬è¦è·¨çº¿ç¨‹è¯»å–æŒä¹…å±‚çš„å¯¹è¯ä¿¡æ¯ï¼Œåˆ™éœ€è¦åœ¨å¯¹è¯é…ç½®è®¾ç½®userid</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> langgraph.store.memory <span class="keyword">import</span> InMemoryStore</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨OpenAIçš„å°è£…ï¼Œä½†æ˜¯è¿è¡Œå›½äº§åµŒå…¥æ¨¡å‹</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨å†…å­˜å­˜å‚¨æ¥ä¿å­˜å‘é‡åŒ–åè®°å¿†æ•°æ®</span></span><br><span class="line">in_memory_store = InMemoryStore(</span><br><span class="line">    index=&#123;</span><br><span class="line">        <span class="string">&quot;embed&quot;</span>: OpenAIEmbeddings(</span><br><span class="line">            model=<span class="string">&quot;BAAI/bge-m3&quot;</span>,</span><br><span class="line">            api_key=os.environ.get(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">            base_url=<span class="string">&quot;https://api.siliconflow.cn/v1&quot;</span>,</span><br><span class="line">        ),</span><br><span class="line">        <span class="string">&quot;dims&quot;</span>: <span class="number">1024</span>,</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> langchain_deepseek <span class="keyword">import</span> ChatDeepSeek</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> langchain_core.runnables <span class="keyword">import</span> RunnableConfig</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, MessagesState, START</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"><span class="keyword">from</span> langgraph.store.base <span class="keyword">import</span> BaseStore</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model = ChatDeepSeek(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    api_key=os.environ.get(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">    base_url=os.environ.get(<span class="string">&quot;DEEPSEEK_API_BASE&quot;</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šæˆ‘ä»¬å°† Store å‚æ•°ä¼ é€’ç»™èŠ‚ç‚¹ --</span></span><br><span class="line"><span class="comment"># è¿™æ˜¯æˆ‘ä»¬ç¼–è¯‘å›¾æ—¶ä½¿ç”¨çš„ Store</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">call_model</span>(<span class="params">state: MessagesState, config: RunnableConfig, *, store: BaseStore</span>):</span><br><span class="line">    <span class="comment"># ä»å­˜å‚¨ä¸­æ£€ç´¢ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    user_id = config[<span class="string">&quot;configurable&quot;</span>][<span class="string">&quot;user_id&quot;</span>]</span><br><span class="line">    <span class="comment"># ä»å­˜å‚¨ä¸­æ£€ç´¢ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    namespace = (<span class="string">&quot;memories&quot;</span>, user_id)</span><br><span class="line">    memories = store.search(namespace, query=<span class="built_in">str</span>(state[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].content))</span><br><span class="line">    info = <span class="string">&quot;\n&quot;</span>.join([d.value[<span class="string">&quot;data&quot;</span>] <span class="keyword">for</span> d <span class="keyword">in</span> memories])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;åœ¨å†…å­˜ä¸­æ£€ç´¢åˆ°çš„ç”¨æˆ·ä¿¡æ¯ï¼š<span class="subst">&#123;info&#125;</span>&quot;</span>)</span><br><span class="line">    system_msg = <span class="string">f&quot;ä½ æ˜¯ä¸€ä¸ªæ­£åœ¨ä¸ç”¨æˆ·äº¤è°ˆçš„å°åŠ©æ‰‹ã€‚ç”¨æˆ·ä¿¡æ¯ï¼š<span class="subst">&#123;info&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœç”¨æˆ·è¦æ±‚æ¨¡å‹è®°ä½ä¿¡æ¯ï¼Œåˆ™å­˜å‚¨æ–°çš„è®°å¿†</span></span><br><span class="line">    last_message = state[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;è®°ä½&quot;</span> <span class="keyword">in</span> last_message.content.lower() <span class="keyword">or</span> <span class="string">&quot;remember&quot;</span> <span class="keyword">in</span> last_message.content.lower():</span><br><span class="line">        <span class="comment"># ç¡¬ç¼–ç ä¸€ä¸ªè®°å¿†</span></span><br><span class="line">        memory = <span class="string">&quot;ç”¨æˆ·åå­—æ˜¯èŠ±èŠ±&quot;</span></span><br><span class="line">        store.put(namespace, <span class="built_in">str</span>(uuid.uuid4()), &#123;<span class="string">&quot;data&quot;</span>: memory&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ¨¡å‹è°ƒç”¨</span></span><br><span class="line">    response = model.invoke(</span><br><span class="line">        [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: system_msg&#125;] + state[<span class="string">&quot;messages&quot;</span>]</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: response&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">builder = StateGraph(MessagesState)</span><br><span class="line">builder.add_node(<span class="string">&quot;call_model&quot;</span>, call_model)</span><br><span class="line">builder.add_edge(START, <span class="string">&quot;call_model&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šæˆ‘ä»¬åœ¨ç¼–è¯‘å›¾æ—¶ä¼ é€’äº† store å¯¹è±¡</span></span><br><span class="line">graph = builder.<span class="built_in">compile</span>(checkpointer=MemorySaver(), store=in_memory_store)</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ‰§è¡Œï¼Œæ³¨æ„çº¿ç¨‹idå’Œç”¨æˆ·id</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;user_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125; <span class="comment"># é…ç½®å¯¹è¯çš„çº¿ç¨‹idå’Œç”¨æˆ·id</span></span><br><span class="line">input_message = &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;è¯·è®°ä½æˆ‘çš„åå­—å«èŠ±èŠ±!&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    chunk[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">è¯·è®°ä½æˆ‘çš„åå­—å«èŠ±èŠ±!</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">å¥½çš„ï¼ŒèŠ±èŠ±ï¼æˆ‘ä¼šè®°ä½ä½ çš„åå­—ã€‚å¦‚æœæœ‰ä»»ä½•éœ€è¦å¸®åŠ©çš„åœ°æ–¹ï¼Œéšæ—¶å‘Šè¯‰æˆ‘å“¦ï¼ ğŸ˜Š</span><br></pre></td></tr></table></figure><p>è·¨çº¿ç¨‹ä½¿ç”¨ç›¸åŒçš„ç”¨æˆ·IDæŸ¥è¯¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„çº¿ç¨‹IDå’Œç”¨æˆ·IDï¼ŒåŒä¸€ä¸ªuser_id</span></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;user_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125; <span class="comment"># é…ç½®å¯¹è¯çš„çº¿ç¨‹idå’Œç”¨æˆ·id</span></span><br><span class="line">input_message = &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;æˆ‘å«ä»€ä¹ˆåå­—?&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    chunk[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">æˆ‘å«ä»€ä¹ˆåå­—?</span><br><span class="line">åœ¨å†…å­˜ä¸­æ£€ç´¢åˆ°çš„ç”¨æˆ·ä¿¡æ¯ï¼šç”¨æˆ·åå­—æ˜¯èŠ±èŠ±</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">ä½ çš„åå­—æ˜¯èŠ±èŠ±ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼ŸğŸ˜Š</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æŸ¥è¯¢å­˜å‚¨åœ¨å†…å­˜ä¸­çš„è®°å¿†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> memory <span class="keyword">in</span> in_memory_store.search((<span class="string">&quot;memories&quot;</span>, <span class="string">&quot;1&quot;</span>)):</span><br><span class="line">    <span class="built_in">print</span>(memory.value)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;data&#x27;</span>: <span class="string">&#x27;ç”¨æˆ·åå­—æ˜¯èŠ±èŠ±&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><p>ç”¨æˆ·çº§çš„è®°å¿†éš”ç¦»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;3&quot;</span>, <span class="string">&quot;user_id&quot;</span>: <span class="string">&quot;2&quot;</span>&#125;&#125;</span><br><span class="line">input_message = &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;æˆ‘å«ä»€ä¹ˆ?&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    chunk[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">æˆ‘å«ä»€ä¹ˆ?</span><br><span class="line">åœ¨å†…å­˜ä¸­æ£€ç´¢åˆ°çš„ç”¨æˆ·ä¿¡æ¯ï¼š</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">æˆ‘æ— æ³•çŸ¥é“æ‚¨çš„åå­—ï¼Œå› ä¸ºæ‚¨æ²¡æœ‰å‘Šè¯‰æˆ‘ã€‚å¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘æ‚¨çš„åå­—ï¼Œæˆ‘ä¼šè®°ä½å®ƒä»¥ä¾¿æ›´å¥½åœ°ä¸ºæ‚¨æœåŠ¡ï¼ ğŸ˜Š</span><br></pre></td></tr></table></figure><h1 id="è®°å¿†ï¼šçŸ­æœŸè®°å¿†çš„å®ç°"><a href="#è®°å¿†ï¼šçŸ­æœŸè®°å¿†çš„å®ç°" class="headerlink" title="è®°å¿†ï¼šçŸ­æœŸè®°å¿†çš„å®ç°"></a>è®°å¿†ï¼šçŸ­æœŸè®°å¿†çš„å®ç°</h1><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_deepseek <span class="keyword">import</span> ChatDeepSeek</span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> MessagesState, StateGraph, START, END</span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šä½¿ç”¨å†…å­˜å­˜å‚¨æ¥å­˜å‚¨è®°å¿†</span></span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">query: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è°ƒç”¨æ­¤å‡½æ•°å¯ä»¥æµè§ˆç½‘ç»œã€‚&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># æ¨¡æ‹Ÿä¸€ä¸ªç½‘ç»œæœç´¢è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;åŒ—äº¬å¤©æ°”æ™´æœ— å¤§çº¦22åº¦ æ¹¿åº¦30%&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tools = [search]</span><br><span class="line">tool_node = ToolNode(tools)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å¤§æ¨¡å‹</span></span><br><span class="line">model = ChatDeepSeek(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    api_key=os.environ.get(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">    base_url=os.environ.get(<span class="string">&quot;DEEPSEEK_API_BASE&quot;</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">bound_model = model.bind_tools(tools)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">should_continue</span>(<span class="params">state: MessagesState</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è¿”å›ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„èŠ‚ç‚¹ã€‚&quot;&quot;&quot;</span></span><br><span class="line">    last_message = state[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># å¦‚æœæ²¡æœ‰å‡½æ•°è°ƒç”¨ï¼Œåˆ™ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> last_message.tool_calls:</span><br><span class="line">        <span class="keyword">return</span> END</span><br><span class="line">    <span class="comment"># å¦åˆ™å¦‚æœæœ‰ï¼Œæˆ‘ä»¬ç»§ç»­</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;action&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰è°ƒç”¨æ¨¡å‹çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">call_model</span>(<span class="params">state: MessagesState</span>):</span><br><span class="line">    response = bound_model.invoke(state[<span class="string">&quot;messages&quot;</span>])</span><br><span class="line">    <span class="comment"># æˆ‘ä»¬è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå› ä¸ºè¿™ä¼šè¢«æ·»åŠ åˆ°ç°æœ‰åˆ—è¡¨ä¸­</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: response&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªå›¾</span></span><br><span class="line">workflow = StateGraph(MessagesState)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æˆ‘ä»¬å°†åœ¨å…¶é—´å¾ªç¯çš„ä¸¤ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">workflow.add_node(<span class="string">&quot;agent&quot;</span>, call_model)</span><br><span class="line">workflow.add_node(<span class="string">&quot;action&quot;</span>, tool_node)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å…¥å£ç‚¹è®¾ç½®ä¸º `agent`</span></span><br><span class="line"><span class="comment"># è¿™æ„å‘³ç€è¿™ä¸ªèŠ‚ç‚¹æ˜¯ç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„</span></span><br><span class="line">workflow.add_edge(START, <span class="string">&quot;agent&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç°åœ¨æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ¡ä»¶è¾¹</span></span><br><span class="line">workflow.add_conditional_edges(</span><br><span class="line">    <span class="comment"># é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰èµ·å§‹èŠ‚ç‚¹ã€‚æˆ‘ä»¬ä½¿ç”¨ `agent`ã€‚</span></span><br><span class="line">    <span class="comment"># è¿™æ„å‘³ç€è¿™äº›æ˜¯åœ¨ `agent` èŠ‚ç‚¹è¢«è°ƒç”¨åé‡‡å–çš„è¾¹ã€‚</span></span><br><span class="line">    <span class="string">&quot;agent&quot;</span>,</span><br><span class="line">    <span class="comment"># æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼ å…¥å°†ç¡®å®šä¸‹ä¸€ä¸ªè°ƒç”¨å“ªä¸ªèŠ‚ç‚¹çš„å‡½æ•°ã€‚</span></span><br><span class="line">    should_continue,</span><br><span class="line">    <span class="comment"># æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼ å…¥è·¯å¾„æ˜ å°„ - è¿™æ¡è¾¹å¯èƒ½å»å¾€çš„æ‰€æœ‰å¯èƒ½èŠ‚ç‚¹</span></span><br><span class="line">    [<span class="string">&quot;action&quot;</span>, END],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç°åœ¨æˆ‘ä»¬ä» `tools` åˆ° `agent` æ·»åŠ ä¸€ä¸ªæ™®é€šè¾¹ã€‚</span></span><br><span class="line"><span class="comment"># è¿™æ„å‘³ç€åœ¨è°ƒç”¨ `tools` ä¹‹åï¼Œæ¥ä¸‹æ¥è°ƒç”¨ `agent` èŠ‚ç‚¹ã€‚</span></span><br><span class="line">workflow.add_edge(<span class="string">&quot;action&quot;</span>, <span class="string">&quot;agent&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åï¼Œæˆ‘ä»¬ç¼–è¯‘å®ƒï¼</span></span><br><span class="line"><span class="comment"># è¿™å°†å®ƒç¼–è¯‘æˆä¸€ä¸ª LangChain Runnableï¼Œ</span></span><br><span class="line"><span class="comment"># æ„å‘³ç€ä½ å¯ä»¥åƒä½¿ç”¨ä»»ä½•å…¶ä»– runnable ä¸€æ ·ä½¿ç”¨å®ƒ</span></span><br><span class="line"><span class="comment"># è®¾ç½®æ£€æŸ¥ç‚¹ä¸ºå†…å­˜å½¢å¼ï¼Œæ³¨æ„æ²¡æœ‰è®¾ç½®store</span></span><br><span class="line">app = workflow.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨</span></span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage</span><br><span class="line"></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;2&quot;</span>&#125;&#125;</span><br><span class="line">input_message = HumanMessage(content=<span class="string">&quot;hi! æˆ‘æ˜¯é˜¿èŠ±&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> app.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">input_message = HumanMessage(content=<span class="string">&quot;æˆ‘å«ä»€ä¹ˆåå­—?&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> app.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">hi! æˆ‘æ˜¯é˜¿èŠ±</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½é˜¿èŠ±ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ï¼æˆ‘æ˜¯AIåŠ©æ‰‹ï¼Œå¯ä»¥å¸®ä½ æœç´¢ä¿¡æ¯ã€å›ç­”é—®é¢˜ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ</span><br><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">æˆ‘å«ä»€ä¹ˆåå­—?</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">ä½ åˆšæ‰å‘Šè¯‰æˆ‘ä½ å«<span class="string">&quot;é˜¿èŠ±&quot;</span>ï¼è¿™ä¸ªåå­—å¾ˆå¯çˆ±å‘¢ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®é˜¿èŠ±åšçš„å—ï¼Ÿ</span><br></pre></td></tr></table></figure><h1 id="è®°å¿†ï¼šé•¿æœŸè®°å¿†çš„å®ç°"><a href="#è®°å¿†ï¼šé•¿æœŸè®°å¿†çš„å®ç°" class="headerlink" title="è®°å¿†ï¼šé•¿æœŸè®°å¿†çš„å®ç°"></a>è®°å¿†ï¼šé•¿æœŸè®°å¿†çš„å®ç°</h1><p>ä½¿ç”¨mongodbè¿›è¡Œå†…å®¹å­˜å‚¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Literal</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"><span class="keyword">from</span> langchain_deepseek <span class="keyword">import</span> ChatDeepSeek</span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> create_react_agent</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å·¥å…·</span></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_weather</span>(<span class="params">city: <span class="type">Literal</span>[<span class="string">&quot;åŒ—äº¬&quot;</span>, <span class="string">&quot;æ·±åœ³&quot;</span>]</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç”¨æ¥è¿”å›å¤©æ°”ä¿¡æ¯çš„å·¥å…·å‡½æ•°ã€‚&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> city == <span class="string">&quot;åŒ—äº¬&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;åŒ—äº¬å¤©æ°”æ™´æœ— å¤§çº¦22åº¦ æ¹¿åº¦30%&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> city == <span class="string">&quot;æ·±åœ³&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æ·±åœ³å¤©æ°”å¤šäº‘ å¤§çº¦28åº¦ æ¹¿åº¦80%&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> AssertionError(<span class="string">&quot;Unknown city&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tools = [get_weather]</span><br><span class="line"></span><br><span class="line">model = ChatDeepSeek(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    api_key=os.environ.get(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">    base_url=os.environ.get(<span class="string">&quot;DEEPSEEK_API_BASE&quot;</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥mongodbè¿›è¡ŒæŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.mongodb <span class="keyword">import</span> MongoDBSaver</span><br><span class="line"></span><br><span class="line">MONGODB_URI = <span class="string">&quot;82.157.193.65:27017&quot;</span>  <span class="comment"># replace this with your connection string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> MongoDBSaver.from_conn_string(MONGODB_URI) <span class="keyword">as</span> checkpointer:</span><br><span class="line">    graph = create_react_agent(model, tools=tools, checkpointer=checkpointer)</span><br><span class="line">    config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line">    response = graph.invoke(</span><br><span class="line">        &#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;human&quot;</span>, <span class="string">&quot;åŒ—äº¬ä»Šå¤©çš„å¤©æ°”å¦‚ä½•ï¼Ÿ&quot;</span>)]&#125;, config</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;messages&#x27;</span>: [HumanMessage(content=<span class="string">&#x27;åŒ—äº¬ä»Šå¤©çš„å¤©æ°”å¦‚ä½•ï¼Ÿ&#x27;</span>, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;, <span class="built_in">id</span>=<span class="string">&#x27;b0bd092b-5519-4ca5-9018-f9a771813ec7&#x27;</span>), AIMessage(content=<span class="string">&#x27;æˆ‘æ¥å¸®æ‚¨æŸ¥è¯¢åŒ—äº¬ä»Šå¤©çš„å¤©æ°”æƒ…å†µã€‚&#x27;</span>, additional_kwargs=&#123;<span class="string">&#x27;tool_calls&#x27;</span>: [&#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;call_00_b7iojoLeBBIQTVuThfk9Mkxu&#x27;</span>, <span class="string">&#x27;function&#x27;</span>: &#123;<span class="string">&#x27;arguments&#x27;</span>: <span class="string">&#x27;&#123;&quot;city&quot;: &quot;\\u5317\\u4eac&quot;&#125;&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;get_weather&#x27;</span>&#125;, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;function&#x27;</span>, <span class="string">&#x27;index&#x27;</span>: 0&#125;], <span class="string">&#x27;refusal&#x27;</span>: None&#125;, response_metadata=&#123;<span class="string">&#x27;token_usage&#x27;</span>: &#123;<span class="string">&#x27;completion_tokens&#x27;</span>: 29, <span class="string">&#x27;prompt_tokens&#x27;</span>: 161, <span class="string">&#x27;total_tokens&#x27;</span>: 190, <span class="string">&#x27;completion_tokens_details&#x27;</span>: None, <span class="string">&#x27;prompt_tokens_details&#x27;</span>: &#123;<span class="string">&#x27;audio_tokens&#x27;</span>: None, <span class="string">&#x27;cached_tokens&#x27;</span>: 0&#125;, <span class="string">&#x27;prompt_cache_hit_tokens&#x27;</span>: 0, <span class="string">&#x27;prompt_cache_miss_tokens&#x27;</span>: 161&#125;, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;deepseek-chat&#x27;</span>, <span class="string">&#x27;system_fingerprint&#x27;</span>: <span class="string">&#x27;fp_08f168e49b_prod0820_fp8_kvcache&#x27;</span>, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;478a99d7-5560-430a-9f82-8f2f7ae1b664&#x27;</span>, <span class="string">&#x27;service_tier&#x27;</span>: None, <span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;tool_calls&#x27;</span>, <span class="string">&#x27;logprobs&#x27;</span>: None&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run--1267678f-a949-44d4-a980-d8f3e09a4b6e-0&#x27;</span>, tool_calls=[&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;get_weather&#x27;</span>, <span class="string">&#x27;args&#x27;</span>: &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;åŒ—äº¬&#x27;</span>&#125;, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;call_00_b7iojoLeBBIQTVuThfk9Mkxu&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;tool_call&#x27;</span>&#125;], usage_metadata=&#123;<span class="string">&#x27;input_tokens&#x27;</span>: 161, <span class="string">&#x27;output_tokens&#x27;</span>: 29, <span class="string">&#x27;total_tokens&#x27;</span>: 190, <span class="string">&#x27;input_token_details&#x27;</span>: &#123;<span class="string">&#x27;cache_read&#x27;</span>: 0&#125;, <span class="string">&#x27;output_token_details&#x27;</span>: &#123;&#125;&#125;), ToolMessage(content=<span class="string">&#x27;åŒ—äº¬å¤©æ°”æ™´æœ— å¤§çº¦22åº¦ æ¹¿åº¦30%&#x27;</span>, name=<span class="string">&#x27;get_weather&#x27;</span>, <span class="built_in">id</span>=<span class="string">&#x27;0ef181b1-2988-4c14-a054-6f84c27b103c&#x27;</span>, tool_call_id=<span class="string">&#x27;call_00_b7iojoLeBBIQTVuThfk9Mkxu&#x27;</span>), AIMessage(content=<span class="string">&#x27;æ ¹æ®æŸ¥è¯¢ç»“æœï¼ŒåŒ—äº¬ä»Šå¤©çš„å¤©æ°”æƒ…å†µå¦‚ä¸‹ï¼š\n\n- **å¤©æ°”çŠ¶å†µ**ï¼šæ™´æœ—\n- **æ¸©åº¦**ï¼šå¤§çº¦22åº¦\n- **æ¹¿åº¦**ï¼š30%\n\nä»Šå¤©åŒ—äº¬çš„å¤©æ°”å¾ˆä¸é”™ï¼Œæ™´æœ—ä¸”æ¸©åº¦é€‚å®œï¼Œæ˜¯ä¸ªé€‚åˆå¤–å‡ºæ´»åŠ¨çš„å¥½å¤©æ°”ï¼&#x27;</span>, additional_kwargs=&#123;<span class="string">&#x27;refusal&#x27;</span>: None&#125;, response_metadata=&#123;<span class="string">&#x27;token_usage&#x27;</span>: &#123;<span class="string">&#x27;completion_tokens&#x27;</span>: 51, <span class="string">&#x27;prompt_tokens&#x27;</span>: 198, <span class="string">&#x27;total_tokens&#x27;</span>: 249, <span class="string">&#x27;completion_tokens_details&#x27;</span>: None, <span class="string">&#x27;prompt_tokens_details&#x27;</span>: &#123;<span class="string">&#x27;audio_tokens&#x27;</span>: None, <span class="string">&#x27;cached_tokens&#x27;</span>: 0&#125;, <span class="string">&#x27;prompt_cache_hit_tokens&#x27;</span>: 0, <span class="string">&#x27;prompt_cache_miss_tokens&#x27;</span>: 198&#125;, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;deepseek-chat&#x27;</span>, <span class="string">&#x27;system_fingerprint&#x27;</span>: <span class="string">&#x27;fp_08f168e49b_prod0820_fp8_kvcache&#x27;</span>, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;99d0def0-6636-4b59-b479-e417a7973a00&#x27;</span>, <span class="string">&#x27;service_tier&#x27;</span>: None, <span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;stop&#x27;</span>, <span class="string">&#x27;logprobs&#x27;</span>: None&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run--e1cf4802-1d6b-48f8-b706-e1a25dcef2f1-0&#x27;</span>, usage_metadata=&#123;<span class="string">&#x27;input_tokens&#x27;</span>: 198, <span class="string">&#x27;output_tokens&#x27;</span>: 51, <span class="string">&#x27;total_tokens&#x27;</span>: 249, <span class="string">&#x27;input_token_details&#x27;</span>: &#123;<span class="string">&#x27;cache_read&#x27;</span>: 0&#125;, <span class="string">&#x27;output_token_details&#x27;</span>: &#123;&#125;&#125;)]&#125;</span><br></pre></td></tr></table></figure><h1 id="è®°å¿†ï¼šä½¿ç”¨æ€»ç»“æŠ€æœ¯ä¼˜åŒ–"><a href="#è®°å¿†ï¼šä½¿ç”¨æ€»ç»“æŠ€æœ¯ä¼˜åŒ–" class="headerlink" title="è®°å¿†ï¼šä½¿ç”¨æ€»ç»“æŠ€æœ¯ä¼˜åŒ–"></a>è®°å¿†ï¼šä½¿ç”¨æ€»ç»“æŠ€æœ¯ä¼˜åŒ–</h1><p>æ³¨æ„ï¼šé•¿æœŸä½¿ç”¨ï¼Œè®°å¿†å†…å®¹è¶Šæ¥è¶Šå¤šï¼Œä¼šå¯¼è‡´è¶…å‡ºå¤§æ¨¡å‹çš„ä¸Šä¸‹æ–‡çª—å£</p><ul><li>æ¶ˆæ¯è¿‡æ»¤ï¼šå¯¹æ—§æ¶ˆæ¯è¿›è¡Œç±»ä¼¼åˆ é™¤æˆ–ç¼–è¾‘çš„æ“ä½œï¼Œç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢æ’‘çˆ†ä¸Šä¸‹æ–‡</li><li>æ¶ˆæ¯æ€»ç»“ï¼šå¯¹æ—§æ¶ˆæ¯è¿›è¡Œæ€»ç»“ï¼Œç›®çš„ä¸€æ ·æ˜¯ä¸ºäº†é˜²æ­¢è®°å¿†å†…å®¹è¿‡é•¿</li><li>æ³¨æ„å¯¹è®°å¿†çš„ç®¡ç†æ˜¯ä¸€é¡¹å…³äºå¬å›ç‡å’Œç²¾åº¦çš„å¹³è¡¡è‰ºæœ¯</li></ul><h2 id="æ–¹å¼ä¸€ï¼šæ¶ˆæ¯è¿‡æ»¤ï¼ˆæˆªå–å¯¹è¯ä¿¡æ¯çš„éƒ¨åˆ†å†…å®¹ï¼‰"><a href="#æ–¹å¼ä¸€ï¼šæ¶ˆæ¯è¿‡æ»¤ï¼ˆæˆªå–å¯¹è¯ä¿¡æ¯çš„éƒ¨åˆ†å†…å®¹ï¼‰" class="headerlink" title="æ–¹å¼ä¸€ï¼šæ¶ˆæ¯è¿‡æ»¤ï¼ˆæˆªå–å¯¹è¯ä¿¡æ¯çš„éƒ¨åˆ†å†…å®¹ï¼‰"></a>æ–¹å¼ä¸€ï¼šæ¶ˆæ¯è¿‡æ»¤ï¼ˆæˆªå–å¯¹è¯ä¿¡æ¯çš„éƒ¨åˆ†å†…å®¹ï¼‰</h2><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_deepseek <span class="keyword">import</span> ChatDeepSeek</span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> MessagesState, StateGraph, START</span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode</span><br><span class="line"></span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">query: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è°ƒç”¨æ­¤å‡½æ•°å¯ä»¥æµè§ˆç½‘ç»œã€‚&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># æ¨¡æ‹Ÿä¸€ä¸ªç½‘ç»œæœç´¢è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;åŒ—äº¬å¤©æ°”æ™´æœ— å¤§çº¦22åº¦ æ¹¿åº¦30%&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tools = [search]</span><br><span class="line">tool_node = ToolNode(tools)</span><br><span class="line"></span><br><span class="line">model = ChatDeepSeek(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    api_key=os.environ.get(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">    base_url=os.environ.get(<span class="string">&quot;DEEPSEEK_API_BASE&quot;</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">bound_model = model.bind_tools(tools)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">should_continue</span>(<span class="params">state: MessagesState</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è¿”å›ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„èŠ‚ç‚¹ã€‚&quot;&quot;&quot;</span></span><br><span class="line">    last_message = state[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># å¦‚æœæ²¡æœ‰å‡½æ•°è°ƒç”¨ï¼Œåˆ™ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> last_message.tool_calls:</span><br><span class="line">        <span class="keyword">return</span> END</span><br><span class="line">    <span class="comment"># å¦åˆ™ï¼Œå¦‚æœæœ‰å‡½æ•°è°ƒç”¨ï¼Œæˆ‘ä»¬ç»§ç»­</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;action&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter_messages</span>(<span class="params">messages: <span class="built_in">list</span></span>):</span><br><span class="line">    <span class="comment"># è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„è¾…åŠ©å‡½æ•°ï¼Œå®ƒåªä½¿ç”¨æœ€åä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">return</span> messages[-<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰è°ƒç”¨æ¨¡å‹çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">call_model</span>(<span class="params">state: MessagesState</span>):</span><br><span class="line">    messages = filter_messages(state[<span class="string">&quot;messages&quot;</span>])</span><br><span class="line">    response = bound_model.invoke(messages)</span><br><span class="line">    <span class="comment"># æˆ‘ä»¬è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå› ä¸ºè¿™å°†è¢«æ·»åŠ åˆ°ç°æœ‰åˆ—è¡¨ä¸­</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: response&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªæ–°å›¾</span></span><br><span class="line">workflow = StateGraph(MessagesState)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æˆ‘ä»¬å°†åœ¨å…¶é—´å¾ªç¯çš„ä¸¤ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">workflow.add_node(<span class="string">&quot;agent&quot;</span>, call_model)</span><br><span class="line">workflow.add_node(<span class="string">&quot;action&quot;</span>, tool_node)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å…¥å£ç‚¹è®¾ç½®ä¸º `agent`</span></span><br><span class="line"><span class="comment"># è¿™æ„å‘³ç€è¿™ä¸ªèŠ‚ç‚¹æ˜¯ç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„</span></span><br><span class="line">workflow.add_edge(START, <span class="string">&quot;agent&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç°åœ¨æ·»åŠ ä¸€ä¸ªæ¡ä»¶è¾¹</span></span><br><span class="line">workflow.add_conditional_edges(</span><br><span class="line">    <span class="comment"># é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰èµ·å§‹èŠ‚ç‚¹ã€‚æˆ‘ä»¬ä½¿ç”¨ `agent`ã€‚</span></span><br><span class="line">    <span class="comment"># è¿™æ„å‘³ç€è¿™äº›æ˜¯åœ¨è°ƒç”¨ `agent` èŠ‚ç‚¹åé‡‡å–çš„è¾¹ã€‚</span></span><br><span class="line">    <span class="string">&quot;agent&quot;</span>,</span><br><span class="line">    <span class="comment"># æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼ å…¥å°†ç¡®å®šä¸‹ä¸€ä¸ªè°ƒç”¨å“ªä¸ªèŠ‚ç‚¹çš„å‡½æ•°ã€‚</span></span><br><span class="line">    should_continue,</span><br><span class="line">    <span class="comment"># æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼ å…¥è·¯å¾„å›¾ - æ­¤è¾¹å¯èƒ½å»å¾€çš„æ‰€æœ‰å¯èƒ½èŠ‚ç‚¹</span></span><br><span class="line">    [<span class="string">&quot;action&quot;</span>, END],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç°åœ¨æˆ‘ä»¬ä» `action` åˆ° `agent` æ·»åŠ ä¸€ä¸ªæ™®é€šè¾¹ã€‚</span></span><br><span class="line"><span class="comment"># è¿™æ„å‘³ç€åœ¨è°ƒç”¨ `action` ä¹‹åï¼Œä¸‹ä¸€æ­¥è°ƒç”¨ `agent` èŠ‚ç‚¹ã€‚</span></span><br><span class="line">workflow.add_edge(<span class="string">&quot;action&quot;</span>, <span class="string">&quot;agent&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åï¼Œæˆ‘ä»¬ç¼–è¯‘å®ƒï¼</span></span><br><span class="line"><span class="comment"># è¿™å°†å®ƒç¼–è¯‘æˆä¸€ä¸ª LangChain Runnableï¼Œ</span></span><br><span class="line"><span class="comment"># æ„å‘³ç€ä½ å¯ä»¥åƒä½¿ç”¨ä»»ä½•å…¶ä»– runnable ä¸€æ ·ä½¿ç”¨å®ƒ</span></span><br><span class="line">app = workflow.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç¤ºä¾‹ï¼Œfilter_messagesç›´æ¥æˆªå–äº†å¯¹è¯æ¶ˆæ¯çš„æœ€åä¸€æ¡ï¼Œæ‰€ä»¥å³ä¾¿ä½¿ç”¨äº†memoryï¼Œä¾ç„¶æ— æ³•è®°ä½è¿‡å¾€å¯¹è¯ï¼Œä»¥ä¸‹è°ƒç”¨ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage</span><br><span class="line"></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;2&quot;</span>&#125;&#125;</span><br><span class="line">input_message = HumanMessage(content=<span class="string">&quot;hi! æˆ‘æ˜¯å°é»‘&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> app.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œå®ƒåªä½¿ç”¨æœ€åä¸€æ¡æ¶ˆæ¯ï¼Œå¤±å»äº†è®°å¿†åŠŸèƒ½</span></span><br><span class="line"><span class="comment"># è¿™å°†å¯¼è‡´æˆ‘ä»¬çš„æ¨¡å‹åªçœ‹åˆ°æœ€åä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line">input_message = HumanMessage(content=<span class="string">&quot;æˆ‘å«ä»€ä¹ˆåå­—?&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> app.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">hi! æˆ‘æ˜¯å°é»‘</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½å°é»‘ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ï¼æˆ‘æ˜¯DeepSeek-V3ï¼Œä¸€ä¸ªAIåŠ©æ‰‹ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ</span><br><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">æˆ‘å«ä»€ä¹ˆåå­—?</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">æˆ‘æ— æ³•ç›´æ¥çŸ¥é“æ‚¨çš„åå­—ï¼Œå› ä¸ºæˆ‘æ²¡æœ‰è®¿é—®ä¸ªäººä¿¡æ¯çš„èƒ½åŠ›ã€‚æ‚¨å¯ä»¥å‘Šè¯‰æˆ‘æ‚¨çš„åå­—ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥åœ¨åç»­çš„å¯¹è¯ä¸­ç”¨åå­—æ¥ç§°å‘¼æ‚¨äº†ã€‚</span><br></pre></td></tr></table></figure><h2 id="æ–¹å¼äºŒï¼šæ¶ˆæ¯æ€»ç»“-æœ€å¸¸ç”¨"><a href="#æ–¹å¼äºŒï¼šæ¶ˆæ¯æ€»ç»“-æœ€å¸¸ç”¨" class="headerlink" title="æ–¹å¼äºŒï¼šæ¶ˆæ¯æ€»ç»“(æœ€å¸¸ç”¨)"></a>æ–¹å¼äºŒï¼šæ¶ˆæ¯æ€»ç»“(æœ€å¸¸ç”¨)</h2><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Literal</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_deepseek <span class="keyword">import</span> ChatDeepSeek</span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> SystemMessage, RemoveMessage, HumanMessage</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> MessagesState, StateGraph, START, END</span><br><span class="line"></span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ª`summary`å±æ€§ï¼ˆé™¤äº†MessagesStateå·²æœ‰çš„`messages`é”®ä¹‹å¤–ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">MessagesState</span>):</span><br><span class="line">    summary: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªæ¨¡å‹è¿›è¡Œå¯¹è¯å’Œæ€»ç»“</span></span><br><span class="line">model = ChatDeepSeek(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    api_key=os.environ.get(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),</span><br><span class="line">    base_url=os.environ.get(<span class="string">&quot;DEEPSEEK_API_BASE&quot;</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰è°ƒç”¨æ¨¡å‹çš„é€»è¾‘</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">call_model</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="comment"># å¦‚æœå­˜åœ¨æ‘˜è¦ï¼Œæˆ‘ä»¬å°†å…¶ä½œä¸ºç³»ç»Ÿæ¶ˆæ¯æ·»åŠ </span></span><br><span class="line">    summary = state.get(<span class="string">&quot;summary&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> summary:</span><br><span class="line">        system_message = <span class="string">f&quot;ä¹‹å‰å¯¹è¯çš„æ‘˜è¦: <span class="subst">&#123;summary&#125;</span>&quot;</span></span><br><span class="line">        messages = [SystemMessage(content=system_message)] + state[<span class="string">&quot;messages&quot;</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        messages = state[<span class="string">&quot;messages&quot;</span>]</span><br><span class="line">    response = model.invoke(messages)</span><br><span class="line">    <span class="comment"># æˆ‘ä»¬è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå› ä¸ºè¿™å°†è¢«æ·»åŠ åˆ°ç°æœ‰åˆ—è¡¨ä¸­</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [response]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç°åœ¨æˆ‘ä»¬å®šä¹‰ç¡®å®šæ˜¯ç»“æŸè¿˜æ˜¯æ€»ç»“å¯¹è¯çš„é€»è¾‘</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">should_continue</span>(<span class="params">state: State</span>) -&gt; <span class="type">Literal</span>[<span class="string">&quot;summarize_conversation&quot;</span>, END]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è¿”å›ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„èŠ‚ç‚¹ã€‚&quot;&quot;&quot;</span></span><br><span class="line">    messages = state[<span class="string">&quot;messages&quot;</span>]</span><br><span class="line">    <span class="comment"># å¦‚æœæ¶ˆæ¯è¶…è¿‡å…­æ¡(æ€»å¯¹è¯æ•°ï¼ŒåŒ…å«äººæœº)ï¼Œåˆ™æˆ‘ä»¬æ€»ç»“å¯¹è¯</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(messages) &gt; <span class="number">6</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;summarize_conversation&quot;</span></span><br><span class="line">    <span class="comment"># å¦åˆ™æˆ‘ä»¬å¯ä»¥ç›´æ¥ç»“æŸ</span></span><br><span class="line">    <span class="keyword">return</span> END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">summarize_conversation</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="comment"># é¦–å…ˆï¼Œæˆ‘ä»¬æ€»ç»“å¯¹è¯</span></span><br><span class="line">    summary = state.get(<span class="string">&quot;summary&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> summary:</span><br><span class="line">        <span class="comment"># å¦‚æœå·²ç»å­˜åœ¨æ‘˜è¦ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„ç³»ç»Ÿæç¤ºæ¥æ€»ç»“å®ƒ</span></span><br><span class="line">        <span class="comment"># ä¸æ²¡æœ‰æ‘˜è¦çš„æƒ…å†µä¸åŒ</span></span><br><span class="line">        summary_message = (</span><br><span class="line">            <span class="string">f&quot;è¿™æ˜¯è¿„ä»Šä¸ºæ­¢å¯¹è¯çš„æ‘˜è¦: <span class="subst">&#123;summary&#125;</span>\n\n&quot;</span></span><br><span class="line">            <span class="string">&quot;è€ƒè™‘ä¸Šé¢çš„æ–°æ¶ˆæ¯ï¼Œæ‰©å±•æ‘˜è¦:&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        summary_message = <span class="string">&quot;åˆ›å»ºä¸Šè¿°å¯¹è¯çš„æ‘˜è¦:&quot;</span></span><br><span class="line"></span><br><span class="line">    messages = state[<span class="string">&quot;messages&quot;</span>] + [HumanMessage(content=summary_message)]</span><br><span class="line">    response = model.invoke(messages)</span><br><span class="line">    <span class="comment"># ç°åœ¨æˆ‘ä»¬éœ€è¦åˆ é™¤æˆ‘ä»¬ä¸å†æƒ³æ˜¾ç¤ºçš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment"># æˆ‘å°†åˆ é™¤é™¤æœ€åä¸¤æ¡ä»¥å¤–çš„æ‰€æœ‰æ¶ˆæ¯ï¼Œä½†ä½ å¯ä»¥æ›´æ”¹è¿™ä¸€ç‚¹</span></span><br><span class="line">    delete_messages = [RemoveMessage(<span class="built_in">id</span>=m.<span class="built_in">id</span>) <span class="keyword">for</span> m <span class="keyword">in</span> state[<span class="string">&quot;messages&quot;</span>][:-<span class="number">2</span>]]</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;summary&quot;</span>: response.content, <span class="string">&quot;messages&quot;</span>: delete_messages&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªæ–°å›¾</span></span><br><span class="line">workflow = StateGraph(State)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å¯¹è¯èŠ‚ç‚¹å’Œæ€»ç»“èŠ‚ç‚¹</span></span><br><span class="line">workflow.add_node(<span class="string">&quot;conversation&quot;</span>, call_model)</span><br><span class="line">workflow.add_node(summarize_conversation)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å…¥å£ç‚¹è®¾ç½®ä¸ºå¯¹è¯</span></span><br><span class="line">workflow.add_edge(START, <span class="string">&quot;conversation&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç°åœ¨æ·»åŠ ä¸€ä¸ªæ¡ä»¶è¾¹</span></span><br><span class="line">workflow.add_conditional_edges(</span><br><span class="line">    <span class="comment"># é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰èµ·å§‹èŠ‚ç‚¹ã€‚æˆ‘ä»¬ä½¿ç”¨`conversation`ã€‚</span></span><br><span class="line">    <span class="comment"># è¿™æ„å‘³ç€è¿™äº›æ˜¯åœ¨è°ƒç”¨`conversation`èŠ‚ç‚¹åé‡‡å–çš„è¾¹ã€‚</span></span><br><span class="line">    <span class="string">&quot;conversation&quot;</span>,</span><br><span class="line">    <span class="comment"># æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼ å…¥å°†ç¡®å®šä¸‹ä¸€ä¸ªè°ƒç”¨å“ªä¸ªèŠ‚ç‚¹çš„å‡½æ•°ã€‚</span></span><br><span class="line">    should_continue,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç°åœ¨æˆ‘ä»¬ä»`summarize_conversation`åˆ°ENDæ·»åŠ ä¸€ä¸ªæ™®é€šè¾¹ã€‚</span></span><br><span class="line"><span class="comment"># è¿™æ„å‘³ç€åœ¨è°ƒç”¨`summarize_conversation`ä¹‹åï¼Œæˆ‘ä»¬ç»“æŸã€‚</span></span><br><span class="line">workflow.add_edge(<span class="string">&quot;summarize_conversation&quot;</span>, END)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åï¼Œæˆ‘ä»¬ç¼–è¯‘å®ƒï¼</span></span><br><span class="line">app = workflow.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡çº§ä¸€ä¸‹printå‡½æ•°ä»¥ä¾¿å¯ä»¥æ›´æ¸…æ™°çš„çœ‹åˆ°è®°å¿†è¿‡ç¨‹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_update</span>(<span class="params">update</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> update.items():</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> v[<span class="string">&quot;messages&quot;</span>]:</span><br><span class="line">            m.pretty_print()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;summary&quot;</span> <span class="keyword">in</span> v:</span><br><span class="line">            <span class="built_in">print</span>(v[<span class="string">&quot;summary&quot;</span>])</span><br><span class="line">            </span><br><span class="line"><span class="comment"># è°ƒç”¨</span></span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage</span><br><span class="line"></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;4&quot;</span>&#125;&#125;</span><br><span class="line">input_message = HumanMessage(content=<span class="string">&quot;hi! æˆ‘æ˜¯å°çº¢&quot;</span>)</span><br><span class="line">input_message.pretty_print()</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> app.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;updates&quot;</span>):</span><br><span class="line">    print_update(event)</span><br><span class="line"></span><br><span class="line">input_message = HumanMessage(content=<span class="string">&quot;æˆ‘å«ä»€ä¹ˆåå­—?&quot;</span>)</span><br><span class="line">input_message.pretty_print()</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> app.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;updates&quot;</span>):</span><br><span class="line">    print_update(event)</span><br><span class="line"></span><br><span class="line">input_message = HumanMessage(content=<span class="string">&quot;æˆ‘å–œæ¬¢AIåº”ç”¨å¼€å‘!&quot;</span>)</span><br><span class="line">input_message.pretty_print()</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> app.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;updates&quot;</span>):</span><br><span class="line">    print_update(event)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">hi! æˆ‘æ˜¯å°çº¢</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½å‘€å°çº¢ï¼ğŸ˜Š å¾ˆé«˜å…´è®¤è¯†ä½ ï¼æˆ‘å«DeepSeek-V3ï¼Œæ˜¯ä½ çš„AIåŠ©æ‰‹ï½æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿæ— è®ºæ˜¯èŠå¤©ã€è§£ç­”é—®é¢˜è¿˜æ˜¯æä¾›å»ºè®®ï¼Œæˆ‘éƒ½ä¼šå°½åŠ›å¸®ä½ å“¦ï¼âœ¨</span><br><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">æˆ‘å«ä»€ä¹ˆåå­—?</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">å“ˆå“ˆï¼Œä½ åˆšåˆšè¯´ä½ æ˜¯å°çº¢å‘€ï¼ğŸ˜Š å¦‚æœè¿™æ˜¯ä½ å–œæ¬¢çš„åå­—ï¼Œé‚£æˆ‘å°±å«ä½ å°çº¢å•¦ï½å¦‚æœéœ€è¦æˆ‘è®°ä½å…¶ä»–åå­—æˆ–è€…æ˜µç§°ï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘å“¦ï¼âœ¨</span><br><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">æˆ‘å–œæ¬¢AIåº”ç”¨å¼€å‘!</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">å¤ªæ£’äº†ï¼å°çº¢å–œæ¬¢AIåº”ç”¨å¼€å‘ï¼Œè¿™å¯æ˜¯ä¸€ä¸ªå……æ»¡åˆ›é€ åŠ›å’Œæœªæ¥æ„Ÿçš„é¢†åŸŸå‘¢ï¼ğŸš€  </span><br><span class="line"></span><br><span class="line">å¦‚æœä½ éœ€è¦ï¼š  </span><br><span class="line">- **å­¦ä¹ èµ„æº**ï¼ˆæ¯”å¦‚æ•™ç¨‹ã€è¯¾ç¨‹æ¨èï¼‰  </span><br><span class="line">- **å·¥å…·æˆ–æ¡†æ¶**ï¼ˆå¦‚TensorFlowã€PyTorchã€LLMåº”ç”¨å¼€å‘ï¼‰  </span><br><span class="line">- **é¡¹ç›®çµæ„Ÿ**ï¼ˆæ¯”å¦‚è¶£å‘³å°åº”ç”¨æˆ–å®æˆ˜æ¡ˆä¾‹ï¼‰  </span><br><span class="line">- **æŠ€æœ¯é—®é¢˜è®¨è®º**ï¼ˆæ¨¡å‹è®­ç»ƒã€éƒ¨ç½²ä¼˜åŒ–ç­‰ï¼‰  </span><br><span class="line"></span><br><span class="line">æˆ–è€…åªæ˜¯æƒ³åˆ†äº«ä½ çš„æƒ³æ³•å’Œä½œå“ï¼Œæˆ‘éƒ½å¾ˆä¹æ„ä¸€èµ·äº¤æµï¼ğŸ¤–ğŸ’¡  </span><br><span class="line"></span><br><span class="line">æœ€è¿‘æœ‰åœ¨åšä»€ä¹ˆæœ‰è¶£çš„AIé¡¹ç›®å—ï¼Ÿæˆ–è€…å¯¹å“ªä¸ªæ–¹å‘ç‰¹åˆ«æ„Ÿå…´è¶£å‘€ï¼ŸğŸ˜ƒ</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ‰§è¡Œç»“æœï¼Œäººæœºå¯¹è¯ä¸€å…±6æ¬¡ï¼Œä»£ç should_continueä¸­ï¼Œæ˜¯å¯¹è¯å¤§äº6æ¬¡æ‰ä¼šè§¦å‘å¯¹è¯æ€»ç»“ï¼Œå› æ­¤è¿™æ¬¡æ‰§è¡Œç»“æœæ¥çœ‹ï¼Œæ˜¯æ²¡æœ‰è¿›è¡Œå¯¹è¯æ€»ç»“çš„ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å‡ºåŸå§‹å¯¹è¯è®°å½•çœ‹ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">values = app.get_state(config).values</span><br><span class="line"><span class="built_in">print</span>(values)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;messages&#x27;</span>: [HumanMessage(content=<span class="string">&#x27;hi! æˆ‘æ˜¯å°çº¢&#x27;</span>, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;, <span class="built_in">id</span>=<span class="string">&#x27;8d0e6e51-d6e9-4efc-9693-c5d04cadc37a&#x27;</span>), AIMessage(content=<span class="string">&#x27;ä½ å¥½å‘€å°çº¢ï¼ğŸ˜Š å¾ˆé«˜å…´è®¤è¯†ä½ ï¼æˆ‘å«DeepSeek-V3ï¼Œæ˜¯ä½ çš„AIåŠ©æ‰‹ï½æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿæ— è®ºæ˜¯èŠå¤©ã€è§£ç­”é—®é¢˜è¿˜æ˜¯æä¾›å»ºè®®ï¼Œæˆ‘éƒ½ä¼šå°½åŠ›å¸®ä½ å“¦ï¼âœ¨&#x27;</span>, additional_kwargs=&#123;<span class="string">&#x27;refusal&#x27;</span>: None&#125;, response_metadata=&#123;<span class="string">&#x27;token_usage&#x27;</span>: &#123;<span class="string">&#x27;completion_tokens&#x27;</span>: 43, <span class="string">&#x27;prompt_tokens&#x27;</span>: 9, <span class="string">&#x27;total_tokens&#x27;</span>: 52, <span class="string">&#x27;completion_tokens_details&#x27;</span>: None, <span class="string">&#x27;prompt_tokens_details&#x27;</span>: &#123;<span class="string">&#x27;audio_tokens&#x27;</span>: None, <span class="string">&#x27;cached_tokens&#x27;</span>: 0&#125;, <span class="string">&#x27;prompt_cache_hit_tokens&#x27;</span>: 0, <span class="string">&#x27;prompt_cache_miss_tokens&#x27;</span>: 9&#125;, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;deepseek-chat&#x27;</span>, <span class="string">&#x27;system_fingerprint&#x27;</span>: <span class="string">&#x27;fp_08f168e49b_prod0820_fp8_kvcache&#x27;</span>, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;6e6881af-870c-4465-b8fe-1d8dc8daf72e&#x27;</span>, <span class="string">&#x27;service_tier&#x27;</span>: None, <span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;stop&#x27;</span>, <span class="string">&#x27;logprobs&#x27;</span>: None&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run--4814bca4-85e4-4d02-b6ce-9fbf48b6d2e6-0&#x27;</span>, usage_metadata=&#123;<span class="string">&#x27;input_tokens&#x27;</span>: 9, <span class="string">&#x27;output_tokens&#x27;</span>: 43, <span class="string">&#x27;total_tokens&#x27;</span>: 52, <span class="string">&#x27;input_token_details&#x27;</span>: &#123;<span class="string">&#x27;cache_read&#x27;</span>: 0&#125;, <span class="string">&#x27;output_token_details&#x27;</span>: &#123;&#125;&#125;), HumanMessage(content=<span class="string">&#x27;æˆ‘å«ä»€ä¹ˆåå­—?&#x27;</span>, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;, <span class="built_in">id</span>=<span class="string">&#x27;decc7342-cafa-407d-b8a6-ea8dbd78001f&#x27;</span>), AIMessage(content=<span class="string">&#x27;å“ˆå“ˆï¼Œä½ åˆšåˆšè¯´ä½ æ˜¯å°çº¢å‘€ï¼ğŸ˜Š å¦‚æœè¿™æ˜¯ä½ å–œæ¬¢çš„åå­—ï¼Œé‚£æˆ‘å°±å«ä½ å°çº¢å•¦ï½å¦‚æœéœ€è¦æˆ‘è®°ä½å…¶ä»–åå­—æˆ–è€…æ˜µç§°ï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘å“¦ï¼âœ¨&#x27;</span>, additional_kwargs=&#123;<span class="string">&#x27;refusal&#x27;</span>: None&#125;, response_metadata=&#123;<span class="string">&#x27;token_usage&#x27;</span>: &#123;<span class="string">&#x27;completion_tokens&#x27;</span>: 37, <span class="string">&#x27;prompt_tokens&#x27;</span>: 60, <span class="string">&#x27;total_tokens&#x27;</span>: 97, <span class="string">&#x27;completion_tokens_details&#x27;</span>: None, <span class="string">&#x27;prompt_tokens_details&#x27;</span>: &#123;<span class="string">&#x27;audio_tokens&#x27;</span>: None, <span class="string">&#x27;cached_tokens&#x27;</span>: 0&#125;, <span class="string">&#x27;prompt_cache_hit_tokens&#x27;</span>: 0, <span class="string">&#x27;prompt_cache_miss_tokens&#x27;</span>: 60&#125;, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;deepseek-chat&#x27;</span>, <span class="string">&#x27;system_fingerprint&#x27;</span>: <span class="string">&#x27;fp_08f168e49b_prod0820_fp8_kvcache&#x27;</span>, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;b393889e-3089-4097-a35d-d833bc9cf6c0&#x27;</span>, <span class="string">&#x27;service_tier&#x27;</span>: None, <span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;stop&#x27;</span>, <span class="string">&#x27;logprobs&#x27;</span>: None&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run--dad889fe-a153-4fa5-9a3e-8229b5933d49-0&#x27;</span>, usage_metadata=&#123;<span class="string">&#x27;input_tokens&#x27;</span>: 60, <span class="string">&#x27;output_tokens&#x27;</span>: 37, <span class="string">&#x27;total_tokens&#x27;</span>: 97, <span class="string">&#x27;input_token_details&#x27;</span>: &#123;<span class="string">&#x27;cache_read&#x27;</span>: 0&#125;, <span class="string">&#x27;output_token_details&#x27;</span>: &#123;&#125;&#125;), HumanMessage(content=<span class="string">&#x27;æˆ‘å–œæ¬¢AIåº”ç”¨å¼€å‘!&#x27;</span>, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;, <span class="built_in">id</span>=<span class="string">&#x27;3521ae51-a210-4543-a21d-ef5508c874ae&#x27;</span>), AIMessage(content=<span class="string">&#x27;å¤ªæ£’äº†ï¼å°çº¢å–œæ¬¢AIåº”ç”¨å¼€å‘ï¼Œè¿™å¯æ˜¯ä¸€ä¸ªå……æ»¡åˆ›é€ åŠ›å’Œæœªæ¥æ„Ÿçš„é¢†åŸŸå‘¢ï¼ğŸš€  \n\nå¦‚æœä½ éœ€è¦ï¼š  \n- **å­¦ä¹ èµ„æº**ï¼ˆæ¯”å¦‚æ•™ç¨‹ã€è¯¾ç¨‹æ¨èï¼‰  \n- **å·¥å…·æˆ–æ¡†æ¶**ï¼ˆå¦‚TensorFlowã€PyTorchã€LLMåº”ç”¨å¼€å‘ï¼‰  \n- **é¡¹ç›®çµæ„Ÿ**ï¼ˆæ¯”å¦‚è¶£å‘³å°åº”ç”¨æˆ–å®æˆ˜æ¡ˆä¾‹ï¼‰  \n- **æŠ€æœ¯é—®é¢˜è®¨è®º**ï¼ˆæ¨¡å‹è®­ç»ƒã€éƒ¨ç½²ä¼˜åŒ–ç­‰ï¼‰  \n\næˆ–è€…åªæ˜¯æƒ³åˆ†äº«ä½ çš„æƒ³æ³•å’Œä½œå“ï¼Œæˆ‘éƒ½å¾ˆä¹æ„ä¸€èµ·äº¤æµï¼ğŸ¤–ğŸ’¡  \n\næœ€è¿‘æœ‰åœ¨åšä»€ä¹ˆæœ‰è¶£çš„AIé¡¹ç›®å—ï¼Ÿæˆ–è€…å¯¹å“ªä¸ªæ–¹å‘ç‰¹åˆ«æ„Ÿå…´è¶£å‘€ï¼ŸğŸ˜ƒ&#x27;</span>, additional_kwargs=&#123;<span class="string">&#x27;refusal&#x27;</span>: None&#125;, response_metadata=&#123;<span class="string">&#x27;token_usage&#x27;</span>: &#123;<span class="string">&#x27;completion_tokens&#x27;</span>: 129, <span class="string">&#x27;prompt_tokens&#x27;</span>: 106, <span class="string">&#x27;total_tokens&#x27;</span>: 235, <span class="string">&#x27;completion_tokens_details&#x27;</span>: None, <span class="string">&#x27;prompt_tokens_details&#x27;</span>: &#123;<span class="string">&#x27;audio_tokens&#x27;</span>: None, <span class="string">&#x27;cached_tokens&#x27;</span>: 64&#125;, <span class="string">&#x27;prompt_cache_hit_tokens&#x27;</span>: 64, <span class="string">&#x27;prompt_cache_miss_tokens&#x27;</span>: 42&#125;, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;deepseek-chat&#x27;</span>, <span class="string">&#x27;system_fingerprint&#x27;</span>: <span class="string">&#x27;fp_08f168e49b_prod0820_fp8_kvcache&#x27;</span>, <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;a08f5947-137c-495e-af6b-494628d45ae9&#x27;</span>, <span class="string">&#x27;service_tier&#x27;</span>: None, <span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;stop&#x27;</span>, <span class="string">&#x27;logprobs&#x27;</span>: None&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run--f7939311-fd82-428e-a050-5e8c61b074e5-0&#x27;</span>, usage_metadata=&#123;<span class="string">&#x27;input_tokens&#x27;</span>: 106, <span class="string">&#x27;output_tokens&#x27;</span>: 129, <span class="string">&#x27;total_tokens&#x27;</span>: 235, <span class="string">&#x27;input_token_details&#x27;</span>: &#123;<span class="string">&#x27;cache_read&#x27;</span>: 64&#125;, <span class="string">&#x27;output_token_details&#x27;</span>: &#123;&#125;&#125;)]&#125;</span><br></pre></td></tr></table></figure><p>ä»ä»¥ä¸ŠåŸå§‹å¯¹è¯å†…å®¹çœ‹åˆ°ï¼Œæ˜¯æ²¡æœ‰summaryçš„æ€»ç»“è®°å½•</p><p>ä¸ºäº†è§¦å‘æ€»ç»“æœºåˆ¶ï¼Œå¯¹è¯æ•°è¦è¶…è¿‡è®¾ç½®çš„é˜ˆå€¼ï¼ˆ6ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ‰§è¡Œä¸€æ¬¡å¯¹è¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">input_message = HumanMessage(content=<span class="string">&quot;æˆ‘æ›´å–œæ¬¢Python!&quot;</span>)</span><br><span class="line">input_message.pretty_print()</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> app.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;updates&quot;</span>):</span><br><span class="line">    print_update(event)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">æˆ‘æ›´å–œæ¬¢Python!</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line"></span><br><span class="line">ğŸ‘ Pythonç®€ç›´æ˜¯AIå¼€å‘çš„â€œç‹ç‰Œè¯­è¨€â€ï¼ç”Ÿæ€å¼ºå¤§ã€åº“ä¸°å¯Œï¼Œè€Œä¸”å†™èµ·æ¥åƒä¼ªä»£ç ä¸€æ ·ä¼˜é›…ï½  </span><br><span class="line"></span><br><span class="line"><span class="comment">### ä½ å¯èƒ½å–œæ¬¢çš„Python AIå·¥å…·é“¾ï¼š</span></span><br><span class="line">- **æœºå™¨å­¦ä¹ **ï¼šScikit-learnã€XGBoost  </span><br><span class="line">- **æ·±åº¦å­¦ä¹ **ï¼šTensorFlowã€PyTorchã€Keras  </span><br><span class="line">- **è‡ªç„¶è¯­è¨€å¤„ç†**ï¼šHugging Face Transformersã€spaCyã€NLTK  </span><br><span class="line">- **æ•°æ®å¤„ç†**ï¼šPandasã€NumPyã€Matplotlib  </span><br><span class="line">- **å¿«é€ŸåŸå‹**ï¼šJupyter Notebook + Colab  </span><br><span class="line"></span><br><span class="line"><span class="comment">### å°å»ºè®®ï¼š</span></span><br><span class="line">å¦‚æœä½ ç”¨PythonåšAIå¼€å‘ï¼Œå¼ºçƒˆè¯•è¯• **Anaconda** ç®¡ç†ç¯å¢ƒï¼Œç”¨ **VS Code** æˆ– **PyCharm** å†™ä»£ç ï¼Œå†æ­é… **Git** ç‰ˆæœ¬æ§åˆ¶ï½  </span><br><span class="line"></span><br><span class="line">æœ€è¿‘åœ¨å°è¯•ä»€ä¹ˆåº“æˆ–é¡¹ç›®å—ï¼Ÿå¯ä»¥ä¸€èµ·èŠèŠæ€è·¯ï¼ğŸâœ¨</span><br><span class="line">================================[1m Remove Message [0m================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">================================[1m Remove Message [0m================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">================================[1m Remove Message [0m================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">================================[1m Remove Message [0m================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">================================[1m Remove Message [0m================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">================================[1m Remove Message [0m================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">**å¯¹è¯æ‘˜è¦**  </span><br><span class="line">**å‚ä¸è€…**ï¼šå°çº¢ï¼ˆç”¨æˆ·ï¼‰ä¸ DeepSeek-V3ï¼ˆAIåŠ©æ‰‹ï¼‰  </span><br><span class="line">**ä¸»é¢˜**ï¼šAIåº”ç”¨å¼€å‘ä¸PythonæŠ€æœ¯åå¥½  </span><br><span class="line"></span><br><span class="line">**å…³é”®å†…å®¹**ï¼š  </span><br><span class="line">1. **è‡ªæˆ‘ä»‹ç»**ï¼šç”¨æˆ·è‡ªç§°â€œå°çº¢â€ï¼ŒAIåŠ©æ‰‹è¡¨ç¤ºæ¬¢è¿å¹¶æä¾›ååŠ©æ„æ„¿ã€‚  </span><br><span class="line">2. **èº«ä»½ç¡®è®¤**ï¼šç”¨æˆ·è¯¢é—®åå­—ï¼ŒAIé‡ç”³ç”¨æˆ·åä¸ºâ€œå°çº¢â€å¹¶æ”¯æŒè‡ªå®šä¹‰ç§°å‘¼ã€‚  </span><br><span class="line">3. **å…´è¶£è¡¨è¾¾**ï¼šç”¨æˆ·æ˜ç¡®å–œæ¬¢AIåº”ç”¨å¼€å‘ï¼ŒAIæ¨èå­¦ä¹ èµ„æºã€å·¥å…·åŠé¡¹ç›®çµæ„Ÿï¼Œå¹¶é‚€è¯·åˆ†äº«å…·ä½“æ–¹å‘ã€‚  </span><br><span class="line">4. **æŠ€æœ¯åå¥½**ï¼šç”¨æˆ·å¼ºè°ƒæ›´åå¥½Pythonï¼ŒAIåˆ—ä¸¾Pythonåœ¨AIé¢†åŸŸçš„æ ¸å¿ƒå·¥å…·é“¾ï¼ˆå¦‚PyTorchã€Transformersç­‰ï¼‰ï¼Œå¹¶è¡¥å……å¼€å‘ç¯å¢ƒå»ºè®®ï¼ˆAnacondaã€VS Codeç­‰ï¼‰ã€‚  </span><br><span class="line">5. **äº’åŠ¨å¯¼å‘**ï¼šAIæŒç»­é¼“åŠ±ç”¨æˆ·åˆ†äº«å½“å‰é¡¹ç›®æˆ–å…´è¶£ç‚¹ï¼Œä¿æŒå¼€æ”¾è®¨è®ºã€‚  </span><br><span class="line"></span><br><span class="line">**ç‰¹ç‚¹**ï¼šå¯¹è¯ç®€æ´å‹å¥½ï¼Œèšç„¦æŠ€æœ¯äº¤æµï¼ŒAIä¸»åŠ¨æä¾›ç»“æ„åŒ–å»ºè®®å¹¶å¼•å¯¼æ·±å…¥æ¢è®¨ã€‚  </span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»æ‰§è¡Œçš„è¾“å‡ºå†…å®¹çœ‹ï¼Œå·²ç»è¿›è¡Œæ¶ˆæ¯çš„åˆ é™¤ä»¥åŠå¯¹è¯çš„æ€»ç»“ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹åŸå§‹å¯¹è¯è®°å½•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">values = app.get_state(config).values</span><br><span class="line"><span class="built_in">print</span>(values)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;messages&#x27;: [HumanMessage(content=&#x27;æˆ‘æ›´å–œæ¬¢Python!&#x27;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;, id=&#x27;7d4f3a28-e18d-494f-a05b-a16063ede5b4&#x27;), AIMessage(content=&#x27;ğŸ‘ Pythonç®€ç›´æ˜¯AIå¼€å‘çš„â€œç‹ç‰Œè¯­è¨€â€ï¼ç”Ÿæ€å¼ºå¤§ã€åº“ä¸°å¯Œï¼Œè€Œä¸”å†™èµ·æ¥åƒä¼ªä»£ç ä¸€æ ·ä¼˜é›…ï½  \n\n### ä½ å¯èƒ½å–œæ¬¢çš„Python AIå·¥å…·é“¾ï¼š\n- **æœºå™¨å­¦ä¹ **ï¼šScikit-learnã€XGBoost  \n- **æ·±åº¦å­¦ä¹ **ï¼šTensorFlowã€PyTorchã€Keras  \n- **è‡ªç„¶è¯­è¨€å¤„ç†**ï¼šHugging Face Transformersã€spaCyã€NLTK  \n- **æ•°æ®å¤„ç†**ï¼šPandasã€NumPyã€Matplotlib  \n- **å¿«é€ŸåŸå‹**ï¼šJupyter Notebook + Colab  \n\n### å°å»ºè®®ï¼š\nå¦‚æœä½ ç”¨PythonåšAIå¼€å‘ï¼Œå¼ºçƒˆè¯•è¯• **Anaconda** ç®¡ç†ç¯å¢ƒï¼Œç”¨ **VS Code** æˆ– **PyCharm** å†™ä»£ç ï¼Œå†æ­é… **Git** ç‰ˆæœ¬æ§åˆ¶ï½  \n\næœ€è¿‘åœ¨å°è¯•ä»€ä¹ˆåº“æˆ–é¡¹ç›®å—ï¼Ÿå¯ä»¥ä¸€èµ·èŠèŠæ€è·¯ï¼ğŸâœ¨&#x27;, additional_kwargs=&#123;&#x27;refusal&#x27;: None&#125;, response_metadata=&#123;&#x27;token_usage&#x27;: &#123;&#x27;completion_tokens&#x27;: 178, &#x27;prompt_tokens&#x27;: 243, &#x27;total_tokens&#x27;: 421, &#x27;completion_tokens_details&#x27;: None, &#x27;prompt_tokens_details&#x27;: &#123;&#x27;audio_tokens&#x27;: None, &#x27;cached_tokens&#x27;: 192&#125;, &#x27;prompt_cache_hit_tokens&#x27;: 192, &#x27;prompt_cache_miss_tokens&#x27;: 51&#125;, &#x27;model_name&#x27;: &#x27;deepseek-chat&#x27;, &#x27;system_fingerprint&#x27;: &#x27;fp_08f168e49b_prod0820_fp8_kvcache&#x27;, &#x27;id&#x27;: &#x27;046eef7d-7034-4093-8e72-05c2d2c46211&#x27;, &#x27;service_tier&#x27;: None, &#x27;finish_reason&#x27;: &#x27;stop&#x27;, &#x27;logprobs&#x27;: None&#125;, id=&#x27;run--696f424e-0663-4653-a90c-42d156ff4ddb-0&#x27;, usage_metadata=&#123;&#x27;input_tokens&#x27;: 243, &#x27;output_tokens&#x27;: 178, &#x27;total_tokens&#x27;: 421, &#x27;input_token_details&#x27;: &#123;&#x27;cache_read&#x27;: 192&#125;, &#x27;output_token_details&#x27;: &#123;&#125;&#125;)], &#x27;summary&#x27;: &#x27;---\n\n**å¯¹è¯æ‘˜è¦**  \n**å‚ä¸è€…**ï¼šå°çº¢ï¼ˆç”¨æˆ·ï¼‰ä¸ DeepSeek-V3ï¼ˆAIåŠ©æ‰‹ï¼‰  \n**ä¸»é¢˜**ï¼šAIåº”ç”¨å¼€å‘ä¸PythonæŠ€æœ¯åå¥½  \n\n**å…³é”®å†…å®¹**ï¼š  \n1. **è‡ªæˆ‘ä»‹ç»**ï¼šç”¨æˆ·è‡ªç§°â€œå°çº¢â€ï¼ŒAIåŠ©æ‰‹è¡¨ç¤ºæ¬¢è¿å¹¶æä¾›ååŠ©æ„æ„¿ã€‚  \n2. **èº«ä»½ç¡®è®¤**ï¼šç”¨æˆ·è¯¢é—®åå­—ï¼ŒAIé‡ç”³ç”¨æˆ·åä¸ºâ€œå°çº¢â€å¹¶æ”¯æŒè‡ªå®šä¹‰ç§°å‘¼ã€‚  \n3. **å…´è¶£è¡¨è¾¾**ï¼šç”¨æˆ·æ˜ç¡®å–œæ¬¢AIåº”ç”¨å¼€å‘ï¼ŒAIæ¨èå­¦ä¹ èµ„æºã€å·¥å…·åŠé¡¹ç›®çµæ„Ÿï¼Œå¹¶é‚€è¯·åˆ†äº«å…·ä½“æ–¹å‘ã€‚  \n4. **æŠ€æœ¯åå¥½**ï¼šç”¨æˆ·å¼ºè°ƒæ›´åå¥½Pythonï¼ŒAIåˆ—ä¸¾Pythonåœ¨AIé¢†åŸŸçš„æ ¸å¿ƒå·¥å…·é“¾ï¼ˆå¦‚PyTorchã€Transformersç­‰ï¼‰ï¼Œå¹¶è¡¥å……å¼€å‘ç¯å¢ƒå»ºè®®ï¼ˆAnacondaã€VS Codeç­‰ï¼‰ã€‚  \n5. **äº’åŠ¨å¯¼å‘**ï¼šAIæŒç»­é¼“åŠ±ç”¨æˆ·åˆ†äº«å½“å‰é¡¹ç›®æˆ–å…´è¶£ç‚¹ï¼Œä¿æŒå¼€æ”¾è®¨è®ºã€‚  \n\n**ç‰¹ç‚¹**ï¼šå¯¹è¯ç®€æ´å‹å¥½ï¼Œèšç„¦æŠ€æœ¯äº¤æµï¼ŒAIä¸»åŠ¨æä¾›ç»“æ„åŒ–å»ºè®®å¹¶å¼•å¯¼æ·±å…¥æ¢è®¨ã€‚  \n\n---&#x27;&#125;</span><br></pre></td></tr></table></figure><p>ä»ä»¥ä¸ŠåŸå§‹å¯¹è¯å†…å®¹çœ‹åˆ°ï¼Œå·²ç»æœ‰summaryçš„æ€»ç»“è®°å½•</p><p>æ­¤æ—¶ç”±äºæ€»ç»“ä¸­é™„å¸¦äº†è¿‡å¾€çš„æ ¸å¿ƒæ¶ˆæ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¾ç„¶å¯ä»¥è¿›è¡Œè®°å¿†å›é¡¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">input_message = HumanMessage(content=<span class="string">&quot;æˆ‘å«ä»€ä¹ˆåå­—?&quot;</span>)</span><br><span class="line">input_message.pretty_print()</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> app.stream(&#123;<span class="string">&quot;messages&quot;</span>: [input_message]&#125;, config, stream_mode=<span class="string">&quot;updates&quot;</span>):</span><br><span class="line">    print_update(event)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">æˆ‘å«ä»€ä¹ˆåå­—?</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">å“ˆå“ˆï¼Œä½ ä¹‹å‰è¯´å¯ä»¥å«ä½ ã€Œå°çº¢ã€å‘€ï½ ğŸ˜Š  </span><br><span class="line">å¦‚æœä½ å¸Œæœ›æ¢ä¸€ä¸ªåå­—ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼æ¯•ç«Ÿåå­—æƒå±äºä½ æœ¬äººâœ¨</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å­¦ä¹ LangGraphå­¦ä¹ ç¬”è®°ç¬¬ä¸‰è®²</summary>
    
    
    
    <category term="LangChain" scheme="https://jinglv.github.io/categories/LangChain/"/>
    
    
    <category term="LangGraph" scheme="https://jinglv.github.io/tags/LangGraph/"/>
    
  </entry>
  
  <entry>
    <title>LangGraphä»‹ç»</title>
    <link href="https://jinglv.github.io/2025/09/17/ai/langchain/langgraph/1-langgraph-introduce/"/>
    <id>https://jinglv.github.io/2025/09/17/ai/langchain/langgraph/1-langgraph-introduce/</id>
    <published>2025-09-16T16:00:00.000Z</published>
    <updated>2025-09-17T01:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯æ™ºèƒ½ä½“"><a href="#ä»€ä¹ˆæ˜¯æ™ºèƒ½ä½“" class="headerlink" title="ä»€ä¹ˆæ˜¯æ™ºèƒ½ä½“"></a>ä»€ä¹ˆæ˜¯æ™ºèƒ½ä½“</h1><p>æ™ºèƒ½ä½“ï¼ˆAI Agentsæˆ–Agentsï¼‰æ˜¯æŒ‡èƒ½å¤Ÿ<strong>è‡ªä¸»æ„ŸçŸ¥ç¯å¢ƒã€åšå‡ºå†³ç­–å¹¶æ‰§è¡Œè¡ŒåŠ¨çš„ç³»ç»Ÿæˆ–ç¨‹åº</strong>ã€‚æ ¹æ®IBMçš„å®šä¹‰ï¼Œæ™ºèƒ½ä½“æ˜¯â€œèƒ½å¤Ÿé€šè¿‡è®¾è®¡å…¶å·¥ä½œæµå’Œåˆ©ç”¨å¯ç”¨å·¥å…·ï¼Œä»£è¡¨ç”¨æˆ·æˆ–å…¶ä»–ç³»ç»Ÿè‡ªä¸»æ‰§è¡Œä»»åŠ¡çš„ç³»ç»Ÿæˆ–ç¨‹åºâ€[<a href="https://www.ibm.com/cn-zh/think/topics/ai-agents">IBM</a>]ã€‚è‹±ä¼Ÿè¾¾åˆ™å°†æ™ºèƒ½ä½“æè¿°ä¸ºâ€œAI æ™ºèƒ½ä½“æ˜¯å…ˆè¿›çš„ AI ç³»ç»Ÿï¼Œæ—¨åœ¨<strong>æ ¹æ®é«˜çº§ç›®æ ‡è‡ªä¸»è¿›è¡Œæ¨ç†ï¼Œåˆ¶å®šè®¡åˆ’å¹¶æ‰§è¡Œå¤æ‚ä»»åŠ¡</strong>ã€‚â€ï¼Œä»£è¡¨äº†â€œä»ç®€å•è‡ªåŠ¨åŒ–å‘èƒ½å¤Ÿç®¡ç†å¤æ‚å·¥ä½œæµçš„è‡ªä¸»ç³»ç»Ÿè¿‡æ¸¡â€çš„æ¼”è¿›æ–¹å‘[<a href="https://www.nvidia.cn/glossary/ai-agents/">NVIDIA</a>]ã€‚</p><p>åœ¨æ›´ä¸“ä¸šçš„å­¦æœ¯å®šä¹‰ä¸­ï¼Œç™¾åº¦ç™¾ç§‘æŒ‡å‡ºï¼šâ€œæ™ºèƒ½ä½“æ˜¯æŒ‡èƒ½å¤Ÿæ„ŸçŸ¥ç¯å¢ƒå¹¶è‡ªä¸»é‡‡å–è¡ŒåŠ¨ä»¥å®ç°ç‰¹å®šç›®æ ‡çš„å®ä½“ã€‚è¿™ä¸€æ¦‚å¿µæœ€æ—©ç”±â€œäººå·¥æ™ºèƒ½ä¹‹çˆ¶â€é©¬æ–‡Â·æ˜æ–¯åŸºæå‡ºï¼Œä»–è®¤ä¸ºæŸäº›é—®é¢˜å¯ç»ç”±ç¤¾ä¼šä¸­çš„ä¸€äº›ä¸ªä½“ç»è¿‡åå•†åè§£å†³ï¼Œè¿™äº›ä¸ªä½“å°±æ˜¯æ™ºèƒ½ä½“ã€‚â€[<a href="https://baike.baidu.com/item/æ™ºèƒ½ä½“/9446647">ç™¾åº¦ç™¾ç§‘</a>]</p><p>æ™ºèƒ½ä½“å…·æœ‰ä»¥ä¸‹åŸºæœ¬ç‰¹å¾ï¼š</p><ul><li>è‡ªä¸»æ€§(Autonomy)ï¼šæ™ºèƒ½ä½“èƒ½å¤Ÿåœ¨æ²¡æœ‰äººç±»æˆ–å…¶ä»–å®ä½“çš„ç›´æ¥å¹²é¢„ä¸‹è¿è¡Œï¼Œå¹¶å¯¹å…¶è¡ŒåŠ¨å’Œå†…éƒ¨çŠ¶æ€å…·æœ‰æŸç§ç¨‹åº¦çš„æ§åˆ¶ã€‚</li><li>ååº”æ€§(Reactivity)ï¼šæ™ºèƒ½ä½“èƒ½å¤Ÿæ„ŸçŸ¥å…¶ç¯å¢ƒï¼Œå¹¶å¯¹ç¯å¢ƒå˜åŒ–åšå‡ºå®æ—¶å“åº”ã€‚</li><li>äº¤äº’æ€§/ç¤¾äº¤æ€§(Socialability)ï¼šæ™ºèƒ½ä½“èƒ½å¤Ÿä¸å…¶ä»–æ™ºèƒ½ä½“æˆ–äººç±»è¿›è¡Œäº¤äº’å’Œåä½œã€‚</li><li>é€‚åº”æ€§/ä¸»åŠ¨æ€§(Proactivity)ï¼šæ™ºèƒ½ä½“èƒ½å¤Ÿæ ¹æ®ç¯å¢ƒå˜åŒ–ä¸»åŠ¨è°ƒæ•´å…¶è¡Œä¸ºç­–ç•¥ï¼Œé€‚åº”æ–°çš„æƒ…å†µã€‚</li><li>å­¦ä¹ èƒ½åŠ›ï¼šè®¸å¤šæ™ºèƒ½ä½“å…·æœ‰é€šè¿‡ç»éªŒæˆ–æ•°æ®å­¦ä¹ å’Œæ”¹è¿›çš„èƒ½åŠ›ã€‚</li></ul><h1 id="å•æ™ºèƒ½ä½“ä¸å¤šæ™ºèƒ½ä½“"><a href="#å•æ™ºèƒ½ä½“ä¸å¤šæ™ºèƒ½ä½“" class="headerlink" title="å•æ™ºèƒ½ä½“ä¸å¤šæ™ºèƒ½ä½“"></a>å•æ™ºèƒ½ä½“ä¸å¤šæ™ºèƒ½ä½“</h1><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250917095828145.png" alt="image-20250917095828145" style="zoom:50%;" /></p><h2 id="LangChainå†…ç½®"><a href="#LangChainå†…ç½®" class="headerlink" title="LangChainå†…ç½®"></a>LangChainå†…ç½®</h2><p>æ³¨æ„ï¼šLangChainå†…ç½®çš„Agentæ¨¡å—å·²ç»ä¸åœ¨æ”¯æŒç»´æŠ¤äº†ï¼Œæ™ºèƒ½ä½“å¼€å‘é‡ç‚¹ä½¿ç”¨LangGraph</p><p>å•Agentçš„ç‰¹ç‚¹</p><ul><li>ç»“æ„ç®€å•ï¼Œåªæœ‰ä¸€ä¸ªæ™ºèƒ½ä½“è´Ÿè´£æ‰€æœ‰ä»»åŠ¡</li><li>å†³ç­–è¿‡ç¨‹ä¸­ï¼Œä¸éœ€è¦åè°ƒå¤šä¸ªAgentä¹‹é—´çš„é€šä¿¡</li><li>é€‚åˆå¤„ç†ç›¸å¯¹ç®€å•æˆ–ä¸“ä¸€çš„ä»»åŠ¡</li><li>é€šå¸¸è®¡ç®—èµ„æºéœ€æ±‚è¾ƒå°‘</li><li>å“åº”é€Ÿåº¦å¯èƒ½æ›´å¿«ï¼Œå› ä¸ºä¸éœ€è¦å¤šAgenté—´çš„åè°ƒ</li></ul><h2 id="LangGraphå†…ç½®"><a href="#LangGraphå†…ç½®" class="headerlink" title="LangGraphå†…ç½®"></a>LangGraphå†…ç½®</h2><p>å¤šAgentsçš„ç‰¹ç‚¹</p><ul><li>ç³»ç»Ÿç”±å¤šä¸ªç›¸äº’åä½œçš„æ™ºèƒ½ä½“ç»„æˆ</li><li>å„Agentå¯èƒ½æœ‰ä¸åŒçš„ä¸“ä¸šé¢†åŸŸæˆ–åŠŸèƒ½</li><li>éœ€è¦Agentä¹‹é—´å¾—çš„é€šä¿¡å’Œåè°ƒæœºåˆ¶</li><li>å¯ä»¥å¹¶è¡Œå¤„ç†å¤šä¸ªä»»åŠ¡</li><li>ç³»ç»Ÿæ•´ä½“æ›´åŠ å¤æ‚ä½†ä¹Ÿæ›´åŠ å¼ºå¤§</li><li>å…·æœ‰æ›´å¥½çš„å¯æ‰©å±•æ€§å’Œå®¹é”™èƒ½åŠ›</li></ul><h1 id="å¤šæ™ºèƒ½ä½“"><a href="#å¤šæ™ºèƒ½ä½“" class="headerlink" title="å¤šæ™ºèƒ½ä½“"></a>å¤šæ™ºèƒ½ä½“</h1><ul><li>æ›´å°é¢—ç²’åº¦å’Œæ›´ä½å±‚é¢çš„å°è£…</li><li>æ›´çµæ´»</li><li>éš¾åº¦ä¹Ÿæ›´é«˜</li></ul><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250917100224849.png" alt="image-20250917100224849" style="zoom:50%;" /></p><h1 id="å¸¸è§çš„å¤šæ™ºèƒ½ä½“æ¶æ„"><a href="#å¸¸è§çš„å¤šæ™ºèƒ½ä½“æ¶æ„" class="headerlink" title="å¸¸è§çš„å¤šæ™ºèƒ½ä½“æ¶æ„"></a>å¸¸è§çš„å¤šæ™ºèƒ½ä½“æ¶æ„</h1><p>å¤šæ™ºèƒ½ä½“æ¶æ„ä¸­çš„ç½‘çŠ¶ç»“æ„ã€ç›‘ç®¡è€…æ¨¡å¼ã€åˆ†çº§æ¶æ„å’Œè‡ªå®šä¹‰æ¨¡å¼ï¼Œå¹¶é€šè¿‡ç±»æ¯”äººç±»å·¥ä½œæ–¹å¼è¯´æ˜å¤šæ™ºèƒ½ä½“å¦‚ä½•åä½œå®Œæˆå¤æ‚ä»»åŠ¡ã€‚</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250917100621793.png" alt="image-20250917100621793" style="zoom:67%;" /></p><ul><li>ç½‘çŠ¶ç»“æ„ï¼šä»»ä½•ä¸€ä¸ªæ™ºèƒ½ä½“éƒ½å¯ä»¥è¿›è¡Œå†³ç­–</li><li>ç›‘ç£è€…ç»“æ„ï¼šç”±ä¸»ç®¡æ¥å†³ç­–ä¸‹ä¸€æ­¥æ“ä½œ</li><li>ç›‘ç®¡è€…æ¶æ„ï¼ˆå·¥å…·ï¼‰ï¼šæ™ºèƒ½ä½“ä½œä¸ºå·¥å…·ï¼Œæ¥å—ä¸€ä¸ªLLMä¸»ç®¡çš„è°ƒç”¨</li><li>åˆ†çº§æ¶æ„ï¼šå¤šçº§æ¶æ„æ¯çº§éƒ½æœ‰ä¸€ä¸ªç›‘ç®¡è€…</li><li>è‡ªå®šä¹‰ï¼šåªæœ‰éƒ¨åˆ†æ™ºèƒ½ä½“å…·å¤‡å†³ç­–æƒ</li></ul><h1 id="LangGraphä»‹ç»"><a href="#LangGraphä»‹ç»" class="headerlink" title="LangGraphä»‹ç»"></a>LangGraphä»‹ç»</h1><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250917101404838.png" alt="image-20250917101404838" style="zoom:50%;" /></p><p>å®˜æ–¹åœ°å€ï¼š<a href="https://langchain-ai.github.io/langgraph">https://langchain-ai.github.io/langgraph</a></p><p><strong>LangGraph</strong> æ˜¯ä¸€ä¸ªä¸“æ³¨äºæ„å»ºã€ç®¡ç†å’Œéƒ¨ç½² <strong>æœ‰çŠ¶æ€ï¼ˆStatefulï¼‰</strong>ã€<strong>é•¿æœŸè¿è¡Œï¼ˆLong-runningï¼‰</strong> çš„ LLM Agent ç¼–æ’æ¡†æ¶ã€‚ </p><ul><li><strong>æ ¸å¿ƒè®¾è®¡æ€æƒ³</strong>ï¼šç»“åˆçŠ¶æ€æœºæ¨¡å‹ä¸ç°ä»£é“¾å¼é€»è¾‘ç¼–æ’èƒ½åŠ›ã€‚ </li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šæ™ºèƒ½ä»£ç†ç³»ç»Ÿã€å¤æ‚å·¥ä½œæµç®¡ç†ã€äººæœºååŒä»»åŠ¡ã€‚ </li><li><strong>è¡Œä¸šåº”ç”¨</strong>ï¼šè¢« Klarnaã€Replitã€Elastic ç­‰ä¸€çº¿å…¬å¸å¹¿æ³›é‡‡ç”¨ï¼Œé€æ­¥æˆä¸ºä¸‹ä¸€ä»£ Agent ç³»ç»Ÿçš„æ ¸å¿ƒåº•åº§ã€‚</li></ul><h2 id="æ ¸å¿ƒä¼˜åŠ¿"><a href="#æ ¸å¿ƒä¼˜åŠ¿" class="headerlink" title="æ ¸å¿ƒä¼˜åŠ¿"></a>æ ¸å¿ƒä¼˜åŠ¿</h2><p>LangGraph ä¸ºé•¿æœŸè¿è¡Œ/æœ‰çŠ¶æ€çš„å·¥ä½œæµæä¾›åº•å±‚åŸºç¡€è®¾æ–½æ”¯æŒï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹æ€§ï¼š </p><div class="table-container"><table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æŒä¹…æ‰§è¡Œ</strong></td><td>æ”¯æŒæ•…éšœæ¢å¤ï¼Œè‡ªåŠ¨ä»ä¸­æ–­ç‚¹ç»§ç»­æ‰§è¡Œã€‚</td></tr><tr><td><strong>äººæœºäº¤äº’</strong></td><td>å…è®¸å®æ—¶æ£€æŸ¥/ä¿®æ”¹ä»£ç†çŠ¶æ€ï¼Œæ— ç¼é›†æˆäººå·¥ç›‘ç£ã€‚</td></tr><tr><td><strong>ç»¼åˆè®°å¿†</strong></td><td>çŸ­æœŸå·¥ä½œè®°å¿†ï¼ˆæ¨ç†ï¼‰ + é•¿æœŸæŒä¹…è®°å¿†ï¼ˆè·¨ä¼šè¯ï¼‰ã€‚</td></tr><tr><td><strong>LangSmith è°ƒè¯•</strong></td><td>é€šè¿‡å¯è§†åŒ–å·¥å…·è·Ÿè¸ªæ‰§è¡Œè·¯å¾„ã€çŠ¶æ€è½¬æ¢å’Œè¿è¡Œæ—¶æŒ‡æ ‡ã€‚</td></tr><tr><td><strong>ç”Ÿäº§å°±ç»ªéƒ¨ç½²</strong></td><td>æä¾›å¯æ‰©å±•æ¶æ„ï¼Œä¸“ä¸ºæœ‰çŠ¶æ€å·¥ä½œæµçš„ç‹¬ç‰¹æŒ‘æˆ˜è®¾è®¡ã€‚</td></tr></tbody></table></div><h2 id="LangGraph-ç”Ÿæ€ç³»ç»Ÿ"><a href="#LangGraph-ç”Ÿæ€ç³»ç»Ÿ" class="headerlink" title="LangGraph ç”Ÿæ€ç³»ç»Ÿ"></a>LangGraph ç”Ÿæ€ç³»ç»Ÿ</h2><p>LangGraph å¯ç‹¬ç«‹ä½¿ç”¨ï¼Œä¹Ÿå¯ä¸ LangChain ç”Ÿæ€æ·±åº¦é›†æˆï¼š </p><div class="table-container"><table><thead><tr><th>ç»„ä»¶</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><strong>LangSmith</strong></td><td>ä»£ç†è¯„ä¼°ä¸å¯è§‚æµ‹æ€§å·¥å…·ï¼Œæ”¯æŒç”Ÿäº§ç¯å¢ƒç›‘æ§å’Œæ€§èƒ½ä¼˜åŒ–ã€‚</td></tr><tr><td><strong>LangGraph å¹³å°</strong></td><td>ä¸“ä¸ºé•¿æœŸå·¥ä½œæµè®¾è®¡çš„éƒ¨ç½²å¹³å°ï¼Œæ”¯æŒå¯è§†åŒ–åŸå‹è®¾è®¡ï¼ˆLangGraph Studioï¼‰ã€‚</td></tr><tr><td><strong>LangChain</strong></td><td>æä¾›å¯ç»„åˆçš„ LLM å¼€å‘ç»„ä»¶ï¼Œç®€åŒ–åº”ç”¨æ„å»ºæµç¨‹ã€‚</td></tr></tbody></table></div><h2 id="ç¯å¢ƒå®‰è£…"><a href="#ç¯å¢ƒå®‰è£…" class="headerlink" title="ç¯å¢ƒå®‰è£…"></a>ç¯å¢ƒå®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install langgraph</span><br></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: __start__</span><br><span class="line">st1=&gt;operation: step_1</span><br><span class="line">st2=&gt;operation: step_2</span><br><span class="line">e=&gt;end: step_3</span><br><span class="line">st-&gt;st1-&gt;st2-&gt;e</span><br></pre></td></tr></table></figure><h3 id="Stateï¼ˆçŠ¶æ€ï¼‰"><a href="#Stateï¼ˆçŠ¶æ€ï¼‰" class="headerlink" title="Stateï¼ˆçŠ¶æ€ï¼‰"></a>Stateï¼ˆçŠ¶æ€ï¼‰</h3><ul><li>çŠ¶æ€æ˜¯ä¸€ä¸ªåœ¨æ•´ä¸ªå›¾ä¸­å…±äº«å’Œä¼ é€’çš„å¯¹è±¡ï¼ŒåŒ…å«äº†æµç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰ä¿¡æ¯ã€‚</li><li>æœ‰çŠ¶æ€ï¼ˆstatefulï¼‰ï¼šç¨‹åºå…·æœ‰â€œè®°å¿†â€ï¼Œèƒ½è®°ä½è¿‡å»çš„æ­¥éª¤å’Œç»“æœï¼Œå¹¶æ ¹æ®è¿™äº›ä¿¡æ¯æ¥å†³å®šä¸‹ä¸€æ­¥</li><li>å¯å˜ï¼ˆmutableï¼‰ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ä¿®æ”¹çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½ä¼šå°†LLMçš„å›å¤å†™å…¥çŠ¶æ€ä¸­ï¼Œè€Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹åˆ™ä¼šè¯»å–è¿™ä¸ªå›å¤å¹¶æ ¹æ®å®ƒæ¥åšå†³ç­–</li></ul><h3 id="Nodeï¼ˆèŠ‚ç‚¹ï¼‰"><a href="#Nodeï¼ˆèŠ‚ç‚¹ï¼‰" class="headerlink" title="Nodeï¼ˆèŠ‚ç‚¹ï¼‰"></a>Nodeï¼ˆèŠ‚ç‚¹ï¼‰</h3><ul><li>èŠ‚ç‚¹æ˜¯å›¾ä¸­çš„åŸºæœ¬å•å…ƒï¼Œä»£è¡¨ä¸€ä¸ªå…·ä½“çš„åŠŸèƒ½æˆ–æ“ä½œï¼Œè§†ä½œæµç¨‹ä¸­çš„ä¸€ä¸ªæ­¥éª¤</li><li>æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å®Œæˆä¸€é¡¹ç‰¹å®šä»»åŠ¡ï¼ˆå¦‚æŸ¥è¯¢æ•°æ®ã€ç”Ÿæˆæ–‡æœ¬ã€åšå†³ç­–ç­‰ï¼‰</li><li>èŠ‚ç‚¹æ¥å—è¾“å…¥ï¼Œå¤„ç†åäº§ç”Ÿè¾“å‡º</li><li>å¯ä»¥æ˜¯ç®€å•çš„å‡½æ•°ã€APIè°ƒç”¨ã€LLMè°ƒç”¨æˆ–å…¶ä»–å¤æ‚æ“ä½œ</li></ul><h3 id="Edgesï¼ˆè¾¹ï¼‰"><a href="#Edgesï¼ˆè¾¹ï¼‰" class="headerlink" title="Edgesï¼ˆè¾¹ï¼‰"></a>Edgesï¼ˆè¾¹ï¼‰</h3><ul><li>è¾¹å†³å®šäº†æµç¨‹å¦‚ä½•ä»ä¸€ä¸ªèŠ‚ç‚¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li><li>LangGraphæ”¯æŒä¸¤ç§ä¸»è¦ç±»å‹çš„è¾¹ï¼š<ul><li>Normal Edgesï¼ˆæ™®é€šè¾¹ï¼‰ï¼šç®€å•çš„å°†æµç¨‹ä»èŠ‚ç‚¹A -&gt; B</li><li>Conditional Edgesï¼ˆæ¡ä»¶è¾¹ï¼‰ï¼šæ ¹æ®å½“å‰çŠ¶æ€çš„å†…å®¹æ¥å†³å®šä¸‹ä¸€æ­¥æ‰§è¡Œå“ªä¸ªèŠ‚ç‚¹ï¼Œæ˜¯æ ¹æ®LLMçš„å›å¤æˆ–å·¥å…·çš„ç»“æœåŠ¨æ€çš„åšå‡ºå†³ç­–</li></ul></li></ul><h3 id="Graphï¼ˆå›¾ï¼‰"><a href="#Graphï¼ˆå›¾ï¼‰" class="headerlink" title="Graphï¼ˆå›¾ï¼‰"></a>Graphï¼ˆå›¾ï¼‰</h3><ul><li>å›¾æ˜¯èŠ‚ç‚¹åŠå…¶è¿æ¥å…³ç³»çš„é›†åˆï¼Œä»£è¡¨æ•´ä¸ªå·¥ä½œæµç¨‹</li><li>å®šä¹‰äº†ä¿¡æ¯å¦‚ä½•ä»ä¸€ä¸ªèŠ‚ç‚¹æµå‘å¦ä¸€ä¸ªèŠ‚ç‚¹</li><li>å¯ä»¥æ˜¯çº¿æ€§çš„ï¼ˆA -&gt; B -&gt; Cï¼‰æˆ–åŒ…å«åˆ†æ”¯ã€å¾ªç¯å¤æ‚ç»“æ„</li><li>æ§åˆ¶æ•´ä¸ªåº”ç”¨çš„æ‰§è¡Œæµç¨‹å’Œé€»è¾‘</li></ul>]]></content>
    
    
    <summary type="html">å­¦ä¹ LangGraphå­¦ä¹ ç¬”è®°ç¬¬ä¸€è®²</summary>
    
    
    
    <category term="LangChain" scheme="https://jinglv.github.io/categories/LangChain/"/>
    
    
    <category term="LangGraph" scheme="https://jinglv.github.io/tags/LangGraph/"/>
    
  </entry>
  
  <entry>
    <title>MCPæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ä»‹ç»</title>
    <link href="https://jinglv.github.io/2025/09/16/ai/langchain/11-langchain-agent-mcp/"/>
    <id>https://jinglv.github.io/2025/09/16/ai/langchain/11-langchain-agent-mcp/</id>
    <published>2025-09-15T16:00:00.000Z</published>
    <updated>2025-09-16T07:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯MCP"><a href="#ä»€ä¹ˆæ˜¯MCP" class="headerlink" title="ä»€ä¹ˆæ˜¯MCP"></a>ä»€ä¹ˆæ˜¯MCP</h1><p><strong>å¤§æ¨¡å‹å’Œå¤–éƒ¨å·¥å…·äº¤äº’çš„æ ‡å‡†åŒ–åè®®</strong></p><p><strong>æ¨¡å‹ä¸Šä¸‹æ–‡åè®®(MCP ModelContextProtocol)æ­£è¿…é€Ÿæˆä¸ºAIé¢†åŸŸçš„æ ¸å¿ƒåŸºç¡€è®¾æ–½æ ‡å‡†ï¼Œå®ƒé€šè¿‡æ ‡å‡†åŒ–å¤§è¯­è¨€æ¨¡å‹ä¸å¤–éƒ¨å·¥å…·çš„äº¤äº’æ–¹å¼ï¼Œè§£å†³äº†AIåº”ç”¨å¼€å‘ä¸­çš„å…³é”®ç“¶é¢ˆï¼Œæ¨åŠ¨äº†æ™ºèƒ½ä½“ä»å®éªŒå®¤èµ°å‘å•†ä¸šåŒ–çš„è¿›ç¨‹</strong>ã€‚è¿™ä¸€ç”±Anthropicäº2024å¹´11æœˆå¼€æºçš„åè®®ï¼Œå·²è¢«OpenAIã€é˜¿é‡Œäº‘ã€è…¾è®¯ã€å­—èŠ‚è·³åŠ¨ç­‰å…¨çƒç§‘æŠ€å·¨å¤´å¹¿æ³›é‡‡çº³ï¼Œå½¢æˆäº†ä¸€åœºé™é»˜çš„AIé©å‘½ã€‚MCPçš„æµè¡Œä¸ä»…æºäºå…¶æŠ€æœ¯åˆ›æ–°ï¼Œæ›´åœ¨äºå®ƒæ»¡è¶³äº†AIäº§ä¸šä»å•ä½“æ™ºèƒ½å‘äº’è”ç½‘ç»œè½¬å˜çš„è¿«åˆ‡éœ€æ±‚ï¼Œä¸ºAIåº”ç”¨çš„è§„æ¨¡åŒ–è½åœ°æä¾›äº†å…³é”®æ”¯æ’‘ã€‚</p><p>å¯ä»¥å°† MCP æƒ³è±¡æˆç”¨äº AI åº”ç”¨ç¨‹åºçš„ USB-C ç«¯å£ã€‚æ­£å¦‚ USB-C æä¾›äº†ä¸€ç§å°†è®¾å¤‡è¿æ¥åˆ°å„ç§å¤–å›´è®¾å¤‡å’Œé…ä»¶çš„æ ‡å‡†åŒ–æ–¹å¼ä¸€æ ·ï¼ŒMCP ä¹Ÿæä¾›äº†ä¸€ç§å°† AI æ¨¡å‹è¿æ¥åˆ°ä¸åŒæ•°æ®æºå’Œå·¥å…·çš„æ ‡å‡†åŒ–æ–¹å¼ã€‚</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/1748010742017-0e6ed1d9-b0c5-439a-94fc-a725bf009f2d.png" alt="image.png" style="zoom:40%;" /></p><h1 id="MCPåŸç†"><a href="#MCPåŸç†" class="headerlink" title="MCPåŸç†"></a>MCPåŸç†</h1><h2 id="MCPçš„æ ¸å¿ƒåŸç†"><a href="#MCPçš„æ ¸å¿ƒåŸç†" class="headerlink" title="MCPçš„æ ¸å¿ƒåŸç†"></a>MCPçš„æ ¸å¿ƒåŸç†</h2><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/1748010605284-114cf209-b913-41dd-9613-626138c3796a.png" alt="image.png" style="zoom:60%;" /></p><h2 id="MCPæœåŠ¡åº”ç”¨"><a href="#MCPæœåŠ¡åº”ç”¨" class="headerlink" title="MCPæœåŠ¡åº”ç”¨"></a>MCPæœåŠ¡åº”ç”¨</h2><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/1748010776601-c0d4944f-ea0d-4e0c-a5f3-a1a1bc7167e8.png" alt="image.png" style="zoom:50%;" /></p><p>MCP çš„æ ¸å¿ƒåŸç†æ˜¯å°†äº’è”ç½‘æœåŠ¡ï¼ˆé«˜å¾·ã€è°·æ­Œï¼‰æˆ–æœ¬åœ°æ“ä½œç³»ç»Ÿ APIï¼ˆæ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ã€ç»ˆç«¯ï¼‰å°è£…æˆ <strong>AI æ™ºèƒ½ä½“èƒ½å¤Ÿç†è§£å’Œä½¿ç”¨çš„ Tools å·¥å…·</strong>ï¼Œè®© AI æ™ºèƒ½ä½“èƒ½å¤Ÿè‡ªç”±åœ°è°ƒç”¨è¿™äº› Tools å·¥å…·å®ç°å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å’ŒåŠŸèƒ½ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ModelScopeå¸‚é¢ä¸Šçš„ä¸€äº›å„ä¸ªæ–¹é¢çš„MCPæœåŠ¡ï¼Œåœ°å€ï¼š<a href="https://modelscope.cn/mcp">https://modelscope.cn/mcp</a></p><h1 id="MCPçš„ä¼˜åŠ¿"><a href="#MCPçš„ä¼˜åŠ¿" class="headerlink" title="MCPçš„ä¼˜åŠ¿"></a>MCPçš„ä¼˜åŠ¿</h1><p><strong>è§£å†³äº†æ™ºèƒ½ä½“å¼€å‘è¿‡ç¨‹ä¸­çš„å…³é”®æ•ˆç‡é—®é¢˜</strong></p><p>MCPä¹‹æ‰€ä»¥è¿…é€Ÿç«çˆ†ï¼Œé¦–å…ˆåœ¨äºå®ƒè§£å†³äº†AIåº”ç”¨å¼€å‘ä¸­çš„<strong>å…³é”®ç—›ç‚¹</strong>ã€‚ä¼ ç»Ÿæ¨¡å¼ä¸‹ï¼Œå¤§æ¨¡å‹ä¸å¤–éƒ¨å·¥å…·çš„é›†æˆéœ€è¦ä¸ºæ¯ä¸ªå·¥å…·å•ç‹¬å¼€å‘æ¥å£ï¼Œå½¢æˆäº†â€<strong>Mä¸ªæ™ºèƒ½ä½“Ã—Nä¸ªå·¥å…·</strong>â€œçš„å¤æ‚åº¦ã€‚</p><p><strong>MCPé€šè¿‡æ ‡å‡†åŒ–äº¤äº’è§„åˆ™ï¼Œå°†å¤æ‚çš„â€MÃ—Nâ€é›†æˆç®€åŒ–ä¸ºâ€M+Nâ€æ¨¡å¼ï¼Œä½¿å¼€å‘è€…åªéœ€éµå¾ªåè®®æ ‡å‡†ï¼Œå°±èƒ½å®ç°AIæ¨¡å‹ä¸å„ç±»å·¥å…·çš„å³æ’å³ç”¨</strong>ã€‚è¿™ç§æ ‡å‡†åŒ–ä¸ä»…é™ä½äº†å¼€å‘é—¨æ§›ï¼Œè¿˜æé«˜äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œäº’æ“ä½œæ€§ã€‚</p><h1 id="åŸºäºMCPçš„æ™ºèƒ½ä½“æ¶æ„"><a href="#åŸºäºMCPçš„æ™ºèƒ½ä½“æ¶æ„" class="headerlink" title="åŸºäºMCPçš„æ™ºèƒ½ä½“æ¶æ„"></a>åŸºäºMCPçš„æ™ºèƒ½ä½“æ¶æ„</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[æ™ºèƒ½ä½“] --&gt; B[å¤§æ¨¡å‹]</span><br><span class="line">    A --&gt; C[å·¥å…·]</span><br><span class="line">    C --&gt; D[æœ¬åœ°å·¥å…· Function]</span><br><span class="line">    C --&gt; E[è¿œç¨‹å·¥å…· MCP]</span><br><span class="line">    E --&gt; F[è¿œç¨‹MCP Server]</span><br><span class="line">    E --&gt; G[æœ¬åœ°MCP Server]</span><br></pre></td></tr></table></figure><h1 id="MCPæœåŠ¡æ¥å…¥ç¤ºä¾‹"><a href="#MCPæœåŠ¡æ¥å…¥ç¤ºä¾‹" class="headerlink" title="MCPæœåŠ¡æ¥å…¥ç¤ºä¾‹"></a>MCPæœåŠ¡æ¥å…¥ç¤ºä¾‹</h1><h2 id="é«˜å¾·MCPæœåŠ¡æ¥å…¥ä¸æ™ºèƒ½ä½“"><a href="#é«˜å¾·MCPæœåŠ¡æ¥å…¥ä¸æ™ºèƒ½ä½“" class="headerlink" title="é«˜å¾·MCPæœåŠ¡æ¥å…¥ä¸æ™ºèƒ½ä½“"></a>é«˜å¾·MCPæœåŠ¡æ¥å…¥ä¸æ™ºèƒ½ä½“</h2><p>é«˜å¾·MCPæœåŠ¡ä»‹ç»ï¼Œå®˜æ–¹åœ°å€ï¼š<a href="https://lbs.amap.com/api/mcp-server/summary">https://lbs.amap.com/api/mcp-server/summary</a></p><h3 id="ç¬¬ä¸€æ­¥ï¼šMCPå®¢æˆ·ç«¯å¼€å‘"><a href="#ç¬¬ä¸€æ­¥ï¼šMCPå®¢æˆ·ç«¯å¼€å‘" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šMCPå®¢æˆ·ç«¯å¼€å‘"></a>ç¬¬ä¸€æ­¥ï¼šMCPå®¢æˆ·ç«¯å¼€å‘</h3><ol><li><p>å®‰è£…ä¾èµ–ï¼š<code>pip install langchain_mcp_adapters</code></p></li><li><p>è·å–é«˜å¾·åº”ç”¨key: <a href="https://lbs.amap.com/api/mcp-server/create-project-and-key">https://lbs.amap.com/api/mcp-server/create-project-and-key</a></p></li><li><p>å¼€å‘é«˜å¾·mcpå®¢æˆ·ç«¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Timeï¼š2025/9/16 15:40</span></span><br><span class="line"><span class="comment"># @Authorï¼šjinglv</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½ .env æ–‡ä»¶ä¸­çš„å˜é‡</span></span><br><span class="line">load_dotenv()</span><br><span class="line"><span class="keyword">from</span> langchain_mcp_adapters.client <span class="keyword">import</span> MultiServerMCPClient</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_amap_mcp_client</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åˆ›å»ºMCPå®¢æˆ·ç«¯&quot;&quot;&quot;</span></span><br><span class="line">    amap_key = os.environ.get(<span class="string">&quot;AMAP_KEY&quot;</span>)</span><br><span class="line"></span><br><span class="line">    client = MultiServerMCPClient(&#123;</span><br><span class="line">        <span class="string">&quot;amap&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">f&quot;https://mcp.amap.com/sse?key=<span class="subst">&#123;amap_key&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&quot;transport&quot;</span>: <span class="string">&quot;sse&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    tools = <span class="keyword">await</span> client.get_tools()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> client, tools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    client, tools = asyncio.run(create_amap_mcp_client())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;-------------------------------æŸ¥çœ‹æ˜¯å¦åˆ›å»ºå®Œæˆå®¢æˆ·ç«¯------------------------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(client)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;-------------------------------æŸ¥çœ‹æä¾›çš„å·¥å…·æœ‰å“ªäº›------------------------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(tools)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h3 id="ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ™ºèƒ½ä½“ï¼Œé›†æˆMCPå·¥å…·"><a href="#ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ™ºèƒ½ä½“ï¼Œé›†æˆMCPå·¥å…·" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ™ºèƒ½ä½“ï¼Œé›†æˆMCPå·¥å…·"></a>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ™ºèƒ½ä½“ï¼Œé›†æˆMCPå·¥å…·</h3><ol><li>è·å–mcp tools</li><li>åˆ›å»ºæ™ºèƒ½ä½“</li><li>åˆ›å»ºæç¤ºè¯</li><li>å¼‚æ­¥è¿è¡Œæ™ºèƒ½ä½“</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½ .env æ–‡ä»¶ä¸­çš„å˜é‡</span></span><br><span class="line">load_dotenv()</span><br><span class="line"><span class="keyword">from</span> langchain_mcp_adapters.client <span class="keyword">import</span> MultiServerMCPClient</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_amap_mcp_client</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åˆ›å»ºMCPå®¢æˆ·ç«¯&quot;&quot;&quot;</span></span><br><span class="line">    amap_key = os.environ.get(<span class="string">&quot;AMAP_KEY&quot;</span>)</span><br><span class="line"></span><br><span class="line">    client = MultiServerMCPClient(&#123;</span><br><span class="line">        <span class="string">&quot;amap&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">f&quot;https://mcp.amap.com/sse?key=<span class="subst">&#123;amap_key&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&quot;transport&quot;</span>: <span class="string">&quot;sse&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    tools = <span class="keyword">await</span> client.get_tools()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> client, tools</span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> initialize_agent, AgentType</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_run_agent</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åˆ›å»ºæ™ºèƒ½ä½“ï¼Œé›†æˆMCPå·¥å…·&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1.è·å–mcp tools</span></span><br><span class="line">    client, tools = <span class="keyword">await</span> create_amap_mcp_client()</span><br><span class="line">    <span class="comment"># 2.åˆ›å»ºæ™ºèƒ½ä½“</span></span><br><span class="line">    qv_llm = ChatOpenAI(</span><br><span class="line">        model=os.getenv(<span class="string">&quot;LLM_MODEL&quot;</span>),</span><br><span class="line">        base_url=os.getenv(<span class="string">&quot;LLM_BASE_URL&quot;</span>),</span><br><span class="line">        api_key=os.getenv(<span class="string">&quot;LLM_API_KEY&quot;</span>),</span><br><span class="line">        streaming=<span class="literal">True</span>,</span><br><span class="line">    )</span><br><span class="line">    agent = initialize_agent(</span><br><span class="line">        tools=tools,</span><br><span class="line">        llm=qv_llm,</span><br><span class="line">        agent=AgentType.STRUCTURED_CHAT_ZERO_SHOT_REACT_DESCRIPTION,</span><br><span class="line">        verbose=<span class="literal">True</span>,  <span class="comment"># æ‰“å¼€è°ƒè¯•æ¨¡å¼</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># 3.åˆ›å»ºæç¤ºè¯</span></span><br><span class="line">    prompt_template = PromptTemplate.from_template(</span><br><span class="line">        <span class="string">&quot;ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥è°ƒç”¨é«˜å¾· MCP å·¥å…·ã€‚\n\né—®é¢˜: &#123;input&#125;&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    prompt = prompt_template.<span class="built_in">format</span>(<span class="built_in">input</span>=<span class="string">&quot;æä¾›åŒ—äº¬å—ç«™çš„åæ ‡&quot;</span>)</span><br><span class="line">    <span class="comment"># 4.å¼‚æ­¥è¿è¡Œæ™ºèƒ½ä½“</span></span><br><span class="line">    res = <span class="keyword">await</span> agent.ainvoke(prompt)</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h2 id="åŸºäºé«˜å¾·MCPçš„å¤æ‚è·¯å¾„è§„åˆ’-å¯è§†åŒ–å±•ç¤º"><a href="#åŸºäºé«˜å¾·MCPçš„å¤æ‚è·¯å¾„è§„åˆ’-å¯è§†åŒ–å±•ç¤º" class="headerlink" title="åŸºäºé«˜å¾·MCPçš„å¤æ‚è·¯å¾„è§„åˆ’+å¯è§†åŒ–å±•ç¤º"></a>åŸºäºé«˜å¾·MCPçš„å¤æ‚è·¯å¾„è§„åˆ’+å¯è§†åŒ–å±•ç¤º</h2><p>å¢åŠ æ–‡ä»¶å·¥å…·åŠæ‰©å±•æ™ºèƒ½ä½“å·¥å…·ï¼Œæ–‡ä»¶å·¥å…·éœ€è¦å®‰è£…ä¾èµ–:<code>pip install langchain_community</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½ .env æ–‡ä»¶ä¸­çš„å˜é‡</span></span><br><span class="line">load_dotenv()</span><br><span class="line"><span class="keyword">from</span> langchain_mcp_adapters.client <span class="keyword">import</span> MultiServerMCPClient</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_amap_mcp_client</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åˆ›å»ºMCPå®¢æˆ·ç«¯&quot;&quot;&quot;</span></span><br><span class="line">    amap_key = os.environ.get(<span class="string">&quot;AMAP_KEY&quot;</span>)</span><br><span class="line"></span><br><span class="line">    client = MultiServerMCPClient(&#123;</span><br><span class="line">        <span class="string">&quot;amap&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">f&quot;https://mcp.amap.com/sse?key=<span class="subst">&#123;amap_key&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&quot;transport&quot;</span>: <span class="string">&quot;sse&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    tools = <span class="keyword">await</span> client.get_tools()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> client, tools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain_community.agent_toolkits <span class="keyword">import</span> FileManagementToolkit</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> initialize_agent, AgentType</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_run_agent</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åˆ›å»ºæ™ºèƒ½ä½“ï¼Œé›†æˆMCPå·¥å…·&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1.è·å–mcp tools</span></span><br><span class="line">    client, tools = <span class="keyword">await</span> create_amap_mcp_client()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¢åŠ è·å–æ–‡ä»¶å·¥å…·</span></span><br><span class="line">    file_toolkit = FileManagementToolkit(root_dir=<span class="string">&quot;/Users/jinglv/PycharmProjects/ai-agent-dev/temp&quot;</span>)</span><br><span class="line">    file_tools = file_toolkit.get_tools()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.åˆ›å»ºæ™ºèƒ½ä½“</span></span><br><span class="line">    qv_llm = ChatOpenAI(</span><br><span class="line">        model=os.getenv(<span class="string">&quot;LLM_MODEL&quot;</span>),</span><br><span class="line">        base_url=os.getenv(<span class="string">&quot;LLM_BASE_URL&quot;</span>),</span><br><span class="line">        api_key=os.getenv(<span class="string">&quot;LLM_API_KEY&quot;</span>),</span><br><span class="line">        streaming=<span class="literal">True</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    agent = initialize_agent(</span><br><span class="line">        tools=tools + file_tools,</span><br><span class="line">        llm=qv_llm,</span><br><span class="line">        agent=AgentType.STRUCTURED_CHAT_ZERO_SHOT_REACT_DESCRIPTION,</span><br><span class="line">        verbose=<span class="literal">True</span>,  <span class="comment"># æ‰“å¼€è°ƒè¯•æ¨¡å¼</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># 3.åˆ›å»ºæç¤ºè¯</span></span><br><span class="line">    prompt_template = PromptTemplate.from_template(</span><br><span class="line">        <span class="string">&quot;ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥è°ƒç”¨é«˜å¾· MCP å·¥å…·ã€‚\n\né—®é¢˜: &#123;input&#125;&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    prompt = prompt_template.<span class="built_in">format</span>(<span class="built_in">input</span>=<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ç›®æ ‡ï¼š</span></span><br><span class="line"><span class="string">    - æ˜å¤©ä¸Šåˆ10ç‚¹æˆ‘è¦ä»åŒ—äº¬å—ç«™åˆ°åŒ—äº¬æœ›äº¬SOHO</span></span><br><span class="line"><span class="string">    - çº¿è·¯é€‰æ‹©ï¼šå…¬è·¯åœ°å€æˆ–æ‰“è½¦</span></span><br><span class="line"><span class="string">    - è€ƒè™‘å‡ºè¡Œæ—¶é—´å’Œè·¯çº¿ï¼Œä»¥åŠå¤©æ°”çŠ¶å†µå’Œç©¿è¡£å»ºè®®</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    è¦æ±‚:</span></span><br><span class="line"><span class="string">    - åˆ¶ä½œç½‘é¡µæ¥å±•ç¤ºå‡ºç°çº¿è·¯å’Œä½ç½®ï¼Œè¾“å‡ºä¸€ä¸ªHTMLé¡µé¢ï¼Œå°†ç½‘é¡µä¿å­˜åˆ°ï¼š/Users/jinglv/PycharmProjects/ai-agent-dev/tempç›®å½•ä¸‹</span></span><br><span class="line"><span class="string">    - ç½‘é¡µä½¿ç”¨ç®€çº¦ç¾è§‚çš„é¡µé¢é£æ ¼ï¼Œä»¥åŠå¡ç‰‡å±•ç¤º</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>)</span><br><span class="line">    <span class="comment"># 4.å¼‚æ­¥è¿è¡Œæ™ºèƒ½ä½“</span></span><br><span class="line">    res = <span class="keyword">await</span> agent.ainvoke(prompt)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    client, tools = asyncio.run(create_amap_mcp_client())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;-------------------------------æŸ¥çœ‹æ˜¯å¦åˆ›å»ºå®Œæˆå®¢æˆ·ç«¯------------------------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(client)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;-------------------------------æŸ¥çœ‹æä¾›çš„å·¥å…·æœ‰å“ªäº›------------------------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(tools)</span><br><span class="line">    res = asyncio.run(create_run_agent())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;-------------------------------æ™ºèƒ½ä½“ç»“åˆMCPå®¢æˆ·ç«¯æ‰§è¡Œç»“æœ------------------------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å­¦ä¹ LangChainå­¦ä¹ ç¬”è®°ç¬¬åä¸€è®²</summary>
    
    
    
    <category term="LangChain" scheme="https://jinglv.github.io/categories/LangChain/"/>
    
    
    <category term="LangChain" scheme="https://jinglv.github.io/tags/LangChain/"/>
    
  </entry>
  
  <entry>
    <title>MCPé€šä¿¡æ–¹å¼</title>
    <link href="https://jinglv.github.io/2025/09/16/ai/langchain/12-langchain-agent-mcp-protocol/"/>
    <id>https://jinglv.github.io/2025/09/16/ai/langchain/12-langchain-agent-mcp-protocol/</id>
    <published>2025-09-15T16:00:00.000Z</published>
    <updated>2025-09-16T09:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸‰ç§MCPé€šè®¯æ–¹å¼"><a href="#ä¸‰ç§MCPé€šè®¯æ–¹å¼" class="headerlink" title="ä¸‰ç§MCPé€šè®¯æ–¹å¼"></a>ä¸‰ç§MCPé€šè®¯æ–¹å¼</h1><p>MCPï¼ˆModel Context Protocolï¼‰åè®®ç›®å‰æ”¯æŒ<strong>ä¸‰ç§ä¸»è¦é€šä¿¡æ–¹å¼</strong>ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><h2 id="stdioï¼ˆæ ‡å‡†è¾“å…¥è¾“å‡ºï¼‰"><a href="#stdioï¼ˆæ ‡å‡†è¾“å…¥è¾“å‡ºï¼‰" class="headerlink" title="stdioï¼ˆæ ‡å‡†è¾“å…¥è¾“å‡ºï¼‰"></a><code>stdio</code>ï¼ˆæ ‡å‡†è¾“å…¥è¾“å‡ºï¼‰</h2><ul><li><p>å·¥ä½œåŸç†ï¼š</p><p>é€šè¿‡æœ¬åœ°è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰å’Œæ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰è¿›è¡Œé€šä¿¡ã€‚å®¢æˆ·ç«¯ä»¥å­è¿›ç¨‹çš„å½¢å¼å¯åŠ¨MCPæœåŠ¡å™¨ï¼ŒåŒæ–¹é€šè¿‡ç®¡é“äº¤æ¢JSON-RPCæ ¼å¼çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä»¥æ¢è¡Œç¬¦åˆ†éš”ã€‚</p></li><li><p>é€‚ç”¨åœºæ™¯ï¼š</p><ul><li>æœ¬åœ°è¿›ç¨‹é—´é€šä¿¡ï¼ˆå¦‚å‘½ä»¤è¡Œå·¥å…·ã€æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼‰ã€‚</li><li>ç®€å•çš„æ‰¹å¤„ç†ä»»åŠ¡æˆ–å·¥å…·è°ƒç”¨ã€‚</li></ul></li><li><p>ä¼˜ç‚¹ï¼š</p><ul><li>å®ç°ç®€å•ï¼Œä½å»¶è¿Ÿã€‚</li><li>æ— éœ€ç½‘ç»œé…ç½®ï¼Œé€‚åˆæœ¬åœ°å¼€å‘ã€‚</li></ul></li><li><p>é™åˆ¶ï¼š</p><ul><li>ä»…é™æœ¬åœ°ä½¿ç”¨ï¼Œä¸æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ã€‚</li><li>æœåŠ¡ç«¯ä¸èƒ½è¾“å‡ºæ§åˆ¶å°æ—¥å¿—ï¼ˆä¼šæ±¡æŸ“åè®®æµï¼‰ã€‚</li></ul></li></ul><h2 id="SSEï¼ˆServer-Sent-Eventsï¼‰"><a href="#SSEï¼ˆServer-Sent-Eventsï¼‰" class="headerlink" title="SSEï¼ˆServer-Sent Eventsï¼‰"></a><code>SSE</code>ï¼ˆServer-Sent Eventsï¼‰</h2><ul><li><p>å·¥ä½œåŸç†ï¼š</p><p>åŸºäºHTTPé•¿è¿æ¥å®ç°æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„å•å‘æ¶ˆæ¯æ¨é€ã€‚å®¢æˆ·ç«¯é€šè¿‡<code>GET /sse</code>å»ºç«‹é•¿è¿æ¥ï¼ŒæœåŠ¡å™¨é€šè¿‡SSEæµå‘é€JSON-RPCæ¶ˆæ¯ï¼›å®¢æˆ·ç«¯é€šè¿‡<code>POST /message</code>å‘é€è¯·æ±‚æˆ–å“åº”ã€‚</p></li><li><p>é€‚ç”¨åœºæ™¯ï¼š</p><ul><li>è¿œç¨‹æœåŠ¡è°ƒç”¨ï¼ˆå¦‚äº‘æœåŠ¡ã€å¤šå®¢æˆ·ç«¯ç›‘æ§ï¼‰ã€‚</li><li>éœ€è¦å®æ—¶æ•°æ®æ¨é€çš„åœºæ™¯ï¼ˆå¦‚å¯¹è¯å¼AIçš„æµå¼è¾“å‡ºï¼‰ã€‚</li></ul></li><li>ä¼˜ç‚¹ï¼š<ul><li>æ”¯æŒå®æ—¶å•å‘æ¨é€ï¼Œé€‚åˆæµå¼äº¤äº’ã€‚</li></ul></li><li>é™åˆ¶ï¼š<ul><li><strong>å·²é€æ­¥è¢«å¼ƒç”¨</strong>ï¼ˆ2025å¹´3æœˆåè¢«Streamable HTTPå–ä»£ï¼‰ã€‚</li><li>è¿æ¥ä¸­æ–­åæ— æ³•æ¢å¤ï¼Œéœ€é‡æ–°å»ºç«‹ã€‚</li><li>æœåŠ¡å™¨éœ€ç»´æŒé•¿è¿æ¥ï¼Œèµ„æºæ¶ˆè€—è¾ƒé«˜ã€‚</li></ul></li></ul><h2 id="Streamable-HTTPï¼ˆæµå¼HTTPï¼‰"><a href="#Streamable-HTTPï¼ˆæµå¼HTTPï¼‰" class="headerlink" title="Streamable HTTPï¼ˆæµå¼HTTPï¼‰"></a><code>Streamable HTTP</code>ï¼ˆæµå¼HTTPï¼‰</h2><ul><li><p>å·¥ä½œåŸç†ï¼š</p><p>2025å¹´3æœˆå¼•å…¥çš„æ–°ä¼ è¾“æ–¹å¼ï¼Œæ›¿ä»£äº†SSEã€‚é€šè¿‡ç»Ÿä¸€çš„/messageç«¯ç‚¹å®ç°åŒå‘é€šä¿¡ï¼Œæ”¯æŒä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li>å®¢æˆ·ç«¯é€šè¿‡HTTP POSTå‘é€è¯·æ±‚ï¼ˆå¦‚å·¥å…·è°ƒç”¨ï¼‰ã€‚</li><li>æœåŠ¡å™¨å¯å°†å“åº”å‡çº§ä¸ºSSEæµå¼ä¼ è¾“ï¼ˆå½“éœ€è¦æ—¶ï¼‰ã€‚</li><li>æ”¯æŒæ— çŠ¶æ€æ¨¡å¼ï¼ˆStateless Serverï¼‰ï¼Œæ— éœ€ç»´æŒé•¿è¿æ¥ã€‚</li></ul></li><li><p>é€‚ç”¨åœºæ™¯ï¼š</p><ul><li>é«˜å¹¶å‘è¿œç¨‹æœåŠ¡è°ƒç”¨ã€‚</li><li>éœ€è¦çµæ´»æµå¼å“åº”çš„åœºæ™¯ï¼ˆå¦‚AIåŠ©æ‰‹çš„åŠ¨æ€è¾“å‡ºï¼‰ã€‚</li></ul></li><li><p>ä¼˜ç‚¹ï¼š</p><ul><li>è§£å†³SSEçš„ç¼ºé™·ï¼š<ul><li>æ”¯æŒè¿æ¥æ¢å¤ï¼ˆæ— éœ€é‡æ–°å¼€å§‹ï¼‰ã€‚</li><li>æ— éœ€æœåŠ¡å™¨ç»´æŒé•¿è¿æ¥ï¼Œé™ä½èµ„æºå‹åŠ›ã€‚</li><li>ç»Ÿä¸€ç«¯ç‚¹ï¼ˆ/messageï¼‰ï¼Œç®€åŒ–æ¥å£è®¾è®¡ã€‚</li></ul></li><li>å…¼å®¹åŸºç¡€è®¾æ–½ï¼ˆå¦‚ä¸­é—´ä»¶ã€è´Ÿè½½å‡è¡¡ï¼‰ã€‚</li></ul></li><li><p>æ¨èä½¿ç”¨ï¼š</p><p>å½“å‰MCPå®˜æ–¹æ¨èçš„ä¼ è¾“æ–¹å¼ï¼Œå°¤å…¶é€‚åˆç”Ÿäº§ç¯å¢ƒå’Œäº‘æœåŠ¡ã€‚</p></li></ul><h1 id="å®ç°åŸºäºstdioçš„mcpæœåŠ¡"><a href="#å®ç°åŸºäºstdioçš„mcpæœåŠ¡" class="headerlink" title="å®ç°åŸºäºstdioçš„mcpæœåŠ¡"></a>å®ç°åŸºäºstdioçš„mcpæœåŠ¡</h1><p>stdioæ¨¡å¼mcpæœåŠ¡æ¶æ„ï¼š</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250916171800738.png" alt="image-20250916171800738" style="zoom:50%;" /></p><h2 id="ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºmcp-serverï¼ˆåŒ…å«å·¥å…·èƒ½åŠ›ï¼‰"><a href="#ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºmcp-serverï¼ˆåŒ…å«å·¥å…·èƒ½åŠ›ï¼‰" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºmcp serverï¼ˆåŒ…å«å·¥å…·èƒ½åŠ›ï¼‰"></a>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºmcp serverï¼ˆåŒ…å«å·¥å…·èƒ½åŠ›ï¼‰</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Timeï¼š2025/9/16 17:19</span></span><br><span class="line"><span class="comment"># @Authorï¼šjinglv</span></span><br><span class="line"><span class="keyword">from</span> mcp.server.fastmcp <span class="keyword">import</span> FastMCP</span><br><span class="line"></span><br><span class="line">mcp = FastMCP(<span class="string">&quot;Match Tools&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Add two numbers&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Multiply two numbers&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    mcp.run(transport=<span class="string">&quot;stdio&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç åŒ…å«ä¸¤éƒ¨åˆ†å†…å®¹ï¼š</p><ol><li>ä½¿ç”¨<code>@mcp.tool()</code>è£…é¥°å™¨æ³¨å†Œçš„ mcp å·¥å…·æ–¹æ³•ï¼›</li><li>ä½¿ç”¨ <code>mcp.run(transport=&quot;stdio&quot;)</code>å¯åŠ¨ stdio mcp æœåŠ¡ã€‚</li></ol><h2 id="ç¬¬äºŒæ­¥ï¼šå¯åŠ¨mcp-server"><a href="#ç¬¬äºŒæ­¥ï¼šå¯åŠ¨mcp-server" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šå¯åŠ¨mcp server"></a>ç¬¬äºŒæ­¥ï¼šå¯åŠ¨mcp server</h2><p>æ‰¾åˆ° mcp server æ‰€åœ¨æ–‡ä»¶å¤¹ï¼Œä½¿ç”¨ python å‘½ä»¤å¯åŠ¨æœåŠ¡ï¼ˆç›¸å½“äºå¯åŠ¨äº†å¯¹ IO æµä¸­ read å’Œ write äº‹ä»¶çš„ç›‘å¬ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(.venv) jinglv@localhost ai-agent-dev % python demo/mcp/stdio/mcp_stdio_server.py</span><br></pre></td></tr></table></figure><p>å¯åŠ¨åï¼Œä¸€ç›´å¤„äºç›‘å¬çŠ¶æ€</p><h2 id="ç¬¬ä¸‰æ­¥ï¼šå¼€å‘mcp-clientï¼ˆåŒ…å«æ™ºèƒ½ä½“ï¼‰"><a href="#ç¬¬ä¸‰æ­¥ï¼šå¼€å‘mcp-clientï¼ˆåŒ…å«æ™ºèƒ½ä½“ï¼‰" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šå¼€å‘mcp clientï¼ˆåŒ…å«æ™ºèƒ½ä½“ï¼‰"></a>ç¬¬ä¸‰æ­¥ï¼šå¼€å‘mcp clientï¼ˆåŒ…å«æ™ºèƒ½ä½“ï¼‰</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Timeï¼š2025/9/16 17:25</span></span><br><span class="line"><span class="comment"># @Authorï¼šjinglv</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> initialize_agent, AgentType</span><br><span class="line"><span class="keyword">from</span> langchain_mcp_adapters.tools <span class="keyword">import</span> load_mcp_tools</span><br><span class="line"><span class="keyword">from</span> mcp <span class="keyword">import</span> StdioServerParameters, ClientSession</span><br><span class="line"><span class="keyword">from</span> mcp.client.stdio <span class="keyword">import</span> stdio_client</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½ .env æ–‡ä»¶ä¸­çš„å˜é‡</span></span><br><span class="line">load_dotenv()</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line">qv_llm = ChatOpenAI(</span><br><span class="line">    model=os.getenv(<span class="string">&quot;LLM_MODEL&quot;</span>),</span><br><span class="line">    base_url=os.getenv(<span class="string">&quot;LLM_BASE_URL&quot;</span>),</span><br><span class="line">    api_key=os.getenv(<span class="string">&quot;LLM_API_KEY&quot;</span>),</span><br><span class="line">    streaming=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_mcp_stdio_client</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åˆ›å»ºMCPå®¢æˆ·ç«¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># å®šä¹‰stdio serverå‚æ•°</span></span><br><span class="line">    server_params = StdioServerParameters(</span><br><span class="line">        command=<span class="string">&quot;python&quot;</span>,</span><br><span class="line">        args=[<span class="string">&quot;/Users/jinglv/PycharmProjects/ai-agent-dev/demo/mcp/stdio/mcp_stdio_server.py&quot;</span>],</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯»å– stdio mcp tools</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> stdio_client(server_params) <span class="keyword">as</span> (read, write):</span><br><span class="line">        <span class="comment"># è®¾ç½®ä¼šè¯ï¼Œå¹¶åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> ClientSession(read, write) <span class="keyword">as</span> session:</span><br><span class="line">            <span class="keyword">await</span> session.initialize()</span><br><span class="line">            tools = <span class="keyword">await</span> load_mcp_tools(session)</span><br><span class="line">            <span class="built_in">print</span>(tools)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å®šä¹‰æ™ºèƒ½ä½“ï¼ŒåŠ è½½ mcp tools</span></span><br><span class="line">            agent = initialize_agent(</span><br><span class="line">                tools=tools,</span><br><span class="line">                llm=qv_llm,</span><br><span class="line">                agent=AgentType.STRUCTURED_CHAT_ZERO_SHOT_REACT_DESCRIPTION,</span><br><span class="line">                verbose=<span class="literal">True</span>,</span><br><span class="line">            )</span><br><span class="line">            res = <span class="keyword">await</span> agent.ainvoke(<span class="string">&quot;100+100=?&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    res = asyncio.run(create_mcp_stdio_client())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;æ‰§è¡Œç»“æœï¼š<span class="subst">&#123;res&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šstdioæ–¹å¼æ˜¯å¯ä»¥ä¸å¯åŠ¨mcp serverçš„ï¼Œåœ¨å®¢æˆ·ç«¯å®šä¹‰stdio serverå‚æ•°ä¼šåŠ è½½è¿›å»çš„</p><h1 id="å®ç°åŸºäºsseçš„mcpæœåŠ¡"><a href="#å®ç°åŸºäºsseçš„mcpæœåŠ¡" class="headerlink" title="å®ç°åŸºäºsseçš„mcpæœåŠ¡"></a>å®ç°åŸºäºsseçš„mcpæœåŠ¡</h1><p>æ³¨æ„ï¼šsseå·²è¢«å®˜æ–¹åºŸå¼ƒï¼Œä¼˜å…ˆä½¿ç”¨streamable-httpï¼Œä¸¤è€…ä»ä»£ç å±‚é¢æ¥çœ‹ï¼Œå·®å¼‚ä¸å¤§</p><p>sse/streamable-httpæ¨¡å¼mcpæœåŠ¡æ¶æ„ï¼š</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250916184135754.png" alt="image-20250916184135754" style="zoom:50%;" /></p><h2 id="ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºmcp-serverç«¯"><a href="#ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºmcp-serverç«¯" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºmcp serverç«¯"></a>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºmcp serverç«¯</h2><p>ä¸stdioçš„åŒºåˆ«ï¼Œæ˜¯å°†MCPå¯åŠ¨ä¿®æ”¹ä¸ºsseï¼štransport=â€stdioâ€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Timeï¼š2025/9/16 18:43</span></span><br><span class="line"><span class="comment"># @Authorï¼šjinglv</span></span><br><span class="line"><span class="keyword">from</span> mcp.server.fastmcp <span class="keyword">import</span> FastMCP</span><br><span class="line"></span><br><span class="line">mcp = FastMCP(<span class="string">&quot;Match Tools&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Add two numbers&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Multiply two numbers&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    mcp.run(transport=<span class="string">&quot;sse&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç¬¬äºŒæ­¥ï¼šå¯åŠ¨mcp-server-1"><a href="#ç¬¬äºŒæ­¥ï¼šå¯åŠ¨mcp-server-1" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šå¯åŠ¨mcp server"></a>ç¬¬äºŒæ­¥ï¼šå¯åŠ¨mcp server</h2><p>æ³¨æ„ï¼šè¿™ä¸ªæ˜¯åŸºäºç½‘ç»œåè®®çš„ï¼Œéœ€è¦å¯åŠ¨æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(.venv) jinglv@localhost ai-agent-dev % python demo/mcp/sse/mcp_sse_server.py </span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡ä¼šæš´éœ²ä¸€ä¸ªç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INFO:     Started server process [36603]</span><br><span class="line">INFO:     Waiting <span class="keyword">for</span> application startup.</span><br><span class="line">INFO:     Application startup complete.</span><br><span class="line">INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸‰æ­¥ï¼šå¼€å‘mcp-clientï¼ˆåŒ…å«æ™ºèƒ½ä½“ï¼‰-1"><a href="#ç¬¬ä¸‰æ­¥ï¼šå¼€å‘mcp-clientï¼ˆåŒ…å«æ™ºèƒ½ä½“ï¼‰-1" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šå¼€å‘mcp clientï¼ˆåŒ…å«æ™ºèƒ½ä½“ï¼‰"></a>ç¬¬ä¸‰æ­¥ï¼šå¼€å‘mcp clientï¼ˆåŒ…å«æ™ºèƒ½ä½“ï¼‰</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Timeï¼š2025/9/16 18:45</span></span><br><span class="line"><span class="comment"># @Authorï¼šjinglv</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> initialize_agent, AgentType</span><br><span class="line"><span class="keyword">from</span> langchain_mcp_adapters.client <span class="keyword">import</span> MultiServerMCPClient</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½ .env æ–‡ä»¶ä¸­çš„å˜é‡</span></span><br><span class="line">load_dotenv()</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line">qv_llm = ChatOpenAI(</span><br><span class="line">    model=os.getenv(<span class="string">&quot;LLM_MODEL&quot;</span>),</span><br><span class="line">    base_url=os.getenv(<span class="string">&quot;LLM_BASE_URL&quot;</span>),</span><br><span class="line">    api_key=os.getenv(<span class="string">&quot;LLM_API_KEY&quot;</span>),</span><br><span class="line">    streaming=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_mcp_sse_client</span>():</span><br><span class="line">    <span class="comment"># åˆ›å»ºMCPå®¢æˆ·ç«¯</span></span><br><span class="line">    client = MultiServerMCPClient(&#123;</span><br><span class="line">        <span class="string">&quot;mcp&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://127.0.0.1:8000/sse&quot;</span>,</span><br><span class="line">            <span class="string">&quot;transport&quot;</span>: <span class="string">&quot;sse&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    tools = <span class="keyword">await</span> client.get_tools()</span><br><span class="line">    <span class="built_in">print</span>(tools)</span><br><span class="line"></span><br><span class="line">    agent = initialize_agent(</span><br><span class="line">        tools=tools,</span><br><span class="line">        llm=qv_llm,</span><br><span class="line">        agent=AgentType.STRUCTURED_CHAT_ZERO_SHOT_REACT_DESCRIPTION,</span><br><span class="line">        verbose=<span class="literal">True</span>,</span><br><span class="line">    )</span><br><span class="line">    res = <span class="keyword">await</span> agent.ainvoke(<span class="string">&quot;100+100=?&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    res = asyncio.run(create_mcp_sse_client())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;æ‰§è¡Œç»“æœï¼š<span class="subst">&#123;res&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å®ç°åŸºäºstreamable-httpçš„mcpæœåŠ¡"><a href="#å®ç°åŸºäºstreamable-httpçš„mcpæœåŠ¡" class="headerlink" title="å®ç°åŸºäºstreamable_httpçš„mcpæœåŠ¡"></a>å®ç°åŸºäºstreamable_httpçš„mcpæœåŠ¡</h1><p>æ³¨æ„ï¼šsseå·²è¢«å®˜æ–¹åºŸå¼ƒï¼Œä¼˜å…ˆä½¿ç”¨streamable-httpï¼Œä¸¤è€…ä»ä»£ç å±‚é¢æ¥çœ‹ï¼Œå·®å¼‚ä¸å¤§ï¼Œå’Œsseçš„åŒºåˆ«ä¹Ÿåªæ˜¯æœåŠ¡å¯åŠ¨æ–¹å¼å’Œåˆ›å»ºå®¢æˆ·ç«¯æ–¹å¼æœ‰å·®å¼‚å…¶ä»–åŸºæœ¬ä¸€è‡´</p><h2 id="mcp-serverç«¯"><a href="#mcp-serverç«¯" class="headerlink" title="mcp serverç«¯"></a>mcp serverç«¯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Timeï¼š2025/9/16 18:54</span></span><br><span class="line"><span class="comment"># @Authorï¼šjinglv</span></span><br><span class="line"><span class="keyword">from</span> mcp.server.fastmcp <span class="keyword">import</span> FastMCP</span><br><span class="line"></span><br><span class="line">mcp = FastMCP(<span class="string">&quot;Match Tools&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Add two numbers&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Multiply two numbers&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    mcp.run(transport=<span class="string">&quot;streamable-http&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="mcp-clientç«¯ï¼ˆåŒ…å«æ™ºèƒ½ä½“ï¼‰"><a href="#mcp-clientç«¯ï¼ˆåŒ…å«æ™ºèƒ½ä½“ï¼‰" class="headerlink" title="mcp clientç«¯ï¼ˆåŒ…å«æ™ºèƒ½ä½“ï¼‰"></a>mcp clientç«¯ï¼ˆåŒ…å«æ™ºèƒ½ä½“ï¼‰</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Timeï¼š2025/9/16 18:54</span></span><br><span class="line"><span class="comment"># @Authorï¼šjinglv</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> initialize_agent, AgentType</span><br><span class="line"><span class="keyword">from</span> langchain_mcp_adapters.client <span class="keyword">import</span> MultiServerMCPClient</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½ .env æ–‡ä»¶ä¸­çš„å˜é‡</span></span><br><span class="line">load_dotenv()</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line">qv_llm = ChatOpenAI(</span><br><span class="line">    model=os.getenv(<span class="string">&quot;LLM_MODEL&quot;</span>),</span><br><span class="line">    base_url=os.getenv(<span class="string">&quot;LLM_BASE_URL&quot;</span>),</span><br><span class="line">    api_key=os.getenv(<span class="string">&quot;LLM_API_KEY&quot;</span>),</span><br><span class="line">    streaming=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_mcp_streamable_http_client</span>():</span><br><span class="line">    <span class="comment"># åˆ›å»ºMCPå®¢æˆ·ç«¯</span></span><br><span class="line">    client = MultiServerMCPClient(&#123;</span><br><span class="line">        <span class="string">&quot;mcp&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://127.0.0.1:8000/mcp&quot;</span>,</span><br><span class="line">            <span class="string">&quot;transport&quot;</span>: <span class="string">&quot;streamable_http&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    tools = <span class="keyword">await</span> client.get_tools()</span><br><span class="line">    <span class="built_in">print</span>(tools)</span><br><span class="line"></span><br><span class="line">    agent = initialize_agent(</span><br><span class="line">        tools=tools,</span><br><span class="line">        llm=qv_llm,</span><br><span class="line">        agent=AgentType.STRUCTURED_CHAT_ZERO_SHOT_REACT_DESCRIPTION,</span><br><span class="line">        verbose=<span class="literal">True</span>,</span><br><span class="line">    )</span><br><span class="line">    res = <span class="keyword">await</span> agent.ainvoke(<span class="string">&quot;100+100=?&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    res = asyncio.run(create_mcp_streamable_http_client())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;æ‰§è¡Œç»“æœï¼š<span class="subst">&#123;res&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å­¦ä¹ LangChainå­¦ä¹ ç¬”è®°ç¬¬åäºŒè®²</summary>
    
    
    
    <category term="LangChain" scheme="https://jinglv.github.io/categories/LangChain/"/>
    
    
    <category term="LangChain" scheme="https://jinglv.github.io/tags/LangChain/"/>
    
  </entry>
  
  <entry>
    <title>RAGç»„ä»¶--å‘é‡æ•°æ®åº“æ£€ç´¢ï¼ˆæœç´¢ï¼‰ã€åº¦é‡ç±»å‹å’Œæ¡ä»¶è¿‡æ»¤</title>
    <link href="https://jinglv.github.io/2025/09/02/ai/rag/23-vector-db-action/"/>
    <id>https://jinglv.github.io/2025/09/02/ai/rag/23-vector-db-action/</id>
    <published>2025-09-01T16:00:00.000Z</published>
    <updated>2025-09-02T01:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Milvusæ··åˆæ£€ç´¢å®æˆ˜"><a href="#Milvusæ··åˆæ£€ç´¢å®æˆ˜" class="headerlink" title="Milvusæ··åˆæ£€ç´¢å®æˆ˜"></a>Milvusæ··åˆæ£€ç´¢å®æˆ˜</h1><h2 id="ç¨ å¯†å‘é‡"><a href="#ç¨ å¯†å‘é‡" class="headerlink" title="ç¨ å¯†å‘é‡"></a>ç¨ å¯†å‘é‡</h2><p>ç¨ å¯†å‘é‡é€šå¸¸è¡¨ç¤ºä¸º<strong>å…·æœ‰å›ºå®šé•¿åº¦çš„æµ®ç‚¹æ•°æ•°ç»„</strong>ï¼Œä¾‹å¦‚[0.2, 0.7, 0.1, 0.8, 0.3, â€¦, 0.5]ã€‚è¿™äº›å‘é‡çš„ç»´æ•°é€šå¸¸åœ¨æ•°ç™¾åˆ°æ•°åƒä¹‹é—´ï¼Œä¾‹å¦‚ 128ã€256ã€768 æˆ– 1024ã€‚æ¯ä¸ªç»´åº¦éƒ½æ•è·å¯¹è±¡çš„ç‰¹å®šè¯­ä¹‰ç‰¹å¾ï¼Œä½¿å…¶é€šè¿‡ç›¸ä¼¼åº¦è®¡ç®—é€‚ç”¨äºå„ç§åœºæ™¯ã€‚</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250902090321879.png" alt="image-20250902090321879" style="zoom:50%;" /></p><ul><li>å®šä¹‰ï¼šç”±å›ºå®šé•¿åº¦çš„æµ®ç‚¹æ•°æ•°ç»„è¡¨ç¤ºï¼Œå¦‚ï»¿$[0.2,0.7,0.1,0.8,0.3,â€¦,0.5]$ï»¿</li><li>ç»´åº¦èŒƒå›´ï¼šé€šå¸¸åœ¨æ•°ç™¾åˆ°æ•°åƒä¹‹é—´ï¼ˆå¦‚128/256/768/1024ç»´ï¼‰</li><li>ç‰¹æ€§ï¼šæ¯ä¸ªç»´åº¦æ•è·å¯¹è±¡çš„ç‰¹å®šè¯­ä¹‰ç‰¹å¾ï¼Œé€šè¿‡ç›¸ä¼¼åº¦è®¡ç®—é€‚ç”¨äºå¤šç§åœºæ™¯</li><li>è¯­ä¹‰è¡¨ç¤ºï¼šåæ ‡å€¼è¡¨ç¤ºè¯­ä¹‰ç»´åº¦å¼ºåº¦ï¼Œç‚¹é—´è·åæ˜ è¯­ä¹‰ç›¸ä¼¼åº¦ï¼ˆè¶Šè¿‘è¶Šç›¸ä¼¼ï¼‰</li></ul><h2 id="ç¨€ç–å‘é‡"><a href="#ç¨€ç–å‘é‡" class="headerlink" title="ç¨€ç–å‘é‡"></a>ç¨€ç–å‘é‡</h2><p>ç¨€ç–å‘é‡çš„ç‰¹ç‚¹æ˜¯<strong>å‘é‡ç»´æ•°é«˜ä¸”éé›¶å€¼è¾ƒå°‘</strong>ã€‚è¿™ç§ç»“æ„ä½¿å…¶ç‰¹åˆ«é€‚åˆä¼ ç»Ÿçš„ä¿¡æ¯æ£€ç´¢åº”ç”¨ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¨€ç–å‘é‡ä¸­ä½¿ç”¨çš„ç»´åº¦æ•°å¯¹åº”äºä¸€ç§æˆ–å¤šç§è¯­è¨€ä¸­çš„ä¸åŒæ ‡è®°ã€‚æ¯ä¸ªç»´åº¦éƒ½è¢«èµ‹äºˆä¸€ä¸ªå€¼ï¼Œè¯¥å€¼æŒ‡ç¤ºè¯¥æ ‡è®°åœ¨æ–‡æ¡£ä¸­çš„ç›¸å¯¹é‡è¦æ€§ã€‚è¿™ç§å¸ƒå±€å¯¹äºæ¶‰åŠæ–‡æœ¬åŒ¹é…çš„ä»»åŠ¡éå¸¸æœ‰åˆ©ã€‚</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250902090518281.png" alt="image-20250902090518281" style="zoom:80%;" /></p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250902090551605.png" alt="image-20250902090551605" style="zoom:67%;" /></p><ul><li>ç‰¹ç‚¹ï¼šç»´åº¦æ•°é«˜ä½†éé›¶å€¼å°‘ï¼Œä¼ ç»Ÿä¿¡æ¯æ£€ç´¢ä¸­å¸¸ç”¨</li><li>è¡¨ç¤ºæ–¹å¼ï¼š<ul><li>æ—©æœŸï¼šäºŒè¿›åˆ¶è¡¨ç¤ºï¼ˆ0/1ï¼‰</li><li>ç°ä»£ï¼šé€šè¿‡æœºå™¨å­¦ä¹ ä¹ å¾—çš„å®æ•°å€¼ï¼ˆå¦‚ï»¿$\{2:0.2,â€¦,9997:0.5,9999:0.7\}$ï»¿ï¼‰</li></ul></li><li>é€‚ç”¨åœºæ™¯ï¼šæ–‡æœ¬åŒ¹é…ä»»åŠ¡ï¼Œç»´åº¦å¯¹åº”è¯­è¨€ä¸­çš„ä¸åŒæ ‡è®°ï¼Œå€¼è¡¨ç¤ºæ ‡è®°åœ¨æ–‡æ¡£ä¸­çš„ç›¸å¯¹é‡è¦æ€§</li></ul><h2 id="æ··åˆæ£€ç´¢"><a href="#æ··åˆæ£€ç´¢" class="headerlink" title="æ··åˆæ£€ç´¢"></a>æ··åˆæ£€ç´¢</h2><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250902090904917.png" alt="image-20250902090904917" style="zoom:67%;" /></p><p>å·¥ä½œæµç¨‹ï¼š</p><ol><li>é€šè¿‡åµŒå…¥æ¨¡å‹ï¼ˆå¦‚BERTå’ŒTransformersï¼‰ç”Ÿæˆå¯†é›†å‘é‡ã€‚</li><li>é€šè¿‡BM25ã€BGE-M3ã€SPLADEç­‰åµŒå…¥æ¨¡å‹ç”Ÿæˆç¨€ç–å‘é‡ã€‚ï¼ˆå¯ä»¥ä½¿ç”¨ Functionç”Ÿæˆç¨€ç–å‘é‡ï¼‰</li><li>åˆ›å»ºä¸€ä¸ªé›†åˆå¹¶å®šä¹‰åŒ…å«å¯†é›†å’Œç¨€ç–çŸ¢é‡åœºçš„é›†åˆæ¨¡å¼ã€‚</li><li>å°†ç¨€ç–å¯†é›†å‘é‡æ’å…¥åˆ°ä¸Šä¸€æ­¥åˆšåˆšåˆ›å»ºçš„é›†åˆä¸­ã€‚</li><li>è¿›è¡Œæ··åˆæœç´¢ï¼šå¯¹å¯†é›†å‘é‡è¿›è¡Œ ANN æœç´¢å°†è¿”å›ä¸€ç»„å‰ K ä¸ªæœ€ç›¸ä¼¼çš„ç»“æœï¼Œå¯¹ç¨€ç–å‘é‡è¿›è¡Œæ–‡æœ¬åŒ¹é…ä¹Ÿå°†è¿”å›ä¸€ç»„å‰ K ä¸ªç»“æœã€‚</li><li>å½’ä¸€åŒ–ï¼šå°†ä¸¤ç»„top-Kç»“æœçš„å¾—åˆ†è¿›è¡Œå½’ä¸€åŒ–ï¼Œå°†å¾—åˆ†è½¬æ¢åˆ°[0,1]ä¹‹é—´çš„èŒƒå›´ã€‚</li><li>é€‰æ‹©åˆé€‚çš„<strong>é‡æ’åº</strong>ç­–ç•¥ï¼Œå¯¹ä¸¤ç»„top-Kç»“æœè¿›è¡Œåˆå¹¶ã€é‡æ’åºï¼Œæœ€ç»ˆè¿”å›ä¸€ç»„top-Kç»“æœã€‚</li></ol><p>é‡æ’åº</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250902091114481.png" alt="image-20250902091114481" style="zoom:67%;" /></p><p>ä¼˜åŠ¿ï¼šåŒæ—¶ä¿ç•™å¯†é›†å‘é‡çš„è¯­ä¹‰ç›¸ä¼¼åº¦å’Œç¨€ç–å‘é‡çš„å…³é”®å­—æŸ¥è¯¢ä¼˜åŠ¿</p><h2 id="å®æˆ˜ä»£ç ï¼ˆè¯´æ˜ï¼‰"><a href="#å®æˆ˜ä»£ç ï¼ˆè¯´æ˜ï¼‰" class="headerlink" title="å®æˆ˜ä»£ç ï¼ˆè¯´æ˜ï¼‰"></a>å®æˆ˜ä»£ç ï¼ˆè¯´æ˜ï¼‰</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Timeï¼š2025/9/2 09:15</span></span><br><span class="line"><span class="comment"># @Authorï¼šjinglv</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> (</span><br><span class="line">    connections,</span><br><span class="line">    utility,</span><br><span class="line">    FieldSchema,</span><br><span class="line">    CollectionSchema,</span><br><span class="line">    DataType,</span><br><span class="line">    Collection,</span><br><span class="line">    AnnSearchRequest,</span><br><span class="line">    WeightedRanker</span><br><span class="line">)</span><br><span class="line"><span class="keyword">from</span> pymilvus.exceptions <span class="keyword">import</span> MilvusException</span><br><span class="line"><span class="keyword">from</span> pymilvus.model.hybrid <span class="keyword">import</span> BGEM3EmbeddingFunction  <span class="comment"># pip install &quot;pymilvus[model]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0. é…ç½® (æ–¹ä¾¿ä¿®æ”¹)</span></span><br><span class="line">DATA_PATH = <span class="string">&quot;../../../data/ç­ç¥çºª/æˆ˜æ–—åœºæ™¯.json&quot;</span></span><br><span class="line">COLLECTION_NAME = <span class="string">&quot;wukong_hybrid_v4&quot;</span>  <span class="comment"># ä½¿ç”¨æ–°çš„é›†åˆåä»¥é¿å…æ—§æ•°æ®å†²çª</span></span><br><span class="line">MILVUS_URI = <span class="string">&quot;http://82.157.193.65:19530&quot;</span>  <span class="comment"># ä½¿ç”¨æ–°çš„æ•°æ®åº“æ–‡ä»¶</span></span><br><span class="line">BATCH_SIZE = <span class="number">50</span>  <span class="comment"># å¯ä»¥å°è¯•å‡å°æ‰¹æ¬¡å¤§å°ï¼Œä¾‹å¦‚ 10 æˆ– 20ï¼Œè¿›è¡Œæµ‹è¯•</span></span><br><span class="line">DEVICE = <span class="string">&quot;cpu&quot;</span>  <span class="comment"># æˆ–è€… &quot;cuda&quot; å¦‚æœæœ‰GPUå¹¶å·²æ­£ç¡®é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;è„šæœ¬å¼€å§‹æ‰§è¡Œ...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. åŠ è½½æ•°æ®</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;1. æ­£åœ¨ä» <span class="subst">&#123;DATA_PATH&#125;</span> åŠ è½½æ•°æ®...&quot;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(DATA_PATH, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        dataset = json.load(f)</span><br><span class="line"><span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;é”™è¯¯: æ•°æ®æ–‡ä»¶ <span class="subst">&#123;DATA_PATH&#125;</span> æœªæ‰¾åˆ°ã€‚è¯·æ£€æŸ¥è·¯å¾„ã€‚&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"><span class="keyword">except</span> json.JSONDecodeError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;é”™è¯¯: æ•°æ®æ–‡ä»¶ <span class="subst">&#123;DATA_PATH&#125;</span> JSON æ ¼å¼é”™è¯¯ã€‚&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line">docs = []</span><br><span class="line">metadata = []</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> dataset.get(<span class="string">&#x27;data&#x27;</span>, []):  <span class="comment"># ä½¿ç”¨ .get é¿å… &#x27;data&#x27; é”®ä¸å­˜åœ¨çš„é”™è¯¯</span></span><br><span class="line">    text_parts = [item.get(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;&#x27;</span>), item.get(<span class="string">&#x27;description&#x27;</span>, <span class="string">&#x27;&#x27;</span>)]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;combat_details&#x27;</span> <span class="keyword">in</span> item <span class="keyword">and</span> <span class="built_in">isinstance</span>(item[<span class="string">&#x27;combat_details&#x27;</span>], <span class="built_in">dict</span>):</span><br><span class="line">        text_parts.extend(item[<span class="string">&#x27;combat_details&#x27;</span>].get(<span class="string">&#x27;combat_style&#x27;</span>, []))</span><br><span class="line">        text_parts.extend(item[<span class="string">&#x27;combat_details&#x27;</span>].get(<span class="string">&#x27;abilities_used&#x27;</span>, []))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;scene_info&#x27;</span> <span class="keyword">in</span> item <span class="keyword">and</span> <span class="built_in">isinstance</span>(item[<span class="string">&#x27;scene_info&#x27;</span>], <span class="built_in">dict</span>):</span><br><span class="line">        text_parts.extend([</span><br><span class="line">            item[<span class="string">&#x27;scene_info&#x27;</span>].get(<span class="string">&#x27;location&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">            item[<span class="string">&#x27;scene_info&#x27;</span>].get(<span class="string">&#x27;environment&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">            item[<span class="string">&#x27;scene_info&#x27;</span>].get(<span class="string">&#x27;time_of_day&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        ])</span><br><span class="line">    <span class="comment"># è¿‡æ»¤æ‰ None å’Œç©ºå­—ç¬¦ä¸²ï¼Œç„¶åè¿æ¥</span></span><br><span class="line">    docs.append(<span class="string">&#x27; &#x27;</span>.join(<span class="built_in">filter</span>(<span class="literal">None</span>, [<span class="built_in">str</span>(part).strip() <span class="keyword">for</span> part <span class="keyword">in</span> text_parts <span class="keyword">if</span> part])))</span><br><span class="line">    metadata.append(item)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> docs:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;é”™è¯¯: æœªèƒ½ä»æ•°æ®æ–‡ä»¶ä¸­åŠ è½½ä»»ä½•æ–‡æ¡£ã€‚è¯·æ£€æŸ¥æ–‡ä»¶å†…å®¹å’Œç»“æ„ã€‚&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ•°æ®åŠ è½½å®Œæˆï¼Œå…± <span class="subst">&#123;<span class="built_in">len</span>(docs)&#125;</span> æ¡æ–‡æ¡£ã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ç”Ÿæˆå‘é‡</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;2. æ­£åœ¨ç”Ÿæˆå‘é‡...&quot;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    ef = BGEM3EmbeddingFunction(use_fp16=<span class="literal">False</span>, device=DEVICE)</span><br><span class="line">    docs_to_embed = docs</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å°†ä¸º <span class="subst">&#123;<span class="built_in">len</span>(docs_to_embed)&#125;</span> æ¡æ–‡æ¡£ç”Ÿæˆå‘é‡...&quot;</span>)</span><br><span class="line">    docs_embeddings = ef(docs_to_embed)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å‘é‡ç”Ÿæˆå®Œæˆã€‚&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  å¯†é›†å‘é‡ç»´åº¦: <span class="subst">&#123;ef.dim[<span class="string">&#x27;dense&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;sparse&quot;</span> <span class="keyword">in</span> docs_embeddings <span class="keyword">and</span> docs_embeddings[<span class="string">&quot;sparse&quot;</span>].shape[<span class="number">0</span>] &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  ç¨€ç–å‘é‡ç±»å‹ (æ•´ä½“): <span class="subst">&#123;<span class="built_in">type</span>(docs_embeddings[<span class="string">&#x27;sparse&#x27;</span>])&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment">#  æ‰“å°ç¬¬ä¸€ä¸ªç¨€ç–å‘é‡çš„å½¢çŠ¶å’Œéƒ¨åˆ†å†…å®¹ä»¥ä¾›æ£€æŸ¥</span></span><br><span class="line">        first_sparse_vector_row_obj = docs_embeddings[<span class="string">&#x27;sparse&#x27;</span>][<span class="number">0</span>]  <span class="comment"># è¿™ä¼šå¾—åˆ°ä¸€ä¸ªè¡¨ç¤ºå•è¡Œçš„ç¨€ç–æ•°ç»„å¯¹è±¡</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  ç¬¬ä¸€ä¸ªç¨€ç–å‘é‡ (è¡Œå¯¹è±¡ç±»å‹): <span class="subst">&#123;<span class="built_in">type</span>(first_sparse_vector_row_obj)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  ç¬¬ä¸€ä¸ªç¨€ç–å‘é‡ (è¡Œå¯¹è±¡å½¢çŠ¶): <span class="subst">&#123;first_sparse_vector_row_obj.shape&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(first_sparse_vector_row_obj, <span class="string">&#x27;col&#x27;</span>) <span class="keyword">and</span> <span class="built_in">hasattr</span>(first_sparse_vector_row_obj, <span class="string">&#x27;data&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  ç¬¬ä¸€ä¸ªç¨€ç–å‘é‡ (éƒ¨åˆ†åˆ—ç´¢å¼•/col): <span class="subst">&#123;first_sparse_vector_row_obj.col[:<span class="number">5</span>]&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  ç¬¬ä¸€ä¸ªç¨€ç–å‘é‡ (éƒ¨åˆ†æ•°æ®/data): <span class="subst">&#123;first_sparse_vector_row_obj.data[:<span class="number">5</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(first_sparse_vector_row_obj, <span class="string">&#x27;indices&#x27;</span>) <span class="keyword">and</span> <span class="built_in">hasattr</span>(first_sparse_vector_row_obj,</span><br><span class="line">                                                                         <span class="string">&#x27;data&#x27;</span>):  <span class="comment"># Fallback for other types</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  ç¬¬ä¸€ä¸ªç¨€ç–å‘é‡ (éƒ¨åˆ†ç´¢å¼•/indices): <span class="subst">&#123;first_sparse_vector_row_obj.indices[:<span class="number">5</span>]&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  ç¬¬ä¸€ä¸ªç¨€ç–å‘é‡ (éƒ¨åˆ†æ•°æ®/data): <span class="subst">&#123;first_sparse_vector_row_obj.data[:<span class="number">5</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;  æ— æ³•ç›´æ¥è·å–ç¬¬ä¸€ä¸ªç¨€ç–å‘é‡çš„åˆ—ç´¢å¼•å’Œæ•°æ®å±æ€§ã€‚&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è­¦å‘Š: æœªç”Ÿæˆç¨€ç–å‘é‡æˆ–ç¨€ç–å‘é‡ä¸ºç©ºã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç”Ÿæˆå‘é‡æ—¶å‘ç”Ÿé”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. è¿æ¥Milvus</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;3. æ­£åœ¨è¿æ¥ Milvus (URI: <span class="subst">&#123;MILVUS_URI&#125;</span>)...&quot;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    connections.connect(uri=MILVUS_URI)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æˆåŠŸè¿æ¥åˆ° Milvusã€‚&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> MilvusException <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è¿æ¥ Milvus å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. åˆ›å»ºé›†åˆ</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;4. æ­£åœ¨å‡†å¤‡é›†åˆ &#x27;<span class="subst">&#123;COLLECTION_NAME&#125;</span>&#x27;...&quot;</span>)</span><br><span class="line">fields = [</span><br><span class="line">    FieldSchema(name=<span class="string">&quot;pk&quot;</span>, dtype=DataType.VARCHAR, is_primary=<span class="literal">True</span>, auto_id=<span class="literal">True</span>, max_length=<span class="number">100</span>),</span><br><span class="line">    FieldSchema(name=<span class="string">&quot;text&quot;</span>, dtype=DataType.VARCHAR, max_length=<span class="number">65535</span>),</span><br><span class="line">    FieldSchema(name=<span class="string">&quot;id&quot;</span>, dtype=DataType.VARCHAR, max_length=<span class="number">100</span>),</span><br><span class="line">    FieldSchema(name=<span class="string">&quot;title&quot;</span>, dtype=DataType.VARCHAR, max_length=<span class="number">512</span>),</span><br><span class="line">    FieldSchema(name=<span class="string">&quot;category&quot;</span>, dtype=DataType.VARCHAR, max_length=<span class="number">128</span>),</span><br><span class="line">    FieldSchema(name=<span class="string">&quot;location&quot;</span>, dtype=DataType.VARCHAR, max_length=<span class="number">256</span>),</span><br><span class="line">    FieldSchema(name=<span class="string">&quot;environment&quot;</span>, dtype=DataType.VARCHAR, max_length=<span class="number">128</span>),</span><br><span class="line">    FieldSchema(name=<span class="string">&quot;sparse_vector&quot;</span>, dtype=DataType.SPARSE_FLOAT_VECTOR),</span><br><span class="line">    FieldSchema(name=<span class="string">&quot;dense_vector&quot;</span>, dtype=DataType.FLOAT_VECTOR, dim=ef.dim[<span class="string">&quot;dense&quot;</span>])</span><br><span class="line">]</span><br><span class="line">schema = CollectionSchema(fields, description=<span class="string">&quot;Wukong Hybrid Search Collection v4&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> utility.has_collection(COLLECTION_NAME):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;é›†åˆ &#x27;<span class="subst">&#123;COLLECTION_NAME&#125;</span>&#x27; å·²å­˜åœ¨ï¼Œæ­£åœ¨åˆ é™¤...&quot;</span>)</span><br><span class="line">        utility.drop_collection(COLLECTION_NAME)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;é›†åˆ &#x27;<span class="subst">&#123;COLLECTION_NAME&#125;</span>&#x27; åˆ é™¤æˆåŠŸã€‚&quot;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ­£åœ¨åˆ›å»ºé›†åˆ &#x27;<span class="subst">&#123;COLLECTION_NAME&#125;</span>&#x27;...&quot;</span>)</span><br><span class="line">    collection = Collection(name=COLLECTION_NAME, schema=schema, consistency_level=<span class="string">&quot;Strong&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;é›†åˆ &#x27;<span class="subst">&#123;COLLECTION_NAME&#125;</span>&#x27; åˆ›å»ºæˆåŠŸã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ­£åœ¨ä¸º sparse_vector åˆ›å»ºç´¢å¼• (SPARSE_INVERTED_INDEX, IP)...&quot;</span>)</span><br><span class="line">    collection.create_index(<span class="string">&quot;sparse_vector&quot;</span>, &#123;<span class="string">&quot;index_type&quot;</span>: <span class="string">&quot;SPARSE_INVERTED_INDEX&quot;</span>, <span class="string">&quot;metric_type&quot;</span>: <span class="string">&quot;IP&quot;</span>&#125;)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sparse_vector ç´¢å¼•åˆ›å»ºæˆåŠŸã€‚&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ­£åœ¨ä¸º dense_vector åˆ›å»ºç´¢å¼• (AUTOINDEX, IP)...&quot;</span>)</span><br><span class="line">    collection.create_index(<span class="string">&quot;dense_vector&quot;</span>, &#123;<span class="string">&quot;index_type&quot;</span>: <span class="string">&quot;AUTOINDEX&quot;</span>, <span class="string">&quot;metric_type&quot;</span>: <span class="string">&quot;IP&quot;</span>&#125;)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;dense_vector ç´¢å¼•åˆ›å»ºæˆåŠŸã€‚&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ­£åœ¨åŠ è½½é›†åˆ &#x27;<span class="subst">&#123;COLLECTION_NAME&#125;</span>&#x27;...&quot;</span>)</span><br><span class="line">    collection.load()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;é›†åˆ &#x27;<span class="subst">&#123;COLLECTION_NAME&#125;</span>&#x27; åŠ è½½æˆåŠŸã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> MilvusException <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;åˆ›å»ºæˆ–åŠ è½½é›†åˆ/ç´¢å¼•æ—¶å‘ç”Ÿ Milvus é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;åˆ›å»ºæˆ–åŠ è½½é›†åˆ/ç´¢å¼•æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;5. æ­£åœ¨å‡†å¤‡æ’å…¥æ•°æ®...&quot;</span>)</span><br><span class="line">num_docs_to_insert = <span class="built_in">len</span>(docs_to_embed)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, num_docs_to_insert, BATCH_SIZE):</span><br><span class="line">        end_idx = <span class="built_in">min</span>(i + BATCH_SIZE, num_docs_to_insert)</span><br><span class="line">        batch_data = []</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  æ­£åœ¨å‡†å¤‡æ‰¹æ¬¡ <span class="subst">&#123;i // BATCH_SIZE + <span class="number">1</span>&#125;</span> (ç´¢å¼• <span class="subst">&#123;i&#125;</span> åˆ° <span class="subst">&#123;end_idx - <span class="number">1</span>&#125;</span>)...&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i, end_idx):</span><br><span class="line">            item_metadata = metadata[j]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å…³é”®ï¼šè½¬æ¢ç¨€ç–å‘é‡æ ¼å¼</span></span><br><span class="line">            <span class="comment"># å½“ä» csr_array ç´¢å¼•ä¸€è¡Œæ—¶ï¼Œå¯èƒ½å¾—åˆ° coo_array æˆ–å…¶ä»–ç¨€ç–æ ¼å¼</span></span><br><span class="line">            sparse_row_obj = docs_embeddings[<span class="string">&quot;sparse&quot;</span>][j]</span><br><span class="line">            <span class="comment"># coo_array ä½¿ç”¨ .col å’Œ .data</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(sparse_row_obj, <span class="string">&#x27;col&#x27;</span>) <span class="keyword">and</span> <span class="built_in">hasattr</span>(sparse_row_obj, <span class="string">&#x27;data&#x27;</span>):</span><br><span class="line">                milvus_sparse_vector = &#123;<span class="built_in">int</span>(idx_col): <span class="built_in">float</span>(val) <span class="keyword">for</span> idx_col, val <span class="keyword">in</span></span><br><span class="line">                                        <span class="built_in">zip</span>(sparse_row_obj.col, sparse_row_obj.data)&#125;</span><br><span class="line">            <span class="comment"># csr_array (å¦‚æœç›´æ¥æ˜¯è¡Œ csr_array) ä½¿ç”¨ .indices å’Œ .data</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">hasattr</span>(sparse_row_obj, <span class="string">&#x27;indices&#x27;</span>) <span class="keyword">and</span> <span class="built_in">hasattr</span>(sparse_row_obj, <span class="string">&#x27;data&#x27;</span>):</span><br><span class="line">                milvus_sparse_vector = &#123;<span class="built_in">int</span>(idx_col): <span class="built_in">float</span>(val) <span class="keyword">for</span> idx_col, val <span class="keyword">in</span></span><br><span class="line">                                        <span class="built_in">zip</span>(sparse_row_obj.indices, sparse_row_obj.data)&#125;</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;è­¦å‘Š: æ— æ³•è¯†åˆ«çš„ç¨€ç–è¡Œå¯¹è±¡ç±»å‹ <span class="subst">&#123;<span class="built_in">type</span>(sparse_row_obj)&#125;</span> åœ¨ç´¢å¼• <span class="subst">&#123;j&#125;</span>ã€‚è·³è¿‡æ­¤æ¡ã€‚&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span>  <span class="comment"># æˆ–è€…å¼•å‘é”™è¯¯</span></span><br><span class="line"></span><br><span class="line">            doc_text = docs_to_embed[j]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(doc_text) &gt; <span class="number">65530</span>:</span><br><span class="line">                doc_text = doc_text[:<span class="number">65530</span>]</span><br><span class="line"></span><br><span class="line">            title_text = item_metadata.get(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;N/A&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(title_text) &gt; <span class="number">500</span>:</span><br><span class="line">                title_text = title_text[:<span class="number">500</span>]</span><br><span class="line"></span><br><span class="line">            batch_data.append(&#123;</span><br><span class="line">                <span class="string">&quot;text&quot;</span>: doc_text,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="built_in">str</span>(item_metadata.get(<span class="string">&quot;id&quot;</span>, <span class="string">f&quot;unknown_id_<span class="subst">&#123;j&#125;</span>&quot;</span>)),</span><br><span class="line">                <span class="string">&quot;title&quot;</span>: title_text,</span><br><span class="line">                <span class="string">&quot;category&quot;</span>: item_metadata.get(<span class="string">&quot;category&quot;</span>, <span class="string">&quot;N/A&quot;</span>),</span><br><span class="line">                <span class="string">&quot;location&quot;</span>: item_metadata.get(<span class="string">&quot;scene_info&quot;</span>, &#123;&#125;).get(<span class="string">&quot;location&quot;</span>, <span class="string">&quot;N/A&quot;</span>),</span><br><span class="line">                <span class="string">&quot;environment&quot;</span>: item_metadata.get(<span class="string">&quot;scene_info&quot;</span>, &#123;&#125;).get(<span class="string">&quot;environment&quot;</span>, <span class="string">&quot;N/A&quot;</span>),</span><br><span class="line">                <span class="string">&quot;sparse_vector&quot;</span>: milvus_sparse_vector,</span><br><span class="line">                <span class="string">&quot;dense_vector&quot;</span>: docs_embeddings[<span class="string">&quot;dense&quot;</span>][j].tolist()</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> batch_data:  <span class="comment"># å¦‚æœæ‰¹æ¬¡ä¸­æ‰€æœ‰ç¨€ç–å‘é‡éƒ½æ— æ³•å¤„ç†</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  æ‰¹æ¬¡ <span class="subst">&#123;i // BATCH_SIZE + <span class="number">1</span>&#125;</span> ä¸ºç©ºï¼Œè·³è¿‡æ’å…¥ã€‚&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  æ­£åœ¨æ’å…¥æ‰¹æ¬¡ <span class="subst">&#123;i // BATCH_SIZE + <span class="number">1</span>&#125;</span> (<span class="subst">&#123;<span class="built_in">len</span>(batch_data)&#125;</span> æ¡è®°å½•)...&quot;</span>)</span><br><span class="line">        insert_result = collection.insert(batch_data)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  æ‰¹æ¬¡ <span class="subst">&#123;i // BATCH_SIZE + <span class="number">1</span>&#125;</span> æ’å…¥æˆåŠŸ, ä¸»é”®: <span class="subst">&#123;insert_result.primary_keys[:<span class="number">5</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">        collection.flush()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  æ‰¹æ¬¡ <span class="subst">&#123;i // BATCH_SIZE + <span class="number">1</span>&#125;</span> flush å®Œæˆã€‚&quot;</span>)</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ‰€æœ‰æ•°æ®æ’å…¥å®Œæˆã€‚æ€»å…± <span class="subst">&#123;collection.num_entities&#125;</span> æ¡å®ä½“ã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> MilvusException <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ’å…¥æ•°æ®æ—¶å‘ç”Ÿ Milvus é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;batch_data&#x27;</span> <span class="keyword">in</span> <span class="built_in">locals</span>() <span class="keyword">and</span> batch_data:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;é—®é¢˜æ‰¹æ¬¡çš„ç¬¬ä¸€æ¡æ•°æ®ï¼ˆéƒ¨åˆ†ï¼‰:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  Text: <span class="subst">&#123;batch_data[<span class="number">0</span>][<span class="string">&#x27;text&#x27;</span>][:<span class="number">100</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  ID: <span class="subst">&#123;batch_data[<span class="number">0</span>][<span class="string">&#x27;id&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  Title: <span class="subst">&#123;batch_data[<span class="number">0</span>][<span class="string">&#x27;title&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ’å…¥æ•°æ®æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;batch_data&#x27;</span> <span class="keyword">in</span> <span class="built_in">locals</span>() <span class="keyword">and</span> batch_data:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;é—®é¢˜æ‰¹æ¬¡çš„ç¬¬ä¸€æ¡æ•°æ®ï¼ˆéƒ¨åˆ†ï¼‰:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  Text: <span class="subst">&#123;batch_data[<span class="number">0</span>][<span class="string">&#x27;text&#x27;</span>][:<span class="number">100</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. æ··åˆæœç´¢ (ç¤ºä¾‹)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hybrid_search</span>(<span class="params">query, category=<span class="literal">None</span>, environment=<span class="literal">None</span>, limit=<span class="number">5</span>, weights=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> weights <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        weights = &#123;<span class="string">&quot;sparse&quot;</span>: <span class="number">0.5</span>, <span class="string">&quot;dense&quot;</span>: <span class="number">0.5</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n6. æ‰§è¡Œæ··åˆæœç´¢: &#x27;<span class="subst">&#123;query&#125;</span>&#x27;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;   Category: <span class="subst">&#123;category&#125;</span>, Environment: <span class="subst">&#123;environment&#125;</span>, Limit: <span class="subst">&#123;limit&#125;</span>, Weights: <span class="subst">&#123;weights&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        query_embeddings = ef([query])</span><br><span class="line"></span><br><span class="line">        conditions = []</span><br><span class="line">        <span class="keyword">if</span> category:</span><br><span class="line">            conditions.append(<span class="string">f&#x27;category == &quot;<span class="subst">&#123;category&#125;</span>&quot;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> environment:</span><br><span class="line">            conditions.append(<span class="string">f&#x27;environment == &quot;<span class="subst">&#123;environment&#125;</span>&quot;&#x27;</span>)</span><br><span class="line">        expr = <span class="string">&quot; &amp;&amp; &quot;</span>.join(conditions) <span class="keyword">if</span> conditions <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;   è¿‡æ»¤è¡¨è¾¾å¼: <span class="subst">&#123;expr&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        search_params_dense = &#123;<span class="string">&quot;metric_type&quot;</span>: <span class="string">&quot;IP&quot;</span>, <span class="string">&quot;params&quot;</span>: &#123;&#125;&#125;</span><br><span class="line">        search_params_sparse = &#123;<span class="string">&quot;metric_type&quot;</span>: <span class="string">&quot;IP&quot;</span>, <span class="string">&quot;params&quot;</span>: &#123;&#125;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> expr:</span><br><span class="line">            search_params_dense[<span class="string">&quot;expr&quot;</span>] = expr</span><br><span class="line">            search_params_sparse[<span class="string">&quot;expr&quot;</span>] = expr</span><br><span class="line"></span><br><span class="line">        dense_req = AnnSearchRequest(</span><br><span class="line">            data=[query_embeddings[<span class="string">&quot;dense&quot;</span>][<span class="number">0</span>].tolist()],</span><br><span class="line">            anns_field=<span class="string">&quot;dense_vector&quot;</span>,</span><br><span class="line">            param=search_params_dense,</span><br><span class="line">            limit=limit</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è½¬æ¢æŸ¥è¯¢ç¨€ç–å‘é‡æ ¼å¼</span></span><br><span class="line">        query_sparse_row_obj = query_embeddings[<span class="string">&quot;sparse&quot;</span>][<span class="number">0</span>]  <span class="comment"># ç´¢å¼•è¿”å›å•è¡Œç¨€ç–å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(query_sparse_row_obj, <span class="string">&#x27;col&#x27;</span>) <span class="keyword">and</span> <span class="built_in">hasattr</span>(query_sparse_row_obj, <span class="string">&#x27;data&#x27;</span>):</span><br><span class="line">            query_milvus_sparse_vector = &#123;<span class="built_in">int</span>(idx): <span class="built_in">float</span>(val) <span class="keyword">for</span> idx, val <span class="keyword">in</span></span><br><span class="line">                                          <span class="built_in">zip</span>(query_sparse_row_obj.col, query_sparse_row_obj.data)&#125;</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(query_sparse_row_obj, <span class="string">&#x27;indices&#x27;</span>) <span class="keyword">and</span> <span class="built_in">hasattr</span>(query_sparse_row_obj, <span class="string">&#x27;data&#x27;</span>):</span><br><span class="line">            query_milvus_sparse_vector = &#123;<span class="built_in">int</span>(idx): <span class="built_in">float</span>(val) <span class="keyword">for</span> idx, val <span class="keyword">in</span></span><br><span class="line">                                          <span class="built_in">zip</span>(query_sparse_row_obj.indices, query_sparse_row_obj.data)&#125;</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;é”™è¯¯: æ— æ³•è¯†åˆ«çš„æŸ¥è¯¢ç¨€ç–å‘é‡ç±»å‹ <span class="subst">&#123;<span class="built_in">type</span>(query_sparse_row_obj)&#125;</span>ã€‚&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        sparse_req = AnnSearchRequest(</span><br><span class="line">            data=[query_milvus_sparse_vector],</span><br><span class="line">            anns_field=<span class="string">&quot;sparse_vector&quot;</span>,</span><br><span class="line">            param=search_params_sparse,</span><br><span class="line">            limit=limit</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        rerank = WeightedRanker(weights[<span class="string">&quot;sparse&quot;</span>], weights[<span class="string">&quot;dense&quot;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;   å‘é€æ··åˆæœç´¢è¯·æ±‚åˆ° Milvus...&quot;</span>)</span><br><span class="line">        results = collection.hybrid_search(</span><br><span class="line">            reqs=[sparse_req, dense_req],</span><br><span class="line">            rerank=rerank,</span><br><span class="line">            limit=limit,</span><br><span class="line">            output_fields=[<span class="string">&quot;text&quot;</span>, <span class="string">&quot;id&quot;</span>, <span class="string">&quot;title&quot;</span>, <span class="string">&quot;category&quot;</span>, <span class="string">&quot;location&quot;</span>, <span class="string">&quot;environment&quot;</span>, <span class="string">&quot;pk&quot;</span>]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;   æœç´¢å®Œæˆã€‚ç»“æœ:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> results <span class="keyword">or</span> <span class="keyword">not</span> results[<span class="number">0</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;   æœªæ‰¾åˆ°ç»“æœã€‚&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        processed_results = []</span><br><span class="line">        <span class="keyword">for</span> hit <span class="keyword">in</span> results[<span class="number">0</span>]:</span><br><span class="line">            processed_results.append(&#123;</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: hit.entity.get(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">                <span class="string">&quot;pk&quot;</span>: hit.<span class="built_in">id</span>,</span><br><span class="line">                <span class="string">&quot;title&quot;</span>: hit.entity.get(<span class="string">&quot;title&quot;</span>),</span><br><span class="line">                <span class="string">&quot;text_preview&quot;</span>: hit.entity.get(<span class="string">&quot;text&quot;</span>, <span class="string">&quot;&quot;</span>)[:<span class="number">200</span>] + <span class="string">&quot;...&quot;</span>,</span><br><span class="line">                <span class="string">&quot;category&quot;</span>: hit.entity.get(<span class="string">&quot;category&quot;</span>),</span><br><span class="line">                <span class="string">&quot;location&quot;</span>: hit.entity.get(<span class="string">&quot;location&quot;</span>),</span><br><span class="line">                <span class="string">&quot;environment&quot;</span>: hit.entity.get(<span class="string">&quot;environment&quot;</span>),</span><br><span class="line">                <span class="string">&quot;distance&quot;</span>: hit.distance</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">return</span> processed_results</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> MilvusException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ··åˆæœç´¢æ—¶å‘ç”Ÿ Milvus é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ··åˆæœç´¢æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹æœç´¢è°ƒç”¨</span></span><br><span class="line"><span class="keyword">if</span> collection.num_entities &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nå¼€å§‹ç¤ºä¾‹æœç´¢...&quot;</span>)</span><br><span class="line">    search_results = hybrid_search(<span class="string">&quot;å­™æ‚Ÿç©ºçš„æˆ˜æ–—æŠ€å·§&quot;</span>, category=<span class="string">&quot;ç¥é­”å¤§æˆ˜&quot;</span>, limit=<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> search_results:</span><br><span class="line">        <span class="keyword">for</span> res <span class="keyword">in</span> search_results:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  - PK: <span class="subst">&#123;res[<span class="string">&#x27;pk&#x27;</span>]&#125;</span>, Title: <span class="subst">&#123;res[<span class="string">&#x27;title&#x27;</span>]&#125;</span>, Distance: <span class="subst">&#123;res[<span class="string">&#x27;distance&#x27;</span>]:<span class="number">.4</span>f&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;    Category: <span class="subst">&#123;res[<span class="string">&#x27;category&#x27;</span>]&#125;</span>, Location: <span class="subst">&#123;res[<span class="string">&#x27;location&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;    Preview: <span class="subst">&#123;res[<span class="string">&#x27;text_preview&#x27;</span>]&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    search_results_filtered = hybrid_search(<span class="string">&quot;ç«ç„°å±±çš„æˆ˜æ–—&quot;</span>, environment=<span class="string">&quot;ç«å±±&quot;</span>, limit=<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> search_results_filtered:</span><br><span class="line">        <span class="keyword">for</span> res <span class="keyword">in</span> search_results_filtered:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  - PK: <span class="subst">&#123;res[<span class="string">&#x27;pk&#x27;</span>]&#125;</span>, Title: <span class="subst">&#123;res[<span class="string">&#x27;title&#x27;</span>]&#125;</span>, Distance: <span class="subst">&#123;res[<span class="string">&#x27;distance&#x27;</span>]:<span class="number">.4</span>f&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;    Category: <span class="subst">&#123;res[<span class="string">&#x27;category&#x27;</span>]&#125;</span>, Location: <span class="subst">&#123;res[<span class="string">&#x27;location&#x27;</span>]&#125;</span>, Environment: <span class="subst">&#123;res[<span class="string">&#x27;environment&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;    Preview: <span class="subst">&#123;res[<span class="string">&#x27;text_preview&#x27;</span>]&#125;</span>\n&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\né›†åˆä¸­æ²¡æœ‰å®ä½“ï¼Œè·³è¿‡ç¤ºä¾‹æœç´¢ã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nè„šæœ¬æ‰§è¡Œå®Œæ¯•ã€‚&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨BGE-M3åµŒå…¥ï¼š</p><ul><li>ç‰¹ç‚¹ï¼šå¤šä»»åŠ¡æ•´åˆæ¨¡å‹ï¼Œå¯ç”Ÿæˆå¯†é›†å‘é‡å’Œç¨€ç–å‘é‡</li><li>å®ç°ï¼šBGEM3EmbeddingFunction(use_fp16=False, device=â€cpuâ€)</li></ul><p>æ··åˆæ£€ç´¢é€»è¾‘</p><ul><li>å…³é”®ç»„ä»¶<ul><li>AnnSearchRequestï¼šå¤„ç†ä¸¤ç§å‘é‡ç±»å‹çš„æ£€ç´¢è¯·æ±‚</li><li>å­—æ®µå®šä¹‰ï¼šéœ€åŒ…å«sparse_vectorå’Œdense_vectorå­—æ®µ</li></ul></li><li>ç´¢å¼•åˆ›å»º</li><li>æƒé‡å‚æ•°è®¾è®¡<ul><li>è®¾è®¡åŸåˆ™ï¼šæƒé‡å€¼ä¸ºç›¸å¯¹æ¯”ä¾‹è€Œéç™¾åˆ†æ¯”ï¼ˆå¦‚{â€œsparseâ€:0.7,â€denseâ€:1.0}ï¼‰</li><li>è°ƒæ•´ç­–ç•¥ï¼š<ul><li>å¯†é›†å‘é‡æ•ˆæœæ›´å¥½æ—¶å¢åŠ denseæƒé‡</li><li>ç¨€ç–å‘é‡æ•ˆæœæ›´å¥½æ—¶å¢åŠ sparseæƒé‡</li><li>æ•ˆæœç›¸å½“æ—¶è®¾ç½®ç›¸è¿‘æƒé‡</li></ul></li></ul></li></ul><h1 id="Milvuså¤šæ¨¡æ€æ£€ç´¢å®æˆ˜"><a href="#Milvuså¤šæ¨¡æ€æ£€ç´¢å®æˆ˜" class="headerlink" title="Milvuså¤šæ¨¡æ€æ£€ç´¢å®æˆ˜"></a>Milvuså¤šæ¨¡æ€æ£€ç´¢å®æˆ˜</h1><h2 id="å¤šæ¨¡æ€æ£€ç´¢"><a href="#å¤šæ¨¡æ€æ£€ç´¢" class="headerlink" title="å¤šæ¨¡æ€æ£€ç´¢"></a>å¤šæ¨¡æ€æ£€ç´¢</h2><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250902093817419.png" alt="image-20250902093817419" style="zoom:80%;" /></p><ul><li>æœ¬è´¨ç†è§£: å¤šæ¨¡æ€æ£€ç´¢å¯ç†è§£ä¸ºæ··åˆæ£€ç´¢ï¼Œå³åœ¨åŸæœ‰æ£€ç´¢åŸºç¡€ä¸Šå¢åŠ ä¸€ç§å‘é‡è¡¨ç¤ºæ–¹å¼ã€‚</li><li>åº”ç”¨åœºæ™¯: é€‚ç”¨äºéœ€è¦åŒæ—¶æ”¯æŒæ–‡å­—å’Œå›¾ç‰‡æ£€ç´¢çš„åœºæ™¯ï¼Œå¦‚åšå®¢å›¾ç‰‡æœç´¢å¼•æ“ã€æ¸¸æˆåœºæ™¯æœç´¢ç­‰ã€‚</li><li>æ ¸å¿ƒç»„ä»¶:<ul><li>å¤šæ¨¡æ€ç¼–ç å™¨ï¼šå¦‚Visualized-BGEæ¨¡å‹</li><li>å‘é‡æ•°æ®åº“ï¼šå­˜å‚¨å‘é‡å’Œå…ƒæ•°æ®</li><li>ç›¸ä¼¼åº¦æœç´¢ï¼šåŸºäºä½™å¼¦ç›¸ä¼¼åº¦ç­‰ç®—æ³•</li></ul></li><li>æ¨¡å‹ç‰¹ç‚¹:<ul><li>åŸºäºBGEæ–‡æœ¬åµŒå…¥æ¡†æ¶ï¼Œå¢åŠ å›¾åƒtokenåµŒå…¥èƒ½åŠ›</li><li>ä¿ç•™åŸBGEæ¨¡å‹çš„å¼ºå¤§æ–‡æœ¬åµŒå…¥èƒ½åŠ›</li><li>æ”¯æŒå¤šç§æ£€ç´¢ä»»åŠ¡ï¼šå¤šæ¨¡æ€çŸ¥è¯†æ£€ç´¢ã€ç»„åˆå›¾åƒæ£€ç´¢ç­‰</li></ul></li><li>æ¨¡å‹ç‰ˆæœ¬:<ul><li>bge-visualized-base-en-v1.5ï¼š768ç»´ï¼Œè‹±æ–‡ç‰ˆ</li><li>bge-visualized-m3ï¼š1024ç»´ï¼Œå¤šè¯­è¨€ç‰ˆ</li></ul></li><li>å®‰è£…ä½¿ç”¨:<ul><li>éœ€è¦æŒ‰å®˜æ–¹æŒ‡å¯¼é€æ­¥å®‰è£…æ¨¡å‹</li><li>æ¨¡å‹ä¸‹è½½åéœ€ä¸Šä¼ åˆ°æœåŠ¡å™¨æŒ‡å®šè·¯å¾„</li><li>æ ¸å¿ƒä¾èµ–åŒ…ï¼štorchvisionã€timmã€einopsç­‰</li></ul></li></ul><h2 id="visual-bgeæ¨¡å‹ä¸‹è½½å®‰è£…"><a href="#visual-bgeæ¨¡å‹ä¸‹è½½å®‰è£…" class="headerlink" title="visual_bgeæ¨¡å‹ä¸‹è½½å®‰è£…"></a>visual_bgeæ¨¡å‹ä¸‹è½½å®‰è£…</h2><p>githubè¯´æ˜åœ°å€ï¼š<a href="https://github.com/FlagOpen/FlagEmbedding/tree/master/research/visual_bge">https://github.com/FlagOpen/FlagEmbedding/tree/master/research/visual_bge</a></p><ol><li><p>ä¸‹è½½å·¥ç¨‹å®‰è£…ä¾èµ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/FlagOpen/FlagEmbedding.git</span><br><span class="line">cd FlagEmbedding/research/visual_bge</span><br><span class="line">pip install -e .</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>å®‰è£…å…¶ä»–éœ€è¦çš„ä¾èµ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install torchvision timm einops ftfy</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ:<code>pip show visual-bge</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Name: visual_bge</span><br><span class="line">Version: 0.1.0</span><br><span class="line">Summary: visual_bge</span><br><span class="line">Home-page: https://github.com/FlagOpen/FlagEmbedding/tree/master/research/visual_bge</span><br><span class="line">Author: </span><br><span class="line">Author-email: </span><br><span class="line">License: </span><br><span class="line">Location: /Users/jinglv/PycharmProjects/llm-rag-system/.venv/lib/python3.12/site-packages</span><br><span class="line">Editable project location: /Users/jinglv/PycharmProjects/llm-rag-system/FlagEmbedding/research/visual_bge</span><br><span class="line">Requires: einops, ftfy, timm, torchvision</span><br><span class="line">Required-by: </span><br></pre></td></tr></table></figure></li></ol><p>å¯¼å…¥æŠ¥é”™é—®é¢˜ï¼š<code>ModuleNotFoundError: No module named &#39;visual_bge&#39;</code></p><ul><li>visual<em>bgeï¼šæ˜¯åœ¨ä¸‹è½½çš„FlagEmbeddingæºç ä¸­ï¼Œå»æ‰¾å¯¹åº”çš„ä½ç½®ï¼Œæœ‰åŒ…å¯¼å…¥é”™è¯¯ï¼Œæˆ–è€…ä¸æ˜¯pythonçš„åŒ…ï¼ˆç›®å½•ä¸‹ç¼ºå°‘ï¼š`<em>_init</em></em>.py`ï¼‰è¡¥ä¸Šå¯¹åº”çš„éƒ¨åˆ†å³å¯ã€‚</li></ul><h2 id="å®æˆ˜ä»£ç ï¼ˆè¯´æ˜ï¼‰-1"><a href="#å®æˆ˜ä»£ç ï¼ˆè¯´æ˜ï¼‰-1" class="headerlink" title="å®æˆ˜ä»£ç ï¼ˆè¯´æ˜ï¼‰"></a>å®æˆ˜ä»£ç ï¼ˆè¯´æ˜ï¼‰</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Timeï¼š2025/9/2 09:45</span></span><br><span class="line"><span class="comment"># @Authorï¼šjinglv</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">å¤šæ¨¡æ€å›¾åƒæ£€ç´¢ç³»ç»Ÿï¼šåŸºäºVisualized-BGEå’ŒMilvuså®ç°</span></span><br><span class="line"><span class="string">åŠŸèƒ½ï¼šå¯¹å›¾åƒå’Œæ–‡æœ¬è¿›è¡Œå¤šæ¨¡æ€ç¼–ç ï¼Œå¹¶åœ¨å›¾åƒæ•°æ®åº“ä¸­æ£€ç´¢ç›¸ä¼¼å†…å®¹</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># ==================== 1. åˆå§‹åŒ–ç¼–ç å™¨ ====================</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> MilvusClient</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> FlagEmbedding.research.visual_bge.visual_bge.modeling <span class="keyword">import</span> Visualized_BGE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># from visual_bge.modeling import Visualized_BGE</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WukongEncoder</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å¤šæ¨¡æ€ç¼–ç å™¨ï¼šå°†å›¾åƒå’Œæ–‡æœ¬ç¼–ç æˆå‘é‡&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model_name: <span class="built_in">str</span>, model_path: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.model = Visualized_BGE(model_name_bge=model_name, model_weight=model_path)</span><br><span class="line">        <span class="variable language_">self</span>.model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encode_query</span>(<span class="params">self, image_path: <span class="built_in">str</span>, text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">float</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ç¼–ç å›¾åƒå’Œæ–‡æœ¬çš„ç»„åˆæŸ¥è¯¢&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">            query_emb = <span class="variable language_">self</span>.model.encode(image=image_path, text=text)</span><br><span class="line">        <span class="keyword">return</span> query_emb.tolist()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encode_image</span>(<span class="params">self, image_path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">float</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ä»…ç¼–ç å›¾åƒ&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">            query_emb = <span class="variable language_">self</span>.model.encode(image=image_path)</span><br><span class="line">        <span class="keyword">return</span> query_emb.tolist()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–ç¼–ç å™¨</span></span><br><span class="line">model_name = <span class="string">&quot;BAAI/bge-m3&quot;</span></span><br><span class="line">model_path = <span class="string">&quot;../../../visualized_models/Visualized_m3.pth&quot;</span></span><br><span class="line">encoder = WukongEncoder(model_name, model_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== 2. æ•°æ®é›†ç®¡ç† ====================</span></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WukongImage</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å›¾åƒå…ƒæ•°æ®ç»“æ„&quot;&quot;&quot;</span></span><br><span class="line">    image_id: <span class="built_in">str</span></span><br><span class="line">    file_path: <span class="built_in">str</span></span><br><span class="line">    title: <span class="built_in">str</span></span><br><span class="line">    category: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span></span><br><span class="line">    tags: <span class="type">List</span>[<span class="built_in">str</span>]</span><br><span class="line">    game_chapter: <span class="built_in">str</span></span><br><span class="line">    location: <span class="built_in">str</span></span><br><span class="line">    characters: <span class="type">List</span>[<span class="built_in">str</span>]</span><br><span class="line">    abilities_shown: <span class="type">List</span>[<span class="built_in">str</span>]</span><br><span class="line">    environment: <span class="built_in">str</span></span><br><span class="line">    time_of_day: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WukongDataset</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å›¾åƒæ•°æ®é›†ç®¡ç†ç±»&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data_dir: <span class="built_in">str</span>, metadata_path: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.data_dir = data_dir</span><br><span class="line">        <span class="variable language_">self</span>.metadata_path = metadata_path</span><br><span class="line">        <span class="variable language_">self</span>.images: <span class="type">List</span>[WukongImage] = []</span><br><span class="line">        <span class="variable language_">self</span>._load_metadata()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_load_metadata</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åŠ è½½å›¾åƒå…ƒæ•°æ®&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="variable language_">self</span>.metadata_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            data = json.load(f)</span><br><span class="line">            <span class="keyword">for</span> img_data <span class="keyword">in</span> data[<span class="string">&#x27;images&#x27;</span>]:</span><br><span class="line">                <span class="comment"># ç¡®ä¿å›¾ç‰‡è·¯å¾„æ˜¯ç›¸å¯¹äº data_dir çš„</span></span><br><span class="line">                img_data[<span class="string">&#x27;file_path&#x27;</span>] = <span class="string">f&quot;<span class="subst">&#123;self.data_dir&#125;</span>/<span class="subst">&#123;img_data[<span class="string">&#x27;file_path&#x27;</span>].split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]&#125;</span>&quot;</span></span><br><span class="line">                <span class="variable language_">self</span>.images.append(WukongImage(**img_data))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–æ•°æ®é›†</span></span><br><span class="line">dataset = WukongDataset(<span class="string">&quot;../../../data/å¤šæ¨¡æ€&quot;</span>, <span class="string">&quot;../../../data/å¤šæ¨¡æ€/metadata.json&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== 3. ç”Ÿæˆå›¾åƒåµŒå…¥ ====================</span></span><br><span class="line"><span class="comment"># ä¸ºæ‰€æœ‰å›¾åƒç”ŸæˆåµŒå…¥å‘é‡</span></span><br><span class="line">image_dict = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> image <span class="keyword">in</span> tqdm(dataset.images, desc=<span class="string">&quot;ç”Ÿæˆå›¾ç‰‡åµŒå…¥&quot;</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        image_dict[image.file_path] = encoder.encode_image(image.file_path)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å¤„ç†å›¾ç‰‡ <span class="subst">&#123;image.file_path&#125;</span> å¤±è´¥ï¼š<span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æˆåŠŸç¼–ç  <span class="subst">&#123;<span class="built_in">len</span>(image_dict)&#125;</span> å¼ å›¾ç‰‡&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== 4. Milvuså‘é‡åº“è®¾ç½® ====================</span></span><br><span class="line"><span class="comment"># è¿æ¥/åˆ›å»ºMilvusæ•°æ®åº“</span></span><br><span class="line">collection_name = <span class="string">&quot;wukong_scenes&quot;</span></span><br><span class="line">milvus_client = MilvusClient(uri=<span class="string">&quot;http://82.157.193.65:19530&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå‘é‡é›†åˆ</span></span><br><span class="line">dim = <span class="built_in">len</span>(<span class="built_in">list</span>(image_dict.values())[<span class="number">0</span>])</span><br><span class="line">milvus_client.create_collection(</span><br><span class="line">    collection_name=collection_name,</span><br><span class="line">    dimension=dim,</span><br><span class="line">    auto_id=<span class="literal">True</span>,</span><br><span class="line">    enable_dynamic_field=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’å…¥æ•°æ®åˆ°Milvus</span></span><br><span class="line">insert_data = []</span><br><span class="line"><span class="keyword">for</span> image <span class="keyword">in</span> dataset.images:</span><br><span class="line">    <span class="keyword">if</span> image.file_path <span class="keyword">in</span> image_dict:</span><br><span class="line">        insert_data.append(&#123;</span><br><span class="line">            <span class="string">&quot;image_path&quot;</span>: image.file_path,</span><br><span class="line">            <span class="string">&quot;vector&quot;</span>: image_dict[image.file_path],</span><br><span class="line">            <span class="string">&quot;title&quot;</span>: image.title,</span><br><span class="line">            <span class="string">&quot;category&quot;</span>: image.category,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: image.description,</span><br><span class="line">            <span class="string">&quot;tags&quot;</span>: <span class="string">&quot;,&quot;</span>.join(image.tags),</span><br><span class="line">            <span class="string">&quot;game_chapter&quot;</span>: image.game_chapter,</span><br><span class="line">            <span class="string">&quot;location&quot;</span>: image.location,</span><br><span class="line">            <span class="string">&quot;characters&quot;</span>: <span class="string">&quot;,&quot;</span>.join(image.characters),</span><br><span class="line">            <span class="string">&quot;abilities&quot;</span>: <span class="string">&quot;,&quot;</span>.join(image.abilities_shown),</span><br><span class="line">            <span class="string">&quot;environment&quot;</span>: image.environment,</span><br><span class="line">            <span class="string">&quot;time_of_day&quot;</span>: image.time_of_day</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">result = milvus_client.insert(</span><br><span class="line">    collection_name=collection_name,</span><br><span class="line">    data=insert_data</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ç´¢å¼•æ„å»ºå®Œæˆï¼Œå…±æ’å…¥ <span class="subst">&#123;result[<span class="string">&#x27;insert_count&#x27;</span>]&#125;</span> æ¡è®°å½•&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== 5. æœç´¢åŠŸèƒ½å®ç° ====================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_similar_images</span>(<span class="params"></span></span><br><span class="line"><span class="params">        query_image: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        query_text: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        limit: <span class="built_in">int</span> = <span class="number">9</span></span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="type">List</span>[<span class="built_in">dict</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æœç´¢ç›¸ä¼¼å›¾åƒ</span></span><br><span class="line"><span class="string">    å‚æ•°:</span></span><br><span class="line"><span class="string">        query_image: æŸ¥è¯¢å›¾åƒè·¯å¾„</span></span><br><span class="line"><span class="string">        query_text: æŸ¥è¯¢æ–‡æœ¬</span></span><br><span class="line"><span class="string">        limit: è¿”å›ç»“æœæ•°é‡</span></span><br><span class="line"><span class="string">    è¿”å›:</span></span><br><span class="line"><span class="string">        æ£€ç´¢ç»“æœåˆ—è¡¨</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># ç”ŸæˆæŸ¥è¯¢å‘é‡</span></span><br><span class="line">    query_vec = encoder.encode_query(query_image, query_text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„å»ºæœç´¢å‚æ•°</span></span><br><span class="line">    search_params = &#123;</span><br><span class="line">        <span class="string">&quot;metric_type&quot;</span>: <span class="string">&quot;COSINE&quot;</span>,</span><br><span class="line">        <span class="string">&quot;params&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;nprobe&quot;</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="string">&quot;radius&quot;</span>: <span class="number">0.1</span>,</span><br><span class="line">            <span class="string">&quot;range_filter&quot;</span>: <span class="number">0.8</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰§è¡Œæœç´¢</span></span><br><span class="line">    results = milvus_client.search(</span><br><span class="line">        collection_name=collection_name,</span><br><span class="line">        data=[query_vec],</span><br><span class="line">        output_fields=[</span><br><span class="line">            <span class="string">&quot;image_path&quot;</span>, <span class="string">&quot;title&quot;</span>, <span class="string">&quot;category&quot;</span>, <span class="string">&quot;description&quot;</span>,</span><br><span class="line">            <span class="string">&quot;tags&quot;</span>, <span class="string">&quot;game_chapter&quot;</span>, <span class="string">&quot;location&quot;</span>, <span class="string">&quot;characters&quot;</span>,</span><br><span class="line">            <span class="string">&quot;abilities&quot;</span>, <span class="string">&quot;environment&quot;</span>, <span class="string">&quot;time_of_day&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        limit=limit,</span><br><span class="line">        search_params=search_params</span><br><span class="line">    )[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== 6. å¯è§†åŒ–å‡½æ•° ====================</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">visualize_results</span>(<span class="params">query_image: <span class="built_in">str</span>, results: <span class="type">List</span>[<span class="built_in">dict</span>], output_path: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å¯è§†åŒ–æœç´¢ç»“æœ</span></span><br><span class="line"><span class="string">    å‚æ•°:</span></span><br><span class="line"><span class="string">        query_image: æŸ¥è¯¢å›¾åƒè·¯å¾„</span></span><br><span class="line"><span class="string">        results: æœç´¢ç»“æœåˆ—è¡¨</span></span><br><span class="line"><span class="string">        output_path: è¾“å‡ºå›¾åƒè·¯å¾„</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># è®¾ç½®å›¾ç‰‡å¤§å°å’Œç½‘æ ¼å‚æ•°</span></span><br><span class="line">    img_size = (<span class="number">300</span>, <span class="number">300</span>)</span><br><span class="line">    grid_size = (<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»ºç”»å¸ƒ</span></span><br><span class="line">    canvas_height = img_size[<span class="number">0</span>] * (grid_size[<span class="number">0</span>] + <span class="number">1</span>)</span><br><span class="line">    canvas_width = img_size[<span class="number">1</span>] * (grid_size[<span class="number">1</span>] + <span class="number">1</span>)</span><br><span class="line">    canvas = np.full((canvas_height, canvas_width, <span class="number">3</span>), <span class="number">255</span>, dtype=np.uint8)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ·»åŠ æŸ¥è¯¢å›¾ç‰‡</span></span><br><span class="line">    query_img = Image.<span class="built_in">open</span>(query_image).convert(<span class="string">&quot;RGB&quot;</span>)</span><br><span class="line">    query_array = np.array(query_img)</span><br><span class="line">    query_resized = cv2.resize(query_array, (img_size[<span class="number">0</span>] - <span class="number">20</span>, img_size[<span class="number">1</span>] - <span class="number">20</span>))</span><br><span class="line">    bordered_query = cv2.copyMakeBorder(</span><br><span class="line">        query_resized, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>,</span><br><span class="line">        cv2.BORDER_CONSTANT,</span><br><span class="line">        value=(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    )</span><br><span class="line">    canvas[:img_size[<span class="number">0</span>], :img_size[<span class="number">1</span>]] = bordered_query</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ·»åŠ ç»“æœå›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">for</span> idx, result <span class="keyword">in</span> <span class="built_in">enumerate</span>(results[:grid_size[<span class="number">0</span>] * grid_size[<span class="number">1</span>]]):</span><br><span class="line">        row = (idx // grid_size[<span class="number">1</span>]) + <span class="number">1</span></span><br><span class="line">        col = idx % grid_size[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        img = Image.<span class="built_in">open</span>(result[<span class="string">&quot;entity&quot;</span>][<span class="string">&quot;image_path&quot;</span>]).convert(<span class="string">&quot;RGB&quot;</span>)</span><br><span class="line">        img_array = np.array(img)</span><br><span class="line">        resized = cv2.resize(img_array, (img_size[<span class="number">0</span>], img_size[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">        y_start = row * img_size[<span class="number">0</span>]</span><br><span class="line">        x_start = col * img_size[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        canvas[y_start:y_start + img_size[<span class="number">0</span>], x_start:x_start + img_size[<span class="number">1</span>]] = resized</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ·»åŠ ç›¸ä¼¼åº¦åˆ†æ•°</span></span><br><span class="line">        score_text = <span class="string">f&quot;Score: <span class="subst">&#123;result[<span class="string">&#x27;distance&#x27;</span>]:<span class="number">.2</span>f&#125;</span>&quot;</span></span><br><span class="line">        cv2.putText(</span><br><span class="line">            canvas,</span><br><span class="line">            score_text,</span><br><span class="line">            (x_start + <span class="number">10</span>, y_start + img_size[<span class="number">0</span>] - <span class="number">10</span>),</span><br><span class="line">            cv2.FONT_HERSHEY_SIMPLEX,</span><br><span class="line">            <span class="number">0.5</span>,</span><br><span class="line">            (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">            <span class="number">1</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    cv2.imwrite(output_path, canvas)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== 7. æ‰§è¡ŒæŸ¥è¯¢ç¤ºä¾‹ ====================</span></span><br><span class="line"><span class="comment"># æ‰§è¡ŒæŸ¥è¯¢</span></span><br><span class="line">query_image = <span class="string">&quot;../../../data/å¤šæ¨¡æ€/query_image.jpg&quot;</span></span><br><span class="line">query_text = <span class="string">&quot;å¯»æ‰¾æ‚Ÿç©ºé¢å¯¹å»ºç­‘ç‰©æˆ˜æ–—åœºæ™¯&quot;</span></span><br><span class="line"></span><br><span class="line">results = search_similar_images(</span><br><span class="line">    query_image=query_image,</span><br><span class="line">    query_text=query_text,</span><br><span class="line">    limit=<span class="number">9</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºè¯¦ç»†ä¿¡æ¯</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\næœç´¢ç»“æœ:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> idx, result <span class="keyword">in</span> <span class="built_in">enumerate</span>(results):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\nç»“æœ <span class="subst">&#123;idx&#125;</span>:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å›¾ç‰‡ï¼š<span class="subst">&#123;result[<span class="string">&#x27;entity&#x27;</span>][<span class="string">&#x27;image_path&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ ‡é¢˜ï¼š<span class="subst">&#123;result[<span class="string">&#x27;entity&#x27;</span>][<span class="string">&#x27;title&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æè¿°ï¼š<span class="subst">&#123;result[<span class="string">&#x27;entity&#x27;</span>][<span class="string">&#x27;description&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç›¸ä¼¼åº¦åˆ†æ•°ï¼š<span class="subst">&#123;result[<span class="string">&#x27;distance&#x27;</span>]:<span class="number">.4</span>f&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯è§†åŒ–ç»“æœ</span></span><br><span class="line">visualize_results(query_image, results, <span class="string">&quot;search_results.jpg&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>æƒé‡å‚æ•°è®¾è®¡:</p><ul><li>sparseæƒé‡0.7ï¼Œdenseæƒé‡1.0</li><li>æƒé‡å€¼ä¸éœ€è¦åŠ èµ·æ¥ç­‰äº1ï¼Œè¡¨ç¤ºç›¸å¯¹é‡è¦æ€§æ¯”ä¾‹</li><li>ç¨ å¯†å‘é‡é‡è¦æ€§æ˜¯ç¨€ç–å‘é‡çš„çº¦1.43å€(1.0/0.7)</li><li>å¯æ ¹æ®å®é™…æ•ˆæœåŠ¨æ€è°ƒæ•´æƒé‡æ¯”ä¾‹</li></ul></li><li><p>æ•°æ®é›†ç®¡ç†</p><ul><li>æ•°æ®ç»“æ„:<ul><li>åŒ…å«å›¾åƒIDã€æ–‡ä»¶è·¯å¾„ã€æ ‡é¢˜ã€ç±»åˆ«ç­‰åŸºç¡€ä¿¡æ¯</li><li>è¯¦ç»†æè¿°å­—æ®µï¼šå¦‚æˆ˜æ–—åœºæ™¯æè¿°ã€è§’è‰²ã€ç¯å¢ƒç­‰</li><li>æ ‡ç­¾åˆ—è¡¨ï¼šå¦‚â€ç¾¤æˆ˜â€ã€â€æ°´ç‰¹æ•ˆâ€ç­‰å…³é”®è¯</li></ul></li><li>æ„å»ºæ–¹æ³•:<ul><li>å¯ä½¿ç”¨å¤§æ¨¡å‹è‡ªåŠ¨ç”Ÿæˆå›¾åƒå…ƒæ•°æ®</li><li>å…ƒæ•°æ®ä¸å›¾åƒæ–‡ä»¶éœ€ä¿æŒå¯¹åº”å…³ç³»</li><li>æ”¯æŒè‡ªå®šä¹‰å­—æ®µæ‰©å±•</li></ul></li></ul></li><li>æ£€ç´¢åŠŸèƒ½çš„å®ç°<ul><li>æ£€ç´¢æ–¹å¼:<ul><li>æ”¯æŒçº¯å›¾åƒæ£€ç´¢</li><li>æ”¯æŒå›¾æ–‡æ··åˆæ£€ç´¢</li><li>æ”¯æŒå¸¦è¿‡æ»¤æ¡ä»¶çš„æ£€ç´¢</li></ul></li><li>æ ¸å¿ƒæµç¨‹:<ul><li>åˆå§‹åŒ–ç¼–ç å™¨å¹¶åŠ è½½æ¨¡å‹</li><li>ä¸ºæ‰€æœ‰å›¾åƒç”ŸæˆåµŒå…¥å‘é‡</li><li>åˆ›å»ºMilvuså‘é‡é›†åˆ</li><li>æ‰§è¡Œç›¸ä¼¼åº¦æœç´¢</li><li>å¯è§†åŒ–å±•ç¤ºç»“æœ</li></ul></li><li>æ··åˆæ£€ç´¢å®ç°:<ul><li>åŒæ—¶ç¼–ç å›¾åƒå’Œæ–‡æœ¬ç”ŸæˆæŸ¥è¯¢å‘é‡</li><li>å¯è®¾ç½®è¿‡æ»¤æ¡ä»¶ç¼©å°æœç´¢èŒƒå›´</li><li>æ”¯æŒè°ƒæ•´ç¨€ç–å’Œç¨ å¯†å‘é‡çš„æƒé‡æ¯”ä¾‹</li></ul></li></ul></li></ul><h2 id="å…¶å®ƒå¤šæ¨¡æ€è§£å†³æ–¹æ¡ˆ"><a href="#å…¶å®ƒå¤šæ¨¡æ€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å…¶å®ƒå¤šæ¨¡æ€è§£å†³æ–¹æ¡ˆ"></a>å…¶å®ƒå¤šæ¨¡æ€è§£å†³æ–¹æ¡ˆ</h2><ul><li>Weaviateï¼šåŸç”Ÿæ”¯æŒå›¾åƒã€æ–‡æœ¬ç­‰å¤šç§æ¨¡æ€çš„ Any-to-Any æ£€ç´¢ ã€‚</li><li>Qdrantï¼šç»“åˆ ImageBindã€LlamaIndex ç­‰æ¨¡å‹ï¼Œå¯å®ç°éŸ³é¢‘ã€å›¾åƒã€æ–‡æœ¬ç­‰è·¨æ¨¡æ€å‘é‡åŒ–æ£€ç´¢ã€‚</li><li>OpenSearchï¼šé€šè¿‡ç¥ç»æ’ä»¶ï¼ˆNeural Searchï¼‰å’Œ Titan å¤šæ¨¡æ€åµŒå…¥æ¨¡å‹ï¼Œæä¾›äº‘ç«¯æ‰˜ç®¡çš„å¤šæ¨¡æ€æœç´¢èƒ½åŠ›ã€‚</li><li>Pineconeï¼šå…¨æ‰˜ç®¡å‘é‡åº“ï¼Œå¼€ç®±å³å¯å®ç°å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ç­‰å¤šæ¨¡æ€å‘é‡æ£€ç´¢ã€‚</li><li>Haystackï¼šåœ¨ NLP æ£€ç´¢æ¡†æ¶åŸºç¡€ä¸Šï¼Œé›†æˆ CLIP ç­‰æ¨¡å‹ï¼Œå¯æ‰©å±•ä¸ºå¤šæ¨¡æ€æœç´¢ç³»ç»Ÿã€‚</li><li>Vespaï¼šæ”¯æŒå¤šå‘é‡ç´¢å¼•ä¸å¤æ‚æ’åå‡½æ•°ï¼Œæ“…é•¿ç”µå•†ã€æ–°é—»ç­‰åœºæ™¯ä¸‹çš„å¤šæ¨¡æ€æ£€ç´¢ã€‚</li></ul>]]></content>
    
    
    <summary type="html">å­¦ä¹ å¤§æ¨¡å‹RAGç³»ç»Ÿå­¦ä¹ ç¬”è®°ç¬¬äºŒåä¸‰è®²</summary>
    
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>AIå¤§æ¨¡å‹å’ŒAgentæ™ºèƒ½ä½“ä»‹ç»</title>
    <link href="https://jinglv.github.io/2025/08/25/ai/llm/1-introduce/"/>
    <id>https://jinglv.github.io/2025/08/25/ai/llm/1-introduce/</id>
    <published>2025-08-24T16:00:00.000Z</published>
    <updated>2025-08-31T12:18:01.596Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰"><a href="#ä»€ä¹ˆæ˜¯å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰"></a>ä»€ä¹ˆæ˜¯å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰</h1><h2 id="å¤§è¯­è¨€æ¨¡å‹å®šä¹‰ï¼ˆLLMï¼‰"><a href="#å¤§è¯­è¨€æ¨¡å‹å®šä¹‰ï¼ˆLLMï¼‰" class="headerlink" title="å¤§è¯­è¨€æ¨¡å‹å®šä¹‰ï¼ˆLLMï¼‰"></a>å¤§è¯­è¨€æ¨¡å‹å®šä¹‰ï¼ˆLLMï¼‰</h2><p><strong>å®šä¹‰ï¼š</strong> å¤§è¯­è¨€æ¨¡å‹ï¼ˆLarge Language Modelï¼Œç®€ç§° LLMï¼‰æ˜¯ä½¿ç”¨å¤§è§„æ¨¡è‡ªç„¶è¯­è¨€æ•°æ®è®­ç»ƒè€Œæˆçš„<strong>æ·±åº¦å­¦ä¹ æ¨¡å‹</strong>ï¼Œå…·æœ‰å¯¹æ–‡æœ¬çš„ç†è§£ä¸ç”Ÿæˆèƒ½åŠ›ã€‚</p><ul><li>å®ƒä¸ä»…èƒ½ç†è§£ç”¨æˆ·è¾“å…¥çš„è‡ªç„¶è¯­è¨€ï¼Œè¿˜èƒ½è¾“å‡ºè¿è´¯ã€æœ‰é€»è¾‘ã€å…·æœ‰ä¸Šä¸‹æ–‡å…³è”çš„å†…å®¹ã€‚</li><li>å¯æ‰§è¡Œçš„ä»»åŠ¡åŒ…æ‹¬ï¼šé—®ç­”ã€ç¿»è¯‘ã€æ–‡æœ¬æ€»ç»“ã€ä»£ç ç”Ÿæˆã€é€»è¾‘æ¨ç†ç­‰ã€‚</li></ul><h2 id="å¤§è¯­è¨€æ¨¡å‹çš„ä¸»è¦ç‰¹å¾"><a href="#å¤§è¯­è¨€æ¨¡å‹çš„ä¸»è¦ç‰¹å¾" class="headerlink" title="å¤§è¯­è¨€æ¨¡å‹çš„ä¸»è¦ç‰¹å¾"></a>å¤§è¯­è¨€æ¨¡å‹çš„ä¸»è¦ç‰¹å¾</h2><h4 id="ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›"><a href="#ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›" class="headerlink" title="ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›"></a>ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›</h4><ul><li>èƒ½è¿½è¸ªå¯¹è¯å†å²ï¼Œç†è§£å¹¶å›åº”è¯­ä¹‰è¿ç»­çš„é—®é¢˜ã€‚</li><li>ä¸¾ä¾‹ï¼šè¿ç»­å¯¹è¯ä¸­ï¼Œæ¨¡å‹çŸ¥é“â€œä»–â€æŒ‡çš„æ˜¯ä¸Šä¸€ä¸ªé—®é¢˜æåˆ°çš„äººç‰©ã€‚</li></ul><h4 id="æ‰§è¡Œå¤æ‚ä»»åŠ¡"><a href="#æ‰§è¡Œå¤æ‚ä»»åŠ¡" class="headerlink" title="æ‰§è¡Œå¤æ‚ä»»åŠ¡"></a>æ‰§è¡Œå¤æ‚ä»»åŠ¡</h4><ul><li>èƒ½è¿›è¡Œé€»è¾‘æ¨ç†ã€æƒ…æ„Ÿåˆ†æã€æ‘˜è¦ç”Ÿæˆã€ç”šè‡³ä»£ç ç¼–å†™ã€‚</li><li>å¦‚ï¼šåˆ†æç”µå½±è¯„è®ºçš„æƒ…ç»ªã€ç”Ÿæˆåšå®¢æ‘˜è¦ã€è¾“å‡º Python å‡½æ•°ã€‚</li></ul><h4 id="Prompt-é©±åŠ¨å­¦ä¹ æ–¹å¼"><a href="#Prompt-é©±åŠ¨å­¦ä¹ æ–¹å¼" class="headerlink" title="Prompt é©±åŠ¨å­¦ä¹ æ–¹å¼"></a>Prompt é©±åŠ¨å­¦ä¹ æ–¹å¼</h4><ul><li><strong>Zero-shot Learningï¼ˆé›¶æ ·æœ¬å­¦ä¹ ï¼‰</strong>ï¼šä¸æä¾›ç¤ºä¾‹ï¼Œä»…é è‡ªç„¶è¯­è¨€æç¤ºæ‰§è¡Œä»»åŠ¡ã€‚</li><li><strong>Few-shot Learningï¼ˆå°‘æ ·æœ¬å­¦ä¹ ï¼‰</strong>ï¼šæä¾› 1~3 ä¸ªç¤ºä¾‹ï¼Œæ¨¡å‹åŸºäºè¿™äº›ç¤ºä¾‹æ¨ç†å‡ºè§£å†³æ–¹æ¡ˆã€‚</li></ul><h2 id="ä¸»æµå¼€æºä¸é—­æºæ¨¡å‹å¯¹æ¯”"><a href="#ä¸»æµå¼€æºä¸é—­æºæ¨¡å‹å¯¹æ¯”" class="headerlink" title="ä¸»æµå¼€æºä¸é—­æºæ¨¡å‹å¯¹æ¯”"></a>ä¸»æµå¼€æºä¸é—­æºæ¨¡å‹å¯¹æ¯”</h2><h3 id="æŒ‰å¼€æº-é—­æºåˆ†ç±»"><a href="#æŒ‰å¼€æº-é—­æºåˆ†ç±»" class="headerlink" title="æŒ‰å¼€æº/é—­æºåˆ†ç±»"></a>æŒ‰å¼€æº/é—­æºåˆ†ç±»</h3><div class="table-container"><table><thead><tr><th><strong>ç±»å‹</strong></th><th><strong>ä»£è¡¨æ¨¡å‹</strong></th></tr></thead><tbody><tr><td>å¼€æº</td><td>LLaMAã€BLOOMã€DeepSeekã€Qwenã€ChatGLMã€</td></tr><tr><td>é—­æº</td><td>GPT ç³»åˆ—ã€Claudeã€æ–‡å¿ƒä¸€è¨€</td></tr></tbody></table></div><ul><li><p><strong>å¼€æºæ¨¡å‹ç±»æ¯”ï¼šè‡ªå·±æ­å»ºä¸€å°æœåŠ¡å™¨</strong></p><ul><li><p>ä¼˜ç‚¹ï¼šå¯æ§ã€å®‰å…¨ã€å¯ä¿®æ”¹ã€‚</p></li><li><p>ç¼ºç‚¹ï¼šè¿ç»´æˆæœ¬é«˜ï¼Œéœ€è¦é…ç½®æ˜¾å¡ã€æƒé‡æ–‡ä»¶ã€åŠ è½½æ–¹å¼ç­‰ã€‚</p></li></ul></li><li><p><strong>é—­æºæ¨¡å‹ç±»æ¯”ï¼šç§Ÿç”¨äº‘æœåŠ¡</strong></p><ul><li><p>ä¼˜ç‚¹ï¼šå³å¼€å³ç”¨ï¼Œæ€§èƒ½å¼ºå¤§ï¼Œæ— éœ€éƒ¨ç½²ã€‚</p></li><li><p>ç¼ºç‚¹ï¼šæ•°æ®å‡ºå¢ƒã€é»‘ç›’é™åˆ¶ã€å®šä»·å¯èƒ½è¾ƒé«˜ã€‚</p></li></ul></li></ul><h3 id="ä¸»æµæ¨¡å‹å¯¹æ¯”ç»´åº¦"><a href="#ä¸»æµæ¨¡å‹å¯¹æ¯”ç»´åº¦" class="headerlink" title="ä¸»æµæ¨¡å‹å¯¹æ¯”ç»´åº¦"></a>ä¸»æµæ¨¡å‹å¯¹æ¯”ç»´åº¦</h3><div class="table-container"><table><thead><tr><th><strong>å¤§æ¨¡å‹</strong></th><th><strong>æœºæ„</strong></th><th><strong>æ˜¯å¦å¼€æº</strong></th><th></th><th></th></tr></thead><tbody><tr><td><strong>GPT-4</strong></td><td>OpenAI</td><td>âŒ å¦</td><td>API</td><td>ç»¼åˆèƒ½åŠ›å¼ºï¼Œç”Ÿæ€æˆç†Ÿï¼Œç¨³å®šæ€§é«˜</td></tr><tr><td><strong>Claude 3</strong></td><td>Anthropic</td><td>âŒ å¦</td><td>API</td><td>é•¿ä¸Šä¸‹æ–‡æ”¯æŒå¼ºï¼ˆ200K+ï¼‰ï¼Œå®‰å…¨æ€§å¥½</td></tr><tr><td><strong>æ–‡å¿ƒä¸€è¨€ï¼ˆERNIE Botï¼‰</strong></td><td>ç™¾åº¦</td><td>âŒ å¦</td><td>API</td><td>ä¸­æ–‡ä¼˜åŒ–ï¼Œé›†æˆç™¾åº¦ç”Ÿæ€</td></tr><tr><td><strong>ChatGLM3</strong></td><td>æ™ºè°±AIï¼ˆZhipu AIï¼‰</td><td>âœ… æ˜¯</td><td>æœ¬åœ°éƒ¨ç½² / API</td><td>ä¸­æ–‡ä¼˜åŒ–å¥½ï¼Œæ¨ç†å¿«ï¼Œæœ‰Mixç»“æ„</td></tr><tr><td><strong>LLaMA 2 / 3</strong></td><td>Meta</td><td>âœ… æ˜¯</td><td>æœ¬åœ°éƒ¨ç½² / API</td><td>ç¤¾åŒºæ´»è·ƒï¼Œé€‚åˆç ”ç©¶ä¸è‡ªå®šä¹‰éƒ¨ç½²</td></tr><tr><td><strong>DeepSeek V3</strong></td><td>æ·±åº¦æ±‚ç´¢</td><td>âœ… æ˜¯</td><td>æœ¬åœ° éƒ¨ç½²/ API</td><td>ä¸­æ–‡ä¼˜åŒ–ï¼Œæ€§èƒ½ä¼˜ï¼Œæ•ˆç‡é«˜ï¼Œæ”¯æŒå¤šæ¨¡æ€</td></tr><tr><td><strong>åƒé—® Qwen</strong></td><td>é˜¿é‡Œ</td><td>âœ… æ˜¯</td><td>æœ¬åœ°éƒ¨ç½² / API</td><td>ä¸­æ–‡å¼ºï¼Œæ”¯æŒé•¿ä¸Šä¸‹æ–‡ï¼Œæ¨ç†å¼ºï¼Œåº”ç”¨æ´»è·ƒ</td></tr></tbody></table></div><h3 id="é—­æºæ¨¡å‹çš„ä¼˜åŠ¿ä¸å±€é™"><a href="#é—­æºæ¨¡å‹çš„ä¼˜åŠ¿ä¸å±€é™" class="headerlink" title="é—­æºæ¨¡å‹çš„ä¼˜åŠ¿ä¸å±€é™"></a>é—­æºæ¨¡å‹çš„ä¼˜åŠ¿ä¸å±€é™</h3><p><strong>ğŸ‘</strong> <strong>ä¼˜åŠ¿:</strong></p><ul><li>è¡¨ç°å¼ºå¤§ï¼Œå¸¸å±…æ’è¡Œæ¦œå‰åˆ—ï¼ˆå¦‚ GPT-4oï¼‰</li><li>äº‘ç«¯éƒ¨ç½²ï¼Œæ— éœ€æœ¬åœ°èµ„æº</li></ul><p><strong>ğŸ‘</strong> <strong>å±€é™ï¼š</strong></p><ul><li>ä½¿ç”¨æˆæœ¬è¾ƒé«˜ï¼ˆæŒ‰ token æ”¶è´¹ï¼‰</li><li>æ— æ³•è‡ªå®šä¹‰/å¾®è°ƒæ¨¡å‹</li><li>æ•°æ®ä¼ è¾“æ¶‰åŠéšç§å’Œåˆè§„é£é™©</li></ul><h3 id="å¼€æºæ¨¡å‹çš„ä¼˜åŠ¿ä¸å±€é™"><a href="#å¼€æºæ¨¡å‹çš„ä¼˜åŠ¿ä¸å±€é™" class="headerlink" title="å¼€æºæ¨¡å‹çš„ä¼˜åŠ¿ä¸å±€é™"></a>å¼€æºæ¨¡å‹çš„ä¼˜åŠ¿ä¸å±€é™</h3><p><strong>ğŸ‘</strong> <strong>ä¼˜åŠ¿ï¼š</strong></p><ul><li>è‡ªä¸»å¯æ§ï¼Œå¯æœ¬åœ°éƒ¨ç½²ï¼Œæ— éœ€è”ç½‘</li><li>å¯å¾®è°ƒé€‚é…ç‰¹å®šåœºæ™¯ï¼ˆå¦‚åŒ»ç–—é—®ç­”ã€æ•™è‚²é—®ç­”ï¼‰</li><li>æˆæœ¬ä½ï¼Œé€‚åˆä¼ä¸š/é«˜æ ¡ç§æœ‰éƒ¨ç½²</li></ul><p><strong>ğŸ‘</strong> <strong>å±€é™ï¼š</strong></p><ul><li>å•æ¨¡å‹èƒ½åŠ›ä¸€èˆ¬ä¸å¦‚ GPT-4oç­‰é—­æºæ¨¡å‹</li><li>å¾®è°ƒä¸éƒ¨ç½²éœ€è¦ GPU èµ„æºåŠä¸€å®šå·¥ç¨‹èƒ½åŠ›</li></ul><h2 id="å¤§æ¨¡å‹çš„èƒ½åŠ›"><a href="#å¤§æ¨¡å‹çš„èƒ½åŠ›" class="headerlink" title="å¤§æ¨¡å‹çš„èƒ½åŠ›"></a>å¤§æ¨¡å‹çš„èƒ½åŠ›</h2><h3 id="æ“…é•¿çš„èƒ½åŠ›é¢†åŸŸï¼ˆå½“å‰ï¼‰"><a href="#æ“…é•¿çš„èƒ½åŠ›é¢†åŸŸï¼ˆå½“å‰ï¼‰" class="headerlink" title="æ“…é•¿çš„èƒ½åŠ›é¢†åŸŸï¼ˆå½“å‰ï¼‰"></a>æ“…é•¿çš„èƒ½åŠ›é¢†åŸŸï¼ˆå½“å‰ï¼‰</h3><div class="table-container"><table><thead><tr><th><strong>èƒ½åŠ›</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>æ–‡æœ¬ç”Ÿæˆ</td><td>è‡ªåŠ¨æ’°å†™æ–‡ç« ã€æ–‡æ¡ˆã€é‚®ä»¶ç­‰</td></tr><tr><td>ä¿¡æ¯æ•´åˆ</td><td>æ‘˜è¦ã€ç¿»è¯‘ã€çŸ¥è¯†é—®ç­”ç­‰ä»»åŠ¡</td></tr><tr><td>ä»£ç ç¼–å†™</td><td>è‡ªåŠ¨ç”Ÿæˆã€è¡¥å…¨ã€ä¿®å¤ä»£ç ï¼ˆå¦‚ Pythonã€JSï¼‰</td></tr><tr><td>é€»è¾‘æ¨ç†</td><td>åœ¨æç¤ºå¼•å¯¼ä¸‹å®Œæˆç»“æ„åŒ–æ¨ç†ï¼ˆå¦‚ Chain-of-Thoughtï¼‰</td></tr><tr><td>å¯¹è¯ç®¡ç†</td><td>æ”¯æŒä¸Šä¸‹æ–‡å…³è”ã€æƒ…ç»ªè°ƒèŠ‚</td></tr><tr><td>å¤šä»»åŠ¡æ‰§è¡Œ</td><td>ç®€å•ä»»åŠ¡è§„åˆ’ä¸æŒ‡ä»¤åˆ†è§£æ‰§è¡Œ</td></tr></tbody></table></div><h3 id="ä¸æ“…é•¿çš„é¢†åŸŸ"><a href="#ä¸æ“…é•¿çš„é¢†åŸŸ" class="headerlink" title="ä¸æ“…é•¿çš„é¢†åŸŸ"></a>ä¸æ“…é•¿çš„é¢†åŸŸ</h3><div class="table-container"><table><thead><tr><th><strong>èƒ½åŠ›é™åˆ¶</strong></th><th><strong>æè¿°</strong></th><th><strong>å½“å‰æ”¹è¿›æ–¹å‘</strong></th></tr></thead><tbody><tr><td>å®æ—¶æŸ¥è¯¢</td><td>é»˜è®¤é—­æºæ¨¡å‹ä¸è”ç½‘</td><td>æ’ä»¶æˆ–å¤–æ¥ APIï¼ˆå¦‚ Perplexityã€Bingï¼‰æ”¯æŒ</td></tr><tr><td>ç²¾å‡†è®¡ç®—</td><td>æ•°å­¦èƒ½åŠ›æœ‰é™ï¼Œæ˜“å‡ºé”™</td><td>å¯ç»“åˆ Wolfram Alpha æ’ä»¶è¿›è¡Œæ•°å­¦è®¡ç®—</td></tr><tr><td>ä¸Šä¸‹æ–‡ä¸€è‡´æ€§</td><td>é•¿å¯¹è¯æ˜“â€œé—å¿˜â€å‰æ–‡å†…å®¹</td><td>Claude 3ã€Gemini 1.5 æä¾›è¶…é•¿ä¸Šä¸‹æ–‡æ”¯æŒ</td></tr><tr><td>ä¿¡æ¯å¹»è§‰</td><td>å¯èƒ½ç¼–é€ äº‹å®ã€å¼•ç”¨é”™è¯¯</td><td>ä½¿ç”¨ RAG æŠ€æœ¯ã€æç¤ºè¯ä¼˜åŒ–å¯ç¼“è§£</td></tr><tr><td>å®‰å…¨è¾¹ç•Œ</td><td>æ— æ³•å¤„ç†æ•æ„Ÿéšç§ä¿¡æ¯</td><td>ä¸é€‚åˆç”¨äºåŒ»ç–—è¯Šæ–­ã€æ³•å¾‹å®šæ¡ˆç­‰åœºæ™¯</td></tr><tr><td>å¤šæ¨¡æ€é™åˆ¶</td><td>å›¾åƒã€éŸ³é¢‘æ¨ç†å°šä¸æˆç†Ÿ</td><td>å­˜åœ¨ç©ºé—´ç†è§£ä¸æƒ…æ„Ÿè¯†åˆ«çš„ç“¶é¢ˆ</td></tr></tbody></table></div><h3 id="èƒ½åŠ›è¾¹ç•Œçš„â€œåŠ¨æ€æ€§â€"><a href="#èƒ½åŠ›è¾¹ç•Œçš„â€œåŠ¨æ€æ€§â€" class="headerlink" title="èƒ½åŠ›è¾¹ç•Œçš„â€œåŠ¨æ€æ€§â€"></a>èƒ½åŠ›è¾¹ç•Œçš„â€œåŠ¨æ€æ€§â€</h3><ul><li>æŠ€æœ¯æŒç»­æ›´æ–°ï¼Œèƒ½åŠ›è¾¹ç•Œæ­£åœ¨æ‹“å®½</li><li>å½“å‰ä¸ç­‰äºæ°¸ä¹…ä¸è¡Œ</li></ul><h1 id="ä»€ä¹ˆæ˜¯Agentæ™ºèƒ½ä½“"><a href="#ä»€ä¹ˆæ˜¯Agentæ™ºèƒ½ä½“" class="headerlink" title="ä»€ä¹ˆæ˜¯Agentæ™ºèƒ½ä½“"></a>ä»€ä¹ˆæ˜¯Agentæ™ºèƒ½ä½“</h1><p>æ™ºèƒ½ä½“ï¼ˆAI Agentsæˆ–Agentsï¼‰æ˜¯æŒ‡èƒ½å¤Ÿ<strong>è‡ªä¸»æ„ŸçŸ¥ç¯å¢ƒã€åšå‡ºå†³ç­–å¹¶æ‰§è¡Œè¡ŒåŠ¨çš„ç³»ç»Ÿæˆ–ç¨‹åº</strong>ã€‚æ ¹æ®IBMçš„å®šä¹‰ï¼Œæ™ºèƒ½ä½“æ˜¯â€œèƒ½å¤Ÿé€šè¿‡è®¾è®¡å…¶å·¥ä½œæµå’Œåˆ©ç”¨å¯ç”¨å·¥å…·ï¼Œä»£è¡¨ç”¨æˆ·æˆ–å…¶ä»–ç³»ç»Ÿè‡ªä¸»æ‰§è¡Œä»»åŠ¡çš„ç³»ç»Ÿæˆ–ç¨‹åºâ€[<a href="https://www.ibm.com/cn-zh/think/topics/ai-agents">IBM</a>]ã€‚è‹±ä¼Ÿè¾¾åˆ™å°†æ™ºèƒ½ä½“æè¿°ä¸ºâ€œAI æ™ºèƒ½ä½“æ˜¯å…ˆè¿›çš„ AI ç³»ç»Ÿï¼Œæ—¨åœ¨<strong>æ ¹æ®é«˜çº§ç›®æ ‡è‡ªä¸»è¿›è¡Œæ¨ç†ï¼Œåˆ¶å®šè®¡åˆ’å¹¶æ‰§è¡Œå¤æ‚ä»»åŠ¡</strong>ã€‚â€ï¼Œä»£è¡¨äº†â€œä»ç®€å•è‡ªåŠ¨åŒ–å‘èƒ½å¤Ÿç®¡ç†å¤æ‚å·¥ä½œæµçš„è‡ªä¸»ç³»ç»Ÿè¿‡æ¸¡â€çš„æ¼”è¿›æ–¹å‘[<a href="https://www.nvidia.cn/glossary/ai-agents/">NVIDIA</a>]ã€‚</p><p>åœ¨æ›´ä¸“ä¸šçš„å­¦æœ¯å®šä¹‰ä¸­ï¼Œç™¾åº¦ç™¾ç§‘æŒ‡å‡ºï¼šâ€œæ™ºèƒ½ä½“æ˜¯æŒ‡èƒ½å¤Ÿæ„ŸçŸ¥ç¯å¢ƒå¹¶è‡ªä¸»é‡‡å–è¡ŒåŠ¨ä»¥å®ç°ç‰¹å®šç›®æ ‡çš„å®ä½“ã€‚è¿™ä¸€æ¦‚å¿µæœ€æ—©ç”±â€œäººå·¥æ™ºèƒ½ä¹‹çˆ¶â€é©¬æ–‡Â·æ˜æ–¯åŸºæå‡ºï¼Œä»–è®¤ä¸ºæŸäº›é—®é¢˜å¯ç»ç”±ç¤¾ä¼šä¸­çš„ä¸€äº›ä¸ªä½“ç»è¿‡åå•†åè§£å†³ï¼Œè¿™äº›ä¸ªä½“å°±æ˜¯æ™ºèƒ½ä½“ã€‚â€[<a href="https://baike.baidu.com/item/æ™ºèƒ½ä½“/9446647">ç™¾åº¦ç™¾ç§‘</a>]</p><p>æ™ºèƒ½ä½“å…·æœ‰ä»¥ä¸‹åŸºæœ¬ç‰¹å¾ï¼š</p><ul><li>è‡ªä¸»æ€§(Autonomy)ï¼šæ™ºèƒ½ä½“èƒ½å¤Ÿåœ¨æ²¡æœ‰äººç±»æˆ–å…¶ä»–å®ä½“çš„ç›´æ¥å¹²é¢„ä¸‹è¿è¡Œï¼Œå¹¶å¯¹å…¶è¡ŒåŠ¨å’Œå†…éƒ¨çŠ¶æ€å…·æœ‰æŸç§ç¨‹åº¦çš„æ§åˆ¶ã€‚</li><li>ååº”æ€§(Reactivity)ï¼šæ™ºèƒ½ä½“èƒ½å¤Ÿæ„ŸçŸ¥å…¶ç¯å¢ƒï¼Œå¹¶å¯¹ç¯å¢ƒå˜åŒ–åšå‡ºå®æ—¶å“åº”ã€‚</li><li>äº¤äº’æ€§/ç¤¾äº¤æ€§(Socialability)ï¼šæ™ºèƒ½ä½“èƒ½å¤Ÿä¸å…¶ä»–æ™ºèƒ½ä½“æˆ–äººç±»è¿›è¡Œäº¤äº’å’Œåä½œã€‚</li><li>é€‚åº”æ€§/ä¸»åŠ¨æ€§(Proactivity)ï¼šæ™ºèƒ½ä½“èƒ½å¤Ÿæ ¹æ®ç¯å¢ƒå˜åŒ–ä¸»åŠ¨è°ƒæ•´å…¶è¡Œä¸ºç­–ç•¥ï¼Œé€‚åº”æ–°çš„æƒ…å†µã€‚</li><li>å­¦ä¹ èƒ½åŠ›ï¼šè®¸å¤šæ™ºèƒ½ä½“å…·æœ‰é€šè¿‡ç»éªŒæˆ–æ•°æ®å­¦ä¹ å’Œæ”¹è¿›çš„èƒ½åŠ›ã€‚</li></ul><h2 id="æ™ºèƒ½ä½“çš„ç±»å‹"><a href="#æ™ºèƒ½ä½“çš„ç±»å‹" class="headerlink" title="æ™ºèƒ½ä½“çš„ç±»å‹"></a>æ™ºèƒ½ä½“çš„ç±»å‹</h2><ul><li><p>è‡ªä¸»æ™ºèƒ½ä½“ (Autonomous Agents)</p><p>è‡ªä¸»æ™ºèƒ½ä½“æ˜¯ä¸€ç§èƒ½å¤Ÿåœ¨æ²¡æœ‰äººç±»å¹²é¢„çš„æƒ…å†µä¸‹ï¼Œè‡ªä¸»æ‰§è¡Œä»»åŠ¡ã€åšå‡ºå†³ç­–å’Œä¸ç¯å¢ƒäº’åŠ¨çš„æ™ºèƒ½ç³»ç»Ÿã€‚å®ƒä»¬å…·æœ‰é«˜åº¦çš„è‡ªä¸»æ€§ï¼Œèƒ½å¤Ÿç‹¬ç«‹åœ°æ„ŸçŸ¥ç¯å¢ƒã€åšå‡ºå†³ç­–å¹¶æ‰§è¡Œè¡ŒåŠ¨ï¼Œè€Œä¸éœ€è¦å¤–éƒ¨çš„æ§åˆ¶å’Œå¹²é¢„ã€‚</p></li><li><p>ååº”æ™ºèƒ½ä½“ (Reactive Agents)</p><p>ååº”æ™ºèƒ½ä½“ä¸»è¦å…³æ³¨å¯¹ç¯å¢ƒå˜åŒ–çš„å®æ—¶å“åº”ã€‚ä½¿ç”¨ç®€å•åå°„æ¨¡å‹ï¼Œæ ¹æ®å½“å‰æ„ŸçŸ¥åšå‡ºå†³ç­–ï¼Œè€Œä¸éœ€è¦å¤æ‚çš„å†…éƒ¨çŠ¶æ€æˆ–é•¿æœŸè§„åˆ’</p></li></ul><h2 id="æ™ºèƒ½ä½“çš„å‘å±•é˜¶æ®µ"><a href="#æ™ºèƒ½ä½“çš„å‘å±•é˜¶æ®µ" class="headerlink" title="æ™ºèƒ½ä½“çš„å‘å±•é˜¶æ®µ"></a>æ™ºèƒ½ä½“çš„å‘å±•é˜¶æ®µ</h2><p>OpenAIæ ¹æ®è‡ªèº«æŠ€æœ¯ç ”å‘ä¸äº§å“å¼€å‘æå‡ºäº†é€šå¾€AGIçš„äº”çº§é‡è¡¨ï¼Œå°†AI Agentåˆ†ä¸ºäº”ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µä»£è¡¨æ›´é«˜çº§çš„èƒ½åŠ›æ°´å¹³ï¼š[<a href="https://www.51cto.com/aigc/3449.html">51CTO</a>]</p><ol><li><strong>ç¬¬1çº§ï¼šèŠå¤©æœºå™¨äºº</strong> - å…·æœ‰å¯¹è¯è¯­è¨€æŠ€èƒ½</li><li><strong>ç¬¬2çº§ï¼šå®ç”¨å·¥å…·</strong> - èƒ½å¤Ÿæ‰§è¡Œå…·ä½“ä»»åŠ¡</li><li><strong>ç¬¬3çº§ï¼šä¸“å®¶åŠ©æ‰‹</strong> - å…·æœ‰ç‰¹å®šé¢†åŸŸçš„ä¸“ä¸šçŸ¥è¯†</li><li><strong>ç¬¬4çº§ï¼šå›¢é˜Ÿåˆä½œè€…</strong> - èƒ½å¤Ÿä¸äººç±»å›¢é˜Ÿåä½œ</li><li><strong>ç¬¬5çº§ï¼šé€šç”¨äººå·¥æ™ºèƒ½(AGI)</strong> - å…·æœ‰ä¸äººç±»ç›¸å½“æˆ–è¶…è¶Šäººç±»çš„é€šç”¨æ™ºèƒ½</li></ol><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250828152117511.png" alt="image-20250828152117511" style="zoom:50%;" /></p><h2 id="æ™ºèƒ½ä½“çš„åº”ç”¨"><a href="#æ™ºèƒ½ä½“çš„åº”ç”¨" class="headerlink" title="æ™ºèƒ½ä½“çš„åº”ç”¨"></a>æ™ºèƒ½ä½“çš„åº”ç”¨</h2><h3 id="å·¥ä¸šè‡ªåŠ¨åŒ–"><a href="#å·¥ä¸šè‡ªåŠ¨åŒ–" class="headerlink" title="å·¥ä¸šè‡ªåŠ¨åŒ–"></a>å·¥ä¸šè‡ªåŠ¨åŒ–</h3><p>åœ¨å·¥ä¸šé¢†åŸŸï¼Œæ™ºèƒ½ä½“è¢«ç”¨äºï¼š</p><ul><li>è‡ªåŠ¨åŒ–ç”Ÿäº§çº¿ç›‘æ§å’Œä¼˜åŒ–</li><li>è®¾å¤‡é¢„æµ‹æ€§ç»´æŠ¤</li><li>ä»“å‚¨å’Œç‰©æµè‡ªåŠ¨åŒ–</li><li>è´¨é‡æ§åˆ¶å’Œæ£€æµ‹</li></ul><h3 id="æœåŠ¡ä¸š"><a href="#æœåŠ¡ä¸š" class="headerlink" title="æœåŠ¡ä¸š"></a>æœåŠ¡ä¸š</h3><p>åœ¨æœåŠ¡ä¸šï¼Œæ™ºèƒ½ä½“çš„åº”ç”¨åŒ…æ‹¬ï¼š</p><ul><li>æ™ºèƒ½å®¢æœå’Œå®¢æˆ·æ”¯æŒ</li><li>ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ</li><li>æ™ºèƒ½å¥åº·ç®¡ç†</li><li>æ™ºèƒ½é‡‘èåˆ†æå’Œé£é™©ç®¡ç†</li></ul><h3 id="åŒ»ç–—å¥åº·"><a href="#åŒ»ç–—å¥åº·" class="headerlink" title="åŒ»ç–—å¥åº·"></a>åŒ»ç–—å¥åº·</h3><p>åœ¨åŒ»ç–—å¥åº·é¢†åŸŸï¼Œæ™ºèƒ½ä½“è¢«ç”¨äºï¼š</p><ul><li>åŒ»å­¦å½±åƒè¾…åŠ©è¯Šæ–­</li><li>ç—…äººç›‘æµ‹å’Œè¿œç¨‹åŒ»ç–—</li><li>è¯ç‰©ç ”å‘å’Œä¸´åºŠè¯•éªŒä¼˜åŒ–</li><li>ä¸ªæ€§åŒ–æ²»ç–—æ–¹æ¡ˆè®¾è®¡</li></ul><h3 id="æ•™è‚²"><a href="#æ•™è‚²" class="headerlink" title="æ•™è‚²"></a>æ•™è‚²</h3><p>åœ¨æ•™è‚²é¢†åŸŸï¼Œæ™ºèƒ½ä½“çš„åº”ç”¨åŒ…æ‹¬ï¼š</p><ul><li>ä¸ªæ€§åŒ–å­¦ä¹ æ¨èç³»ç»Ÿ</li><li>æ™ºèƒ½æ•™å­¦åŠ©æ‰‹</li><li>å­¦ä¹ è¯„ä¼°å’Œåé¦ˆç³»ç»Ÿ</li><li>è™šæ‹Ÿæ•™è‚²åŠ©æ‰‹</li></ul><h3 id="å¨±ä¹ä¸åˆ›æ„"><a href="#å¨±ä¹ä¸åˆ›æ„" class="headerlink" title="å¨±ä¹ä¸åˆ›æ„"></a>å¨±ä¹ä¸åˆ›æ„</h3><p>åœ¨å¨±ä¹ä¸åˆ›æ„é¢†åŸŸï¼Œæ™ºèƒ½ä½“è¢«ç”¨äºï¼š</p><ul><li>æ™ºèƒ½å†…å®¹åˆ›ä½œå’Œæ¨è</li><li>æ¸¸æˆAIå’Œè™šæ‹Ÿå¯¹æ‰‹</li><li>æ•°å­—åŠ©æ‰‹å’Œåˆ›æ„è¾…åŠ©å·¥å…·</li><li>è™šæ‹Ÿä¸»æ’­å’Œå†…å®¹ç”Ÿæˆ</li></ul><h2 id="Agent-çš„æ ¸å¿ƒèƒ½åŠ›æ¨¡å—"><a href="#Agent-çš„æ ¸å¿ƒèƒ½åŠ›æ¨¡å—" class="headerlink" title="Agent çš„æ ¸å¿ƒèƒ½åŠ›æ¨¡å—"></a>Agent çš„æ ¸å¿ƒèƒ½åŠ›æ¨¡å—</h2><div class="table-container"><table><thead><tr><th><strong>æ¨¡å—</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td><strong>æ„ŸçŸ¥ï¼ˆPerceptionï¼‰</strong></td><td>è¯»å–è¾“å…¥å†…å®¹ï¼ŒåŒ…æ‹¬è‡ªç„¶è¯­è¨€ã€ç»“æ„åŒ–æ•°æ®ã€ç¯å¢ƒçŠ¶æ€ç­‰</td></tr><tr><td><strong>ç†è§£ä¸æ¨ç†ï¼ˆReasoningï¼‰</strong></td><td>åˆ†æä»»åŠ¡ã€æ‹†è§£ç›®æ ‡ã€åˆ¶å®šè§£å†³ç­–ç•¥</td></tr><tr><td><strong>è®°å¿†ï¼ˆMemoryï¼‰</strong></td><td>ä¿ç•™ä¸Šä¸‹æ–‡ä¿¡æ¯å’Œå†å²è®°å½•ï¼Œå®ç°æŒç»­æ€§äº¤äº’</td></tr><tr><td><strong>è§„åˆ’ï¼ˆPlanningï¼‰</strong></td><td>å¤šæ­¥éª¤æ€è€ƒå’Œä»»åŠ¡åˆ†è§£èƒ½åŠ›ï¼ˆå¦‚Chain of Thoughtï¼‰</td></tr><tr><td><strong>å·¥å…·è°ƒç”¨ï¼ˆTool Callingï¼‰</strong></td><td>ç»“åˆ APIã€æœç´¢ã€ä»£ç æ‰§è¡Œç­‰å¤–éƒ¨èƒ½åŠ›å®Œæˆä»»åŠ¡</td></tr><tr><td><strong>æ‰§è¡Œä¸åé¦ˆï¼ˆActionï¼‰</strong></td><td>æ‰§è¡Œä»»åŠ¡å¹¶åŸºäºç»“æœåšå‡ºè°ƒæ•´æˆ–è§£é‡Š</td></tr></tbody></table></div><h1 id="æ™ºèƒ½ä½“å’Œæ¨¡å‹ã€å¤§æ¨¡å‹çš„åŒºåˆ«"><a href="#æ™ºèƒ½ä½“å’Œæ¨¡å‹ã€å¤§æ¨¡å‹çš„åŒºåˆ«" class="headerlink" title="æ™ºèƒ½ä½“å’Œæ¨¡å‹ã€å¤§æ¨¡å‹çš„åŒºåˆ«"></a>æ™ºèƒ½ä½“å’Œæ¨¡å‹ã€å¤§æ¨¡å‹çš„åŒºåˆ«</h1><div class="table-container"><table><thead><tr><th><strong>åè¯</strong></th><th><strong>æ ¸å¿ƒæ¦‚å¿µ</strong></th></tr></thead><tbody><tr><td>AI</td><td>äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯å­¦ç§‘</td></tr><tr><td>æ¨¡å‹</td><td>AIç³»ç»Ÿçš„æ ¸å¿ƒç®—æ³•ç»„ä»¶ï¼Œé€šè¿‡ä»æ•°æ®ä¸­å­¦ä¹ è§„å¾‹å’Œæ¨¡å¼æ¥å®ç°ç‰¹å®šåŠŸèƒ½å¸¸è§æ¨¡å‹å¦‚ï¼šé¢„æµ‹æ¨¡å‹ï¼ˆåˆ†ç±»ã€å›å½’ï¼‰ï¼Œç”Ÿæˆæ¨¡å‹ï¼ˆæ–‡æœ¬ã€å›¾åƒç”Ÿæˆï¼‰ç­‰æ¨¡å‹æ˜¯æ— å®ä½“çš„å·¥å…·ï¼Œä¸å…·æœ‰è‡ªä¸»æ€§</td></tr><tr><td>å¤§æ¨¡å‹</td><td>æ¨¡å‹çš„ç‰¹æ®Šå½¢æ€ï¼Œä»¥å‚æ•°è§„æ¨¡å·¨å¤§ï¼ˆè¾¾åˆ°ç™¾äº¿ã€åƒäº¿ç”šè‡³ä¸‡äº¿ï¼‰ä¸ºæ˜¾è‘—ç‰¹å¾ä¸»è¦ç”¨æ¥å¤„ç†å¤æ‚ä»»åŠ¡å’Œå¤æ‚æ¨ç†ï¼Œå¯¹äººç±»æŒ‡ä»¤æœ‰å¾ˆå¼ºçš„éµå¾ªèƒ½åŠ›</td></tr><tr><td>æ™ºèƒ½ä½“</td><td>èƒ½å¤Ÿæ„ŸçŸ¥ç¯å¢ƒã€è‡ªä¸»å†³ç­–å¹¶æ‰§è¡Œè¡ŒåŠ¨ä»¥å®ç°ç‰¹å®šç›®æ ‡çš„å®ä½“æˆ–ç³»ç»Ÿæ™ºèƒ½ä½“æ˜¯AIæŠ€æœ¯è½åœ°çš„ç³»ç»Ÿçº§<strong>åº”ç”¨å½¢å¼</strong>èƒ½å¤Ÿå½¢æˆå®Œæ•´çš„â€œæ„ŸçŸ¥-å†³ç­–-è¡ŒåŠ¨â€é—­ç¯</td></tr></tbody></table></div><h1 id="æ™ºèƒ½ä½“æ¶æ„"><a href="#æ™ºèƒ½ä½“æ¶æ„" class="headerlink" title="æ™ºèƒ½ä½“æ¶æ„"></a>æ™ºèƒ½ä½“æ¶æ„</h1><ul><li><p>å•ä¸ªæ™ºèƒ½ä½“çš„æ„æˆï¼š</p><ul><li><p>å¤§æ¨¡å‹ï¼ˆå¿…é€‰ï¼‰</p></li><li><p>Toolsï¼ˆå¿…é€‰ï¼‰</p></li></ul></li><li><p>å¤šä¸ªæ™ºèƒ½ä½“çš„ä¸²è”ï¼š</p><ul><li><p>LangGraph</p></li><li><p>Difyã€Cozeç­‰å¹³å°</p></li></ul></li><li><p>æ™ºèƒ½ä½“çš„è°ƒç”¨ï¼š</p><ul><li>Python/Node</li></ul></li></ul><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250828152606906.png" alt="image-20250828152606906" style="zoom:50%;" /></p>]]></content>
    
    
    <summary type="html">å­¦ä¹  AIå¤§æ¨¡å‹å’ŒAgentæ™ºèƒ½ä½“å­¦ä¹ ç¬”è®°ç¬¬ä¸€è®²</summary>
    
    
    
    <category term="AIå¤§æ¨¡å‹å’ŒAgentæ™ºèƒ½ä½“å­¦ä¹ " scheme="https://jinglv.github.io/categories/AI%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%92%8CAgent%E6%99%BA%E8%83%BD%E4%BD%93%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="AIå¤§æ¨¡å‹å’ŒAgentæ™ºèƒ½ä½“å­¦ä¹ " scheme="https://jinglv.github.io/tags/AI%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%92%8CAgent%E6%99%BA%E8%83%BD%E4%BD%93%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>RAGç»„ä»¶--å‘é‡æ•°æ®åº“æ£€ç´¢ï¼ˆæœç´¢ï¼‰ã€åº¦é‡ç±»å‹å’Œæ¡ä»¶è¿‡æ»¤</title>
    <link href="https://jinglv.github.io/2025/08/22/ai/rag/22-vector-db-search/"/>
    <id>https://jinglv.github.io/2025/08/22/ai/rag/22-vector-db-search/</id>
    <published>2025-08-21T16:00:00.000Z</published>
    <updated>2025-08-22T02:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åº¦é‡ç±»å‹"><a href="#åº¦é‡ç±»å‹" class="headerlink" title="åº¦é‡ç±»å‹"></a>åº¦é‡ç±»å‹</h1><h2 id="è·ç¦»åº¦é‡çš„æ ‡å‡†ï¼ˆç±»å‹ï¼‰"><a href="#è·ç¦»åº¦é‡çš„æ ‡å‡†ï¼ˆç±»å‹ï¼‰" class="headerlink" title="è·ç¦»åº¦é‡çš„æ ‡å‡†ï¼ˆç±»å‹ï¼‰"></a>è·ç¦»åº¦é‡çš„æ ‡å‡†ï¼ˆç±»å‹ï¼‰</h2><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250822101843966.png" alt="image-20250822101843966" style="zoom:67%;" /></p><h3 id="L2ï¼ˆæ¬§æ°è·ç¦»ï¼‰"><a href="#L2ï¼ˆæ¬§æ°è·ç¦»ï¼‰" class="headerlink" title="L2ï¼ˆæ¬§æ°è·ç¦»ï¼‰"></a>L2ï¼ˆæ¬§æ°è·ç¦»ï¼‰</h3><ul><li>é€‚ç”¨äºè¿ç»­æ•°å€¼å‹ç‰¹å¾ï¼Œå¦‚å›¾åƒåƒç´ æˆ–å£°çº¹ç‰¹å¾ï¼›</li><li><p>å¸¸è§äºéœ€è¦ç²¾ç¡®åº¦é‡â€œå‡ ä½•è·ç¦»â€çš„åœºæ™¯ï¼Œä¾‹å¦‚è§†è§‰æ£€ç´¢ã€ç‚¹äº‘åŒ¹é…ç­‰ã€‚</p></li><li><p>é€‚ç”¨åœºæ™¯: è¿ç»­æ•°å€¼å‹ç‰¹å¾(å¦‚å›¾åƒåƒç´ ã€å£°çº¹ç‰¹å¾)ï¼Œéœ€è¦ç²¾ç¡®åº¦é‡å‡ ä½•è·ç¦»çš„åœºæ™¯(è§†è§‰æ£€ç´¢ã€ç‚¹äº‘åŒ¹é…)</p></li><li>ç‰¹æ€§: å€¼è¶Šå°ç›¸ä¼¼åº¦è¶Šé«˜ï¼ŒèŒƒå›´ï»¿$[0,âˆ)$ï»¿</li><li>å…¬å¼:$L2= \sqrt{\sum(A-B)^2}$ï»¿</li></ul><h3 id="IPï¼ˆå†…ç§¯ï¼‰"><a href="#IPï¼ˆå†…ç§¯ï¼‰" class="headerlink" title="IPï¼ˆå†…ç§¯ï¼‰"></a>IPï¼ˆå†…ç§¯ï¼‰</h3><ul><li>åœ¨å‘é‡é•¿åº¦ï¼ˆèŒƒæ•°ï¼‰æœ‰æ„ä¹‰æ—¶ä½¿ç”¨ï¼Œæ¯”å¦‚è¯„ä¼°æœªå½’ä¸€åŒ–åµŒå…¥å‘é‡çš„åŒ¹é…å¼ºåº¦ï¼›</li><li><p>è‹¥å‘é‡å·²å½’ä¸€åŒ–ï¼Œç­‰ä»·äºä½™å¼¦ç›¸ä¼¼åº¦ï¼Œå¯ç”¨äºæ–‡æœ¬æˆ–æ¨èç³»ç»Ÿä¸­çš„è¯„åˆ†è®¡ç®—ã€‚</p></li><li><p>é€‚ç”¨åœºæ™¯: å‘é‡é•¿åº¦(èŒƒæ•°)æœ‰æ„ä¹‰æ—¶(å¦‚æœªå½’ä¸€åŒ–çš„åµŒå…¥å‘é‡)</p></li><li>ç‰¹æ€§: å€¼è¶Šå¤§ç›¸ä¼¼åº¦è¶Šé«˜ï¼ŒèŒƒå›´æ— é™åˆ¶</li><li>å…¬å¼:ï»¿ $IP = A \cdot B = \sum(A_1B_1 + A_2B_2 + â€¦)$ï»¿</li><li>æ³¨æ„: è‹¥å‘é‡å·²å½’ä¸€åŒ–ï¼Œç­‰ä»·äºä½™å¼¦ç›¸ä¼¼åº¦</li></ul><h3 id="COSINEï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰"><a href="#COSINEï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰" class="headerlink" title="COSINEï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰"></a>COSINEï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰</h3><ul><li>æœ€å¸¸ç”¨äºæ–‡æœ¬ã€è‡ªç„¶è¯­è¨€åµŒå…¥ä¹‹é—´çš„è¯­ä¹‰ç›¸ä¼¼æ€§è®¡ç®—ï¼›</li><li><p>ä¸å—å‘é‡é•¿åº¦å½±å“ï¼Œå…³æ³¨æ–¹å‘ä¸€è‡´æ€§ï¼Œé€‚åˆä¸»é¢˜æˆ–æ„å›¾åŒ¹é…ã€‚</p></li><li><p>é€‚ç”¨åœºæ™¯: æ–‡æœ¬/NLPåµŒå…¥çš„è¯­ä¹‰ç›¸ä¼¼æ€§è®¡ç®—ï¼Œä¸»é¢˜æˆ–æ„å›¾åŒ¹é…</p></li><li>ç‰¹æ€§: å€¼è¶Šå¤§ç›¸ä¼¼åº¦è¶Šé«˜ï¼ŒèŒƒå›´ï»¿$[-1,1]$ï»¿</li><li>å…¬å¼:$cos(Î¸)=\frac{A \cdot B}{|A||B|}$ï»¿</li><li>é»„é‡‘æ ‡å‡†: æ–‡æœ¬æ£€ç´¢ä¸çŸ¥é“é€‰ä»€ä¹ˆæ—¶é¦–é€‰ä½™å¼¦</li></ul><h3 id="JACCARDï¼ˆäº¤å¹¶æ¯”è·ç¦»ï¼‰"><a href="#JACCARDï¼ˆäº¤å¹¶æ¯”è·ç¦»ï¼‰" class="headerlink" title="JACCARDï¼ˆäº¤å¹¶æ¯”è·ç¦»ï¼‰"></a>JACCARDï¼ˆäº¤å¹¶æ¯”è·ç¦»ï¼‰</h3><ul><li>ç”¨äºé›†åˆæˆ–äºŒå€¼ç‰¹å¾çš„ç›¸ä¼¼åº¦è¯„ä¼°ï¼Œå¦‚æ ‡ç­¾é›†åˆã€å…³é”®è¯é‡å ï¼›</li><li>åœ¨æ–‡æœ¬ç‰‡æ®µé‡å ã€æ¨èç³»ç»Ÿä¸­åŸºäºå…´è¶£æ ‡ç­¾çš„åŒ¹é…åœºæ™¯å¸¸è§ã€‚</li></ul><ul><li>é€‚ç”¨åœºæ™¯: é›†åˆæˆ–äºŒå€¼ç‰¹å¾çš„ç›¸ä¼¼åº¦è¯„ä¼°(æ ‡ç­¾é›†åˆã€å…³é”®è¯é‡å )</li><li>ç‰¹æ€§: å€¼è¶Šå°ç›¸ä¼¼åº¦è¶Šé«˜ï¼ŒèŒƒå›´$[0,1]$ï»¿</li><li>å…¬å¼:$J=1-\frac{|Aâˆ©B|}{|AâˆªB|}$ï»¿</li></ul><h3 id="HAMMINGï¼ˆæµ·æ˜è·ç¦»ï¼‰"><a href="#HAMMINGï¼ˆæµ·æ˜è·ç¦»ï¼‰" class="headerlink" title="HAMMINGï¼ˆæµ·æ˜è·ç¦»ï¼‰"></a>HAMMINGï¼ˆæµ·æ˜è·ç¦»ï¼‰</h3><ul><li>ä¸“ç”¨äºäºŒè¿›åˆ¶å‘é‡ï¼ˆå¦‚æ„ŸçŸ¥å“ˆå¸Œã€äºŒå€¼åŒ–ç‰¹å¾ï¼‰çš„ç›¸ä¼¼åº¦åº¦é‡ï¼›</li><li><p>å¸¸è§äºå›¾åƒæŒ‡çº¹æ£€ç´¢ã€äººè„¸äºŒå€¼ç¼–ç æˆ–è€…ç®€æ˜“å“ˆå¸ŒåŒ¹é…åœºæ™¯ã€‚</p></li><li><p>é€‚ç”¨åœºæ™¯: äºŒè¿›åˆ¶å‘é‡(æ„ŸçŸ¥å“ˆå¸Œã€äºŒå€¼åŒ–ç‰¹å¾)</p></li><li>ç‰¹æ€§: å€¼è¶Šå°ç›¸ä¼¼åº¦è¶Šé«˜ï¼ŒèŒƒå›´$[0,dim]$ï»¿</li></ul><h3 id="BM25ï¼ˆå…¨æ–‡æ£€ç´¢è¯„åˆ†ï¼‰"><a href="#BM25ï¼ˆå…¨æ–‡æ£€ç´¢è¯„åˆ†ï¼‰" class="headerlink" title="BM25ï¼ˆå…¨æ–‡æ£€ç´¢è¯„åˆ†ï¼‰"></a>BM25ï¼ˆå…¨æ–‡æ£€ç´¢è¯„åˆ†ï¼‰</h3><ul><li>ä¸“ä¸ºç¨€ç–å‘é‡ä¸Šçš„å…¨æ–‡æœç´¢è®¾è®¡ï¼Œç»“åˆ TFã€IDF å’Œæ–‡æ¡£é•¿åº¦å½’ä¸€åŒ–ï¼›</li><li><p>é€‚ç”¨äºæ–‡æ¡£æ£€ç´¢ã€é—®ç­”ç³»ç»Ÿçš„å€’æ’ç´¢å¼•æœç´¢åœºæ™¯ã€‚</p></li><li><p>é€‚ç”¨åœºæ™¯: ç¨€ç–å‘é‡ä¸Šçš„å…¨æ–‡æœç´¢(æ–‡æ¡£æ£€ç´¢ã€é—®ç­”ç³»ç»Ÿ)</p></li><li>ç‰¹æ€§: å€¼è¶Šå¤§ç›¸ä¼¼åº¦è¶Šé«˜ï¼ŒèŒƒå›´ï»¿$[0,âˆ)$ï»¿</li></ul><h2 id="å„ç§å­—æ®µæ‰€æ”¯æŒçš„åº¦é‡ç±»å‹"><a href="#å„ç§å­—æ®µæ‰€æ”¯æŒçš„åº¦é‡ç±»å‹" class="headerlink" title="å„ç§å­—æ®µæ‰€æ”¯æŒçš„åº¦é‡ç±»å‹"></a>å„ç§å­—æ®µæ‰€æ”¯æŒçš„åº¦é‡ç±»å‹</h2><div class="table-container"><table><thead><tr><th>å­—æ®µç±»å‹</th><th>ç»´åº¦èŒƒå›´</th><th>æ”¯æŒçš„åº¦é‡ç±»å‹</th><th>é»˜è®¤åº¦é‡ç±»å‹</th></tr></thead><tbody><tr><td>FLOAT_VECTOR</td><td>2 â€“ 32 768</td><td>COSINEã€L2ã€IP</td><td>COSINE</td></tr><tr><td>FLOAT16_VECTOR</td><td>2 â€“ 32 768</td><td>COSINEã€L2ã€IP</td><td>COSINE</td></tr><tr><td>BFLOAT16_VECTOR</td><td>2 â€“ 32 768</td><td>COSINEã€L2ã€IP</td><td>COSINE</td></tr><tr><td>SPARSE_FLOAT_VECTOR</td><td>æ— éœ€æŒ‡å®š</td><td>IPã€BM25(ä»…é™å…¨æ–‡æ£€ç´¢)</td><td>IP</td></tr><tr><td>BINARY_VECTOR</td><td>8 â€“ (32 768x8)</td><td>HAMMINGã€JACCARD</td><td>HAMMING</td></tr></tbody></table></div><ul><li>FLOAT/FLOAT16/BFLOAT16 VECTOR:<ul><li>ç»´åº¦èŒƒå›´: 2-32768</li><li>æ”¯æŒ: COSINE, L2, IP</li><li>é»˜è®¤: COSINE</li></ul></li><li>SPARSE FLOAT VECTOR:<ul><li>æ— éœ€æŒ‡å®šç»´åº¦</li><li>æ”¯æŒ: IPã€BM25(ä»…é™å…¨æ–‡æ£€ç´¢)</li><li>é»˜è®¤: IP</li></ul></li><li>BINARY VECTOR:<ul><li>ç»´åº¦èŒƒå›´: 8-(32768Ã—8)</li><li>æ”¯æŒ: HAMMING, JACCARD</li><li>é»˜è®¤: HAMMING</li></ul></li></ul><h2 id="å„ç§åº¦é‡ç±»å‹çš„å–å€¼èŒƒå›´"><a href="#å„ç§åº¦é‡ç±»å‹çš„å–å€¼èŒƒå›´" class="headerlink" title="å„ç§åº¦é‡ç±»å‹çš„å–å€¼èŒƒå›´"></a>å„ç§åº¦é‡ç±»å‹çš„å–å€¼èŒƒå›´</h2><div class="table-container"><table><thead><tr><th>åº¦é‡ç±»å‹</th><th>ç›¸ä¼¼åº¦/è·ç¦»ç‰¹æ€§</th><th>æ•°å€¼èŒƒå›´</th></tr></thead><tbody><tr><td><strong>L2</strong> (æ¬§æ°è·ç¦»)</td><td>å€¼è¶Šå°ï¼Œç›¸ä¼¼åº¦è¶Šé«˜</td><td>[0,âˆ)</td></tr><tr><td><strong>IP</strong> (å†…ç§¯)</td><td>å€¼è¶Šå¤§ï¼Œç›¸ä¼¼åº¦è¶Šé«˜</td><td>[âˆ’1,1]</td></tr><tr><td><strong>COSINE</strong> (ä½™å¼¦)</td><td>å€¼è¶Šå¤§ï¼Œç›¸ä¼¼åº¦è¶Šé«˜</td><td>[âˆ’1,1]</td></tr><tr><td><strong>JACCARD</strong></td><td>å€¼è¶Šå°ï¼Œç›¸ä¼¼åº¦è¶Šé«˜</td><td>[0,1]</td></tr><tr><td><strong>HAMMING</strong></td><td>å€¼è¶Šå°ï¼Œç›¸ä¼¼åº¦è¶Šé«˜</td><td>[0,dim)</td></tr><tr><td><strong>BM25</strong></td><td>å€¼è¶Šå¤§ï¼Œç›¸ä¼¼åº¦è¶Šé«˜</td><td>[0,âˆ)</td></tr></tbody></table></div><p>å…³é”®æ³¨æ„: ä¸åŒåº¦é‡ç±»å‹çš„æ•°å€¼èŒƒå›´å·®å¼‚å¾ˆå¤§ï¼Œå¦‚æ¬§å¼è·ç¦»å¯èƒ½å¤§äº1æ˜¯æ­£å¸¸çš„</p><h1 id="ANNæœç´¢"><a href="#ANNæœç´¢" class="headerlink" title="ANNæœç´¢"></a>ANNæœç´¢</h1><p>Milvusçš„ANNæœç´¢æ˜¯ä¸€ç§é«˜æ•ˆçš„å‘é‡ç›¸ä¼¼åº¦æœç´¢æ–¹æ³•ï¼Œå®ƒé€šè¿‡é¢„æ„å»ºçš„ç´¢å¼•æ–‡ä»¶æ¥åŠ é€Ÿæœç´¢è¿‡ç¨‹ã€‚ä¸kNNæœç´¢ç›¸æ¯”ï¼ŒANNæœç´¢ä¸éœ€è¦éå†æ‰€æœ‰å‘é‡ï¼Œè€Œæ˜¯é€šè¿‡ç´¢å¼•å¿«é€Ÿå®šä½å¯èƒ½åŒ…å«æœ€ç›¸ä¼¼å‘é‡çš„å­é›†ï¼Œä»è€Œå¤§å¤§æé«˜äº†æœç´¢æ•ˆç‡ã€‚</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250822101723764.png" alt="image-20250822101723764" style="zoom:67%;" /></p><ul><li>æ ¸å¿ƒåŸç†: é€šè¿‡é¢„æ„å»ºçš„ç´¢å¼•æ–‡ä»¶åŠ é€Ÿæœç´¢è¿‡ç¨‹ï¼Œä¸éœ€è¦éå†æ‰€æœ‰å‘é‡ï¼Œè€Œæ˜¯å¿«é€Ÿå®šä½å¯èƒ½åŒ…å«æœ€ç›¸ä¼¼å‘é‡çš„å­é›†</li><li>ä¸kNNåŒºåˆ«: ANN(Approximate Nearest Neighbor)æ˜¯è¿‘ä¼¼æœç´¢ï¼Œæ•ˆç‡é«˜ä½†ç»“æœä¸ä¸€å®šå®Œç¾ï¼›kNNéœ€è¦ç²¾ç¡®éå†æ‰€æœ‰æ•°æ®</li><li>ä¸»è¦ç‰¹ç‚¹:<ul><li>æ”¯æŒå•å‘é‡å’Œæ‰¹é‡å‘é‡æœç´¢</li><li>å¯åœ¨ç‰¹å®šåˆ†åŒºå†…è¿›è¡Œæœç´¢</li><li>æ”¯æŒå¤šç§ç›¸ä¼¼åº¦åº¦é‡æ–¹å¼(L2ã€IPã€COSINEç­‰)</li><li>å¯é€šè¿‡è¿‡æ»¤æ¡ä»¶ã€èŒƒå›´æœç´¢å¢å¼ºæ•ˆæœ</li><li>æ”¯æŒåˆ†é¡µæŸ¥è¯¢å’Œè¾“å‡ºå­—æ®µæ§åˆ¶</li></ul></li></ul><h2 id="è¿‡æ»¤æœç´¢"><a href="#è¿‡æ»¤æœç´¢" class="headerlink" title="è¿‡æ»¤æœç´¢"></a>è¿‡æ»¤æœç´¢</h2><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250822102907414.png" alt="image-20250822102907414" style="zoom:67%;" /></p><h3 id="æ ‡å‡†è¿‡æ»¤"><a href="#æ ‡å‡†è¿‡æ»¤" class="headerlink" title="æ ‡å‡†è¿‡æ»¤"></a>æ ‡å‡†è¿‡æ»¤</h3><ul><li>åŸç†: å…ˆæ‰§è¡Œè¿‡æ»¤æ¡ä»¶ç­›é€‰æ•°æ®ï¼Œå†åœ¨è¿‡æ»¤åçš„æ•°æ®é›†ä¸Šè¿›è¡Œæœç´¢</li><li>é€‚ç”¨åœºæ™¯: è¿‡æ»¤æ¡ä»¶ç®€å•ä¸”èƒ½æ˜¾è‘—å‡å°‘æ•°æ®é‡çš„æƒ…å†µ</li></ul><h3 id="è¿­ä»£è¿‡æ»¤"><a href="#è¿­ä»£è¿‡æ»¤" class="headerlink" title="è¿­ä»£è¿‡æ»¤"></a>è¿­ä»£è¿‡æ»¤</h3><ul><li>åŸç†: è¾¹æœç´¢è¾¹è¿‡æ»¤ï¼ŒåŠ¨æ€åˆ¤æ–­æ˜¯å¦æ»¡è¶³æ¡ä»¶</li><li>ä¼˜åŠ¿: å¤„ç†å¤æ‚è¿‡æ»¤æ¡ä»¶æ—¶å¯èƒ½æ›´é«˜æ•ˆ</li><li>å®ç°: é€šè¿‡è®¾ç½®â€hintsâ€: â€œiterative filterâ€å‚æ•°å¯ç”¨</li></ul><h2 id="èŒƒå›´æœç´¢"><a href="#èŒƒå›´æœç´¢" class="headerlink" title="èŒƒå›´æœç´¢"></a>èŒƒå›´æœç´¢</h2><p>èŒƒå›´æœç´¢æ˜¯åœ¨ ANN æœç´¢ç»“æœçš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥æŒ‰ç›¸ä¼¼åº¦ï¼ˆæˆ–è·ç¦»ï¼‰é˜ˆå€¼è¿›è¡Œç­›é€‰ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„å‘é‡è¿”å›ã€‚</p><p>é€šè¿‡ä¸¤ä¸ªå‚æ•° radiusï¼ˆå¤–åœˆåŠå¾„ï¼‰å’Œ range_filterï¼ˆå†…åœˆåŠå¾„ï¼‰æ„æˆä¸€å¯¹åŒå¿ƒåœ†ï¼Œè¿”å›è½åœ¨è¿™ä¸¤ä¸ªåœ†ä¹‹é—´ï¼ˆæˆ–å†…å¤–åœˆå®šä¹‰åŒºé—´å†…ï¼‰çš„æ‰€æœ‰å‘é‡</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250822103507782.png" alt="image-20250822103507782" style="zoom:67%;" /></p><ul><li>åŸç†: åœ¨ANNç»“æœåŸºç¡€ä¸Šï¼ŒæŒ‰ç›¸ä¼¼åº¦é˜ˆå€¼è¿›ä¸€æ­¥ç­›é€‰</li><li>å‚æ•°:<ul><li>radius: å¤–åœˆåŠå¾„</li><li>range_filter: å†…åœˆåŠå¾„</li></ul></li><li>æ•ˆæœ: è¿”å›è½åœ¨ä¸¤ä¸ªåŠå¾„å®šä¹‰çš„ç¯å½¢åŒºåŸŸå†…çš„å‘é‡</li></ul><h2 id="åˆ†ç»„æœç´¢"><a href="#åˆ†ç»„æœç´¢" class="headerlink" title="åˆ†ç»„æœç´¢"></a>åˆ†ç»„æœç´¢</h2><p>ç›®çš„ï¼šåœ¨åŸºäºå‘é‡çš„ç›¸ä¼¼åº¦æœç´¢ç»“æœä¸­ï¼ŒæŒ‰æŸä¸ªæ ‡é‡å­—æ®µï¼ˆå¦‚ docIdã€categoryï¼‰åˆ†ç»„ï¼Œä»¥æé«˜ç»“æœå¤šæ ·æ€§ï¼Œé¿å…åŒä¸€ç»„å†…å¤šä¸ªç›¸ä¼¼ç‰‡æ®µæŠ¢å  Top-Kã€‚</p><p>åœºæ™¯ä¸¾ä¾‹ï¼šå¯¹æ‹†åˆ†æˆå¤šä¸ªæ®µè½çš„æ–‡æ¡£åšæ£€ç´¢ï¼Œå¸Œæœ›æœ€ç»ˆè¿”å›æœ€ç›¸å…³çš„æ–‡æ¡£åˆ—è¡¨ï¼Œè€Œä¸æ˜¯è¿”å›åŒä¸€æ–‡æ¡£ä¸­å¤šä¸ªç›¸ä¼¼æ®µè½ã€‚</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250822103728847.png" alt="image-20250822103728847" style="zoom:67%;" /></p><p>æµç¨‹</p><ol><li>ANN æ£€ç´¢ å¯¹æ•´ä¸ªé›†åˆæ‰§è¡Œè¿‘ä¼¼æœ€è¿‘é‚»æœç´¢ï¼Œå¾—åˆ°è‹¥å¹²æœ€ç›¸ä¼¼å®ä½“ï¼ˆchunkï¼‰ã€‚</li><li>æŒ‰å­—æ®µåˆ†ç»„ å°†æ£€ç´¢ç»“æœæŒ‰ group_by_field æŒ‡å®šçš„å­—æ®µå€¼ï¼ˆå¦‚ docIdï¼‰åˆ†æ¡¶ã€‚</li><li>é€‰å–æ¯ç»„ TopN é»˜è®¤ä»æ¯ä¸ªç»„ä¸­å–æœ€ç›¸ä¼¼çš„ 1æ¡ï¼› å¦‚éœ€æ›´å¤šï¼Œå¯é€šè¿‡ group_sizeï¼ˆæ¯ç»„è¿”å›æ¡æ•°ï¼‰å’Œ strict_group_sizeï¼ˆæ˜¯å¦ä¸¥æ ¼ä¿è¯æ¯ç»„æ¡æ•°ï¼‰è¿›è¡Œæ§åˆ¶ã€‚</li><li>æ•´ä½“æ±‡æ€» æœ€ç»ˆæŒ‰ç»„çº§ TopKï¼ˆlimitï¼‰é€‰å‡ºè‹¥å¹²ç»„ï¼Œå¹¶è¿”å›å„ç»„å†…æŒ‰ç›¸ä¼¼åº¦æ’åºçš„å®ä½“ã€‚</li></ol><h2 id="æ··åˆæœç´¢"><a href="#æ··åˆæœç´¢" class="headerlink" title="æ··åˆæœç´¢"></a>æ··åˆæœç´¢</h2><p>åŒæ—¶å¯¹åŒä¸€å®ä½“ä¸­çš„å¤šç§å‘é‡å­—æ®µï¼ˆå¦‚ç¨ å¯†å‘é‡ dense ä¸ç¨€ç–å‘é‡ sparseï¼‰åˆ†åˆ«æ‰§è¡Œ ANN æœç´¢ï¼Œå°†å„è‡ªè¿”å›çš„ Top-K ç»“æœæŒ‰å¾—åˆ†æˆ–æ’åç­–ç•¥é‡æ–°èåˆï¼ˆrerankï¼‰ï¼Œæœ€åè¾“å‡ºä¸€ä¸ªç»Ÿä¸€çš„ç»“æœé›†ã€‚</p><p>ç›®çš„ï¼šèåˆå¤šæ¨¡æ€æˆ–å¤šè§†è§’ç‰¹å¾ï¼Œæé«˜æ£€ç´¢çš„å‡†ç¡®æ€§å’Œé²æ£’æ€§ã€‚</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250822103942383.png" alt="image-20250822103942383" style="zoom:67%;" /></p><p>å®ç°æ­¥éª¤ï¼š</p><ul><li>Embedding ç”Ÿæˆ<ul><li>ç¨ å¯†å‘é‡ï¼ˆdenseï¼‰ï¼šç”¨ BERTã€CLIPã€å…¶ä»–æ·±åº¦æ¨¡å‹ç”Ÿæˆã€‚</li><li>ç¨€ç–å‘é‡ï¼ˆsparseï¼‰ï¼šç”¨ BM25ã€SPLADEã€BGE-M3 ç­‰ç®—æ³•æˆ– Milvus Function ç”Ÿæˆã€‚</li></ul></li><li>åˆ›å»ºé›†åˆå¹¶å®šä¹‰å¤šå‘é‡å­—æ®µ<ul><li>åœ¨å»ºè¡¨æ—¶åŒæ—¶åŒ…æ‹¬ FLOAT_VECTORï¼ˆç¨ å¯†ï¼‰</li><li>å’Œ SPARSE_FLOAT_VECTORï¼ˆç¨€ç–ï¼‰å­—æ®µ</li><li>å¹¶åˆ†åˆ«å»ºç«‹ç´¢å¼•</li></ul></li><li>æ’å…¥æ•°æ®<ul><li>åŒä¸€æ¡è®°å½•åŒæ—¶æ’å…¥ä¸¤ç§å‘é‡ã€‚</li><li>å‘èµ·å¤šæ¬¡åŸºç¡€ ANN æœç´¢</li><li>é’ˆå¯¹æ¯ä¸ªå‘é‡å­—æ®µæ„é€ ä¸€ä¸ªAnnSearchRequest</li></ul></li><li>é€‰æ‹©é‡æ’åºï¼ˆRerankingï¼‰ç­–ç•¥<ul><li>WeightedRankerï¼šå¯ä¸ºæ¯ä¸ªå‘é‡å­—æ®µåˆ†é…æƒé‡ï¼Œå¼ºåŒ–æŸäº›å­—æ®µçš„é‡è¦æ€§</li><li>RRFRankerï¼ˆReciprocal Rank Fusionï¼‰ï¼šå¹³è¡¡èåˆï¼Œé»˜è®¤å‚æ•° k å¯è°ƒ</li></ul></li><li>æ‰§è¡Œ Hybrid Search<ul><li>limit å†³å®šæœ€ç»ˆè¾“å‡ºçš„ Top-K æ¡èåˆç»“æœã€‚</li></ul></li></ul><h2 id="BM25-å…¨æ–‡å…³é”®å­—æ£€ç´¢"><a href="#BM25-å…¨æ–‡å…³é”®å­—æ£€ç´¢" class="headerlink" title="BM25 å…¨æ–‡å…³é”®å­—æ£€ç´¢"></a>BM25 å…¨æ–‡å…³é”®å­—æ£€ç´¢</h2><p>é€šè¿‡ BM25 å¯¹åŸå§‹æ–‡æœ¬è¿›è¡Œå…³é”®è¯åŒ¹é…æ’åºï¼Œå¼¥è¡¥è¯­ä¹‰å‘é‡æ£€ç´¢å¯èƒ½å¿½ç•¥ç²¾ç¡®è¯æ¡åŒ¹é…çš„ä¸è¶³ã€‚</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250822104341926.png" alt="image-20250822104341926" style="zoom:67%;" /></p><p>ä¼˜åŠ¿ï¼š</p><ul><li>æ¥å—åŸå§‹æ–‡æœ¬è¾“å…¥ï¼Œæ— éœ€æ‰‹åŠ¨ç”Ÿæˆå‘é‡ï¼›</li><li>è‡ªåŠ¨å°†æ–‡æœ¬åˆ†è¯ã€æ˜ å°„ä¸ºç¨€ç–å‘é‡ï¼ˆSPARSE_FLOAT_VECTORï¼‰ï¼›</li><li>é€‚åˆéœ€ç²¾ç¡®å‘½ä¸­å…³é”®æœ¯è¯­çš„åœºæ™¯ï¼Œå¦‚æ³•å¾‹ã€åŒ»è¯ã€é…ç½®æ–‡æ¡£ç­‰ï¼›</li><li>ä¸ç¨ å¯†å‘é‡æ£€ç´¢ç»“åˆï¼Œå¯åœ¨ RAG ä¸­å®ç°â€œè¯­ä¹‰ + å…³é”®è¯â€åŒä¿é™©ã€‚</li></ul><p>åº”ç”¨: å¯ä¸ç¨ å¯†å‘é‡æ£€ç´¢ç»“åˆå®ç°â€è¯­ä¹‰+å…³é”®è¯â€åŒä¿é™©</p><h2 id="Text-Match-ç²¾ç¡®æ–‡æœ¬åŒ¹é…"><a href="#Text-Match-ç²¾ç¡®æ–‡æœ¬åŒ¹é…" class="headerlink" title="Text Match: ç²¾ç¡®æ–‡æœ¬åŒ¹é…"></a>Text Match: ç²¾ç¡®æ–‡æœ¬åŒ¹é…</h2><p>ç²¾ç¡®åŒ¹é…ï¼šåŸºäºå€’æ’ç´¢å¼•æŸ¥æ‰¾åŒ…å«æŒ‡å®šè¯æ¡çš„æ–‡æ¡£ï¼Œä¸è®¡ç®—ç›¸å…³åº¦åˆ†æ•°ï¼Œä»…è¿”å›å‘½ä¸­å®ä½“ã€‚<br>åº•å±‚å¼•æ“ï¼šé›†æˆ Tantivy ï¼Œé’ˆå¯¹æ¯ä¸ª VARCHAR å­—æ®µå»ºç«‹å€’æ’ç´¢å¼•ï¼ŒæŒ‰è¯æ¡å¿«é€Ÿå®šä½ã€‚</p><ul><li><p>åŸç†: åŸºäºå€’æ’ç´¢å¼•æŸ¥æ‰¾åŒ…å«æŒ‡å®šè¯æ¡çš„æ–‡æ¡£</p></li><li><p>ç‰¹ç‚¹:</p><ul><li>ä¸è®¡ç®—ç›¸å…³åº¦åˆ†æ•°ï¼Œä»…è¿”å›å‘½ä¸­å®ä½“</li><li>åº•å±‚é›†æˆTantivyå¼•æ“</li></ul></li><li><p>æŸ¥è¯¢è¯­æ³•:</p><ul><li><p>åŒ…å« machine æˆ– deep: TEXT_MATCH(text, â€˜machine deepâ€™)</p></li><li><p>åŒ…å« machine ä¸”åŒ…å« deep: TEXT_MATCH(text, â€˜machineâ€™) AND TEXT_MATCH(text, â€˜deepâ€™)</p></li><li><p>åŒ…å« machineã€learningï¼Œä½†ä¸åŒ…å« deep: </p><p>TEXT_MATCH(text, â€˜machineâ€™)<br>AND TEXT_MATCH(text, â€˜learningâ€™)<br>AND NOT TEXT_MATCH(text, â€˜deepâ€™)</p></li></ul></li></ul><h1 id="æœç´¢å’ŒæŸ¥è¯¢"><a href="#æœç´¢å’ŒæŸ¥è¯¢" class="headerlink" title="æœç´¢å’ŒæŸ¥è¯¢"></a>æœç´¢å’ŒæŸ¥è¯¢</h1><ul><li>æœ¬è´¨åŒºåˆ«ï¼š<ul><li>æœç´¢ï¼šåŸºäºå‘é‡ç›¸ä¼¼åº¦ï¼Œé€šè¿‡è·ç¦»åº¦é‡æ‰¾åˆ°ç›¸è¿‘å‘é‡ï¼ˆå¦‚ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰</li><li>æŸ¥è¯¢ï¼šåŸºäºå…ƒæ•°æ®ï¼ˆæ ‡é‡æ•°æ®ï¼‰ç›´æ¥å®šä½å®ä½“ï¼Œä¸å‘é‡æ— å…³</li></ul></li><li>å…¸å‹åœºæ™¯ï¼š<ul><li>æœç´¢é€‚ç”¨äºâ€æ‰¾åˆ°ç›¸ä¼¼å†…å®¹â€ï¼ˆå¦‚æ¨èç³»ç»Ÿï¼‰</li><li>æŸ¥è¯¢é€‚ç”¨äºâ€ç²¾ç¡®æŸ¥æ‰¾è®°å½•â€ï¼ˆå¦‚æ•°æ®åº“æ£€ç´¢ï¼‰</li></ul></li></ul><div class="table-container"><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>è¾“å…¥</th><th>è¾“å‡º</th><th>åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Get</strong></td><td>æ ¹æ®ä¸»é”®æŸ¥è¯¢æŒ‡å®šå®ä½“</td><td>collection_name, ids</td><td>æŒ‡å®šä¸»é”®å¯¹åº”çš„æ‰€æœ‰å­—æ®µå®ä½“</td><td>å·²çŸ¥ ID æ—¶æœ€å¿«é€Ÿåœ°è·å–å®Œæ•´è®°å½•</td></tr><tr><td><strong>Query</strong></td><td>æ ¹æ®è‡ªå®šä¹‰è¿‡æ»¤è¡¨è¾¾å¼æŸ¥è¯¢æŒ‡å®šæ•°é‡çš„å®ä½“</td><td>collection_name, filter, limit</td><td>æ»¡è¶³æ¡ä»¶æœ€å¤š limit ä¸ªå®ä½“</td><td>éœ€è¦ä¸€æ¬¡æ€§æ‹¿åˆ°éƒ¨åˆ†æ»¡è¶³æ¡ä»¶çš„ç»“æœ</td></tr><tr><td><strong>QueryIterator</strong></td><td>æ ¹æ®è‡ªå®šä¹‰è¿‡æ»¤è¡¨è¾¾å¼æŒ‰æ‰¹æ¬¡ (åˆ†é¡µ) éå†æ‰€æœ‰å®ä½“</td><td>collection_name, expr, batch_size</td><td>é€šè¿‡ iterator.next() åˆ†æ‰¹è¿”å›å®ä½“</td><td>éœ€è¦éå†æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„å®ä½“ (æµå¼æˆ–åˆ†é¡µå¤„ç†åœºæ™¯)</td></tr></tbody></table></div><h2 id="Getå’ŒQuery"><a href="#Getå’ŒQuery" class="headerlink" title="Getå’ŒQuery"></a>Getå’ŒQuery</h2><ul><li>æ ¸å¿ƒåŠŸèƒ½ï¼š<ul><li>Getï¼šé€šè¿‡ä¸»é”®IDå¿«é€Ÿè·å–å®Œæ•´è®°å½•ï¼ˆå¦‚æŸ¥è¯¢IDä¸º0/1/2çš„è®°å½•ï¼‰</li><li>Queryï¼šé€šè¿‡è¿‡æ»¤è¡¨è¾¾å¼è·å–é™å®šæ•°é‡çš„ç»“æœï¼ˆå¦‚color=â€çº¢è‰²â€å–å‰5æ¡ï¼‰</li></ul></li><li>å‚æ•°ç‰¹ç‚¹ï¼š<ul><li>Getéœ€æ˜ç¡®æŒ‡å®šidså­—æ®µåˆ—è¡¨</li><li>Queryæ”¯æŒfilterè¡¨è¾¾å¼å’Œlimité™åˆ¶ï¼ˆç¤ºä¾‹ï¼šcolor like â€œcolor_1%â€ï¼‰</li></ul></li></ul><h2 id="QueryIterator"><a href="#QueryIterator" class="headerlink" title="QueryIterator"></a>QueryIterator</h2><ul><li>æµå¼å¤„ç†ï¼š<ul><li>é€šè¿‡iterator.next()åˆ†æ‰¹è¿”å›ç»“æœï¼ˆç±»ä¼¼OpenAI APIçš„æµå¼å“åº”ï¼‰</li><li>æ¯æ‰¹æ•°é‡ç”±batch_sizeå‚æ•°æ§åˆ¶ï¼ˆå¦‚æ¯æ¬¡è¿”å›5æ¡è®°å½•ï¼‰</li></ul></li><li>é€‚ç”¨åœºæ™¯ï¼š<ul><li>å¤„ç†å¤§è§„æ¨¡ç»“æœé›†ï¼ˆé¿å…å†…å­˜æº¢å‡ºï¼‰</li><li>éœ€è¦æ¸è¿›å¼å±•ç¤ºç»“æœçš„åœºæ™¯ï¼ˆå¦‚åˆ†é¡µåŠ è½½ï¼‰</li></ul></li></ul>]]></content>
    
    
    <summary type="html">å­¦ä¹ å¤§æ¨¡å‹RAGç³»ç»Ÿå­¦ä¹ ç¬”è®°ç¬¬äºŒåäºŒè®²</summary>
    
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>RAGç»„ä»¶--å‘é‡æ•°æ®åº“ç´¢å¼•</title>
    <link href="https://jinglv.github.io/2025/08/19/ai/rag/21-vector-db-index/"/>
    <id>https://jinglv.github.io/2025/08/19/ai/rag/21-vector-db-index/</id>
    <published>2025-08-18T16:00:00.000Z</published>
    <updated>2025-08-19T07:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Milvusä¸­çš„å¸¸ç”¨ç´¢å¼•ä»‹ç»"><a href="#Milvusä¸­çš„å¸¸ç”¨ç´¢å¼•ä»‹ç»" class="headerlink" title="Milvusä¸­çš„å¸¸ç”¨ç´¢å¼•ä»‹ç»"></a>Milvusä¸­çš„å¸¸ç”¨ç´¢å¼•ä»‹ç»</h1><h2 id="FLAT-ç´¢å¼•-â€“-å…¨é‡æ‰«æ"><a href="#FLAT-ç´¢å¼•-â€“-å…¨é‡æ‰«æ" class="headerlink" title="FLAT ç´¢å¼• â€“ å…¨é‡æ‰«æ"></a>FLAT ç´¢å¼• â€“ å…¨é‡æ‰«æ</h2><p>æ¯ä¸ªæŸ¥è¯¢å‘é‡ç›´æ¥ä¸æ•°æ®é›†ä¸­çš„æ¯ä¸ªå‘é‡è¿›è¡Œæ¯”è¾ƒï¼Œæ— éœ€ä»»ä½•é«˜çº§é¢„å¤„ç†æˆ–æ•°æ®ç»“æ„åŒ–ã€‚</p><p>å·¥ä½œåŸç†ï¼šå…¨é‡æ‰«ææ¯ä¸ªæŸ¥è¯¢å‘é‡ï¼Œç›´æ¥ä¸æ•°æ®é›†ä¸­çš„æ¯ä¸ªå‘é‡è¿›è¡Œæ¯”è¾ƒ</p><p>åˆ›å»ºç´¢å¼•ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> MilvusClient</span><br><span class="line"></span><br><span class="line">index_params = MilvusClient.prepare_index_params()</span><br><span class="line"></span><br><span class="line">index_params.add_index(</span><br><span class="line">    field_name=<span class="string">&quot;your_vector_field_name&quot;</span>,</span><br><span class="line">    index_type=<span class="string">&quot;FLAT&quot;</span>,</span><br><span class="line">    index_name=<span class="string">&quot;vector_index&quot;</span>,</span><br><span class="line">    metric_type=<span class="string">&quot;L2&quot;</span>,</span><br><span class="line">    params=&#123;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li>ç‰¹ç‚¹ï¼š<ul><li>æ— é¢„å¤„ç†ï¼šæ•°æ®åŠ è½½æ—¶å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ï¼Œæ²¡æœ‰ä»»ä½•ç»“æ„åŒ–å¤„ç†</li><li>ç²¾å‡†åº¦é«˜ï¼šèƒ½è¾¾åˆ°embeddingæ¨¡å‹ç»™å‡ºçš„ä¸Šé™ï¼Œæ˜¯å‘é‡æ£€ç´¢çš„â€å¤©èŠ±æ¿â€</li><li>é€‚ç”¨åœºæ™¯ï¼šé€‚åˆæ•°æ®é‡åœ¨å‡ ä¸‡åˆ°å‡ åä¸‡æ¡çš„æƒ…å†µ</li><li>æ€§èƒ½å±€é™ï¼šç™¾ä¸‡/åƒä¸‡çº§æ•°æ®æ—¶å»¶è¿Ÿè¿‡é«˜ï¼Œä¸æ¨èä½¿ç”¨</li></ul></li></ul><h2 id="IVF-FLAT-å€’æ’æ–‡ä»¶"><a href="#IVF-FLAT-å€’æ’æ–‡ä»¶" class="headerlink" title="IVF_FLAT - å€’æ’æ–‡ä»¶"></a>IVF_FLAT - å€’æ’æ–‡ä»¶</h2><p>å½“å¯¹æ•°æ®é›†è¿›è¡Œèšç±»å¯ä»¥å‡å°‘æœç´¢ç©ºé—´ï¼Œå¹¶ä¸”æœ‰è¶³å¤Ÿçš„å†…å­˜æ¥å­˜å‚¨èšç±»æ•°æ®æ—¶ï¼Œå¿«é€ŸæŸ¥è¯¢å“åº”å¹¶ä¿è¯é«˜ç²¾åº¦ã€‚</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250820095803094.png" alt="image-20250820095803094" style="zoom:67%;" /></p><ul><li>æ ¸å¿ƒæ€æƒ³ï¼šé€šè¿‡èšç±»å‡å°‘æœç´¢ç©ºé—´ï¼Œç›¸ä¼¼å‘é‡èšä¸ºä¸€ç±»(ç±»ä¼¼ï¼šä¸€å¼ ç…§ç‰‡ä¸­ï¼Œå°†äººã€çŒ«ã€ç‹—åˆ†åˆ«è¿›è¡Œåˆ†åŒº)</li><li>å·¥ä½œæµç¨‹ï¼š<ul><li>ä½¿ç”¨k-meansç®—æ³•å°†å‘é‡èšç±»ï¼ˆnlistæŒ‡å®šèšç±»æ•°é‡ï¼‰</li><li>æŸ¥è¯¢æ—¶è®¡ç®—ä¸å„èšç±»ä¸­å¿ƒçš„è·ç¦»</li><li>åªåœ¨æœ€è¿‘çš„nprobeä¸ªèšç±»ä¸­è¿›è¡Œæœç´¢</li><li>è¿”å›æœ€ç›¸ä¼¼çš„ç»“æœ</li></ul></li><li>å…³é”®å‚æ•°ï¼š<ul><li>nlistï¼šæŒ‡å®šèšç±»åˆ†åŒºæ•°é‡ï¼ˆå¦‚64/80ï¼‰</li><li>nprobeï¼šæœç´¢æ—¶è€ƒè™‘çš„èšç±»æ•°é‡ï¼ˆå¦‚3/5ï¼‰</li></ul></li><li>ä¼˜åŠ¿ï¼š<ul><li>æ•ˆç‡æå‡ï¼šç›¸æ¯”FLATå¯å¿«nlistå€ï¼ˆå¦‚åˆ†æˆ80ç±»å¿«80å€ï¼‰</li><li>çµæ´»æ€§ï¼šé€šè¿‡è°ƒæ•´nprobeå¹³è¡¡ç²¾åº¦ä¸æ€§èƒ½</li></ul></li><li>å±€é™æ€§ï¼šç²¾åº¦ç•¥ä½äºFLATï¼Œä½†é€šè¿‡å¢åŠ nprobeå¯æ¥è¿‘</li></ul><p>åˆ›å»ºç´¢å¼•ä»£ç ç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> MilvusClient</span><br><span class="line"></span><br><span class="line">index_params = MilvusClient.prepare_index_params()</span><br><span class="line"></span><br><span class="line">index_params.add_index(</span><br><span class="line">    field_name=<span class="string">&quot;vector&quot;</span>,</span><br><span class="line">    metric_type=<span class="string">&quot;L2&quot;</span>,</span><br><span class="line">    index_type=<span class="string">&quot;IVF_FLAT&quot;</span>,</span><br><span class="line">    index_name=<span class="string">&quot;vector_index&quot;</span>,</span><br><span class="line">    params=&#123;</span><br><span class="line">        <span class="string">&quot;nlist&quot;</span>: <span class="number">64</span>  <span class="comment"># è®¾ç½®èšç±»æ•°é‡</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="IVF-PQï¼šå€’æ’æ–‡ä»¶ä¸ä¹˜ç§¯é‡åŒ–"><a href="#IVF-PQï¼šå€’æ’æ–‡ä»¶ä¸ä¹˜ç§¯é‡åŒ–" class="headerlink" title="IVF_PQï¼šå€’æ’æ–‡ä»¶ä¸ä¹˜ç§¯é‡åŒ–"></a>IVF_PQï¼šå€’æ’æ–‡ä»¶ä¸ä¹˜ç§¯é‡åŒ–</h2><p>Inverted File with Product Quantizationï¼Œæ˜¯ä¸€ç§ç»“åˆç´¢å¼•å’Œå‹ç¼©çš„æ··åˆæ–¹æ³•ã€‚</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250820101017610.png" alt="image-20250820101017610" style="zoom:80%;" /></p><ul><li>æ ¸å¿ƒåŸç†: ç»“åˆå€’æ’ç´¢å¼•å’Œä¹˜ç§¯é‡åŒ–çš„æ··åˆæ–¹æ³•ï¼Œé€šè¿‡ç»´åº¦åˆ†è§£å’Œå­ç©ºé—´é‡åŒ–å®ç°é«˜æ•ˆå‹ç¼©æ£€ç´¢</li><li>å·¥ä½œæµç¨‹:<ul><li>ç»´åº¦åˆ†è§£: å°†é«˜ç»´å‘é‡åˆ†è§£ä¸ºmä¸ªç­‰é•¿å­å‘é‡ï¼Œmå€¼æ§åˆ¶åˆ†è§£ç²’åº¦å’Œå‹ç¼©ç‡</li><li>ç æœ¬ç”Ÿæˆ: æ¯ä¸ªå­ç©ºé—´ç”¨K-meansèšç±»ç”Ÿæˆ$2^n$ï»¿ä½è´¨å¿ƒç æœ¬ï¼ˆå¦‚nbits=8æ—¶ç æœ¬å«256ä¸ªè´¨å¿ƒï¼‰</li><li>çŸ¢é‡é‡åŒ–: å­å‘é‡é€šè¿‡æœ€è¿‘é‚»æœç´¢åŒ¹é…å¯¹åº”å­ç©ºé—´çš„è´¨å¿ƒ</li><li>å‹ç¼©è¡¨ç¤º: æœ€ç»ˆç¼–ç ç”±mä¸ªå­ç©ºé—´ç´¢å¼•ç»„æˆï¼Œå­˜å‚¨éœ€æ±‚ä»$DÃ—32$ï»¿ä½é™è‡³$mÃ—nbits$ï»¿ä½</li></ul></li><li>é‡åŒ–æœ¬è´¨:<ul><li>å‹ç¼©åŸç†: é€šè¿‡é™ä½å‚æ•°ç²¾åº¦ï¼ˆå¦‚64ä½æµ®ç‚¹â†’8ä½æ•´å‹ï¼‰å‡å°‘å­˜å‚¨ç©ºé—´</li><li>æ€§èƒ½å½±å“: æ˜¾è‘—æå‡æ£€ç´¢é€Ÿåº¦ä½†ä¼šæŸå¤±ç²¾åº¦ï¼Œé€‚ç”¨äºå¯¹é€Ÿåº¦æ•æ„Ÿã€ç²¾åº¦è¦æ±‚å®½æ¾çš„åœºæ™¯</li></ul></li><li>å…³é”®å‚æ•°:<ul><li>k: æ¯ä¸ªå­ç©ºé—´çš„è´¨å¿ƒæ•°ï¼Œè®¡ç®—å…¬å¼ï»¿$k=2^{nbits}$ï»¿</li><li>m: åŸå§‹å‘é‡åˆ†å‰²çš„å­å‘é‡æ•°é‡ï¼Œéœ€æ»¡è¶³$dim/mâ‰¥2$ï»¿</li><li>nbits: è´¨å¿ƒç´¢å¼•ç¼–ç ä½æ•°ï¼ˆå…¸å‹å€¼ä¸º8ä½ï¼‰</li></ul></li></ul><p>åˆ›å»ºç´¢å¼•ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> MilvusClient</span><br><span class="line"></span><br><span class="line">index_params = MilvusClient.prepare_index_params()</span><br><span class="line"></span><br><span class="line">index_params.add_index(</span><br><span class="line">    field_name=<span class="string">&quot;vector&quot;</span>,</span><br><span class="line">    metric_type=<span class="string">&quot;L2&quot;</span>,</span><br><span class="line">    index_type=<span class="string">&quot;IVF_PQ&quot;</span>,</span><br><span class="line">    index_name=<span class="string">&quot;vector_index&quot;</span>,</span><br><span class="line">    params=&#123;</span><br><span class="line">        <span class="string">&quot;nlist&quot;</span>: <span class="number">64</span>,  <span class="comment"># èšç±»ä¸­å¿ƒæ•°é‡ï¼Œé€šå¸¸è®¾ç½®ä¸º 4*sqrt(n)ï¼Œn ä¸ºå‘é‡æ•°é‡</span></span><br><span class="line">        <span class="string">&quot;m&quot;</span>: <span class="number">32</span>,  <span class="comment"># å‘é‡è¢«åˆ†å‰²çš„å­å‘é‡æ•°é‡ï¼Œé€šå¸¸ä¸º dim/m &gt;= 2ï¼Œè¿™é‡Œ 128/32=4</span></span><br><span class="line">        <span class="string">&quot;nbits&quot;</span>: <span class="number">8</span>  <span class="comment"># æ¯ä¸ªå­å‘é‡çš„ç¼–ç ä½æ•°ï¼Œé€šå¸¸ä¸º 8 ä½</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li>å‚æ•°é…ç½®:<ul><li>nlist=64: èšç±»ä¸­å¿ƒæ•°é‡ï¼Œå»ºè®®è®¾ä¸ºï»¿$4Ã—\sqrt{n}$ï»¿ï¼ˆnä¸ºå‘é‡æ€»æ•°ï¼‰</li><li>m=32: 128ç»´å‘é‡åˆ†å‰²ä¸º32ä¸ªå­å‘é‡ï¼ˆæ»¡è¶³128/32=4ï¼‰</li><li>nbits=8: æ¯ä¸ªå­å‘é‡8ä½ç¼–ç ï¼Œäº§ç”Ÿ256ä¸ªè´¨å¿ƒï¼ˆï»¿$2^8$ï»¿ï¼‰</li></ul></li><li>å®ç°ç‰¹ç‚¹:<ul><li>å°æ•°æ®é›†éš¾ä»¥ä½“ç°æ€§èƒ½ä¼˜åŠ¿ï¼Œé€‚åˆå¤§è§„æ¨¡é«˜ç»´å‘é‡åœºæ™¯</li><li>ç›¸æ¯”åŸå§‹å­˜å‚¨ï¼ˆå¦‚1536ç»´32ä½æµ®ç‚¹å‘é‡ï¼‰ï¼Œå‹ç¼©åä»…éœ€$mÃ—nbits$ï»¿å­˜å‚¨ç©ºé—´</li></ul></li></ul><h2 id="HNSWï¼šåˆ†å±‚å¯å¯¼èˆªå°ä¸–ç•Œ"><a href="#HNSWï¼šåˆ†å±‚å¯å¯¼èˆªå°ä¸–ç•Œ" class="headerlink" title="HNSWï¼šåˆ†å±‚å¯å¯¼èˆªå°ä¸–ç•Œ"></a>HNSWï¼šåˆ†å±‚å¯å¯¼èˆªå°ä¸–ç•Œ</h2><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250820101448765.png" alt="image-20250820101448765" style="zoom:67%;" /></p><p><strong>åˆ†å±‚å¯å¯¼èˆªå°ä¸–ç•Œ (HNSW)</strong> ç®—æ³•æ„å»ºäº†ä¸€ä¸ªå¤šå±‚å›¾ï¼Œæœ‰ç‚¹åƒå…·æœ‰ä¸åŒç¼©æ”¾çº§åˆ«çš„åœ°å›¾ã€‚åº•å±‚åŒ…å«æ‰€æœ‰æ•°æ®ç‚¹ï¼Œè€Œä¸Šå±‚åˆ™ç”±ä»ä¸‹å±‚é‡‡æ ·çš„æ•°æ®ç‚¹å­é›†ç»„æˆã€‚</p><p>åœ¨è¿™ä¸ªå±‚æ¬¡ç»“æ„ä¸­ï¼Œæ¯ä¸€å±‚éƒ½åŒ…å«ä»£è¡¨æ•°æ®ç‚¹çš„èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹é€šè¿‡æŒ‡ç¤ºå…¶æ¥è¿‘åº¦çš„è¾¹è¿æ¥èµ·æ¥ã€‚è¾ƒé«˜çš„å±‚çº§æä¾›é•¿è·ç¦»è·³è·ƒï¼Œä»¥å¿«é€Ÿæ¥è¿‘ç›®æ ‡ï¼Œè€Œè¾ƒä½çš„å±‚çº§åˆ™æ”¯æŒç»†ç²’åº¦æœç´¢ï¼Œä»¥è·å¾—æœ€å‡†ç¡®çš„ç»“æœã€‚</p><ol><li><strong>å…¥å£ç‚¹</strong>ï¼šæœç´¢ä»é¡¶å±‚çš„å›ºå®šå…¥å£ç‚¹å¼€å§‹ï¼Œè¯¥å…¥å£ç‚¹æ˜¯å›¾ä¸­é¢„å…ˆç¡®å®šçš„èŠ‚ç‚¹ã€‚</li><li><strong>è´ªå©ªæœç´¢</strong>ï¼šè¯¥ç®—æ³•è´ªå©ªåœ°ç§»åŠ¨åˆ°å½“å‰å±‚çš„æœ€è¿‘é‚»ï¼Œç›´åˆ°æ— æ³•å†æ¥è¿‘æŸ¥è¯¢å‘é‡ã€‚ä¸Šå±‚èµ·åˆ°å¯¼èˆªçš„ä½œç”¨ï¼Œå……å½“ç²—ç•¥çš„è¿‡æ»¤å™¨ï¼Œä¸ºä¸‹å±‚æ›´ç²¾ç»†çš„æœç´¢æ‰¾åˆ°æ½œåœ¨çš„å…¥å£ç‚¹ã€‚</li><li><strong>å±‚ä¸‹é™</strong>ï¼šä¸€æ—¦åœ¨å½“å‰å±‚è¾¾åˆ°å±€éƒ¨æœ€å°å€¼ï¼Œç®—æ³•å°±ä¼šä½¿ç”¨é¢„å…ˆå»ºç«‹çš„è¿æ¥è·³è½¬åˆ°è¾ƒä½å±‚ï¼Œå¹¶é‡å¤è´ªå©ªæœç´¢ã€‚</li><li><strong>æœ€ç»ˆç»†åŒ–</strong>ï¼šè¯¥è¿‡ç¨‹æŒç»­ç›´è‡³åˆ°è¾¾åº•å±‚ï¼Œå…¶ä¸­æœ€ç»ˆç»†åŒ–æ­¥éª¤è¯†åˆ«æœ€è¿‘çš„é‚»å±…ã€‚</li></ol><p>æ€»ç»“ï¼š</p><ul><li>ç®—æ³•æ¶æ„: å¤šå±‚å›¾ç»“æ„ï¼Œç±»ä¼¼å¤šåˆ†è¾¨ç‡åœ°å›¾<ul><li>åº•å±‚: åŒ…å«å…¨éƒ¨æ•°æ®ç‚¹</li><li>ä¸Šå±‚: ä¸‹å±‚æ•°æ®ç‚¹çš„æŠ½æ ·å­é›†ï¼Œå±‚çº§è¶Šé«˜æ•°æ®ç‚¹è¶Šç¨€ç–</li></ul></li><li>æœç´¢æœºåˆ¶:<ul><li>å…¥å£ç‚¹: ä»é¡¶å±‚å›ºå®šå…¥å£ç‚¹å¯åŠ¨æœç´¢</li><li>è´ªå©ªæœç´¢: é€å±‚å¯»æ‰¾æœ€è¿‘é‚»ï¼Œä¸Šå±‚å®ç°å¿«é€Ÿç²—ç­›ï¼Œä¸‹å±‚è¿›è¡Œç²¾ç»†æœç´¢</li><li>å±‚é—´è·³è½¬: åˆ°è¾¾å±€éƒ¨æœ€ä¼˜åé™å±‚ç»§ç»­æœç´¢ï¼Œç›´è‡³åº•å±‚å®Œæˆæœ€ç»ˆåŒ¹é…</li></ul></li><li>æ ¸å¿ƒå‚æ•°:<ul><li>M: èŠ‚ç‚¹æœ€å¤§è¿æ¥æ•°ï¼ˆæ§åˆ¶å›¾å¯†åº¦ï¼‰</li><li>efConstruction: æ„å»ºæ—¶çš„å€™é€‰é‚»å±…æ•°ï¼ˆå½±å“ç´¢å¼•è´¨é‡ï¼‰</li></ul></li><li>æ€§èƒ½ç‰¹ç‚¹:<ul><li>ç²¾åº¦ä¸æ•ˆç‡å¹³è¡¡è‰¯å¥½ï¼Œé€‚åˆéœ€è¦é«˜å‡†ç¡®ç‡çš„åœºæ™¯</li><li>é€šè¿‡å±‚çº§ç»“æ„å®ç°ç±»ä¼¼é›·è¾¾çš„æ¸è¿›å¼æœç´¢ï¼Œé€æ­¥æ‰©å¤§æœç´¢èŒƒå›´</li></ul></li></ul><p>åˆ›å»ºç´¢å¼•ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> MilvusClient</span><br><span class="line"></span><br><span class="line">index_params = MilvusClient.prepare_index_params()</span><br><span class="line"></span><br><span class="line">index_params.add_index(</span><br><span class="line">    field_name=<span class="string">&quot;vector&quot;</span>,</span><br><span class="line">    metric_type=<span class="string">&quot;L2&quot;</span>,</span><br><span class="line">    index_type=<span class="string">&quot;HNSW&quot;</span>,</span><br><span class="line">    index_name=<span class="string">&quot;vector_index&quot;</span>,</span><br><span class="line">    params=&#123;</span><br><span class="line">        <span class="string">&quot;M&quot;</span>: <span class="number">64</span>,  <span class="comment"># æœ€å¤§é‚»å±…æ•°</span></span><br><span class="line">        <span class="string">&quot;efConstruction&quot;</span>: <span class="number">100</span>  <span class="comment"># æ„å»ºæ—¶çš„å€™é€‰é‚»å±…æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="DISKANNï¼ˆç£ç›˜ç‰ˆå›¾ç´¢å¼•ï¼‰"><a href="#DISKANNï¼ˆç£ç›˜ç‰ˆå›¾ç´¢å¼•ï¼‰" class="headerlink" title="DISKANNï¼ˆç£ç›˜ç‰ˆå›¾ç´¢å¼•ï¼‰"></a>DISKANNï¼ˆç£ç›˜ç‰ˆå›¾ç´¢å¼•ï¼‰</h2><p>åŸºäº Vamana å›¾ï¼ˆç±»ä¼¼ HNSWï¼‰ï¼Œå°†å›¾ç»“æ„å’Œå‹ç¼©å‘é‡å­˜æ”¾åœ¨ SSD ä¸Šï¼›åœ¨å†…å­˜ä¸­åªä¿ç•™å…ƒæ•°æ®ã€‚</p><p><strong>æŸ¥è¯¢æµç¨‹</strong>ï¼šç»“åˆ PQ å‹ç¼©å’Œå›¾éå†ï¼Œä»ç£ç›˜ I/O ä¸­è¯»å…¥å¿…è¦èŠ‚ç‚¹ã€‚</p><p><strong>ä¼˜ç¼ºç‚¹</strong></p><ul><li>âœ” é€‚åˆæµ·é‡æ•°æ®ï¼šå¯æ”¯æ’‘åäº¿çº§å‘é‡</li><li>âœ” RAM å ç”¨ä½ï¼šä»…å…ƒæ•°æ®åœ¨å†…å­˜</li><li>âœ˜ å»¶è¿Ÿå— SSD IOPS é™åˆ¶ï¼šå¯¹ I/O æ€§èƒ½ä¾èµ–é«˜</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong></p><ul><li>æ•°æ®é‡è¿œè¶…å¯ç”¨å†…å­˜</li><li>å¯¹å“åº”æ—¶å»¶æœ‰ä¸€å®šå®¹å¿ï¼ˆæˆ– SSD IOPS è¶³å¤Ÿé«˜ï¼‰</li></ul><p>æ€»ç»“ï¼š</p><ul><li>æ ¸å¿ƒæ€æƒ³ï¼šåŸºäºVamanaå›¾ï¼ˆç±»ä¼¼HNSWï¼‰ç»“æ„ï¼Œå°†å›¾ç»“æ„å’Œå‹ç¼©å‘é‡å­˜æ”¾åœ¨SSDä¸Šï¼Œå†…å­˜ä¸­ä»…ä¿ç•™å…ƒæ•°æ®</li><li>æŸ¥è¯¢æœºåˆ¶ï¼šç»“åˆPQå‹ç¼©å’Œå›¾éå†æŠ€æœ¯ï¼ŒæŒ‰éœ€ä»ç£ç›˜I/Oè¯»å–å¿…è¦èŠ‚ç‚¹</li><li>ä¼˜åŠ¿ç‰¹ç‚¹ï¼š<ul><li>æµ·é‡æ”¯æŒï¼šå¯å¤„ç†åäº¿çº§å‘é‡æ•°æ®</li><li>å†…å­˜ä¼˜åŒ–ï¼šä»…éœ€å­˜å‚¨å…ƒæ•°æ®ï¼ŒRAMå ç”¨æä½</li></ul></li><li>æ€§èƒ½å±€é™ï¼š<ul><li>I/Oä¾èµ–ï¼šæŸ¥è¯¢å»¶è¿Ÿå—SSD IOPSé™åˆ¶</li><li>é€Ÿåº¦æŠ˜è¡·ï¼šç›¸æ¯”çº¯å†…å­˜æ–¹æ¡ˆå­˜åœ¨æ€§èƒ½å·®è·</li></ul></li><li>é€‚ç”¨åœºæ™¯ï¼š<ul><li>æ•°æ®è§„æ¨¡è¿œè¶…å¯ç”¨å†…å­˜å®¹é‡</li><li>å¯¹å“åº”æ—¶å»¶æœ‰ä¸€å®šå®¹å¿åº¦ï¼ˆæˆ–å…·å¤‡é«˜æ€§èƒ½SSDï¼‰</li></ul></li></ul><p>åˆ›å»ºç´¢å¼•ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> MilvusClient</span><br><span class="line"></span><br><span class="line">index_params = MilvusClient.prepare_index_params()</span><br><span class="line"></span><br><span class="line">index_params.add_index(</span><br><span class="line">    field_name=<span class="string">&quot;vector&quot;</span>,</span><br><span class="line">    metric_type=<span class="string">&quot;L2&quot;</span>,  <span class="comment"># æ”¯æŒ L2ã€IP æˆ– COSINE</span></span><br><span class="line">    index_type=<span class="string">&quot;DISKANN&quot;</span>,  <span class="comment"># ä½¿ç”¨ DiskANN ç´¢å¼•</span></span><br><span class="line">    index_name=<span class="string">&quot;vector_index&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li>ç´¢å¼•åˆ›å»ºæ­¥éª¤ï¼š<ul><li>å‡†å¤‡ç´¢å¼•å‚æ•°ï¼šä½¿ç”¨prepare_index_params()æ–¹æ³•åˆå§‹åŒ–ç´¢å¼•å‚æ•°å¯¹è±¡</li><li>æ·»åŠ ç´¢å¼•é…ç½®ï¼šé€šè¿‡add_index()æ–¹æ³•è®¾ç½®å­—æ®µåã€åº¦é‡ç±»å‹å’Œç´¢å¼•ç±»å‹<ul><li>æ”¯æŒä¸‰ç§åº¦é‡ç±»å‹ï¼š$L2$ï»¿è·ç¦»ã€å†…ç§¯(ã€$IP$ï»¿)å’Œä½™å¼¦ç›¸ä¼¼åº¦($COSINE$ï»¿)</li><li>ç´¢å¼•ç±»å‹éœ€æ˜ç¡®æŒ‡å®šä¸ºâ€DISKANNâ€</li></ul></li><li>æ‰§è¡Œåˆ›å»ºæ“ä½œï¼šè°ƒç”¨create_index()æ–¹æ³•å¹¶ä¼ å…¥é›†åˆåç§°å’Œç´¢å¼•å‚æ•°</li></ul></li><li>DiskANNç‰¹ç‚¹ï¼š<ul><li>ç¡¬ç›˜å­˜å‚¨ï¼šç´¢å¼•æ•°æ®ç›´æ¥å­˜å‚¨åœ¨ç¡¬ç›˜è€Œéå†…å­˜ï¼Œé€‚åˆå¤§è§„æ¨¡æ•°æ®é›†</li><li>ç®€å•é…ç½®ï¼šåªéœ€åœ¨ç´¢å¼•ç±»å‹å‚æ•°ä¸­æŒ‡å®šâ€DISKANNâ€å³å¯å¯ç”¨</li><li>è‡ªåŠ¨è¿è¡Œï¼šè®¾ç½®å®Œæˆåç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨ç¡¬ç›˜ä¸Šæ„å»ºå’Œè¿è¡Œç´¢å¼•</li></ul></li><li>æ³¨æ„äº‹é¡¹ï¼š<ul><li>ç´¢å¼•åˆ›å»ºæ˜¯åŒæ­¥æ“ä½œï¼Œå»ºè®®è®¾ç½®sync=Trueç­‰å¾…å®Œæˆ</li><li>åˆ›å»ºå‰éœ€ç¡®ä¿é›†åˆå·²å­˜åœ¨ä¸”åŒ…å«å‘é‡æ•°æ®</li><li>ä¸åŒåº¦é‡ç±»å‹ä¼šå½±å“æœç´¢ç»“æœï¼Œéœ€æ ¹æ®åº”ç”¨åœºæ™¯é€‰æ‹©</li></ul></li></ul><h1 id="ç´¢å¼•å’Œå‘é‡ç±»å‹ä»¥åŠåº¦é‡æ ‡å‡†ç›¸å…³"><a href="#ç´¢å¼•å’Œå‘é‡ç±»å‹ä»¥åŠåº¦é‡æ ‡å‡†ç›¸å…³" class="headerlink" title="ç´¢å¼•å’Œå‘é‡ç±»å‹ä»¥åŠåº¦é‡æ ‡å‡†ç›¸å…³"></a>ç´¢å¼•å’Œå‘é‡ç±»å‹ä»¥åŠåº¦é‡æ ‡å‡†ç›¸å…³</h1><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250820102716154.png" alt="image-20250820102716154" style="zoom:50%;" /></p><ul><li>ç´¢å¼•ä½“ç³»ï¼š<ul><li>æµ®ç‚¹å‘é‡ï¼šæ”¯æŒFLAT/IVF_FLAT/IVF_SQ8/IVF_PQ/HNSW/DISKANNç­‰</li><li>ç¨€ç–å‘é‡ï¼šä»…æ”¯æŒSPARSE_INVERTED_INDEX</li><li>äºŒè¿›åˆ¶å‘é‡ï¼šæä¾›BIN_FLAT/BIN_IVF_FLATä¸“ç”¨ç´¢å¼•</li></ul></li><li>åº¦é‡æ ‡å‡†ï¼š<ul><li>æµ®ç‚¹å‘é‡ï¼šé€‚ç”¨$L_2$ï»¿/IP/COSINEä¸‰ç§è·ç¦»</li><li>ç¨€ç–å‘é‡ï¼šé™å®šIP/BM25ç›¸ä¼¼åº¦</li><li>äºŒè¿›åˆ¶å‘é‡ï¼šä¸“ç”¨JACCARD/HAMMINGè·ç¦»</li></ul></li><li>ç»„åˆè§„å¾‹ï¼š<ul><li>æµ®ç‚¹å‘é‡ç´¢å¼•ä½“ç³»æœ€ä¸°å¯Œï¼ˆå«GPUåŠ é€Ÿç‰ˆæœ¬ï¼‰</li><li>äºŒè¿›åˆ¶å‘é‡ç´¢å¼•é‡‡ç”¨â€BIN_â€å‰ç¼€æ ‡è¯†</li><li>ç¨€ç–å‘é‡ä»…æ”¯æŒå€’æ’ç´¢å¼•ç»“æ„</li></ul></li></ul><h1 id="å„ç§ç±»å‹ç´¢å¼•çš„ç»„åˆ"><a href="#å„ç§ç±»å‹ç´¢å¼•çš„ç»„åˆ" class="headerlink" title="å„ç§ç±»å‹ç´¢å¼•çš„ç»„åˆ"></a>å„ç§ç±»å‹ç´¢å¼•çš„ç»„åˆ</h1><div class="table-container"><table><thead><tr><th>åç§°</th><th>åˆ†ç±»</th><th>é€‚ç”¨åœºæ™¯</th><th>åµŒå…¥ç±»å‹</th></tr></thead><tbody><tr><td>FLAT</td><td>æ™®é€šç´¢å¼•</td><td>æ•°æ®é›†è§„æ¨¡ç›¸å¯¹è¾ƒå°éœ€è¦100%çš„å¬å›ç‡</td><td>æµ®ç‚¹åµŒå…¥</td></tr><tr><td>IVF_FLAT</td><td>åŸºäºæ ‘çš„ç´¢å¼•</td><td>æŸ¥è¯¢é€Ÿåº¦è¦æ±‚é«˜åŒæ—¶éœ€è¦å°½å¯èƒ½é«˜çš„å¬å›ç‡<br />æŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«å†…å­˜èµ„æºæœ‰é™</td><td>æµ®ç‚¹åµŒå…¥</td></tr><tr><td>IVF_SQ8</td><td>åŸºäºé‡åŒ–çš„ç´¢å¼•</td><td>å¯æ¥å—åœ¨å¬å›ç‡ä¸Šæœ‰è½»å¾®æŠ˜ä¸­</td><td>æµ®ç‚¹åµŒå…¥</td></tr><tr><td></td><td></td><td>æŸ¥è¯¢é€Ÿåº¦è¾ƒå¿«å†…å­˜èµ„æºæœ‰é™</td><td></td></tr><tr><td>IVF_PQ</td><td>åŸºäºé‡åŒ–çš„ç´¢å¼•</td><td>å¯æ¥å—åœ¨å¬å›ç‡ä¸Šæœ‰è½»å¾®æŠ˜ä¸­<br /></td><td>æŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«å¯¹å¬å›ç‡è¦æ±‚é«˜æµ®ç‚¹åµŒå…¥</td></tr><tr><td>SCANN</td><td>åŸºäºé‡åŒ–çš„ç´¢å¼•</td><td>æŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«å¯¹å¬å›ç‡è¦æ±‚é«˜å†…å­˜èµ„æºå……è¶³</td><td>æµ®ç‚¹åµŒå…¥</td></tr><tr><td>HNSW</td><td>åŸºäºå›¾çš„ç´¢å¼•</td><td>æŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«å¯¹å¬å›ç‡è¦æ±‚é«˜<br />å†…å­˜èµ„æºè¾ƒä¸ºå……è¶³</td><td>æµ®ç‚¹åµŒå…¥</td></tr><tr><td>HNSW_SQ</td><td>åŸºäºå›¾çš„ç´¢å¼•</td><td>æŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«å†…å­˜èµ„æºæœ‰é™<br />å¯æ¥å—åœ¨å¬å›ç‡ä¸Šæœ‰è½»å¾®æŠ˜ä¸­</td><td>æµ®ç‚¹åµŒå…¥</td></tr><tr><td>HNSW_PQ</td><td>åŸºäºå›¾çš„ç´¢å¼•</td><td>æŸ¥è¯¢é€Ÿåº¦ä¸­ç­‰å†…å­˜èµ„æºéå¸¸æœ‰é™<br />å¯æ¥å—åœ¨å¬å›ç‡ä¸Šæœ‰è½»å¾®æŠ˜ä¸­</td><td>æµ®ç‚¹åµŒå…¥</td></tr><tr><td>HNSW_PRQ</td><td>åŸºäºå›¾çš„ç´¢å¼•</td><td>æŸ¥è¯¢é€Ÿåº¦ä¸­ç­‰å†…å­˜èµ„æºéå¸¸æœ‰é™<br />å¯æ¥å—åœ¨å¬å›ç‡ä¸Šæœ‰è½»å¾®æŠ˜ä¸­</td><td>æµ®ç‚¹åµŒå…¥</td></tr><tr><td>BIN_FLAT</td><td>æ™®é€šç´¢å¼•</td><td>æ•°æ®é›†è§„æ¨¡è¾ƒå°<br />éœ€è¦ç²¾ç¡®çš„æœç´¢ç»“æœæ— é¡»å‹ç¼©</td><td>äºŒè¿›åˆ¶åµŒå…¥</td></tr><tr><td>BIN_IVF_FLAT</td><td>åŸºäºæ ‘çš„ç´¢å¼•</td><td>éœ€è¦é«˜æŸ¥è¯¢é€Ÿåº¦å¯¹å¬å›ç‡è¦æ±‚é«˜<br />æ•°æ®é›†è§„æ¨¡è¾ƒå¤§</td><td>äºŒè¿›åˆ¶åµŒå…¥</td></tr><tr><td>SPARSE_INVERTED_INDEX</td><td>æ™®é€šç´¢å¼•</td><td>æ•°æ®é›†è§„æ¨¡è¾ƒå°éœ€è¦100%çš„å¬å›ç‡<br />é€‚ç”¨äºç¨€ç–å‘é‡çš„æ£€ç´¢</td><td>ç¨€ç–åµŒå…¥</td></tr></tbody></table></div><ul><li>FLATç´¢å¼•ï¼š<ul><li>åˆ†ç±»ï¼šæ™®é€šç´¢å¼•</li><li>é€‚ç”¨åœºæ™¯ï¼šæ•°æ®é›†è§„æ¨¡è¾ƒå°ä¸”éœ€è¦100%å¬å›ç‡</li><li>åµŒå…¥ç±»å‹ï¼šæµ®ç‚¹åµŒå…¥</li><li>ç‰¹ç‚¹ï¼šå…¨é‡ç²¾åº¦æœ€é«˜ï¼Œé€‚åˆå¯¹å¬å›ç‡è¦æ±‚ä¸¥æ ¼çš„åœºæ™¯</li></ul></li><li>IVF_FLATç´¢å¼•ï¼š<ul><li>åˆ†ç±»ï¼šåŸºäºæ ‘çš„ç´¢å¼•</li><li>é€‚ç”¨åœºæ™¯ï¼šæŸ¥è¯¢é€Ÿåº¦è¦æ±‚é«˜åŒæ—¶éœ€è¦å°½å¯èƒ½é«˜çš„å¬å›ç‡</li><li>åµŒå…¥ç±»å‹ï¼šæµ®ç‚¹åµŒå…¥</li><li>ç‰¹ç‚¹ï¼šé€šè¿‡èšç±»(æ ‘çŠ¶ç»“æ„)åŠ é€ŸæŸ¥è¯¢ï¼Œé€‚åˆå¤§è§„æ¨¡æ•°æ®</li></ul></li><li>é‡åŒ–ç´¢å¼•ç³»åˆ—ï¼š<ul><li>åŒ…å«IVF_SQ8/IVF_PQ/SCANNç­‰</li><li>å…±åŒç‰¹ç‚¹ï¼šé€šè¿‡æœ‰æŸå‹ç¼©å‡å°‘å†…å­˜å ç”¨</li><li>å–èˆï¼šåœ¨æŸ¥è¯¢é€Ÿåº¦å’Œå†…å­˜å ç”¨ä¸Šæœ‰ä¼˜åŠ¿ï¼Œä½†ä¼šç‰ºç‰²éƒ¨åˆ†å¬å›ç‡</li><li>å…¸å‹åº”ç”¨ï¼šIVF_SQ8é€‚åˆå†…å­˜ç´§å¼ åœºæ™¯ï¼ŒSCANNé€‚åˆèµ„æºå……è¶³ä½†å¯¹å¬å›ç‡è¦æ±‚é«˜çš„åœºæ™¯</li></ul></li><li>å›¾ç´¢å¼•ç³»åˆ—ï¼š<ul><li>åŒ…å«HNSW/HNSW_SQ/HNSW_PQç­‰</li><li>å…±åŒç‰¹ç‚¹ï¼šåŸºäºå›¾ç½‘ç»œç»“æ„å®ç°å¿«é€Ÿå¯¼èˆª</li><li>ä¼˜åŠ¿ï¼šHNSWåœ¨é€Ÿåº¦å’Œå¬å›ç‡ä¸Šè¡¨ç°ä¼˜å¼‚ï¼Œé€‚åˆèµ„æºå……è¶³åœºæ™¯</li><li>å˜ä½“ï¼šå¸¦é‡åŒ–çš„ç‰ˆæœ¬(HNSW_SQç­‰)åœ¨å†…å­˜å ç”¨å’Œæ€§èƒ½é—´å–å¾—å¹³è¡¡</li></ul></li><li>äºŒè¿›åˆ¶ç´¢å¼•ï¼š<ul><li>BIN_FLATï¼šé€‚åˆå°è§„æ¨¡äºŒè¿›åˆ¶æ•°æ®ç²¾ç¡®æœç´¢</li><li>BIN_IVF_FLATï¼šé€‚åˆå¤§è§„æ¨¡äºŒè¿›åˆ¶æ•°æ®é«˜é€ŸæŸ¥è¯¢</li><li>ç‰¹ç‚¹ï¼šä¸“é—¨å¤„ç†äºŒè¿›åˆ¶åµŒå…¥ï¼Œä¸è¿›è¡Œå‹ç¼©</li></ul></li><li>ç¨€ç–ç´¢å¼•ï¼š<ul><li>SPARSE_INVERTED_INDEXï¼šä¸“ä¸ºç¨€ç–å‘é‡è®¾è®¡</li><li>ç‰¹ç‚¹ï¼šä¿æŒ100%å¬å›ç‡ï¼Œé€‚åˆå°è§„æ¨¡ç¨€ç–æ•°æ®</li></ul></li></ul><h1 id="ç´¢å¼•é€‰å‹é€Ÿè§ˆ"><a href="#ç´¢å¼•é€‰å‹é€Ÿè§ˆ" class="headerlink" title="ç´¢å¼•é€‰å‹é€Ÿè§ˆ"></a>ç´¢å¼•é€‰å‹é€Ÿè§ˆ</h1><ul><li>ç²¾åº¦ä¼˜å…ˆï¼š<ul><li>é€‰æ‹©FLATç´¢å¼•</li><li>ç‰¹ç‚¹ï¼šä¿è¯100%å¬å›ç‡ï¼Œé€‚åˆå¯¹ç²¾åº¦è¦æ±‚æé«˜çš„åœºæ™¯</li></ul></li><li>ä½å»¶è¿Ÿåœºæ™¯ï¼š<ul><li>é€‰æ‹©HNSWç³»åˆ—</li><li>é€‚ç”¨æ¡ä»¶ï¼štop-Kè¾ƒå°ä¸”å†…å­˜èµ„æºå……è¶³</li><li>ä¼˜åŠ¿ï¼šæŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«</li></ul></li><li>æµ·é‡æ•°æ®å¤„ç†ï¼š<ul><li>é€‰æ‹©IVF_FLAT</li><li>ç‰¹ç‚¹ï¼šé€‚åˆå¤§è§„æ¨¡æ•°æ®å’Œå¤§top-Kåœºæ™¯</li><li>åŸç†ï¼šé€šè¿‡èšç±»å‡å°‘æœç´¢èŒƒå›´</li></ul></li><li>å†…å­˜ä¼˜åŒ–æ–¹æ¡ˆï¼š<ul><li>IVF_SQ8æˆ–IVF_PQ</li><li>ç‰¹ç‚¹ï¼šé‡åŒ–å‹ç¼©å‡å°‘å†…å­˜å ç”¨</li><li>å–èˆï¼šä¼šè½»å¾®å½±å“å¬å›ç‡</li></ul></li><li>GPUåŠ é€Ÿï¼š<ul><li>GPU_IVF_FLAT/GPU_IVF_PQ</li><li>ä¼˜åŠ¿ï¼šåˆ©ç”¨GPUå¹¶è¡Œè®¡ç®—èƒ½åŠ›åŠ é€Ÿ</li></ul></li><li>è¶…å¤§æ•°æ®é›†ï¼š<ul><li>DISKANN</li><li>ç‰¹ç‚¹ï¼šæ•°æ®é‡è¶…è¿‡å†…å­˜å®¹é‡æ—¶ä½¿ç”¨</li><li>åŸç†ï¼šåŸºäºç£ç›˜çš„ç´¢å¼•ç»“æ„</li></ul></li></ul><h1 id="Milvusä¸­ç´¢å¼•çš„å·¥ä½œæœºåˆ¶"><a href="#Milvusä¸­ç´¢å¼•çš„å·¥ä½œæœºåˆ¶" class="headerlink" title="Milvusä¸­ç´¢å¼•çš„å·¥ä½œæœºåˆ¶"></a>Milvusä¸­ç´¢å¼•çš„å·¥ä½œæœºåˆ¶</h1><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250820103439677.png" alt="image-20250820103439677" style="zoom:50%;" /></p><p>Milvus çš„å‘é‡ç´¢å¼•é‡‡ç”¨â€œç²—â€”å¿«â€”å‡†â€ä¸‰å±‚åˆ†å±‚æ¶æ„ï¼Œä»¥åœ¨æ£€ç´¢æ•ˆç‡å’Œç²¾åº¦ä¹‹é—´å–å¾—æœ€ä½³å¹³è¡¡ï¼š</p><ol><li><strong>æ•°æ®ç»“æ„ï¼ˆç²—è¿‡æ»¤ï¼‰</strong>â€” ä¾‹å¦‚ IVF å°†å‘é‡æŒ‰è´¨å¿ƒåˆ’åˆ†å­˜å‚¨æ¡¶ï¼Œæˆ– HNSWæ„å»ºåˆ†å±‚å›¾ç½‘ç»œï¼Œé€šè¿‡åªæ‰«æä¸æŸ¥è¯¢å‘é‡è´¨å¿ƒæˆ–é‚»åŸŸç›¸å…³çš„å­é›†ï¼Œå®ç°å¯¹å¤§è§„æ¨¡æ•°æ®çš„å¿«é€Ÿè¿‡æ»¤ã€‚</li><li><strong>é‡åŒ–ï¼ˆåŠ é€Ÿè®¡ç®—ï¼‰</strong>â€” é€šè¿‡ SQ8ã€PQ ç­‰æœ‰æŸå‹ç¼©ï¼Œå°†å‘é‡ä» 32 ä½æµ®ç‚¹å‹ç¼©åˆ° 8 ä½æˆ–æ›´ä½ç»´åº¦ï¼Œå¤§å¹…å‡å°‘å†…å­˜å’Œè®¡ç®—å¼€é”€ï¼Œå¿«é€Ÿè®¡ç®—å€™é€‰é›†è·ç¦»ã€‚</li><li><strong>ç²¾ç‚¼å™¨ï¼ˆç²¾å‡†é‡æ’</strong>ï¼‰â€” å¯¹é‡åŒ–åçš„å€™é€‰ç»“æœï¼ˆtopKÃ—æ‰©å±•ç‡ï¼‰ä½¿ç”¨FP32 ç²¾åº¦é‡æ–°è®¡ç®—è·ç¦»ï¼Œå¯¹æ’åºè¿›è¡Œå¾®è°ƒï¼Œå¼¥è¡¥é‡åŒ–å¸¦æ¥çš„è¯¯å·®ï¼Œç¡®ä¿æœ€ç»ˆè¿”å›çš„ topK ç»“æœé«˜è´¨é‡ã€ä½å»¶è¿Ÿã€‚</li></ol><p>æ€»ç»“ï¼š</p><ul><li>ä¸‰å±‚æ¶æ„ï¼š<ul><li>æ•°æ®ç»“æ„å±‚ï¼šè´Ÿè´£ç²—è¿‡æ»¤ï¼Œå¦‚IVFçš„èšç±»æˆ–HNSWçš„å›¾ç»“æ„</li><li>é‡åŒ–å±‚ï¼šå¯é€‰ï¼Œé€šè¿‡SQ8/PQç­‰ç®—æ³•å‹ç¼©æ•°æ®</li><li>ç²¾ç‚¼å™¨ï¼šå¯¹å€™é€‰ç»“æœè¿›è¡Œç²¾å‡†é‡æ’</li></ul></li><li>æ•°æ®ç»“æ„å±‚ï¼š<ul><li>æ ¸å¿ƒåŠŸèƒ½ï¼šç»„ç»‡æ•°æ®ä»¥åŠ é€Ÿæ£€ç´¢</li><li>å®ç°æ–¹å¼ï¼šèšç±»(IVF)æˆ–å›¾ç½‘ç»œ(HNSW)</li><li>ç‰¹ç‚¹ï¼šåªæ‰«æç›¸å…³å­é›†ï¼Œå¤§å¹…æé«˜æ•ˆç‡</li></ul></li><li>é‡åŒ–æŠ€æœ¯ï¼š<ul><li>ç›®çš„ï¼šå‡å°‘å†…å­˜å’Œè®¡ç®—å¼€é”€</li><li>æ–¹æ³•ï¼šå°†32ä½æµ®ç‚¹å‹ç¼©åˆ°8ä½æˆ–æ›´ä½</li><li>å½±å“ï¼šä¼šå¼•å…¥è¯¯å·®ï¼Œä½†æ˜¾è‘—æå‡é€Ÿåº¦</li></ul></li><li>ç²¾ç‚¼å™¨æœºåˆ¶ï¼š<ul><li>å·¥ä½œæµç¨‹ï¼šå…ˆè·å–topKÃ—æ‰©å±•ç‡çš„å€™é€‰é›†ï¼Œå†ç”¨FP32ç²¾åº¦é‡ç®—è·ç¦»</li><li>ä¼˜åŠ¿ï¼šå¼¥è¡¥é‡åŒ–è¯¯å·®ï¼Œç¡®ä¿æœ€ç»ˆç»“æœè´¨é‡</li><li>ç‰¹ç‚¹ï¼šç±»ä¼¼æ£€ç´¢åå¤„ç†ï¼Œæå‡æ’åºå‡†ç¡®æ€§</li></ul></li><li>è®¾è®¡ç†å¿µï¼š<ul><li>â€œç²—-å¿«-å‡†â€åˆ†å±‚æ¶æ„</li><li>åœ¨æ£€ç´¢æ•ˆç‡å’Œç²¾åº¦é—´å–å¾—æœ€ä½³å¹³è¡¡</li><li>å†…éƒ¨è‡ªåŠ¨å®Œæˆå¤šé˜¶æ®µä¼˜åŒ–</li></ul></li></ul><h1 id="æ€§èƒ½çš„æƒè¡¡"><a href="#æ€§èƒ½çš„æƒè¡¡" class="headerlink" title="æ€§èƒ½çš„æƒè¡¡"></a>æ€§èƒ½çš„æƒè¡¡</h1><p><strong>æ„å»ºæ—¶é—´ vs QPS vs å¬å›ç‡</strong></p><ul><li>åŸºäºå›¾ï¼ˆå¦‚ HNSWï¼‰é€šå¸¸èƒ½æä¾›æœ€é«˜çš„ QPS å’Œä½å»¶è¿Ÿï¼Œå°¤å…¶é€‚åˆ Top-K è¾ƒå°ï¼ˆâ‰¤2 000ï¼‰æˆ–å¯¹é«˜å¬å›ç‡æœ‰éœ€æ±‚çš„åœºæ™¯ã€‚</li><li>IVF ç³»åˆ—ï¼ˆIVF-PQ/SQ8 ç­‰ï¼‰åœ¨ Top-K è¾ƒå¤§ï¼ˆï¼2 000ï¼‰æ—¶æ›´é«˜æ•ˆï¼Œèƒ½å¤Ÿé€šè¿‡èšç±»åˆ†æ¡¶å‡å°‘æ£€ç´¢èŒƒå›´ã€‚</li><li>åœ¨ç›¸åŒå‹ç¼©ç‡ä¸‹ï¼ŒPQ æ¯” SQ8 å¬å›ç‡æ›´é«˜ï¼Œä½† SQ8 çš„æŸ¥è¯¢é€Ÿåº¦ç•¥èƒœä¸€ç­¹ã€‚</li><li>ä½¿ç”¨ DiskANNï¼ˆç£ç›˜ï¼‹PQ é‡åŒ–ï¼‹Vamana å›¾ï¼‰å¯å¤„ç†è¿œè¶…å†…å­˜å®¹é‡çš„æµ·é‡æ•°æ®ï¼Œä½†ä¼šå—åˆ¶äºç£ç›˜ IOPSã€‚</li></ul><p><strong>å®¹é‡ä¸å†…å­˜æ˜ å°„ï¼ˆmmap</strong>ï¼‰</p><ul><li>å¦‚æœæ‰€æœ‰å‘é‡æ•°æ®éƒ½èƒ½è£…è¿›å†…å­˜ï¼Œå¯ä¼˜å…ˆé€‰ç”¨å†…å­˜ç´¢å¼•ï¼ˆHNSWã€IVFï¼‹ç²¾ç‚¼ï¼‰å¹¶é…åˆ mmap ä¼˜åŒ–å¤§æ–‡ä»¶è®¿é—®ã€‚</li><li>å¦‚æœåªæœ‰éƒ¨åˆ†æ•°æ®èƒ½è¿›å†…å­˜ï¼ŒDiskANN æ˜¯æ›´ç¨³çš„ä½å»¶è¿Ÿæ–¹æ¡ˆï¼›IVFPQ/SQ8ï¼‹mmap åˆ™åœ¨æˆæœ¬å’Œç²¾åº¦é—´æä¾›æŠ˜ä¸­ã€‚</li></ul><p><strong>è¿‡æ»¤ç‡ï¼ˆFilter Rateï¼‰ä¸å¬å›ç­–ç•¥</strong></p><ul><li>è¿‡æ»¤ç‡ &lt; 85%ï¼šå›¾ç´¢å¼•æ•ˆæœæœ€ä½³</li><li>85% â‰¤ è¿‡æ»¤ç‡ â‰¤ 95%ï¼šIVF ç³»åˆ—æ›´åˆé€‚</li><li>è¿‡æ»¤ç‡ &gt; 98%ï¼šæš´åŠ›æœç´¢ï¼ˆFLATï¼‰å¯ä¿è¯æœ€é«˜å¬å›</li></ul><p><strong>Top-K å¤§å°å½±å“</strong></p><ul><li>å° top-Kã€é«˜å¬å›ï¼šåŸºäºå›¾</li><li>å¤§ top-Kï¼ˆå æ•°æ®é›† â‰¥ 1%ï¼‰ï¼šIVF ç³»åˆ—</li><li>æé«˜å¬å›ç‡ï¼ˆï¼ 99%ï¼‰ï¼šFLATï¼‹GPU é‡ç®—</li></ul><p>æ€»ç»“ï¼š</p><ol><li>æ„å»ºæ—¶é—´ vs QPS vs å¬å›ç‡<ul><li>åŸºäºå›¾çš„ç´¢å¼•ä¼˜åŠ¿ï¼šåœ¨Top-Kè¾ƒå°ï¼ˆï»¿$\leq 2000$ï»¿ï¼‰æˆ–éœ€è¦é«˜å¬å›ç‡æ—¶ï¼ŒHNSWç­‰å›¾ç»“æ„èƒ½æä¾›æœ€é«˜QPSå’Œæœ€ä½å»¶è¿Ÿã€‚</li><li>IVFç³»åˆ—é€‚ç”¨åœºæ™¯ï¼šå½“Top-Kè¾ƒå¤§ï¼ˆ$&gt; 2000$ï»¿ï¼‰æ—¶ï¼ŒIVF-PQ/SQ8é€šè¿‡èšç±»åˆ†æ¡¶å‡å°‘æ£€ç´¢èŒƒå›´æ›´é«˜æ•ˆã€‚</li><li>PQä¸SQ8å¯¹æ¯”ï¼šç›¸åŒå‹ç¼©ç‡ä¸‹PQå¬å›ç‡æ›´é«˜ï¼Œä½†SQ8æŸ¥è¯¢é€Ÿåº¦æ›´å¿«ã€‚</li><li>DiskANNç‰¹ç‚¹ï¼šé‡‡ç”¨ç£ç›˜å­˜å‚¨+PQé‡åŒ–+Vamanaå›¾ç»“æ„å¯å¤„ç†è¶…å†…å­˜æ•°æ®ï¼Œä½†æ€§èƒ½å—ç£ç›˜IOPSé™åˆ¶ã€‚</li></ul></li><li>å®¹é‡ä¸å†…å­˜æ˜ å°„<ul><li>å…¨å†…å­˜åœºæ™¯ï¼šä¼˜å…ˆé€‰æ‹©HNSWæˆ–IVF+ç²¾ç‚¼ç´¢å¼•ï¼Œé…åˆmmapä¼˜åŒ–å¤§æ–‡ä»¶è®¿é—®ã€‚</li><li>éƒ¨åˆ†å†…å­˜åœºæ™¯ï¼š<ul><li>DiskANNæ˜¯ä½å»¶è¿Ÿç¨³å®šæ–¹æ¡ˆ</li><li>VFPQ/SQ8+mmapåœ¨æˆæœ¬ä¸ç²¾åº¦é—´æä¾›æŠ˜ä¸­æ–¹æ¡ˆ</li></ul></li></ul></li><li>è¿‡æ»¤ç‡ä¸å¬å›ç­–ç•¥<ul><li>ä½è¿‡æ»¤ç‡ï¼ˆ&lt;85%ï¼‰ï¼šå›¾ç´¢å¼•æ•ˆæœæœ€ä½³</li><li>ä¸­è¿‡æ»¤ç‡ï¼ˆ85%-95%ï¼‰ï¼šIVFç³»åˆ—æ›´åˆé€‚</li><li>æé«˜è¿‡æ»¤ç‡ï¼ˆ&gt;98%ï¼‰ï¼šæš´åŠ›æœç´¢(FLAT)å¯ä¿è¯æœ€é«˜å¬å›</li></ul></li><li>Top-Kå¤§å°å½±å“<ul><li>å°top-Ké«˜å¬å›ï¼šåŸºäºå›¾ç»“æ„</li><li>å¤§top-Kï¼ˆâ‰¥æ•°æ®é›†1%ï¼‰ï¼šIVFç³»åˆ—</li><li>æé«˜å¬å›ç‡ï¼ˆ&gt;99%ï¼‰ï¼šFLAT+GPUé‡ç®—</li></ul></li></ol><h1 id="æ¡ˆä¾‹ï¼šå†…å­˜ä¼°ç®—ï¼ˆä»¥-1-ç™¾ä¸‡æ¡-128-ç»´å‘é‡ä¸ºä¾‹ï¼‰"><a href="#æ¡ˆä¾‹ï¼šå†…å­˜ä¼°ç®—ï¼ˆä»¥-1-ç™¾ä¸‡æ¡-128-ç»´å‘é‡ä¸ºä¾‹ï¼‰" class="headerlink" title="æ¡ˆä¾‹ï¼šå†…å­˜ä¼°ç®—ï¼ˆä»¥ 1 ç™¾ä¸‡æ¡ 128 ç»´å‘é‡ä¸ºä¾‹ï¼‰"></a>æ¡ˆä¾‹ï¼šå†…å­˜ä¼°ç®—ï¼ˆä»¥ 1 ç™¾ä¸‡æ¡ 128 ç»´å‘é‡ä¸ºä¾‹ï¼‰</h1><div class="table-container"><table><thead><tr><th>ç´¢å¼•ç±»å‹</th><th>ç»„æˆ</th><th>å†…å­˜æ¶ˆè€—</th></tr></thead><tbody><tr><td>IVF-PQ</td><td>è´¨å¿ƒ(2 000x128x4 B)=1 MB<br/>ç°‡åˆ†é…(1 000 000x2 B)=2 MB<br/>PQ(1 000 000x8 B)=8 MB</td><td>â‰ˆ11 MB</td></tr><tr><td>IVF-PQ + 10% ç²¾ç‚¼</td><td>IVF-PQ(11 MB)+ç²¾ç‚¼ç¼“å­˜(1 000 000x128 x 0.1 x4 B)=51.2 MB</td><td>â‰ˆ62 MB</td></tr><tr><td>IVF-SQ8</td><td>è´¨å¿ƒ(1 MB)+ç°‡åˆ†é…(2 MB)+SQ8(1 000 000x128 x 1 B)=128 MB</td><td>â‰ˆ131 MB</td></tr><tr><td>IVF-FLAT</td><td>è´¨å¿ƒ(1 MB)+ç°‡åˆ†é…(2 MB)+åŸå§‹å‘é‡(1 000 000x128x4 B)=512 MB</td><td>â‰ˆ515 MB</td></tr><tr><td>HNSW</td><td>å›¾ç»“æ„(1 000 000x32x4 B)=128 MB<br/>åŸå§‹å‘é‡=512 MB</td><td>â‰ˆ640 MB</td></tr><tr><td>HNSW-PQ</td><td>å›¾ç»“æ„(128 MB)+PQ(1 000 000x8 B)=8 MB</td><td>â‰ˆ136 MB</td></tr></tbody></table></div><ul><li>IVF-PQï¼š11MBï¼ˆè´¨å¿ƒ1MB + ç°‡åˆ†é…2MB + PQç¼–ç 8MBï¼‰</li><li>IVF-PQ+10%ç²¾ç‚¼ï¼š62MBï¼ˆåŸºç¡€11MB + ç²¾ç‚¼ç¼“å­˜51.2MBï¼‰</li><li>IVF-SQ8ï¼š131MBï¼ˆè´¨å¿ƒ1MB + ç°‡åˆ†é…2MB + SQ8ç¼–ç 128MBï¼‰</li><li>IVF-FLATï¼š515MBï¼ˆå«åŸå§‹å‘é‡å­˜å‚¨ï¼‰</li><li>HNSWï¼š&lt;640MBï¼ˆå›¾ç»“æ„128MB + åŸå§‹å‘é‡512MBï¼‰</li><li>HNSW-PQï¼š136MBï¼ˆå›¾ç»“æ„128MB + PQç¼–ç 8MBï¼‰</li><li>ä¼°ç®—æ–¹æ³•ï¼šæ ¹æ®å®é™…æ•°æ®é‡å‚ç…§è¡¨æ ¼æ¯”ä¾‹è®¡ç®—ï¼Œéœ€ç»“åˆå¯ç”¨å†…å­˜é€‰æ‹©åˆé€‚ç´¢å¼•ç±»å‹ã€‚å·¥ä¸šé¡¹ç›®ä¸­éœ€æŸ¥é˜…æ–‡æ¡£è·å–æ›´ç²¾ç¡®çš„å†…å­˜æ˜ å°„ç®—æ³•å‚æ•°ã€‚</li></ul>]]></content>
    
    
    <summary type="html">å­¦ä¹ å¤§æ¨¡å‹RAGç³»ç»Ÿå­¦ä¹ ç¬”è®°ç¬¬äºŒåä¸€è®²</summary>
    
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>RAGç»„ä»¶--å‘é‡æ•°æ®åº“ä»‹ç»</title>
    <link href="https://jinglv.github.io/2025/08/18/ai/rag/19-vector-db/"/>
    <id>https://jinglv.github.io/2025/08/18/ai/rag/19-vector-db/</id>
    <published>2025-08-17T16:00:00.000Z</published>
    <updated>2025-08-18T02:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‘é‡å­˜å‚¨"><a href="#å‘é‡å­˜å‚¨" class="headerlink" title="å‘é‡å­˜å‚¨"></a>å‘é‡å­˜å‚¨</h1><h2 id="ç»“æ„åŒ–æ•°æ®vså‘é‡æ•°æ®"><a href="#ç»“æ„åŒ–æ•°æ®vså‘é‡æ•°æ®" class="headerlink" title="ç»“æ„åŒ–æ•°æ®vså‘é‡æ•°æ®"></a>ç»“æ„åŒ–æ•°æ®vså‘é‡æ•°æ®</h2><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250818104425937.png" alt="image-20250818104425937" style="zoom:50%;" /></p><ul><li>ç»“æ„åŒ–æ•°æ®å­˜å‚¨ï¼šé€šè¿‡æ•°æ®åº“è¡¨ç»“æ„å­˜å‚¨ï¼Œä½¿ç”¨ä¸»é”®å’Œå¤–é”®ç›¸äº’é“¾æ¥å½¢æˆå¤æ‚schema</li><li>éç»“æ„åŒ–æ•°æ®è½¬æ¢ï¼šæ–‡æœ¬/å›¾ç‰‡/éŸ³é¢‘ç­‰é€šè¿‡åµŒå…¥æ¨¡å‹è½¬åŒ–ä¸ºæ•°å­—å½¢å¼çš„å‘é‡</li><li>å­˜å‚¨æ–¹å¼å·®å¼‚ï¼š<ul><li>ç»“æ„åŒ–ï¼šä¼ ç»ŸSQLæ•°æ®åº“è¡¨å½¢å¼ï¼ˆå¦‚SQL Serverï¼‰</li><li>å‘é‡æ•°æ®ï¼šé€šè¿‡åµŒå…¥æ¨¡å‹è½¬æ¢åå­˜å‚¨åœ¨å‘é‡æ•°æ®åº“</li></ul></li></ul><h2 id="ç®€å•çš„å‘é‡å­˜å‚¨"><a href="#ç®€å•çš„å‘é‡å­˜å‚¨" class="headerlink" title="ç®€å•çš„å‘é‡å­˜å‚¨"></a>ç®€å•çš„å‘é‡å­˜å‚¨</h2><p>ä½¿ç”¨LlamaIndexçš„index.storage_context.persist(persist_dir=â€saved_indexâ€) å°†å‘é‡ç´¢å¼•ä¿å­˜åˆ°ç£ç›˜</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core.node_parser <span class="keyword">import</span> SentenceSplitter</span><br><span class="line"></span><br><span class="line">text_splitter = SentenceSplitter(chunk_size=<span class="number">512</span>, chunk_overlap=<span class="number">10</span>)</span><br><span class="line">nodes = text_splitter.get_nodes_from_documents(documents)</span><br><span class="line">index = VectorStoreIndex(nodes, embed_model=embed_model) <span class="comment"># ä»nodesä¸­ç”ŸæˆIndex</span></span><br><span class="line"><span class="comment"># ä¿å­˜ç´¢å¼•åˆ°ç£ç›˜</span></span><br><span class="line">index.storage_context.persist(persist_dir=<span class="string">&quot;saved_index&quot;</span>)</span><br></pre></td></tr></table></figure><p>æ­¤å†™æ³•ä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç›®å½•ä¸ºsaved_indexï¼Œå°†å‘é‡ç´¢å¼•çš„å†…å®¹å­˜å‚¨åˆ°è¯¥ç›®å½•ä¸‹ã€‚</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250818111917272.png" alt="image-20250818111917272" style="zoom:67%;" /></p><ul><li>æœ¬åœ°å­˜å‚¨å®ç°ï¼š<ul><li>ä½¿ç”¨storage_context.persist(persist_dir=â€saved_indexâ€)è¯­å¥</li><li>ç”Ÿæˆ5ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼š<ul><li>default_vector_store.jsonï¼ˆå‘é‡æ•°æ®ï¼‰</li><li>docstore.jsonï¼ˆæ–‡æ¡£å…³ç³»ï¼‰</li><li>graph_store.jsonï¼ˆå›¾ç»“æ„ï¼‰</li><li>image_vector_store.jsonï¼ˆå›¾åƒå‘é‡ï¼‰</li><li>index_store.jsonï¼ˆç´¢å¼•ç»“æ„ï¼‰</li></ul></li></ul></li><li>æ–‡ä»¶åŠŸèƒ½ï¼š<ul><li>index_store.jsonï¼šè®°å½•æ‰€æœ‰èŠ‚ç‚¹IDå’Œç´¢å¼•å…ƒæ•°æ®</li><li>docstore.jsonï¼šå­˜å‚¨æ–‡æ¡£å—é—´çš„å‰åå…³ç³»ï¼ˆå¦‚relationshipå­—æ®µï¼‰</li></ul></li><li>èŠ‚ç‚¹å…³ç³»è¡¨ç¤ºï¼š<ul><li>é€šè¿‡node_idå’Œnode_typeå­—æ®µå»ºç«‹å…³è”</li><li>ç¤ºä¾‹ï¼šrelationship â€œ3â€è¡¨ç¤ºåç»­èŠ‚ç‚¹å…³ç³»</li><li>åŒ…å«åŸå§‹æ–‡æ¡£å…ƒæ•°æ®ï¼ˆæ–‡ä»¶è·¯å¾„ã€åˆ›å»ºæ—¶é—´ç­‰ï¼‰</li></ul></li></ul><h1 id="ä»ç®€å•å‘é‡å­˜å‚¨åˆ°å•†ç”¨å‘é‡æ•°æ®åº“"><a href="#ä»ç®€å•å‘é‡å­˜å‚¨åˆ°å•†ç”¨å‘é‡æ•°æ®åº“" class="headerlink" title="ä»ç®€å•å‘é‡å­˜å‚¨åˆ°å•†ç”¨å‘é‡æ•°æ®åº“"></a>ä»ç®€å•å‘é‡å­˜å‚¨åˆ°å•†ç”¨å‘é‡æ•°æ®åº“</h1><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250815103626944.png" alt="image-20250815103626944"></p><p>Milvusæä¾›3ç§éƒ¨ç½²æ¨¡å¼ï¼Œé€‚ç”¨äºä»ç®€å•åº”ç”¨åˆ°ç®¡ç†æ•°ç™¾äº¿å‘é‡çš„å¤§è§„æ¨¡Kubernetesé›†ç¾¤çš„æ•°æ®è§„æ¨¡ã€‚</p><ul><li>Milvus Liteä½œä¸ºMilvusçš„è½»é‡çº§ç‰ˆæœ¬ï¼Œæ˜“äºé›†æˆåˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œæœ¬ä¹¦å°†ä»¥å®ƒä¸ºä¾‹è¿›è¡Œä»‹ç»ã€‚</li><li>Milvus Standaloneæ˜¯Milvusçš„å•æœºæœåŠ¡å™¨ç‰ˆæœ¬ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½æ‰“åŒ…åœ¨ä¸€ä¸ªDockeré•œåƒä¸­ï¼Œä¾¿äºéƒ¨ç½²ã€‚</li><li>Milvus Distributedå¯ä»¥éƒ¨ç½²åœ¨Kubernetesé›†ç¾¤ä¸Šï¼Œæ”¯æŒåäº¿çº§å‘é‡ç”šè‡³æ›´å¤§è§„æ¨¡åœºæ™¯çš„äº‘åŸç”Ÿæ¶æ„ã€‚</li></ul><h1 id="å•†ç”¨å‘é‡æ•°æ®åº“çš„æ ¸å¿ƒåŠŸèƒ½"><a href="#å•†ç”¨å‘é‡æ•°æ®åº“çš„æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="å•†ç”¨å‘é‡æ•°æ®åº“çš„æ ¸å¿ƒåŠŸèƒ½"></a>å•†ç”¨å‘é‡æ•°æ®åº“çš„æ ¸å¿ƒåŠŸèƒ½</h1><div class="table-container"><table><thead><tr><th>åŠŸèƒ½</th><th>æè¿°</th></tr></thead><tbody><tr><td><strong>æ€§èƒ½å’Œå®¹é”™</strong></td><td>åˆ†ç‰‡ï¼Œåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šå¯¹æ•°æ®è¿›è¡Œåˆ†åŒº; å¤åˆ¶ï¼Œåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šåˆ›å»ºå¤šä¸ªæ•°æ®å‰¯æœ¬ã€‚å‘ç”Ÿæ•…éšœæ—¶å¯ç”¨å®¹é”™æœºåˆ¶ï¼Œç¡®ä¿æ€§èƒ½ç¨³å®š</td></tr><tr><td><strong>ç›‘æµ‹</strong></td><td>ç›‘æµ‹èµ„æºä½¿ç”¨æƒ…å†µã€æŸ¥è¯¢æ€§èƒ½åŠç³»ç»Ÿè¿è¡ŒçŠ¶å†µï¼ŒæŒç»­ä¼˜åŒ–æ€§èƒ½å’Œå®¹é”™æ€§</td></tr><tr><td><strong>è®¿é—®æ§åˆ¶</strong></td><td>ç¡®ä¿æ•°æ®å®‰å…¨ï¼Œæä¾›åˆè§„æ€§ã€é—®è´£åˆ¶åŠå®¡è®¡èƒ½åŠ›; ä¿æŠ¤æ•°æ®å…å—æœªç»æˆæƒè®¿é—®ï¼Œå¹¶è®°å½•ç”¨æˆ·æ´»åŠ¨</td></tr><tr><td><strong>å¯æ‰©å±•æ€§ä¸å¯è°ƒæ€§</strong></td><td>æ”¯æŒæ¨ªå‘æ‰©å±•ï¼Œé€‚åº”ä¸åŒçš„æ’å…¥ç‡ã€æŸ¥è¯¢ç‡åŠç¡¬ä»¶å·®å¼‚</td></tr><tr><td><strong>å¤šç”¨æˆ·å’Œæ•°æ®éš”ç¦»</strong></td><td>æ”¯æŒå¤šç”¨æˆ·æˆ–å¤šç§Ÿæˆ·; å®ç°æ•°æ®éš”ç¦»ï¼Œç¡®ä¿ç”¨æˆ·æ´»åŠ¨ (å¦‚æ’å…¥ã€åˆ é™¤æŸ¥è¯¢) ä¸å½±å“å…¶ä»–ç”¨æˆ·çš„ç§å¯†æ•°æ®</td></tr><tr><td><strong>å¤‡ä»½</strong></td><td>å®šæœŸåˆ›å»ºæ•°æ®å¤‡ä»½; æ”¯æŒåœ¨æ•°æ®ä¸¢å¤±æˆ–æŸåæ—¶æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼Œå‡å°‘ä¸­æ–­æ—¶é—´</td></tr><tr><td><strong>APIå’ŒSDK</strong></td><td>æä¾›æ˜“äºæ“ä½œçš„API; å°è£…å¤šä¸ªAPIï¼Œæ–¹ä¾¿å¼€å‘è€…åœ¨ç‰¹å®šç”¨ä¾‹ (å¦‚è¯­ä¹‰æœç´¢ã€æ¨èç³»ç»Ÿç­‰) ä¸­ä½¿ç”¨å‘é‡æ•°æ®åº“ï¼Œä¸éœ€è¦å…³æ³¨åº•å±‚ç»“æ„</td></tr></tbody></table></div><ul><li>å…³é”®èƒ½åŠ›ï¼š<ul><li>åˆ†ç‰‡ä¸å¤åˆ¶ï¼šæ•°æ®åˆ†åŒºå­˜å‚¨å’Œå®¹é”™æœºåˆ¶</li><li>è®¿é—®æ§åˆ¶ï¼šåˆè§„å®¡è®¡å’Œå®‰å…¨é˜²æŠ¤</li><li>æ¨ªå‘æ‰©å±•ï¼šé€‚åº”ä¸åŒç¡¬ä»¶å’Œè´Ÿè½½</li><li>å¤šç§Ÿæˆ·éš”ç¦»ï¼šä¿è¯ç”¨æˆ·æ•°æ®ç§å¯†æ€§</li></ul></li><li>é€‰å‹è€ƒé‡ï¼š<ul><li>ç¤¾åŒºæ´»è·ƒåº¦ï¼ˆå¦‚PyTorchå¼ç”Ÿæ€ï¼‰</li><li>API/SDKå®Œå–„ç¨‹åº¦</li><li>ç›‘æ§å’Œå¤‡ä»½èƒ½åŠ›</li><li>æ£€ç´¢ç®—æ³•å¤šæ ·æ€§ï¼ˆå“ˆå¸Œ/é‡åŒ–/å›¾æœç´¢ï¼‰</li></ul></li></ul><h1 id="ä¸»æµå‘é‡æ•°æ®åº“ä¸€è§ˆ"><a href="#ä¸»æµå‘é‡æ•°æ®åº“ä¸€è§ˆ" class="headerlink" title="ä¸»æµå‘é‡æ•°æ®åº“ä¸€è§ˆ"></a>ä¸»æµå‘é‡æ•°æ®åº“ä¸€è§ˆ</h1><h2 id="å„ç§å„æ ·çš„å‘é‡æ•°æ®åº“"><a href="#å„ç§å„æ ·çš„å‘é‡æ•°æ®åº“" class="headerlink" title="å„ç§å„æ ·çš„å‘é‡æ•°æ®åº“"></a>å„ç§å„æ ·çš„å‘é‡æ•°æ®åº“</h2><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250818134520067.png" alt="image-20250818134520067" style="zoom:67%;" /></p><p>å¸‚åœºç°çŠ¶: ç›®å‰å¸‚é¢ä¸Šå­˜åœ¨å¤šç§å‘é‡æ•°æ®åº“é€‰æ‹©ï¼ŒåŒ…æ‹¬FAISSã€Milvusã€Weaviateã€Qdrantã€Elasticã€Chromaç­‰ï¼Œé€‰æ‹©æ—¶éœ€è¦è¿›è¡Œæ¯”è¾ƒåˆ†æ</p><h3 id="1-Milvus"><a href="#1-Milvus" class="headerlink" title="1. Milvus"></a>1. Milvus</h3><p>æ ¸å¿ƒåŠŸèƒ½ï¼š</p><ul><li>é«˜æ€§èƒ½åˆ†å¸ƒå¼å‘é‡æ£€ç´¢ï¼Œæ”¯æŒIVFã€HNSWã€ANNOYã€DiskANNç­‰å¤šç§ç´¢å¼•</li><li>æ¨ªå‘å¯æ‰©å±•è‡³1000+èŠ‚ç‚¹é›†ç¾¤</li><li>æ”¯æŒåŠ¨æ€å­—æ®µã€åˆ†åŒºå’Œå¹¶è¡ŒæŸ¥è¯¢</li></ul><p>ç‰¹ç‚¹ï¼š</p><ul><li>æ¨ªå‘å¯ä¼¸ç¼©ã€æ”¯æŒ 1000+ èŠ‚ç‚¹é›†ç¾¤</li><li>ä¸°å¯Œçš„ metricï¼ˆCOSINE/L2/IPï¼‰å’Œç´¢å¼•ç±»å‹</li><li>æ”¯æŒåŠ¨æ€å­—æ®µã€åˆ†åŒºã€å¹¶è¡ŒæŸ¥è¯¢</li></ul><p>ä¼˜åŠ¿ï¼šä¼ä¸šçº§ SLAï¼Œæµ·é‡æ•°æ®ï¼ˆ10â¸+ï¼‰æ€§èƒ½å‡ºè‰²ï¼›ç¤¾åŒºæ´»è·ƒï¼Œç”Ÿæ€å®Œå–„ã€‚</p><p>åŠ£åŠ¿ï¼šè¿ç»´ç›¸å¯¹å¤æ‚ï¼›å¯¹å°è§„æ¨¡å•æœºéƒ¨ç½²ç•¥æ˜¾é‡ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šå¤§è§„æ¨¡ã€å¤šå¹¶å‘æ£€ç´¢ï¼›éœ€è¦å¤æ‚è¿‡æ»¤ã€å®æ—¶å¢é‡å†™å…¥çš„ç”Ÿäº§ç¯å¢ƒã€‚</p><p>é€‰å‹å»ºè®®ï¼šæ•°æ®é‡ â‰¥1äº¿ã€å¯¹ååå’Œå¯ç”¨æ€§è¦æ±‚é«˜æ—¶é¦–é€‰ã€‚</p><h3 id="2-Weaviate"><a href="#2-Weaviate" class="headerlink" title="2. Weaviate"></a>2. Weaviate</h3><p>æ ¸å¿ƒåŠŸèƒ½ï¼šAny-to-Any å¤šæ¨¡æ€æ£€ç´¢ï¼ˆnearText/nearImage/nearVectorï¼‰ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>åŸç”Ÿ GraphQL æ¥å£</li><li>å†…ç½®å¦‚ CLIPã€ImageBindã€OpenAI Embeddings ç­‰æ¨¡å‹</li><li>è‡ªåŠ¨ schema ç®¡ç†ä¸å‘é‡åŒ–ç®¡é“</li></ul><p>ä¼˜åŠ¿ï¼šä¸Šæ‰‹å¿«ã€æ— éœ€é¢å¤–æ¨¡å‹æ¥å…¥ï¼›å¤šæ¨¡æ€æŸ¥è¯¢ç»Ÿä¸€ APIã€‚</p><p>åŠ£åŠ¿ï¼šé›†ç¾¤æ‰©å±•æ€§å¼±äº Milvusï¼›ä¼ä¸šçº§æ€§èƒ½éœ€å•†ä¸šç‰ˆã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šPoC éªŒè¯ã€å¤šæ¨¡æ€å®éªŒã€å¿«é€Ÿä¸Šçº¿ MVPã€‚</p><p>é€‰å‹å»ºè®®ï¼šå›¢é˜Ÿå¸Œæœ›é›¶è¿ç»´ï¼Œæƒ³â€œå¼€ç®±å³ç”¨â€æ—¶æ¨è</p><h3 id="3-Qdrant"><a href="#3-Qdrant" class="headerlink" title="3. Qdrant"></a>3. Qdrant</h3><p>æ ¸å¿ƒåŠŸèƒ½ï¼š</p><ul><li>å‘é‡æ£€ç´¢+é«˜æ•ˆè¿‡æ»¤(Single-Stage Filtering/Hybrid Search)</li><li>Rustå†…æ ¸ï¼Œå•èŠ‚ç‚¹æˆ–å°é›†ç¾¤æ€§èƒ½ä¼˜å¼‚</li><li>æ”¯æŒå¤šå‘é‡å­—æ®µå’Œåˆ†æ®µç´¢å¼•</li></ul><p>ç‰¹ç‚¹ï¼š</p><ul><li>Rust å†…æ ¸ã€å•èŠ‚ç‚¹æˆ–å°é›†ç¾¤æ€§èƒ½ä¼˜</li><li>æ”¯æŒå¤šå‘é‡å­—æ®µå’Œåˆ†æ®µç´¢å¼•</li><li>ä¸°å¯Œçš„äºŒçº§è¿‡æ»¤ä¸å¸ƒå°”æŸ¥è¯¢</li></ul><p>ä¼˜åŠ¿ï¼šå»¶è¿Ÿä½ã€ååé«˜ï¼›å¯¹å¤æ‚è¿‡æ»¤æ¡ä»¶æ€§èƒ½å‹å¥½ã€‚</p><p>åŠ£åŠ¿ï¼šå¤§è§„æ¨¡åˆ†å¸ƒå¼éƒ¨ç½²æ–¹æ¡ˆè¾ƒæ–°ï¼Œéœ€è¦è‡ªè¡Œæ‰“ç£¨ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šå¯¹è¿‡æ»¤/å¸ƒå°”æŸ¥è¯¢ä¾èµ–åº¦é«˜çš„è¯­ä¹‰æœç´¢ï¼›ä¸­å°è§„æ¨¡é›†ç¾¤ã€‚</p><p>é€‰å‹å»ºè®®ï¼šéœ€è¦åœ¨è¯­ä¹‰å¬å›ä¸ç²¾ç¡®è¿‡æ»¤é—´å¹³è¡¡æ—¶ä¼˜é€‰</p><h3 id="4-Pinecone"><a href="#4-Pinecone" class="headerlink" title="4. Pinecone"></a>4. Pinecone</h3><p>æ ¸å¿ƒåŠŸèƒ½ï¼šå…¨æ‰˜ç®¡ã€é«˜å¯ç”¨å‘é‡æ•°æ®åº“ï¼›æ”¯æŒ hybrid searchã€namespace å¤šç§Ÿæˆ·ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>Serverlessï¼Œè‡ªåŠ¨æ‰©ç¼©å®¹</li><li>æ”¯æŒç¨€ç–+ç¨ å¯†æ··åˆæ£€ç´¢</li></ul><p>ä¼˜åŠ¿ï¼šæä½è¿ç»´é—¨æ§›ï¼›SDK å‹å¥½ï¼Œä¼ä¸šçº§ SLAã€‚</p><p>åŠ£åŠ¿ï¼šæˆæœ¬éšå­˜å‚¨/QPS å¢é•¿ï¼›ç½‘ç»œå»¶è¿Ÿä¾èµ–äº‘å‚å•†ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šå¿«é€Ÿä¸Šçº¿å¤§è§„æ¨¡æ£€ç´¢æœåŠ¡ï¼›ä¸æƒ³è‡ªå»ºé›†ç¾¤çš„ä¸šåŠ¡ã€‚</p><p>é€‰å‹å»ºè®®ï¼šé¡¹ç›®åˆæœŸæˆ–çŸ­æœŸ PoCï¼ŒåŠå¯¹è¿ç»´å›¢é˜Ÿå°‘çš„å…¬å¸ä¼˜é€‰ã€‚</p><h3 id="5-Chroma"><a href="#5-Chroma" class="headerlink" title="5. Chroma"></a>5. Chroma</h3><p>æ ¸å¿ƒåŠŸèƒ½ï¼šè½»é‡çº§ã€æœ¬åœ°åŒ–å‘é‡å­˜å‚¨ï¼›é€‚åˆå¼€å‘è€…æœ¬åœ°è°ƒè¯•ä¸å°è§„æ¨¡åº”ç”¨ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>Python åŸç”Ÿï¼ŒAPI ä¸æ–‡æ¡£å‹å¥½</li><li>æ”¯æŒ SQLiteã€DuckDB ç­‰åç«¯å­˜å‚¨</li></ul><p>ä¼˜åŠ¿ï¼šé›¶è¿ç»´ï¼Œç›´æ¥å†…åµŒåˆ°åº”ç”¨ä¸­ï¼›éå¸¸é€‚åˆæœ¬åœ°æµ‹è¯•æˆ–æ¡Œé¢åº”ç”¨ã€‚</p><p>åŠ£åŠ¿ï¼šä¸é€‚åˆå¤§è§„æ¨¡ã€åˆ†å¸ƒå¼åœºæ™¯ï¼›åŠŸèƒ½ç›¸å¯¹åŸºç¡€ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šåŸå‹å¼€å‘ã€Notebook ç¯å¢ƒã€æ¡Œé¢/å°å‹æœåŠ¡ã€‚</p><p>é€‰å‹å»ºè®®ï¼šæ•°æ®é‡ &lt;10ä¸‡ï¼Œå›¢é˜Ÿæ— è¿ç»´æˆæœ¬æ—¶ä¼˜é€‰ã€‚</p><h3 id="6-Faiss"><a href="#6-Faiss" class="headerlink" title="6. Faiss"></a>6. Faiss</h3><p>æ ¸å¿ƒåŠŸèƒ½ï¼šFacebook å¼€æºçš„é«˜æ•ˆå‘é‡è¿‘é‚»åº“ï¼›æ”¯æŒ CPU/GPU ç®—æ³•ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>ä¸°å¯Œçš„ç´¢å¼•ç±»å‹ï¼ˆIVFã€PQã€HNSWã€LSHï¼‰</li><li>ä»£ç çº§å¯æ§ï¼Œé€‚åˆé›†æˆåˆ°è‡ªç ”ç³»ç»Ÿä¸­</li></ul><p>ä¼˜åŠ¿ï¼šæ€§èƒ½æœ€ä¼˜ã€ç®—æ³•å‰æ²¿ï¼›GPU åŠ é€Ÿæ•ˆæœæ˜¾è‘—ã€‚</p><p>åŠ£åŠ¿ï¼šä»…æä¾›åº“ï¼Œä¸å«å­˜å‚¨å±‚ï¼›éœ€è¦è‡ªè¡Œå®ç°æ•°æ®ç®¡ç†ã€åˆ†å¸ƒå¼ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šå¯¹ç®—æ³•è°ƒä¼˜æœ‰æ·±åº¦éœ€æ±‚çš„ç§‘ç ”æˆ–è‡ªç ”å¼•æ“ã€‚</p><p>é€‰å‹å»ºè®®ï¼šå…·å¤‡ ML/ç®—æ³•å›¢é˜Ÿï¼Œéœ€æè‡´æ€§èƒ½ä¸”æ„¿æ„è‡ªè¡Œå°è£…å­˜å‚¨æ—¶é€‰ã€‚</p><h3 id="7-Vespa"><a href="#7-Vespa" class="headerlink" title="7. Vespa"></a>7. Vespa</h3><p>æ ¸å¿ƒåŠŸèƒ½ï¼šå¤§è§„æ¨¡åˆ†å¸ƒå¼æ£€ç´¢ä¸å®æ—¶è®¡ç®—ï¼›æ”¯æŒå¤šå‘é‡å­—æ®µã€å¤æ‚ rankingã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>å†…ç½®æœºå™¨å­¦ä¹ æ¨¡å‹éƒ¨ç½²ï¼ˆJava/Pythonï¼‰</li><li>æ”¯æŒåœ¨çº¿è®­ç»ƒä¸åœ¨çº¿æ¨ç†</li></ul><p>ä¼˜åŠ¿ï¼šä¼ä¸šçº§ç‰¹æ€§å®Œå–„ï¼›æŸ¥è¯¢ååä¸æ’åºèƒ½åŠ›å¼ºã€‚</p><p>åŠ£åŠ¿ï¼šå­¦ä¹ æ›²çº¿é™¡å³­ï¼›é›†ç¾¤éƒ¨ç½²ä¸è¿ç»´æˆæœ¬é«˜ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šç”µå•†æ¨èã€æ–°é—»æ’åºã€å¹¿å‘Šæ’åç­‰å¤æ‚æ£€ç´¢ä¸æ’åºåœºæ™¯ã€‚</p><p>é€‰å‹å»ºè®®ï¼šéœ€è¦è‡ªå®šä¹‰å¤æ‚æ’åå‡½æ•°ã€åœ¨çº¿æ¨¡å‹æœåŠ¡çš„åœºæ™¯ä¼˜é€‰ã€‚</p><h3 id="8-Elasticsearch"><a href="#8-Elasticsearch" class="headerlink" title="8. Elasticsearch"></a>8. Elasticsearch</h3><p>æ ¸å¿ƒåŠŸèƒ½ï¼šå…¨æ–‡æ£€ç´¢ï¼‹å‘é‡æ£€ç´¢æ··åˆï¼›æ”¯æŒ BM25 + kNNã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>å…¼å®¹åŸæœ‰æœç´¢å¼•æ“ç”Ÿæ€</li><li>å¯åœ¨åŒä¸€æ¬¡æŸ¥è¯¢ä¸­åŒæ—¶æ‰§è¡Œ sparse &amp; dense æ£€ç´¢</li><li>æ’ä»¶å¼æ‰©å±•ï¼ˆè‡ªå®šä¹‰è„šæœ¬ã€rank_featureï¼‰</li></ul><p>ä¼˜åŠ¿ï¼šæ— ç¼æ¥å…¥å·²æœ‰æ—¥å¿—/æŒ‡æ ‡å¹³å°ï¼›ç¤¾åŒºå’Œå•†ä¸šæ”¯æŒæˆç†Ÿã€‚</p><p>åŠ£åŠ¿ï¼šå‘é‡æ£€ç´¢æ€§èƒ½ä¸åŠä¸“ç”¨åº“ï¼›ç´¢å¼•ä½“ç§¯å¤§ï¼Œå†…å­˜æ¶ˆè€—é«˜ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šå·²æœ‰ ES é›†ç¾¤ï¼Œæƒ³å¢é‡åŠ å¯†å‘é‡æœç´¢ï¼›å¯¹å…¨æ–‡ä¸å‘é‡æ··åˆæ£€ç´¢æœ‰éœ€æ±‚ã€‚</p><p>é€‰å‹å»ºè®®ï¼šå·²æœ‰ Elastic éƒ¨ç½²ï¼Œæ— éœ€é¢å¤–è¿ç»´å›¢é˜Ÿæ—¶å¯è€ƒè™‘ã€‚</p><h3 id="9-MongoDB-Atlas-Vector-Search"><a href="#9-MongoDB-Atlas-Vector-Search" class="headerlink" title="9. MongoDB Atlas Vector Search"></a>9. MongoDB Atlas Vector Search</h3><p>æ ¸å¿ƒåŠŸèƒ½ï¼šAtlas æ‰˜ç®¡çš„å‘é‡æ£€ç´¢ï¼›é›†æˆå…¨æ–‡ç´¢å¼•ä¸åœ°ç†ä½ç½®ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>æ— ç¼ä¸ MongoDB æ–‡æ¡£æ•°æ®è”åŠ¨</li><li>Atlas Serverless å¯æŒ‰éœ€æ‰©å±•</li></ul><p>ä¼˜åŠ¿ï¼šå®Œå…¨æ‰˜ç®¡ï¼Œé›¶è¿ç»´ï¼›å¯ä»¥åˆ©ç”¨å¹³å°ç›‘æ§ä¸å®‰å…¨ç‰¹æ€§ã€‚</p><p>åŠ£åŠ¿ï¼šæˆæœ¬è¾ƒé«˜ï¼›æ£€ç´¢æ€§èƒ½ç•¥åŠ£äºä¸“ç”¨åº“ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šå·²ç»åœ¨ Atlas ä¸Šï¼Œæƒ³å¢é‡åŠ å‘é‡æœç´¢èƒ½åŠ›çš„å›¢é˜Ÿã€‚</p><p>é€‰å‹å»ºè®®ï¼šå¯¹æ‰˜ç®¡å¯ä¿¡èµ–åº¦è¦æ±‚é«˜ï¼Œä¸”é¢„ç®—å……è¶³æ—¶å¯è€ƒè™‘ã€‚</p><h3 id="10-PGVector-PostgreSQL-æ’ä»¶ï¼‰"><a href="#10-PGVector-PostgreSQL-æ’ä»¶ï¼‰" class="headerlink" title="10. PGVector(PostgreSQL æ’ä»¶ï¼‰"></a>10. PGVector(PostgreSQL æ’ä»¶ï¼‰</h3><p>æ ¸å¿ƒåŠŸèƒ½ï¼šåœ¨ PostgreSQL ä¸­åŸç”Ÿå­˜å‚¨ä¸æ£€ç´¢å‘é‡ï¼›æ”¯æŒ SQL+å‘é‡æ··åˆæŸ¥è¯¢ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>ä¸å…³ç³»æ•°æ®æ— ç¼è”è¡¨</li><li>æ”¯æŒç´¢å¼•ï¼ˆIVFã€HNSWï¼‰</li></ul><p>ä¼˜åŠ¿ï¼šæ— éœ€é¢å¤–æ•°æ®åº“ï¼Œåˆ©ç”¨æˆç†Ÿçš„äº‹åŠ¡ä¸æƒé™ä½“ç³»ã€‚</p><p>åŠ£åŠ¿ï¼šå•æœºæ€§èƒ½æœ‰é™ï¼›å¤§è§„æ¨¡æ—¶ PG æ‰©å±•å¤æ‚ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šå·²æœ‰ PostgreSQLï¼Œæƒ³è¿½åŠ ç®€å•å‘é‡æ£€ç´¢åŠŸèƒ½çš„ä¸šåŠ¡ã€‚</p><p>é€‰å‹å»ºè®®ï¼šå…³ç³»å‹ä¸å‘é‡æ··åˆåœºæ™¯ï¼Œä¸”æ•°æ®é‡ &lt;åƒä¸‡çº§æ—¶ä¼˜é€‰ã€‚</p><h3 id="11-Redis-Vector"><a href="#11-Redis-Vector" class="headerlink" title="11. Redis Vector"></a>11. Redis Vector</h3><p>æ ¸å¿ƒåŠŸèƒ½ï¼šRedis Modules æä¾›å‘é‡æ£€ç´¢ï¼›æ”¯æŒ HNSWã€Flatã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>ç»“åˆ RedisStreamã€Pub/Sub å¯åšå®æ—¶æµå¼æ£€ç´¢</li><li>å•å®ä¾‹å»¶è¿Ÿæä½</li></ul><p>ä¼˜åŠ¿ï¼šé€‚åˆé›†æˆåˆ°å·²æœ‰ Redis ç¼“å­˜/æ¶ˆæ¯ä½“ç³»ï¼›è¿ç»´ç»éªŒæ™®éã€‚</p><p>åŠ£åŠ¿ï¼šå†…å­˜æ¶ˆè€—å¤§ï¼›åˆ†å¸ƒå¼æ¨ªå‘æ‰©å±•éœ€ Cluster+Slot ç®¡ç†ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šå¯¹å®æ—¶æ€§è¦æ±‚æé«˜ï¼Œä¸”å·²æœ‰ Redis é›†ç¾¤çš„åœºæ™¯ã€‚</p><p>é€‰å‹å»ºè®®ï¼šç¼“å­˜/è·¯ç”±å±‚å³éœ€åšæ£€ç´¢ï¼Œä¸”å¯¹é«˜å¹¶å‘ä½å»¶è¿Ÿæœ‰ä¸¥æ ¼è¦æ±‚æ—¶é€‰ã€‚</p><h2 id="åˆ†æˆè¿™ä¹ˆå‡ ç±»"><a href="#åˆ†æˆè¿™ä¹ˆå‡ ç±»" class="headerlink" title="åˆ†æˆè¿™ä¹ˆå‡ ç±»"></a>åˆ†æˆè¿™ä¹ˆå‡ ç±»</h2><h3 id="1-ä¸“ç”¨å‘é‡æ•°æ®åº“-Self-managed-æˆ–-æ‰˜ç®¡ç‰ˆ"><a href="#1-ä¸“ç”¨å‘é‡æ•°æ®åº“-Self-managed-æˆ–-æ‰˜ç®¡ç‰ˆ" class="headerlink" title="1. ä¸“ç”¨å‘é‡æ•°æ®åº“ (Self-managed æˆ– æ‰˜ç®¡ç‰ˆ)"></a>1. ä¸“ç”¨å‘é‡æ•°æ®åº“ (Self-managed æˆ– æ‰˜ç®¡ç‰ˆ)</h3><p><strong>ç‰¹ç‚¹</strong>: ä»åº•å±‚åˆ°åè®®å…¨æ–‡æ”¯æŒå‘é‡æ£€ç´¢, æ€§èƒ½ä¸å¯ä¼¸ç¼©æ€§æœ€ä½³ã€‚</p><ul><li>Milvus (è‡ªå»º/ä¼ä¸šçº§é›†ç¾¤)</li><li>Qdrant (è½»é‡ Rust å†…æ ¸ + é«˜æ•ˆè¿‡æ»¤)</li><li>Weaviate (è‡ªå»ºæˆ– Weaviate Cloud, Any-to-Any å¤šæ¨¡æ€)</li><li>Pinecone (å…¨æ‰˜ç®¡ Serverless)</li></ul><h3 id="2-é€šç”¨æœç´¢å¼•æ“å¢å¼º-Search-first-å¹³å°"><a href="#2-é€šç”¨æœç´¢å¼•æ“å¢å¼º-Search-first-å¹³å°" class="headerlink" title="2. é€šç”¨æœç´¢å¼•æ“å¢å¼º (Search-first å¹³å°)"></a>2. é€šç”¨æœç´¢å¼•æ“å¢å¼º (Search-first å¹³å°)</h3><p><strong>ç‰¹ç‚¹</strong>: å…¼é¡¾æ–‡æœ¬æ£€ç´¢ä¸å‘é‡æ£€ç´¢, é€‚åˆå·²æœ‰ Elasticsearch/ç±»ä¼¼ä½“ç³»çš„æ‰©å±•ã€‚</p><ul><li>Elasticsearch (+ kNN)</li><li>Vespa (å¤šå‘é‡å­—æ®µ + å¤æ‚ Ranking, å¼•æ“çº§æ’åºèƒ½åŠ›)</li><li>MongoDB Atlas Vector Search (æ‰˜ç®¡, æ–‡æ¡£ + å‘é‡æ··åˆ)</li></ul><h3 id="3-æ•°æ®åº“åŸç”Ÿæ’ä»¶-SQL-NoSQL-å‘é‡"><a href="#3-æ•°æ®åº“åŸç”Ÿæ’ä»¶-SQL-NoSQL-å‘é‡" class="headerlink" title="3. æ•°æ®åº“åŸç”Ÿæ’ä»¶ (SQL/NoSQL + å‘é‡)"></a>3. æ•°æ®åº“åŸç”Ÿæ’ä»¶ (SQL/NoSQL + å‘é‡)</h3><p><strong>ç‰¹ç‚¹</strong>: åœ¨ç°æœ‰å…³ç³»æˆ– KV å­˜å‚¨ä¸­å åŠ å‘é‡æ£€ç´¢, è¿ç»´ç®€å•ã€æ•°æ®è”åŠ¨å¼ºã€‚</p><ul><li>Pgvector (PostgreSQL æ’ä»¶)</li><li>Redis Vector (Redis æ¨¡å—)</li></ul><h3 id="4-åµŒå…¥å¼è½»é‡åº“-Library-first"><a href="#4-åµŒå…¥å¼è½»é‡åº“-Library-first" class="headerlink" title="4. åµŒå…¥å¼è½»é‡åº“ (Library-first)"></a>4. åµŒå…¥å¼è½»é‡åº“ (Library-first)</h3><p><strong>ç‰¹ç‚¹</strong>:  ä»…æä¾›å‘é‡ç®—æ³•æˆ–æœ¬åœ°å­˜å‚¨, é€‚åˆåµŒå…¥å¼ã€æ¡Œé¢/å°è§„æ¨¡åœºæ™¯æˆ–æ·±åº¦å®šåˆ¶ã€‚</p><ul><li>FAISS (CPU/GPU é«˜æ€§èƒ½å‘é‡åº“)</li><li>Chroma (Python æœ¬åœ°è½»é‡å­˜å‚¨)</li><li>LanceDB (åŸºäº Arrow/Parquet æ–‡ä»¶å­˜å‚¨)</li></ul><h1 id="é—®é¢˜ä»ç„¶èšç„¦äºï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ"><a href="#é—®é¢˜ä»ç„¶èšç„¦äºï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ" class="headerlink" title="é—®é¢˜ä»ç„¶èšç„¦äºï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ"></a>é—®é¢˜ä»ç„¶èšç„¦äºï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ</h1><p><a href="https://python.langchain.com/docs/integrations/vectorstores/">https://python.langchain.com/docs/integrations/vectorstores/</a></p><div class="table-container"><table><thead><tr><th>å‘é‡æ•°æ®åº“åç§°</th><th>æ˜¯å¦æ”¯æŒå¼€æº</th><th>æ˜¯å¦æ”¯æŒè‡ªæ‰˜ç®¡</th><th>æ˜¯å¦æ”¯æŒäº‘ç«¯ç®¡ç†</th><th>æ˜¯å¦ä¸“ä¸ºå‘é‡æœç´¢è®¾è®¡</th><th>å¼€å‘è€…ä½“éªŒ</th><th>æ¯ç§’æŸ¥è¯¢æ•°</th><th>å»¶è¿Ÿ/ms</th><th>æ”¯æŒç´¢å¼•ç±»å‹</th><th>æ˜¯å¦æ”¯æŒæ··åˆæœç´¢</th><th>æ˜¯å¦æ”¯æŒå‘é‡ç´¢å¼•</th><th>æ˜¯å¦æ”¯æŒè§’è‰²è®¿é—®æ§åˆ¶</th><th>æ˜¯å¦æ”¯æŒåŠ¨æ€åˆ†ç‰‡</th><th>æ˜¯å¦å…è´¹æ‰˜ç®¡è®¡åˆ’</th><th>ä»·æ ¼ (50K å‘é‡) /ç¾å…ƒ</th><th>ä»·æ ¼ (20Må‘é‡)/ç¾å…ƒ</th></tr></thead><tbody><tr><td>Pinecone</td><td>å¦</td><td>å¦</td><td>æ˜¯</td><td>æ˜¯</td><td>è¾ƒå¥½</td><td>150+ (æ‰©å±•åæ›´é«˜)</td><td>1</td><td>æœªçŸ¥</td><td>æ˜¯</td><td>å¦</td><td>å¦</td><td>æœªçŸ¥</td><td>æ˜¯</td><td>70</td><td>227 (é«˜æ€§èƒ½ç‰ˆä¸º2074)</td></tr><tr><td>Weaviate</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td><td>è¾ƒå¥½</td><td>791</td><td>2</td><td>HNSW</td><td>æ˜¯</td><td>æ˜¯</td><td>å¦</td><td>å¦ï¼Œé™æ€åˆ†ç‰‡</td><td>æ˜¯</td><td>25èµ·</td><td>1536</td></tr><tr><td>Milvus</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td><td>å¾ˆå¥½</td><td>2406</td><td>1</td><td>å¤šç§ (11ç§)</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td><td>65èµ·</td><td>309 (é«˜æ€§èƒ½ç‰ˆä¸º2291)</td></tr><tr><td>Qdrant</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td><td>è¾ƒå¥½</td><td>326</td><td>4</td><td>HNSW</td><td>æ˜¯</td><td>æ˜¯</td><td>å¦</td><td>æ˜¯</td><td>æ˜¯</td><td>9èµ·</td><td>281 (é«˜æ€§èƒ½ç‰ˆä¸º820)</td></tr><tr><td>Chroma</td><td>æ˜¯</td><td>æ˜¯</td><td>å¦</td><td>æ˜¯</td><td>è¾ƒå¥½</td><td>æœªçŸ¥</td><td>æœªçŸ¥</td><td>HNSW</td><td>æ˜¯</td><td>æ˜¯</td><td>å¦</td><td>æ˜¯</td><td>è‡ªæ‰˜ç®¡å…è´¹</td><td>è‡ªæ‰˜ç®¡å…è´¹</td><td></td></tr><tr><td>Elasticsearch</td><td>å¦</td><td>æ˜¯</td><td>å¦</td><td>å¦</td><td>ä¸€èˆ¬</td><td>700-100</td><td>5-10</td><td>HNSW</td><td>æ˜¯</td><td>æ˜¯</td><td>å¦</td><td>æ˜¯ï¼Œé™æ€åˆ†ç‰‡</td><td>è‡ªæ‰˜ç®¡å…è´¹</td><td>ä¸å®š</td><td>1225</td></tr><tr><td>PGVector</td><td>æ˜¯</td><td>æ˜¯</td><td>å¦</td><td>å¦</td><td>ä¸€èˆ¬</td><td>141</td><td>8</td><td>HNSW/IVFFlat</td><td>æ˜¯</td><td>æ˜¯</td><td>å¦</td><td>-</td><td>è‡ªæ‰˜ç®¡å…è´¹</td><td>ä¸å®š</td><td>ä¸å®š</td></tr></tbody></table></div><ul><li>é€‰å‹ç»´åº¦:<ul><li>æ˜¯å¦å¼€æºã€æ˜¯å¦æ”¯æŒè‡ªæ‰˜ç®¡ã€æ˜¯å¦æ”¯æŒäº‘ç«¯ç®¡ç†</li><li>ä¸“ä¸ºå‘é‡æœç´¢è®¾è®¡ã€å¼€å‘è€…ä½“éªŒã€æ¯ç§’æŸ¥è¯¢æ•°</li><li>å»¶è¿Ÿã€æ”¯æŒç´¢å¼•ç±»å‹ã€æ˜¯å¦æ”¯æŒæ··åˆæœç´¢</li><li>æ˜¯å¦æ”¯æŒç£ç›˜ç´¢å¼•ã€è§’è‰²è®¿é—®æ§åˆ¶ã€åŠ¨æ€åˆ†ç‰‡</li><li>ä»·æ ¼ç­‰å•†ä¸šè€ƒé‡å› ç´ </li></ul></li><li>å…¸å‹æ•°æ®:<ul><li>Milvusæ”¯æŒå¤šè¾¾11ç§ç´¢å¼•ç±»å‹</li><li>Pineconeä»·æ ¼ä»70ç¾å…ƒ(50kå‘é‡)åˆ°2074ç¾å…ƒ(é«˜æ€§èƒ½ç‰ˆ20Må‘é‡)ä¸ç­‰</li><li>WeaviateæŸ¥è¯¢æ€§èƒ½791 QPSï¼Œå»¶è¿Ÿ2ms</li></ul></li></ul><h2 id="é€‰å‹æ€è·¯æ€»ç»“"><a href="#é€‰å‹æ€è·¯æ€»ç»“" class="headerlink" title="é€‰å‹æ€è·¯æ€»ç»“"></a>é€‰å‹æ€è·¯æ€»ç»“</h2><ul><li>è§„æ¨¡ä¸æ€§èƒ½:<ul><li>è¶…å¤§è§„æ¨¡($10^8+$ï»¿)ã€é«˜å¹¶å‘ï¼šMilvusã€Vespaã€Pinecone</li><li>ä¸­å°è§„æ¨¡($&lt;10^7$ï»¿): Qdrantã€Weaviateã€Redis</li></ul></li><li>è¿ç»´æˆæœ¬:<ul><li>é›¶è¿ç»´ï¼šPineconeã€MongoDB Atlasã€Weaviate(Cloud)</li><li>è‡ªç ”å¯æ§ï¼šMilvusã€FAISSã€Vespa</li></ul></li><li>åŠŸèƒ½ä¾§é‡:<ul><li>å¤šæ¨¡æ€Any-to-Any: Weaviateã€OpenSearch</li><li>å¤æ‚è¿‡æ»¤&amp;æ··åˆæ£€ç´¢ï¼šQdrantã€Elasticsearch</li></ul></li><li>ç°æœ‰æ ˆå¯¹æ¥:<ul><li>å·²æœ‰PostgreSQL/Redis: Pgvectorã€Redis Vector</li><li>Elasticsearchç”Ÿæ€ï¼šElasticsearch(+kNN)</li></ul></li></ul><h1 id="ä¸€äº›å¼€æºæµ‹è¯„å·¥å…·"><a href="#ä¸€äº›å¼€æºæµ‹è¯„å·¥å…·" class="headerlink" title="ä¸€äº›å¼€æºæµ‹è¯„å·¥å…·"></a>ä¸€äº›å¼€æºæµ‹è¯„å·¥å…·</h1><p>å·¥å…·ï¼š<a href="https://ann-benchmarks.com/index.html">https://ann-benchmarks.com/index.html</a></p><p>å·¥å…·ï¼š<a href="https://github.com/zilliztech/VectorDBBench">https://github.com/zilliztech/VectorDBBench</a></p>]]></content>
    
    
    <summary type="html">å­¦ä¹ å¤§æ¨¡å‹RAGç³»ç»Ÿå­¦ä¹ ç¬”è®°ç¬¬åä¹è®²</summary>
    
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>RAGç»„ä»¶--å‘é‡æ•°æ®åº“é›†åˆ</title>
    <link href="https://jinglv.github.io/2025/08/18/ai/rag/20-vector-db-collection/"/>
    <id>https://jinglv.github.io/2025/08/18/ai/rag/20-vector-db-collection/</id>
    <published>2025-08-17T16:00:00.000Z</published>
    <updated>2025-08-18T10:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‘é‡æ•°æ®åº“åŸºæœ¬å¤„ç†æµç¨‹"><a href="#å‘é‡æ•°æ®åº“åŸºæœ¬å¤„ç†æµç¨‹" class="headerlink" title="å‘é‡æ•°æ®åº“åŸºæœ¬å¤„ç†æµç¨‹"></a>å‘é‡æ•°æ®åº“åŸºæœ¬å¤„ç†æµç¨‹</h1><p>ä»¥Milvuså‘é‡æ•°æ®åº“ä¸ºä¾‹</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250818180534338.png" alt="image-20250818180534338" style="zoom:67%;" /></p><ul><li>æ ¸å¿ƒæŒ‡æ ‡ï¼šå‘é‡æ•°æ®åº“å¤„ç†éœ€å¹³è¡¡ä¸‰ä¸ªå…³é”®æŒ‡æ ‡ï¼šå‡†ç¡®ç‡ï¼ˆé€¼è¿‘æ¨¡å‹ä¸Šé™ï¼‰ã€æ£€ç´¢é€Ÿåº¦ã€å†…å­˜æ¶ˆè€—</li><li>å®Œæ•´æµç¨‹ï¼š<ul><li>æ•°æ®å‡†å¤‡ï¼šæ¸¸æˆæ•°æ®/åŒ»ç–—æ•°æ®ç­‰åŸå§‹æ•°æ®</li><li>å‘é‡åŒ–å¤„ç†ï¼šä½¿ç”¨OpenAI Embedding Modelç­‰æ¨¡å‹ç”Ÿæˆå‘é‡</li><li>æ•°æ®åº“æ“ä½œï¼š<ul><li>åˆ›å»ºCollectionå¹¶å®šä¹‰Schema</li><li>åˆ›å»ºç´¢å¼•ï¼ˆç´¢å¼•ç±»å‹ç›´æ¥å½±å“æ£€ç´¢æ•ˆç‡ï¼‰</li><li>æ‰¹é‡æ’å…¥å‘é‡æ•°æ®å½¢æˆå®ä½“</li></ul></li><li>æ£€ç´¢åŠŸèƒ½ï¼š<ul><li>ç›¸ä¼¼åº¦æœç´¢</li><li>æ¡ä»¶è¿‡æ»¤</li><li>å‘é‡è·ç¦»è®¡ç®—</li><li>å±æ€§ç­›é€‰</li></ul></li></ul></li><li>å…³é”®å› ç´ ï¼š<ul><li>æ¨¡å‹èƒ½åŠ›ï¼šEmbeddingæ¨¡å‹è´¨é‡å†³å®šå‡†ç¡®ç‡ä¸Šé™</li><li>ç´¢å¼•ä¼˜åŒ–ï¼šéœ€æ ¹æ®æ•°æ®é‡å’Œå†…å­˜æƒ…å†µé€‰æ‹©æœ€ä¼˜ç´¢å¼•å‚æ•°</li><li>å·¥ç¨‹è€ƒé‡ï¼šä¸èƒ½ç®€å•ä½¿ç”¨AUTOINDEXï¼Œéœ€äº†è§£ä¸åŒç´¢å¼•æ–¹å¼çš„é€‚ç”¨åœºæ™¯</li></ul></li></ul><h1 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h1><p>Milvuså®˜æ–¹ç½‘å€ï¼š<a href="https://milvus.io/">https://milvus.io/</a></p><p>åœ¨ Milvus ä¸­ï¼Œæ•°æ®åº“æ˜¯ç»„ç»‡å’Œç®¡ç†æ•°æ®çš„é€»è¾‘å•å…ƒã€‚å¤šç§Ÿæˆ·åˆ›å»ºå¤šä¸ªæ•°æ®åº“ï¼Œä¸ºä¸åŒçš„åº”ç”¨ç¨‹åºæˆ–ç§Ÿæˆ·ä»é€»è¾‘ä¸Šéš”ç¦»æ•°æ®ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªæ•°æ®åº“ç”¨äºå­˜å‚¨ç”¨æˆ· A çš„æ•°æ®ï¼Œå¦ä¸€ä¸ªæ•°æ®åº“ç”¨äºå­˜å‚¨ç”¨æˆ· B çš„æ•°æ®ã€‚</p><ul><li><p>é€»è¾‘å•å…ƒï¼šæ•°æ®åº“æ˜¯ç»„ç»‡ç®¡ç†æ•°æ®çš„é€»è¾‘å•å…ƒï¼Œæ”¯æŒå¤šç§Ÿæˆ·éš”ç¦»</p></li><li><p>åˆ›å»ºæ–¹æ³•ï¼Œå‚è€ƒä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> MilvusClient</span><br><span class="line"></span><br><span class="line">client = MilvusClient(</span><br><span class="line">uri=<span class="string">&quot;http://localhost:19530&quot;</span>,</span><br><span class="line">token=<span class="string">&quot;root:Milvus&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">client.create_database(</span><br><span class="line">db_name=<span class="string">&quot;my_database_1&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><ul><li>ç‰ˆæœ¬è¦æ±‚ï¼šéœ€ä½¿ç”¨Standaloneç‰ˆï¼ˆLocalç‰ˆåŠŸèƒ½å—é™ï¼Œä¸æ”¯æŒé‡åŒ–ç´¢å¼•ç­‰é«˜çº§åŠŸèƒ½ï¼‰</li></ul><h2 id="æ•°æ®åº“æ“ä½œ"><a href="#æ•°æ®åº“æ“ä½œ" class="headerlink" title="æ•°æ®åº“æ“ä½œ"></a>æ•°æ®åº“æ“ä½œ</h2><ol><li><p>è¿æ¥Milvuså®¢æˆ·ç«¯</p><ul><li><p>uri: åè®®+åœ°å€+ç«¯å£ï¼Œé»˜è®¤ä¸º <a href="http://localhost:19530">http://localhost:19530</a></p></li><li><p>token: â€œç”¨æˆ·å:å¯†ç â€ï¼Œé»˜è®¤ root:Milvus (æ³¨ï¼šä¹Ÿå¯ä»¥ä¸ºç©º)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> MilvusClient, exceptions</span><br><span class="line"></span><br><span class="line">client = MilvusClient(</span><br><span class="line">    uri=<span class="string">&quot;http://localhost:19530&quot;</span>,</span><br><span class="line">    <span class="comment"># token=&quot;root:Milvus&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ul></li></ol><ol><li><p>åˆ›å»ºæ•°æ®åº“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> exceptions</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    client.create_database(db_name=<span class="string">&quot;test_vector_db&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;âœ“ test_vector_dbåˆ›å»ºæˆåŠŸ&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> exceptions.AlreadyExistError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;â„¹ test_vector_db å·²å­˜åœ¨&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db_list = client.list_databases()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å½“å‰æ‰€æœ‰æ•°æ®åº“ï¼š&quot;</span>, db_list)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>æŸ¥çœ‹æ•°æ®åº“è¯¦æƒ…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">default_info = client.describe_database(db_name=<span class="string">&quot;default&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;é»˜è®¤æ•°æ®åº“è¯¦æƒ…ï¼š&quot;</span>, default_info)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>ä¿®æ”¹æ•°æ®åº“å±æ€§ï¼šé™åˆ¶æœ€å¤§é›†åˆæ•°ä¸º10</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">client.alter_database_properties(</span><br><span class="line">    db_name=<span class="string">&quot;test_vector_db&quot;</span>,</span><br><span class="line">    properties=&#123;<span class="string">&quot;database.max.collections&quot;</span>: <span class="number">10</span>&#125;</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;âœ“ å·²ä¸º test_vector_db é™åˆ¶æœ€å¤§é›†åˆæ•°ä¸º 10&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>åˆ é™¤æ•°æ®æœ€å¤§é›†åˆé™åˆ¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">client.drop_database_properties(</span><br><span class="line">    db_name=<span class="string">&quot;test_vector_db&quot;</span>,</span><br><span class="line">    property_keys=[<span class="string">&quot;database.max.collections&quot;</span>]</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;âœ“ å·²ç§»é™¤ test_vector_db çš„æœ€å¤§é›†åˆæ•°é™åˆ¶&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>åˆ‡æ¢æ•°æ®åº“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">client.use_database(db_name=<span class="string">&quot;dev_vector_db&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;âœ“ å·²åˆ‡æ¢å½“å‰æ•°æ®åº“ä¸º dev_vector_db&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>åˆ é™¤æ•°æ®åº“</p><ul><li>æ³¨æ„ï¼šå¦‚æœåº“å†…æœ‰ Collectionï¼Œéœ€å…ˆ client.drop_collection() å°†å…¶æ¸…ç©º</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">client.drop_database(db_name=<span class="string">&quot;test_vector_db&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;âœ“ test_vector_db å·²åˆ é™¤&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol><h2 id="é›†åˆï¼šCollection"><a href="#é›†åˆï¼šCollection" class="headerlink" title="é›†åˆï¼šCollection"></a>é›†åˆï¼šCollection</h2><ul><li>åŸºæœ¬æ¦‚å¿µï¼šCollectionæ˜¯ç®¡ç†æ•°æ®çš„å®¹å™¨ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªCollectionsæ¥ç»„ç»‡æ•°æ®ï¼Œç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ã€‚</li><li>æ•°æ®ç»“æ„ï¼šé‡‡ç”¨äºŒç»´è¡¨ç»“æ„ï¼Œå…·æœ‰å›ºå®šçš„åˆ—ï¼ˆå­—æ®µï¼‰å’Œå˜åŒ–çš„è¡Œï¼ˆå®ä½“ï¼‰ï¼Œæ¯åˆ—ä»£è¡¨ä¸€ä¸ªå­—æ®µï¼Œæ¯è¡Œä»£è¡¨ä¸€ä¸ªå®ä½“ã€‚</li><li>ç±»æ¯”å…³ç³»ï¼šCollectionså¯¹åº”æ•°æ®åº“è¡¨ï¼Œå®ä½“(Entity)å¯¹åº”è¡¨ä¸­çš„è®°å½•</li></ul><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250819110839640.png" alt="image-20250819110839640" style="zoom:80%;" /></p><h3 id="é›†åˆçš„Schema"><a href="#é›†åˆçš„Schema" class="headerlink" title="é›†åˆçš„Schema"></a>é›†åˆçš„Schema</h3><p>ä»£ç ç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> MilvusClient, DataType</span><br><span class="line"></span><br><span class="line">client = MilvusClient(</span><br><span class="line">  uri=<span class="string">&quot;http://localhost:19530&quot;</span>,</span><br><span class="line">  token=<span class="string">&quot;root:Milvus&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create schema</span></span><br><span class="line">schema = MilvusClient.create_schema(</span><br><span class="line">  auto_id=<span class="literal">False</span>,</span><br><span class="line">  enable_dynamic_field=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add fields to schema</span></span><br><span class="line">schema.add_field(field_name=<span class="string">&quot;my_id&quot;</span>, datatype=DataType.INT64, is_primary=<span class="literal">True</span>)</span><br><span class="line">schema.add_field(field_name=<span class="string">&quot;my_vector&quot;</span>, datatype=DataType.FLOAT_VECTOR, dim=<span class="number">5</span>)</span><br><span class="line">schema.add_field(field_name=<span class="string">&quot;my_varchar&quot;</span>, datatype=DataType.VARCHAR, max_length=<span class="number">512</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>å®šä¹‰ï¼šSchemaè§„å®šäº†é›†åˆçš„æ•°æ®ç»“æ„ï¼Œåœ¨åˆ›å»ºé›†åˆæ—¶å¿…é¡»æ˜ç¡®è®¾è®¡ã€‚</li><li>æ ¸å¿ƒå­—æ®µï¼š<ul><li>IDå­—æ®µï¼šå¿…é¡»å­˜åœ¨çš„ä¸»é”®å­—æ®µï¼Œæ”¯æŒæ•´æ•°æˆ–å­—ç¬¦ä¸²ç±»å‹</li><li>Vectorå­—æ®µï¼šå­˜å‚¨å‘é‡æ•°æ®çš„æ ¸å¿ƒå­—æ®µ</li><li>Textå­—æ®µï¼šä¸å‘é‡å¯¹åº”çš„åŸå§‹æ–‡æœ¬å­—æ®µ</li></ul></li><li>åŠ¨æ€å­—æ®µï¼šå¯é€šè¿‡è®¾ç½®enable_dynamic_field=Trueå…è®¸åç»­æ·»åŠ æœªå®šä¹‰çš„å­—æ®µ</li></ul><h3 id="é›†åˆçš„å­—æ®µæ¶æ„"><a href="#é›†åˆçš„å­—æ®µæ¶æ„" class="headerlink" title="é›†åˆçš„å­—æ®µæ¶æ„"></a>é›†åˆçš„å­—æ®µæ¶æ„</h3><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250819111346793.png" alt="image-20250819111346793" style="zoom:67%;" /></p><ul><li>å­—æ®µé™åˆ¶ï¼š<ul><li>å¿…é¡»åŒ…å«1ä¸ªä¸»é”®å­—æ®µ</li><li>æœ€å¤šæ”¯æŒ4ä¸ªå‘é‡å­—æ®µ</li></ul></li><li>å¤šå‘é‡åº”ç”¨ï¼š<ul><li>æ”¯æŒæ··åˆæ£€ç´¢ï¼ˆå¯†é›†å‘é‡+ç¨€ç–å‘é‡ï¼‰</li><li>æ”¯æŒå¤šæ¨¡æ€æ£€ç´¢ï¼ˆæ–‡æœ¬+å›¾åƒç­‰ï¼‰</li></ul></li></ul><h3 id="ä¸»é”®å’ŒAuto-ID"><a href="#ä¸»é”®å’ŒAuto-ID" class="headerlink" title="ä¸»é”®å’ŒAuto ID"></a>ä¸»é”®å’ŒAuto ID</h3><p>ä¸å…³ç³»æ•°æ®åº“ä¸­çš„ä¸»å­—æ®µç±»ä¼¼ï¼ŒCollection ä¹Ÿæœ‰ä¸€ä¸ªä¸»å­—æ®µï¼Œç”¨äºå°†å®ä½“ä¸å…¶ä»–å®ä½“åŒºåˆ†å¼€æ¥ã€‚ä¸»å­—æ®µä¸­çš„æ¯ä¸ªå€¼éƒ½æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œå¹¶ä¸ä¸€ä¸ªç‰¹å®šå®ä½“ç›¸å¯¹åº”ã€‚</p><p>åä¸ºidçš„å­—æ®µæ˜¯ä¸»å­—æ®µã€‚ä¸»å­—æ®µåªæ¥å—æ•´æ•°æˆ–å­—ç¬¦ä¸²ã€‚</p><ul><li>æ’å…¥å®ä½“æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹åº”åŒ…å«ä¸»å­—æ®µå€¼ã€‚</li><li>å¦‚æœåœ¨åˆ›å»º Collections æ—¶å¯ç”¨äº†AutoIdï¼ŒMilvus å°†åœ¨æ’å…¥æ•°æ®æ—¶ç”Ÿæˆè¿™äº›å€¼ã€‚æ­¤æ—¶ï¼Œä»è¦æ’å…¥çš„å®ä½“ä¸­æ’é™¤ä¸»å­—æ®µå€¼ã€‚</li></ul><p>æ€»ç»“ï¼š</p><ul><li>ä¸»é”®ç‰¹æ€§ï¼š<ul><li>æ¯ä¸ªå€¼å…¨å±€å”¯ä¸€</li><li>æ”¯æŒæ•´æ•°æˆ–å­—ç¬¦ä¸²ç±»å‹</li><li>ç”¨äºç²¾ç¡®æŸ¥è¯¢è€Œéå‘é‡æ£€ç´¢</li></ul></li><li>Auto IDï¼š<ul><li>åˆ›å»ºé›†åˆæ—¶å¯å¯ç”¨è‡ªåŠ¨ç”Ÿæˆä¸»é”®åŠŸèƒ½</li><li>å¯ç”¨åæ’å…¥æ•°æ®æ—¶æ— éœ€æŒ‡å®šä¸»é”®å€¼</li><li>ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†é…å”¯ä¸€IDå€¼</li></ul></li></ul><h3 id="é›†åˆçš„æ“ä½œ"><a href="#é›†åˆçš„æ“ä½œ" class="headerlink" title="é›†åˆçš„æ“ä½œ"></a>é›†åˆçš„æ“ä½œ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> MilvusClient</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥Miilvus</span></span><br><span class="line">client = MilvusClient(</span><br><span class="line">    uri=<span class="string">&quot;http://localhost:19530&quot;</span>,</span><br><span class="line">    <span class="comment"># token=&quot;root:Milvus&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><ol><li><p>åˆ›å»º Collection</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥å¹¶åˆ é™¤å·²å­˜åœ¨çš„é›†åˆ</span></span><br><span class="line">collection_name = <span class="string">&quot;quick_setup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> collection_name <span class="keyword">in</span> client.list_collections():</span><br><span class="line">    client.drop_collection(collection_name=collection_name)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;âœ“ å·²åˆ é™¤å·²å­˜åœ¨çš„é›†åˆ <span class="subst">&#123;collection_name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ–°é›†åˆ,</span></span><br><span class="line">client.create_collection(</span><br><span class="line">    collection_name=collection_name,</span><br><span class="line">    dimension=<span class="number">5</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;âœ“ <span class="subst">&#123;collection_name&#125;</span> å·²åˆ›å»º&quot;</span>) <span class="comment"># æ²¡æœ‰æŒ‡å®šæ•°æ®åº“åˆ›å»ºé›†åˆï¼Œåˆ™é›†åˆä¼šåˆ›å»ºåœ¨defaultä¸‹</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨é»˜è®¤è®¾ç½®ç«‹å³åˆ›å»ºé›†åˆæ—¶ï¼Œå°†åº”ç”¨ä»¥ä¸‹è®¾ç½®ï¼š</p><ul><li>å°†ä¸»è¦å­—æ®µå’Œå‘é‡å­—æ®µæ·»åŠ åˆ°æ¨¡å¼ï¼ˆidå’ŒçŸ¢é‡ï¼‰ä¸­ã€‚</li><li>ä¸»å­—æ®µæ¥å—æ•´æ•°å¹¶ç¦ç”¨AutoIdã€‚</li><li>å‘é‡å­—æ®µæ¥å—æµ®ç‚¹å‘é‡åµŒå…¥ã€‚</li><li>AUTOINDEXç”¨äºåœ¨çŸ¢é‡å­—æ®µä¸Šåˆ›å»ºç´¢å¼•ã€‚</li><li>COSINEç”¨äºæµ‹é‡å‘é‡åµŒå…¥ä¹‹é—´çš„ç›¸ä¼¼æ€§ã€‚</li><li>å¯ç”¨åä¸º$metaçš„ä¿ç•™åŠ¨æ€å­—æ®µï¼Œä»¥é”®å€¼å¯¹çš„å½¢å¼ä¿å­˜éæ¨¡å¼å®šä¹‰çš„å­—æ®µåŠå…¶å€¼ã€‚</li><li>è¯¥é›†åˆåœ¨åˆ›å»ºæ—¶è‡ªåŠ¨åŠ è½½ã€‚</li></ul></li></ol><p>   åˆ›å»ºäº†åŒ…å«ç´¢å¼•å‚æ•°çš„é›†åˆï¼ŒMilvus ä¼šåœ¨åˆ›å»ºæ—¶è‡ªåŠ¨åŠ è½½è¯¥é›†åˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç´¢å¼•å‚æ•°ä¸­æåˆ°çš„æ‰€æœ‰å­—æ®µéƒ½ä¼šè¢«ç´¢å¼•ã€‚</p>   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">client.create_collection(</span><br><span class="line">  collection_name=<span class="string">&quot;customized_setup_1&quot;</span>,</span><br><span class="line">  schema=schema,</span><br><span class="line">  index_params=index_params</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ol><li><p>åˆ—å‡ºæ‰€æœ‰ Collections</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cols = client.list_collections()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å½“å‰æ‰€æœ‰é›†åˆï¼š&quot;</span>, cols)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>æŸ¥çœ‹ Collection è¯¦æƒ…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">info = client.describe_collection(collection_name=collection_name)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;collection_name&#125;</span> è¯¦æƒ…ï¼š&quot;</span>, info)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>é‡å‘½å Collection</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">new_collection_name = <span class="string">&quot;quick_renamed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> new_collection_name <span class="keyword">in</span> client.list_collections():</span><br><span class="line">    client.drop_collection(collection_name=new_collection_name)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;âœ“ å·²åˆ é™¤å·²å­˜åœ¨çš„é›†åˆ <span class="subst">&#123;new_collection_name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">client.rename_collection(</span><br><span class="line">    old_name=collection_name,</span><br><span class="line">    new_name=new_collection_name</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;âœ“ <span class="subst">&#123;collection_name&#125;</span> å·²é‡å‘½åä¸º <span class="subst">&#123;new_collection_name&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>ä¿®æ”¹ Collection å±æ€§ï¼ˆè®¾ç½® TTL 60 ç§’ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">client.alter_collection_properties(</span><br><span class="line">    collection_name=new_collection_name,</span><br><span class="line">    properties=&#123;<span class="string">&quot;collection.ttl.seconds&quot;</span>: <span class="number">60</span>&#125;</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;âœ“ å·²ä¸º <span class="subst">&#123;new_collection_name&#125;</span> è®¾ç½® TTL=60s&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>åˆ é™¤ Collection å±æ€§ï¼ˆTTLï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">client.drop_collection_properties(</span><br><span class="line">    collection_name=new_collection_name,</span><br><span class="line">    property_keys=[<span class="string">&quot;collection.ttl.seconds&quot;</span>]</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;âœ“ å·²åˆ é™¤ <span class="subst">&#123;new_collection_name&#125;</span> çš„ TTL å±æ€§&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>åŠ è½½ &amp; æ£€æŸ¥åŠ è½½çŠ¶æ€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">client.load_collection(collection_name=new_collection_name)</span><br><span class="line">state = client.get_load_state(collection_name=new_collection_name)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;åŠ è½½çŠ¶æ€ï¼š&quot;</span>, state)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>é‡Šæ”¾ &amp; æ£€æŸ¥é‡Šæ”¾çŠ¶æ€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">client.release_collection(collection_name=new_collection_name)</span><br><span class="line">state = client.get_load_state(collection_name=new_collection_name)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;é‡Šæ”¾åçŠ¶æ€ï¼š&quot;</span>, state)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>ç®¡ç† Partition(åˆ†åŒº)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 9.1 åˆ—å‡º Partitionï¼ˆé»˜è®¤åªæœ‰ &quot;_default&quot;ï¼‰</span></span><br><span class="line"></span><br><span class="line">parts = client.list_partitions(collection_name=new_collection_name)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Partition åˆ—è¡¨ï¼š&quot;</span>, parts)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 9.2 åˆ›å»ºæ–° Partition</span></span><br><span class="line"></span><br><span class="line">client.create_partition(</span><br><span class="line">    collection_name=new_collection_name,</span><br><span class="line">    partition_name=<span class="string">&quot;partA&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;âœ“ å·²åˆ›å»º partition partA&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ›´æ–°å Partition åˆ—è¡¨ï¼š&quot;</span>, client.list_partitions(new_collection_name))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 9.3 æ£€æŸ¥ Partition æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"></span><br><span class="line">exists = client.has_partition(</span><br><span class="line">    collection_name=new_collection_name,</span><br><span class="line">    partition_name=<span class="string">&quot;partA&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;partA å­˜åœ¨ï¼Ÿ&quot;</span>, exists)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 9.4 åŠ è½½ &amp; é‡Šæ”¾ æŒ‡å®š Partition</span></span><br><span class="line"></span><br><span class="line">client.load_partitions(</span><br><span class="line">    collection_name=new_collection_name,</span><br><span class="line">    partition_names=[<span class="string">&quot;partA&quot;</span>]</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;partA åŠ è½½çŠ¶æ€ï¼š&quot;</span>, client.get_load_state(new_collection_name, partition_name=<span class="string">&quot;partA&quot;</span>))</span><br><span class="line"></span><br><span class="line">client.release_partitions(</span><br><span class="line">    collection_name=new_collection_name,</span><br><span class="line">    partition_names=[<span class="string">&quot;partA&quot;</span>]</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;partA é‡Šæ”¾åçŠ¶æ€ï¼š&quot;</span>, client.get_load_state(new_collection_name, partition_name=<span class="string">&quot;partA&quot;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 9.5 åˆ é™¤ Partitionï¼ˆéœ€å…ˆ releaseï¼‰</span></span><br><span class="line"></span><br><span class="line">client.drop_partition(</span><br><span class="line">    collection_name=new_collection_name,</span><br><span class="line">    partition_name=<span class="string">&quot;partA&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;âœ“ å·²åˆ é™¤ partition partA&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æœ€ç»ˆ Partition åˆ—è¡¨ï¼š&quot;</span>, client.list_partitions(new_collection_name))</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>ç®¡ç† Alias(åˆ«å)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 10.1 åˆ›å»º Alias</span></span><br><span class="line"></span><br><span class="line">client.create_alias(collection_name=new_collection_name, alias=<span class="string">&quot;alias3&quot;</span>)</span><br><span class="line">client.create_alias(collection_name=new_collection_name, alias=<span class="string">&quot;alias4&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;âœ“ å·²åˆ›å»º alias3, alias4&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 10.2 åˆ—å‡º Alias</span></span><br><span class="line"></span><br><span class="line">aliases = client.list_aliases(collection_name=new_collection_name)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å½“å‰ aliasesï¼š&quot;</span>, aliases)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 10.3 æŸ¥çœ‹ Alias è¯¦æƒ…</span></span><br><span class="line"></span><br><span class="line">desc = client.describe_alias(alias=<span class="string">&quot;alias3&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;alias3 è¯¦æƒ…ï¼š&quot;</span>, desc)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 10.4 é‡æ–°åˆ†é… Alias</span></span><br><span class="line"></span><br><span class="line">client.alter_alias(collection_name=new_collection_name, alias=<span class="string">&quot;alias4&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;âœ“ å·²å°† alias4 é‡æ–°åˆ†é…ç»™ quick_renamed&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 10.5 åˆ é™¤ Alias</span></span><br><span class="line"></span><br><span class="line">client.drop_alias(alias=<span class="string">&quot;alias4&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;âœ“ å·²åˆ é™¤ alias4&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å‰©ä½™ aliasesï¼š&quot;</span>, client.list_aliases(new_collection_name))</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>åˆ é™¤ Collection</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">client.drop_collection(collection_name=new_collection_name) <span class="comment"># æ³¨ï¼šé›†åˆä¸­çš„Aliasä¹Ÿè¦åˆ å¹²å‡€ï¼Œå¦åˆ™é›†åˆä¹Ÿä¸ä¼šåˆ é™¤æˆåŠŸ</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;âœ“ é›†åˆ <span class="subst">&#123;new_collection_name&#125;</span> å·²åˆ é™¤&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol><h2 id="Schemaæ“ä½œ"><a href="#Schemaæ“ä½œ" class="headerlink" title="Schemaæ“ä½œ"></a>Schemaæ“ä½œ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> MilvusClient, DataType</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥Miilvus</span></span><br><span class="line">client = MilvusClient(</span><br><span class="line">    uri=<span class="string">&quot;http://localhost:19530&quot;</span>,</span><br><span class="line">    <span class="comment"># token=&quot;root:Milvus&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><ol><li><p>åˆ›å»ºåŸºæœ¬ Schema</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">schema = MilvusClient.create_schema()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;âœ“ å·²åˆ›å»ºç©º Schema&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>æ·»åŠ ä¸»é”®å­—æ®µï¼ˆPrimary Fieldï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2.1 INT64ç±»å‹ä¸»é”®ï¼ˆæ‰‹åŠ¨æŒ‡å®šIDï¼‰</span></span><br><span class="line"></span><br><span class="line">schema.add_field(</span><br><span class="line">    field_name=<span class="string">&quot;id&quot;</span>,</span><br><span class="line">    datatype=DataType.INT64,</span><br><span class="line">    is_primary=<span class="literal">True</span>,  <span class="comment"># è®¾ç½®ä¸ºä¸»é”®</span></span><br><span class="line">    auto_id=<span class="literal">False</span>     <span class="comment"># ä¸è‡ªåŠ¨ç”ŸæˆID</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2.2 VARCHARç±»å‹ä¸»é”®ï¼ˆè‡ªåŠ¨ç”ŸæˆIDï¼‰</span></span><br><span class="line"></span><br><span class="line">schema.add_field(</span><br><span class="line">    field_name=<span class="string">&quot;doc_id&quot;</span>,</span><br><span class="line">    datatype=DataType.VARCHAR,</span><br><span class="line">    is_primary=<span class="literal">True</span>,  <span class="comment"># è®¾ç½®ä¸ºä¸»é”®</span></span><br><span class="line">    auto_id=<span class="literal">True</span>,     <span class="comment"># è‡ªåŠ¨ç”ŸæˆID</span></span><br><span class="line">    max_length=<span class="number">100</span>    <span class="comment"># VARCHARç±»å‹éœ€è¦æŒ‡å®šæœ€å¤§é•¿åº¦</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>æ·»åŠ å‘é‡å­—æ®µï¼ˆVector Fieldï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3.1 Dense Vector (æµ®ç‚¹å‘é‡)</span></span><br><span class="line">schema.add_field(</span><br><span class="line">    field_name=<span class="string">&quot;text_vector&quot;</span>,</span><br><span class="line">    datatype=DataType.FLOAT_VECTOR,  <span class="comment"># 32ä½æµ®ç‚¹å‘é‡</span></span><br><span class="line">    dim=<span class="number">768</span>                          <span class="comment"># å‘é‡ç»´åº¦</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3.2 Binary Vector (äºŒè¿›åˆ¶å‘é‡)</span></span><br><span class="line">schema.add_field(</span><br><span class="line">    field_name=<span class="string">&quot;image_vector&quot;</span>,</span><br><span class="line">    datatype=DataType.BINARY_VECTOR,  <span class="comment"># äºŒè¿›åˆ¶å‘é‡</span></span><br><span class="line">    dim=<span class="number">256</span>                           <span class="comment"># ç»´åº¦å¿…é¡»æ˜¯8çš„å€æ•°</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>æ·»åŠ æ ‡é‡å­—æ®µï¼ˆScalar Fieldï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4.1 å­—ç¬¦ä¸²å­—æ®µ</span></span><br><span class="line">schema.add_field(</span><br><span class="line">    field_name=<span class="string">&quot;title&quot;</span>,</span><br><span class="line">    datatype=DataType.VARCHAR,</span><br><span class="line">    max_length=<span class="number">200</span>,</span><br><span class="line">    <span class="comment"># å¯ä»¥ä¸ºç©ºä¸”æœ‰é»˜è®¤å€¼</span></span><br><span class="line">    is_nullable=<span class="literal">True</span>,</span><br><span class="line">    default_value=<span class="string">&quot;untitled&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4.2 æ•°å€¼å­—æ®µ</span></span><br><span class="line">schema.add_field(</span><br><span class="line">    field_name=<span class="string">&quot;age&quot;</span>,</span><br><span class="line">    datatype=DataType.INT32,</span><br><span class="line">    is_nullable=<span class="literal">False</span>  <span class="comment"># ä¸å¯ä¸ºç©º</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4.3 å¸ƒå°”å­—æ®µ</span></span><br><span class="line">schema.add_field(</span><br><span class="line">    field_name=<span class="string">&quot;is_active&quot;</span>,</span><br><span class="line">    datatype=DataType.BOOL,</span><br><span class="line">    default_value=<span class="literal">True</span>  <span class="comment"># é»˜è®¤å€¼ä¸ºTrue</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4.4 JSONå­—æ®µ</span></span><br><span class="line">schema.add_field(</span><br><span class="line">    field_name=<span class="string">&quot;metadata&quot;</span>,</span><br><span class="line">    datatype=DataType.JSON</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4.5 æ•°ç»„å­—æ®µ</span></span><br><span class="line">schema.add_field(</span><br><span class="line">    field_name=<span class="string">&quot;tags&quot;</span>,</span><br><span class="line">    datatype=DataType.ARRAY,</span><br><span class="line">    element_type=DataType.VARCHAR,  <span class="comment"># æ•°ç»„å…ƒç´ ç±»å‹</span></span><br><span class="line">    max_capacity=<span class="number">10</span>,                <span class="comment"># æ•°ç»„æœ€å¤§å®¹é‡</span></span><br><span class="line">    max_length=<span class="number">50</span>                   <span class="comment"># æ¯ä¸ªå…ƒç´ æœ€å¤§é•¿åº¦</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>æ·»åŠ åŠ¨æ€å­—æ®µï¼ˆDynamic Fieldï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">schema.add_field(</span><br><span class="line">    field_name=<span class="string">&quot;dynamic_field&quot;</span>,</span><br><span class="line">    datatype=DataType.VARCHAR,</span><br><span class="line">    is_dynamic=<span class="literal">True</span>,    <span class="comment"># è®¾ç½®ä¸ºåŠ¨æ€å­—æ®µ</span></span><br><span class="line">    max_length=<span class="number">500</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>ä½¿ç”¨Schemaåˆ›å»ºCollection</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">collection_name = <span class="string">&quot;document_store10&quot;</span></span><br><span class="line">client.create_collection(</span><br><span class="line">    collection_name=collection_name,</span><br><span class="line">    schema=schema</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>ä¿®æ”¹Collectionå­—æ®µ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ æ–°å­—æ®µ</span></span><br><span class="line">client.alter_collection_field(</span><br><span class="line">    collection_name=collection_name,</span><br><span class="line">    field_name=<span class="string">&quot;tags&quot;</span>,</span><br><span class="line">    field_params=&#123;</span><br><span class="line">        <span class="string">&quot;max_capacity&quot;</span>: <span class="number">64</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>æŸ¥çœ‹Collectionè¯¦æƒ…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">info = client.describe_collection(collection_name=collection_name)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Collectionè¯¦æƒ…ï¼š&quot;</span>, info)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>æ¸…ç†ï¼ˆåˆ é™¤é›†åˆï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">client.drop_collection(collection_name=collection_name)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;âœ“ å·²åˆ é™¤æµ‹è¯•é›†åˆ&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol><h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><ul><li>å¿…è¦æ€§ï¼šå‘é‡å­—æ®µå¿…é¡»åˆ›å»ºç´¢å¼•æ‰èƒ½é«˜æ•ˆæ£€ç´¢</li><li>ç´¢å¼•å‚æ•°ï¼š<ul><li>å‘é‡å­—æ®µéœ€æŒ‡å®šç´¢å¼•ç±»å‹å’Œåº¦é‡ç±»å‹</li><li>æ ‡é‡å­—æ®µåªéœ€æŒ‡å®šç´¢å¼•ç±»å‹</li></ul></li><li>åº¦é‡ç±»å‹ï¼šåŒ…æ‹¬ä½™å¼¦ç›¸ä¼¼åº¦(COSINE)ã€å†…ç§¯(IP)ã€æ¬§å¼è·ç¦»(L2)ç­‰</li></ul><p>åˆ›å»ºç´¢å¼•ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Prepare index parameters</span></span><br><span class="line">index_params = client.prepare_index_params()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add indexes</span></span><br><span class="line">index_params.add_index(</span><br><span class="line">  field_name=<span class="string">&quot;my_id&quot;</span>,</span><br><span class="line">  index_type=<span class="string">&quot;AUTOINDEX&quot;</span></span><br><span class="line">)</span><br><span class="line">index_params.add_index(</span><br><span class="line">  field_name=<span class="string">&quot;my_vector&quot;</span>,</span><br><span class="line">  index_type=<span class="string">&quot;AUTOINDEX&quot;</span>,</span><br><span class="line">  metric_type=<span class="string">&quot;COSINE&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="å®ä½“ï¼šEntity"><a href="#å®ä½“ï¼šEntity" class="headerlink" title="å®ä½“ï¼šEntity"></a>å®ä½“ï¼šEntity</h2><p>åœ¨ Milvus ä¸­ï¼ŒEntityæ˜¯æŒ‡Collectionä¸­å…±äº«åŒä¸€ä¸ªSchemaçš„æ•°æ®è®°å½•ï¼Œä¸€è¡Œä¸­æ¯ä¸ªå­—æ®µçš„æ•°æ®æ„æˆä¸€ä¸ª Entityã€‚å› æ­¤ï¼ŒåŒä¸€ä¸ª Collection å†…çš„ Entity å…·æœ‰ç›¸åŒçš„å±æ€§ï¼ˆä¾‹å¦‚å­—æ®µåã€æ•°æ®ç±»å‹å’Œå…¶ä»–çº¦æŸï¼‰ã€‚</p><p>å°†å®ä½“æ’å…¥é›†åˆ (Collection) æ—¶ï¼Œåªæœ‰åŒ…å« Schema ä¸­å®šä¹‰çš„æ‰€æœ‰å­—æ®µï¼Œæ’å…¥çš„å®ä½“æ‰èƒ½æˆåŠŸæ·»åŠ ã€‚æ’å…¥çš„å®ä½“å°†æŒ‰æ’å…¥é¡ºåºè¿›å…¥åä¸º_defaultçš„åˆ†åŒº (Partition )ã€‚å¦‚æœå­˜åœ¨æŸä¸ªåˆ†åŒº (Partition)ï¼Œæ‚¨ä¹Ÿå¯ä»¥é€šè¿‡åœ¨æ’å…¥è¯·æ±‚ä¸­æŒ‡å®šåˆ†åŒºåç§°ï¼Œå°†å®ä½“æ’å…¥åˆ°è¯¥åˆ†åŒº (Partition) ä¸­ã€‚</p><h3 id="å®ä½“ï¼šUpsert"><a href="#å®ä½“ï¼šUpsert" class="headerlink" title="å®ä½“ï¼šUpsert"></a>å®ä½“ï¼šUpsert</h3><p>å½“ä½ éœ€è¦æ›´æ–°é›†åˆä¸­çš„å®ä½“ï¼Œæˆ–è€…ä¸ç¡®å®šæ˜¯æ›´æ–°è¿˜æ˜¯æ’å…¥æ—¶ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ Upsert æ“ä½œã€‚åŠ¡å¿…ç¡®ä¿ Upsert è¯·æ±‚ä¸­åŒ…å«çš„å®ä½“åŒ…å«ä¸»é”®ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250819160329230.png" alt="image-20250819160329230" style="zoom:50%;" /></p><ol><li>æ£€æŸ¥Collectionçš„ä¸»å­—æ®µæ˜¯å¦å¯ç”¨äº†AutoIdã€‚<ul><li>å¦‚æœæ˜¯ï¼ŒMilvus ä¼šå°†å®ä½“ä¸­çš„ä¸»é”®æ›¿æ¢ä¸ºè‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®ï¼Œå¹¶æ’å…¥æ•°æ®ã€‚</li><li>å¦‚æœæ²¡æœ‰ï¼ŒMilvus å°†ä½¿ç”¨å®ä½“æºå¸¦çš„ä¸»é”®æ¥æ’å…¥æ•°æ®ã€‚</li></ul></li><li>æ ¹æ®Upsertè¯·æ±‚ä¸­åŒ…å«çš„Entityçš„ä¸»é”®å€¼æ‰§è¡Œåˆ é™¤æ“ä½œã€‚</li></ol><ul><li>Upsertæ“ä½œ:<ul><li>ç»“åˆinsertå’ŒupdateåŠŸèƒ½</li><li>æ£€æŸ¥AutoIDè®¾ç½®å†³å®šä¸»é”®å¤„ç†æ–¹å¼</li><li>å­˜åœ¨ç›¸åŒä¸»é”®æ—¶å…ˆåˆ é™¤å†æ’å…¥</li></ul></li></ul><h3 id="å®ä½“Entityæ“ä½œ"><a href="#å®ä½“Entityæ“ä½œ" class="headerlink" title="å®ä½“Entityæ“ä½œ"></a>å®ä½“Entityæ“ä½œ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> MilvusClient</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥Miilvus</span></span><br><span class="line">client = MilvusClient(</span><br><span class="line">    uri=<span class="string">&quot;http://localhost:19530&quot;</span>,</span><br><span class="line">    <span class="comment"># token=&quot;root:Milvus&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé›†åˆ</span></span><br><span class="line"><span class="comment"># æ£€æŸ¥é›†åˆæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™åˆ é™¤</span></span><br><span class="line"><span class="keyword">if</span> client.has_collection(<span class="string">&quot;quick_setup&quot;</span>):</span><br><span class="line">    client.drop_collection(<span class="string">&quot;quick_setup&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé›†åˆ</span></span><br><span class="line">client.create_collection(</span><br><span class="line">    collection_name=<span class="string">&quot;quick_setup&quot;</span>,</span><br><span class="line">    dimension=<span class="number">5</span>,  <span class="comment"># vector ç»´åº¦</span></span><br><span class="line">    primary_field_name=<span class="string">&quot;id&quot;</span>,</span><br><span class="line">    vector_field_name=<span class="string">&quot;vector&quot;</span>,</span><br><span class="line">    id_type=<span class="string">&quot;int&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><ol><li><p>æ’å…¥å®ä½“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">data=[</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">0</span>, <span class="string">&quot;vector&quot;</span>: [<span class="number">0.3580376395471989</span>, -<span class="number">0.6023495712049978</span>, <span class="number">0.18414012509913835</span>, -<span class="number">0.26286205330961354</span>, <span class="number">0.9029438446296592</span>], <span class="string">&quot;color&quot;</span>: <span class="string">&quot;pink_8682&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;vector&quot;</span>: [<span class="number">0.19886812562848388</span>, <span class="number">0.06023560599112088</span>, <span class="number">0.6976963061752597</span>, <span class="number">0.2614474506242501</span>, <span class="number">0.838729485096104</span>], <span class="string">&quot;color&quot;</span>: <span class="string">&quot;red_7025&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">2</span>, <span class="string">&quot;vector&quot;</span>: [<span class="number">0.43742130801983836</span>, -<span class="number">0.5597502546264526</span>, <span class="number">0.6457887650909682</span>, <span class="number">0.7894058910881185</span>, <span class="number">0.20785793220625592</span>], <span class="string">&quot;color&quot;</span>: <span class="string">&quot;orange_6781&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">3</span>, <span class="string">&quot;vector&quot;</span>: [<span class="number">0.3172005263489739</span>, <span class="number">0.9719044792798428</span>, -<span class="number">0.36981146090600725</span>, -<span class="number">0.4860894583077995</span>, <span class="number">0.95791889146345</span>], <span class="string">&quot;color&quot;</span>: <span class="string">&quot;pink_9298&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">4</span>, <span class="string">&quot;vector&quot;</span>: [<span class="number">0.4452349528804562</span>, -<span class="number">0.8757026943054742</span>, <span class="number">0.8220779437047674</span>, <span class="number">0.46406290649483184</span>, <span class="number">0.30337481143159106</span>], <span class="string">&quot;color&quot;</span>: <span class="string">&quot;red_4794&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">5</span>, <span class="string">&quot;vector&quot;</span>: [<span class="number">0.985825131989184</span>, -<span class="number">0.8144651566660419</span>, <span class="number">0.6299267002202009</span>, <span class="number">0.1206906911183383</span>, -<span class="number">0.1446277761879955</span>], <span class="string">&quot;color&quot;</span>: <span class="string">&quot;yellow_4222&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">6</span>, <span class="string">&quot;vector&quot;</span>: [<span class="number">0.8371977790571115</span>, -<span class="number">0.015764369584852833</span>, -<span class="number">0.31062937026679327</span>, -<span class="number">0.562666951622192</span>, -<span class="number">0.8984947637863987</span>], <span class="string">&quot;color&quot;</span>: <span class="string">&quot;red_9392&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">7</span>, <span class="string">&quot;vector&quot;</span>: [-<span class="number">0.33445148015177995</span>, -<span class="number">0.2567135004164067</span>, <span class="number">0.8987539745369246</span>, <span class="number">0.9402995886420709</span>, <span class="number">0.5378064918413052</span>], <span class="string">&quot;color&quot;</span>: <span class="string">&quot;grey_8510&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">8</span>, <span class="string">&quot;vector&quot;</span>: [<span class="number">0.39524717779832685</span>, <span class="number">0.4000257286739164</span>, -<span class="number">0.5890507376891594</span>, -<span class="number">0.8650502298996872</span>, -<span class="number">0.6140360785406336</span>], <span class="string">&quot;color&quot;</span>: <span class="string">&quot;white_9381&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">9</span>, <span class="string">&quot;vector&quot;</span>: [<span class="number">0.5718280481994695</span>, <span class="number">0.24070317428066512</span>, -<span class="number">0.3737913482606834</span>, -<span class="number">0.06726932177492717</span>, -<span class="number">0.6980531615588608</span>], <span class="string">&quot;color&quot;</span>: <span class="string">&quot;purple_4976&quot;</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">res = client.insert(</span><br><span class="line">    collection_name=<span class="string">&quot;quick_setup&quot;</span>,</span><br><span class="line">    data=data</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>æ›´æ–°å®ä½“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">update_data = [</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">0</span>, <span class="string">&quot;vector&quot;</span>: [random.random() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)], <span class="string">&quot;color&quot;</span>: <span class="string">&quot;updated_pink_8682&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;vector&quot;</span>: [random.random() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)], <span class="string">&quot;color&quot;</span>: <span class="string">&quot;updated_red_7025&quot;</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">res = client.upsert(</span><br><span class="line">    collection_name=<span class="string">&quot;quick_setup&quot;</span>,</span><br><span class="line">    data=update_data</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\næ›´æ–°ç»“æœ:&quot;</span>, res)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>åˆ é™¤å®ä½“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">res = client.delete(</span><br><span class="line">    collection_name=<span class="string">&quot;quick_setup&quot;</span>,</span><br><span class="line">    ids=[<span class="number">0</span>]</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nåˆ é™¤ç»“æœ:&quot;</span>, res)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>æŸ¥è¯¢å®ä½“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">client.flush(collection_name=<span class="string">&quot;quick_setup&quot;</span>) <span class="comment"># åˆ·æ–°å†…å­˜</span></span><br><span class="line"></span><br><span class="line">res = client.query(</span><br><span class="line">    collection_name=<span class="string">&quot;quick_setup&quot;</span>,</span><br><span class="line">    <span class="built_in">filter</span>=<span class="string">&quot;id in [1,2]&quot;</span>,</span><br><span class="line">    output_fields=[<span class="string">&quot;id&quot;</span>, <span class="string">&quot;color&quot;</span>]</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\næŸ¥è¯¢ç»“æœ:&quot;</span>, res)</span><br></pre></td></tr></table></figure></li></ol><h1 id="å…¶å®ƒæ¦‚å¿µ"><a href="#å…¶å®ƒæ¦‚å¿µ" class="headerlink" title="å…¶å®ƒæ¦‚å¿µ"></a>å…¶å®ƒæ¦‚å¿µ</h1><ul><li><strong>Partition</strong> - åˆ†åŒºæ˜¯é›†åˆçš„å­é›†ï¼Œä¸å…¶çˆ¶é›†åˆå…±äº«ç›¸åŒçš„å­—æ®µé›†ï¼Œæ¯ä¸ªåˆ†åŒºåŒ…å«ä¸€ä¸ªå®ä½“å­é›†ã€‚é€šè¿‡å°†å®ä½“åˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºï¼Œæ‚¨å¯ä»¥åˆ›å»ºå®ä½“ç»„ã€‚æ‚¨å¯ä»¥åœ¨ç‰¹å®šåˆ†åŒºå†…è¿›è¡Œæœç´¢å’ŒæŸ¥è¯¢ï¼Œè®©Milvus å¿½ç•¥å…¶ä»–åˆ†åŒºä¸­çš„å®ä½“ï¼Œä»è€Œæé«˜æœç´¢æ•ˆç‡ã€‚</li><li><strong>Shard</strong> - åˆ†ç‰‡æ˜¯é›†åˆçš„æ°´å¹³åˆ‡ç‰‡ã€‚æ¯ä¸ªåˆ†ç‰‡å¯¹åº”ä¸€ä¸ªæ•°æ®è¾“å…¥é€šé“ã€‚æ¯ä¸ªé›†åˆé»˜è®¤éƒ½æœ‰ä¸€ä¸ªåˆ†ç‰‡ã€‚æ‚¨å¯ä»¥æ ¹æ®é¢„æœŸååé‡å’Œè¦æ’å…¥åˆ°é›†åˆä¸­çš„æ•°æ®é‡ï¼Œåœ¨åˆ›å»ºé›†åˆæ—¶è®¾ç½®é€‚å½“çš„åˆ†ç‰‡æ•°é‡ã€‚ã€‚</li><li><strong>Alias</strong> - æ‚¨å¯ä»¥ä¸ºé›†åˆåˆ›å»ºåˆ«åã€‚ä¸€ä¸ªé›†åˆå¯ä»¥æœ‰å¤šä¸ªåˆ«åï¼Œä½†é›†åˆä¹‹é—´ä¸èƒ½å…±äº«ä¸€ä¸ªåˆ«åã€‚æ”¶åˆ°é’ˆå¯¹æŸä¸ªé›†åˆçš„è¯·æ±‚åï¼ŒMilvus ä¼šæ ¹æ®æä¾›çš„åç§°æŸ¥æ‰¾è¯¥é›†åˆã€‚</li><li><strong>Function</strong> - æ‚¨å¯ä»¥åœ¨ Milvus åˆ›å»ºé›†åˆæ—¶è®¾ç½®å‡½æ•°æ¥å¯¼å‡ºå­—æ®µã€‚ä¾‹å¦‚ï¼Œå…¨æ–‡æœç´¢åŠŸèƒ½ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä»ç‰¹å®šçš„ varchar å­—æ®µå¯¼å‡ºç¨€ç–å‘é‡å­—æ®µã€‚</li><li><strong>Consistency Leve</strong>l - åˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿé€šå¸¸ä½¿ç”¨ä¸€è‡´æ€§çº§åˆ«æ¥å®šä¹‰è·¨æ•°æ®èŠ‚ç‚¹å’Œå‰¯æœ¬çš„æ•°æ®ç›¸åŒæ€§ã€‚å¯ä»¥åœ¨åˆ›å»ºé›†åˆæˆ–åœ¨é›†åˆå†…è¿›è¡Œç›¸ä¼¼æ€§æœç´¢æ—¶è®¾ç½®å•ç‹¬çš„ä¸€è‡´æ€§çº§åˆ«ã€‚é€‚ç”¨çš„ä¸€è‡´æ€§çº§åˆ«åŒ…æ‹¬<strong>Strong</strong>, <strong>Bounded Staleness</strong>, <strong>Session</strong>, <strong>Eventually</strong></li></ul><h1 id="æ•°æ®ä¸€è‡´æ€§"><a href="#æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="æ•°æ®ä¸€è‡´æ€§"></a>æ•°æ®ä¸€è‡´æ€§</h1><div class="table-container"><table><thead><tr><th>ä¸€è‡´æ€§çº§åˆ«</th><th>å«ä¹‰</th><th>ç‰¹æ€§</th><th>å…¸å‹åœºæ™¯</th></tr></thead><tbody><tr><td>Strongï¼ˆä¸€è‡´æ€§ï¼‰</td><td>ä»»ä½•è¯»æ“ä½œéƒ½èƒ½ç«‹åˆ»çœ‹åˆ°æ‰€æœ‰å·²å®Œæˆå†™æ“ä½œçš„æœ€æ–°æ•°æ®ï¼Œä¿è¯â€œçº¿æ€§åŒ–â€</td><td>â€¢ æœ€é«˜è¯»å†™ä¸€è‡´æ€§<br>â€¢ å»¶è¿Ÿå’Œååå¯èƒ½å—é™äºå‰¯æœ¬åŒæ­¥é€Ÿåº¦</td><td>â€¢ å¯¹æ•°æ®å‡†ç¡®æ€§è¦æ±‚æé«˜çš„ä¸šåŠ¡ï¼Œå¦‚é‡‘èäº¤æ˜“ã€è®¢å•æ”¯ä»˜<br>â€¢ å†™å…¥ä¸è¯»å–å¼ºè€¦åˆçš„åœºæ™¯</td></tr><tr><td>Bounded Stalenessï¼ˆæœ‰ç•Œæ—¶æ»ä¸€è‡´æ€§ï¼‰</td><td>è¯»æ“ä½œå¯èƒ½çœ‹åˆ°æœ€æ–°å†™æ“ä½œä¹‹å‰çš„æ—§æ•°æ®ï¼Œä½†â€œè½åé‡â€å¯æ§</td><td>â€¢ æœ€é•¿æ—¶å»¶æˆ–ç‰ˆæœ¬å·®å¯é…ç½®ï¼ˆå¦‚æœ€å¤šæ»å5ç§’æˆ–3ä¸ªç‰ˆæœ¬ï¼‰<br>â€¢ åœ¨å¯æ¥å—å»¶è¿ŸèŒƒå›´å†…å…¼é¡¾æ€§èƒ½ä¸ä¸€è‡´æ€§</td><td>â€¢ ç¤¾äº¤åª’ä½“æ—¶åºæ•°æ®æ˜¾ç¤ºï¼Œåªè¦è¯¯å·®åœ¨å‡ ç§’ä»¥å†…å¯æ¥å—<br>â€¢ ä»ªè¡¨ç›˜ã€ç›‘æ§ç±»åœºæ™¯</td></tr><tr><td>Sessionï¼ˆä¼šè¯ä¸€è‡´æ€§ï¼‰</td><td>åŒä¸€å®¢æˆ·ç«¯ä¼šè¯å†…ï¼Œè¯»å†™æ“ä½œæŒ‰ç…§å®¢æˆ·ç«¯é¡ºåºä¸€è‡´ï¼›è·¨ä¼šè¯å¯è§æ€§æ— ä¿è¯</td><td>â€¢ ä¿è¯â€œè¯»å·²æ‰€å†™â€ã€â€œè¯»åå†™â€ã€â€œå†™åè¯»â€<br>â€¢ ä¸åŒå®¢æˆ·ç«¯ä¹‹é—´å¯èƒ½çœ‹åˆ°ä¸åŒç‰ˆæœ¬</td><td>â€¢ ç”¨æˆ·ä¸ªæ€§åŒ–æ“ä½œï¼šè‡ªå·±å†™å…¥çš„æ•°æ®è‡ªå·±å³åˆ»å¯è§<br>â€¢ èŠå¤©ã€ä¸ªäººè®¾ç½®ç­‰åœºæ™¯</td></tr><tr><td>Eventuallyï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰</td><td>å†™æ“ä½œä¼šè¢«å¼‚æ­¥ä¼ æ’­åˆ°æ‰€æœ‰å‰¯æœ¬ï¼ŒçŸ­æœŸå†…è¯»åˆ°æ—§æ•°æ®ï¼Œæœ€ç»ˆæ”¶æ•›åˆ°ä¸€è‡´</td><td>â€¢ å†™å…¥å»¶è¿Ÿæœ€ä½ã€ååæœ€é«˜<br>â€¢ ä¸ä¿è¯ä»»ä½•æ—¶åˆ»çš„ä¸€è‡´æ€§ï¼Œåªä¿è¯æœ€ç»ˆä¸€è‡´</td><td>â€¢ æµ·é‡æ—¥å¿—æ”¶é›†ã€åŸ‹ç‚¹æ•°æ®ã€ç¦»çº¿åˆ†æåœºæ™¯<br>â€¢ ç¼“å­˜å›æºã€CDNæ•°æ®åˆ†å‘</td></tr></tbody></table></div><ul><li>Strong(å¼ºä¸€è‡´æ€§):<ul><li>ä»»ä½•è¯»éƒ½èƒ½çœ‹åˆ°æœ€æ–°å†™ç»“æœ</li><li>é€‚ç”¨äºé‡‘èäº¤æ˜“ç­‰é«˜è¦æ±‚åœºæ™¯</li></ul></li><li>Bounded Staleness(æœ‰ç•Œæ—¶æ»):<ul><li>é»˜è®¤çº§åˆ«ï¼Œè½åé‡å¯æ§(å¦‚5ç§’å†…)</li><li>å…¼é¡¾æ€§èƒ½ä¸ä¸€è‡´æ€§</li></ul></li><li>Session(ä¼šè¯ä¸€è‡´æ€§):<ul><li>ä¿è¯åŒä¸€ä¼šè¯å†…çš„è¯»å†™é¡ºåº</li><li>é€‚ç”¨äºä¸ªæ€§åŒ–æ“ä½œåœºæ™¯</li></ul></li><li>Eventually(æœ€ç»ˆä¸€è‡´æ€§):<ul><li>å†™å…¥å»¶è¿Ÿæœ€ä½ï¼Œæœ€ç»ˆæ”¶æ•›ä¸€è‡´</li><li>é€‚ç”¨äºæ—¥å¿—æ”¶é›†ç­‰åœºæ™¯</li></ul></li></ul>]]></content>
    
    
    <summary type="html">å­¦ä¹ å¤§æ¨¡å‹RAGç³»ç»Ÿå­¦ä¹ ç¬”è®°ç¬¬äºŒåè®²</summary>
    
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>RAGç»„ä»¶--å‘é‡åµŒå…¥ä¹‹ç¨€ç–åµŒå…¥ã€å¯†é›†åµŒå…¥ã€æ··åˆæ£€ç´¢</title>
    <link href="https://jinglv.github.io/2025/08/15/ai/rag/17-embedding-technology/"/>
    <id>https://jinglv.github.io/2025/08/15/ai/rag/17-embedding-technology/</id>
    <published>2025-08-14T16:00:00.000Z</published>
    <updated>2025-08-15T01:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç¨€ç–åµŒå…¥ä¸å¯†é›†åµŒå…¥"><a href="#ç¨€ç–åµŒå…¥ä¸å¯†é›†åµŒå…¥" class="headerlink" title="ç¨€ç–åµŒå…¥ä¸å¯†é›†åµŒå…¥"></a>ç¨€ç–åµŒå…¥ä¸å¯†é›†åµŒå…¥</h1><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250815093602208.png" alt="image-20250815093602208" style="zoom:50%;" /></p><h2 id="ç¨€ç–åµŒå…¥"><a href="#ç¨€ç–åµŒå…¥" class="headerlink" title="ç¨€ç–åµŒå…¥"></a>ç¨€ç–åµŒå…¥</h2><ul><li>å®šä¹‰ï¼šæ—©æœŸè‡ªç„¶è¯­è¨€å¤„ç†ä¸­åŸºäºè¯é¢‘ç»Ÿè®¡çš„åµŒå…¥æ–¹å¼</li><li>å½¢æˆæ–¹å¼ï¼šé€šè¿‡è¯é¢‘æˆ–n-gramç»Ÿè®¡è¯åœ¨æ–‡æ¡£ä¸­å‡ºç°æ¬¡æ•°</li><li>ç¨€ç–æ€§åŸå› ï¼šç»´åº¦ä¸è¯å…¸å¤§å°ç›¸åŒï¼ˆå¦‚ç°ä»£æ±‰è¯­å­—å…¸å‡ ä¸‡å­—å¯¹åº”å‡ ä¸‡ç»´ï¼‰</li><li>å­˜å‚¨æ–¹å¼ï¼šå‡ºç°è¯æ ‡è®°ä¸º1ï¼ˆå¦‚â€é»‘ç¥è¯æ‚Ÿç©ºâ€åœ¨3000ã€5000ã€8000ç»´æ ‡è®°1ï¼‰ï¼Œæœªå‡ºç°è¯å‡ä¸º0</li><li>å…¸å‹ç¤ºä¾‹ï¼šæ¸¸æˆè§’è‰²ç‰¹å¾æ ‡ç­¾ï¼ˆé‡‘ç®æ£’:1ï¼Œä¸ƒåäºŒå˜:1ï¼Œç­‹æ–—äº‘:1ç­‰ï¼‰</li></ul><p>ç¨€ç–åµŒå…¥çš„ç‰¹å®šåœºæ™¯åº”ç”¨</p><ul><li>ä¿ç•™ä»·å€¼ï¼š<ul><li>ç²¾ç¡®åŒ¹é…ç‰¹å®šå…³é”®è¯ï¼ˆå¦‚æ¸¸æˆä¸­çš„â€é‡‘ç®æ£’â€ï¼‰</li><li>å¿«é€Ÿè¿‡æ»¤æœªå‡ºç°çš„å…³é”®è¯ï¼ˆå¾—åˆ†ä¸º0ï¼‰</li><li>å¤„ç†æ˜ç¡®ç‰¹å¾æ ‡ç­¾ï¼ˆå¦‚è§’è‰²å±æ€§ã€æŠ€èƒ½åç§°ï¼‰</li></ul></li><li>æ··åˆæ£€ç´¢ï¼šç»“åˆç¨€ç–åµŒå…¥çš„ç²¾ç¡®åŒ¹é…å’Œå¯†é›†åµŒå…¥çš„è¯­ä¹‰ç†è§£ä¼˜åŠ¿</li></ul><h2 id="å¯†é›†åµŒå…¥"><a href="#å¯†é›†åµŒå…¥" class="headerlink" title="å¯†é›†åµŒå…¥"></a>å¯†é›†åµŒå…¥</h2><ul><li>ç°ä»£ä¸»æµï¼šå¤§è¯­è¨€æ¨¡å‹æ—¶ä»£ä¸»è¦ä½¿ç”¨çš„åµŒå…¥å½¢å¼</li><li>ç”Ÿæˆæ–¹å¼ï¼šé€šè¿‡transformeræ¶æ„è®¡ç®—ï¼ŒåŸºäºæ–‡æ¡£ç›¸ä¼¼åº¦ç‰¹å¾æå–</li><li>ç‰¹ç‚¹ï¼š<ul><li>è¿ç»­å®æ•°å€¼ï¼ˆå¦‚[0.2,-0.5,0.8]ï¼‰</li><li>ç»´åº¦è¾ƒå°ï¼ˆé€šå¸¸128-256ç»´ï¼‰</li><li>ç‰¹å¾è‡ªåŠ¨å­¦ä¹ å¾—åˆ°</li></ul></li><li>ä¼˜åŠ¿ï¼šèƒ½æ•æ‰è¯­ä¹‰ç›¸ä¼¼åº¦ï¼Œé€‚åˆå¤„ç†æŠ½è±¡è¯­ä¹‰å…³ç³»</li></ul><h1 id="ç¨€ç–åµŒå…¥ä¸å¯†é›†åµŒå…¥çš„ç»“åˆä½¿ç”¨"><a href="#ç¨€ç–åµŒå…¥ä¸å¯†é›†åµŒå…¥çš„ç»“åˆä½¿ç”¨" class="headerlink" title="ç¨€ç–åµŒå…¥ä¸å¯†é›†åµŒå…¥çš„ç»“åˆä½¿ç”¨"></a>ç¨€ç–åµŒå…¥ä¸å¯†é›†åµŒå…¥çš„ç»“åˆä½¿ç”¨</h1><ul><li>åº”ç”¨åœºæ™¯ï¼šæ¸¸æˆé—®ç­”ç³»ç»Ÿä¸­æŸ¥è¯¢ç‰¹å®šæ­¦å™¨/æŠ€èƒ½æ—¶</li><li>ååŒæ•ˆåº”ï¼š<ul><li>ç¨€ç–åµŒå…¥å¿«é€Ÿå®šä½å«å…³é”®è¯æ®µè½</li><li>å¯†é›†åµŒå…¥ç†è§£è¯­ä¹‰ç›¸å…³ä½†è¡¨è¿°ä¸åŒçš„å†…å®¹</li></ul></li><li>ç¤ºä¾‹ï¼šæŸ¥è¯¢â€æ‚Ÿç©ºçš„æ­¦å™¨åœ¨å“ªäº›å…³å¡ç®¡ç”¨â€æ—¶ï¼Œç¨€ç–åµŒå…¥èƒ½ç²¾å‡†åŒ¹é…â€é‡‘ç®æ£’â€ç›¸å…³æ®µè½</li></ul><h1 id="ç¨€ç–åµŒå…¥çš„ç‰¹å¾æ ‡ç­¾è¡¨ç¤ºå½¢å¼"><a href="#ç¨€ç–åµŒå…¥çš„ç‰¹å¾æ ‡ç­¾è¡¨ç¤ºå½¢å¼" class="headerlink" title="ç¨€ç–åµŒå…¥çš„ç‰¹å¾æ ‡ç­¾è¡¨ç¤ºå½¢å¼"></a>ç¨€ç–åµŒå…¥çš„ç‰¹å¾æ ‡ç­¾è¡¨ç¤ºå½¢å¼</h1><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250815093846348.png" alt="image-20250815093846348" style="zoom:50%;" /></p><ul><li>æ ‡ç­¾åŒ–è¡¨ç¤ºï¼šå°†ç‰¹å¾è½¬åŒ–ä¸ºäºŒè¿›åˆ¶æ ‡è®°ï¼ˆå­˜åœ¨=1ï¼Œä¸å­˜åœ¨=0ï¼‰</li><li>ç°ä»£å‘å±•ï¼šä»ç®€å•0/1æ ‡è®°å‘å±•ä¸ºå¸¦æƒé‡çš„å®æ•°è¡¨ç¤ºï¼ˆå¦‚é‡‘ç®æ£’:0.82ï¼‰</li><li>ç±»æ¯”ç†è§£ï¼šå¯è§†ä¸ºæ›´ç²¾ç¡®çš„å…³é”®è¯æ£€ç´¢ç³»ç»Ÿ</li></ul><h1 id="å‘é‡ç±»å‹çš„å¯¹æ¯”"><a href="#å‘é‡ç±»å‹çš„å¯¹æ¯”" class="headerlink" title="å‘é‡ç±»å‹çš„å¯¹æ¯”"></a>å‘é‡ç±»å‹çš„å¯¹æ¯”</h1><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250815094142413.png" alt="image-20250815094142413" style="zoom:50%;" /></p><ul><li>ä¸»è¦ç±»å‹ï¼š<ul><li>Float Vectorï¼ˆå¯†é›†åµŒå…¥ï¼‰</li><li>Sparse Float Vectorï¼ˆç¨€ç–å®æ•°å‘é‡ï¼‰</li><li>Binary Vectorï¼ˆç¨€ç–åµŒå…¥ç®€åŒ–å½¢å¼ï¼‰</li></ul></li></ul><h2 id="Sparse-Float-Vectorï¼ˆç¨€ç–å®æ•°å‘é‡ï¼‰"><a href="#Sparse-Float-Vectorï¼ˆç¨€ç–å®æ•°å‘é‡ï¼‰" class="headerlink" title="Sparse Float Vectorï¼ˆç¨€ç–å®æ•°å‘é‡ï¼‰"></a>Sparse Float Vectorï¼ˆç¨€ç–å®æ•°å‘é‡ï¼‰</h2><ul><li>å­˜å‚¨æ–¹å¼ï¼šé”®å€¼å¯¹è¡¨ç¤ºï¼ˆå¦‚(1:0.5, 5:-0.3, 8:0.7)ï¼‰</li><li>ç‰¹ç‚¹ï¼š<ul><li>åªå­˜å‚¨éé›¶å€¼</li><li>ç»´åº¦å¯ä»¥éå¸¸å¤§ï¼ˆå‡ ä¸‡ç»´ï¼‰</li><li>ç°ä»£ç¨€ç–å‘é‡åŒ…å«æƒé‡å€¼ï¼ˆéç®€å•0/1ï¼‰</li></ul></li></ul><h2 id="Binary-Vectorï¼ˆç¨€ç–åµŒå…¥çš„ç®€åŒ–å½¢å¼ï¼‰"><a href="#Binary-Vectorï¼ˆç¨€ç–åµŒå…¥çš„ç®€åŒ–å½¢å¼ï¼‰" class="headerlink" title="Binary Vectorï¼ˆç¨€ç–åµŒå…¥çš„ç®€åŒ–å½¢å¼ï¼‰"></a>Binary Vectorï¼ˆç¨€ç–åµŒå…¥çš„ç®€åŒ–å½¢å¼ï¼‰</h2><ul><li>ç‰¹ç‚¹ï¼š<ul><li>ä»…åŒ…å«0å’Œ1</li><li>è¡¨ç¤ºç‰¹å¾å­˜åœ¨ä¸å¦</li><li>æ¨èç³»ç»Ÿä¸­ç”¨æˆ·ç”»åƒçš„å…¸å‹è¡¨ç¤ºæ–¹å¼</li></ul></li><li>ç¤ºä¾‹ï¼šæ·˜å®ç”¨æˆ·æ ‡ç­¾ç³»ç»Ÿï¼ˆæ€§åˆ«ã€æ¶ˆè´¹åå¥½ç­‰ï¼‰</li></ul><h2 id="ç¨€ç–åµŒå…¥ä¸å¯†é›†åµŒå…¥çš„å…³ç³»"><a href="#ç¨€ç–åµŒå…¥ä¸å¯†é›†åµŒå…¥çš„å…³ç³»" class="headerlink" title="ç¨€ç–åµŒå…¥ä¸å¯†é›†åµŒå…¥çš„å…³ç³»"></a>ç¨€ç–åµŒå…¥ä¸å¯†é›†åµŒå…¥çš„å…³ç³»</h2><ul><li>å®ç°å½¢å¼ï¼š<ul><li>å¯†é›†åµŒå…¥ â†’ Float Vector</li><li>ç¨€ç–åµŒå…¥ â†’ Binary Vectoræˆ–Sparse Float Vector</li></ul></li><li>æ ¸å¿ƒåŒºåˆ«ï¼š<ul><li>å¯†é›†åµŒå…¥æ‰€æœ‰ä½ç½®éƒ½æœ‰å€¼</li><li>ç¨€ç–åµŒå…¥å¤§éƒ¨åˆ†ä½ç½®ä¸º0</li></ul></li></ul><h1 id="BM25ï¼šå…¸å‹çš„ç¨€ç–åµŒå…¥å®ç°"><a href="#BM25ï¼šå…¸å‹çš„ç¨€ç–åµŒå…¥å®ç°" class="headerlink" title="BM25ï¼šå…¸å‹çš„ç¨€ç–åµŒå…¥å®ç°"></a>BM25ï¼šå…¸å‹çš„ç¨€ç–åµŒå…¥å®ç°</h1><p>æ–‡æœ¬ï¼šâ€œçŒ¢ç‹²æ–½å±•çƒˆç„°æ‹³ï¼Œå‡»é€€å¦–æ€ªï¼›éšåå¼€å¯é‡‘åˆšä½“ï¼ŒæŠµæŒ¡ç¥å…µæ”»å‡»ã€‚â€å¦‚è¯è¡¨åŒ…å«10 000ä¸ªè¯ï¼Œä½†ä½œä¸ºç¨€ç–å‘é‡åªæœ‰ç‰¹å®šç»´åº¦æœ‰å€¼ï¼Œä¾‹å¦‚103ç»´ã€302ç»´ç­‰ï¼Œåˆ†åˆ«å¯¹åº”â€œé‡‘åˆšä½“â€â€œç­ç¥çºªâ€â€œçŒ¢ç‹²â€ç­‰è¯çš„æƒé‡ã€‚</p><script type="math/tex; mode=display">\text{score}(w) = \text{IDF}(w) \cdot \frac{\text{TF}(w) \cdot (k_1 + 1)}{\text{TF}(w) + k_1 \cdot \left(1 - b + b \cdot \frac{\text{æ–‡æ¡£é•¿åº¦}}{\text{å¹³å‡æ–‡æ¡£é•¿åº¦}}\right)}</script><ul><li>å‚æ•°è¯´æ˜ï¼š<ul><li>ï»¿$k_1$ï»¿ï¼šæ§åˆ¶è¯é¢‘å¯¹æƒé‡çš„å½±å“ï¼ˆå–å€¼1-2ï¼‰</li><li>ï»¿$b$ï»¿ï¼šæ–‡æ¡£é•¿åº¦å½’ä¸€åŒ–å‚æ•°ï¼ˆ0-1ï¼‰</li></ul></li><li>å‚æ•°è°ƒæ•´ï¼š<ul><li>æ–‡æ¡£é•¿åº¦å·®å¼‚å¤§æ—¶å¢åŠ bå€¼</li><li>å¼ºè°ƒè¯é¢‘é‡è¦æ€§æ—¶å¢åŠ k1å€¼</li></ul></li></ul><script type="math/tex; mode=display">\text{IDF}(w) = \log \frac{\text{æ€»æ–‡æ¡£æ•°} - \text{åŒ…å«è¯ } w \text{ çš„æ–‡æ¡£æ•°} + 0.5}{\text{åŒ…å«è¯ } w \text{ çš„æ–‡æ¡£æ•°} + 0.5} + 1</script><ul><li><h6 id="è¯é¢‘ï¼ˆTFï¼‰çš„è§£é‡Šä¸è®¡ç®—"><a href="#è¯é¢‘ï¼ˆTFï¼‰çš„è§£é‡Šä¸è®¡ç®—" class="headerlink" title="è¯é¢‘ï¼ˆTFï¼‰çš„è§£é‡Šä¸è®¡ç®—"></a>è¯é¢‘ï¼ˆTFï¼‰çš„è§£é‡Šä¸è®¡ç®—</h6><ul><li>è®¡ç®—æ–¹å¼ï¼šè¯åœ¨å½“å‰æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°</li><li>ç¤ºä¾‹ï¼šâ€æ‚Ÿç©ºâ€å‡ºç°3æ¬¡åˆ™TF=3</li><li>åŸºç¡€ä½œç”¨ï¼šå•ç‹¬ä½¿ç”¨TFå³å¯ç”Ÿæˆç®€å•ç¨€ç–å‘é‡</li></ul></li><li><h6 id="é€†æ–‡æ¡£é¢‘ç‡ï¼ˆIDFï¼‰çš„æ¦‚å¿µä¸é‡è¦æ€§"><a href="#é€†æ–‡æ¡£é¢‘ç‡ï¼ˆIDFï¼‰çš„æ¦‚å¿µä¸é‡è¦æ€§" class="headerlink" title="é€†æ–‡æ¡£é¢‘ç‡ï¼ˆIDFï¼‰çš„æ¦‚å¿µä¸é‡è¦æ€§"></a>é€†æ–‡æ¡£é¢‘ç‡ï¼ˆIDFï¼‰çš„æ¦‚å¿µä¸é‡è¦æ€§</h6><ul><li>å®šä¹‰ï¼šè¡¡é‡è¯åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­çš„å…¨å±€é‡è¦æ€§</li><li>æ ¸å¿ƒæ€æƒ³ï¼š<ul><li>åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­é¢‘ç¹å‡ºç°çš„è¯ï¼ˆå¦‚â€çš„â€ã€â€æ˜¯â€ï¼‰é‡è¦æ€§ä½</li><li>åœ¨å°‘æ•°æ–‡æ¡£ä¸­é«˜é¢‘å‡ºç°çš„è¯é‡è¦æ€§é«˜</li></ul></li></ul></li></ul><h2 id="BM25çš„åº”ç”¨å®ä¾‹ä¸è§£é‡Š"><a href="#BM25çš„åº”ç”¨å®ä¾‹ä¸è§£é‡Š" class="headerlink" title="BM25çš„åº”ç”¨å®ä¾‹ä¸è§£é‡Š"></a>BM25çš„åº”ç”¨å®ä¾‹ä¸è§£é‡Š</h2><ul><li>ç¤ºä¾‹æ–‡æœ¬ï¼šâ€çŒ¢ç‹²æ–½å±•çƒˆç„°æ‹³ï¼Œå‡»é€€å¦–æ€ªï¼›éšåå¼€å¯é‡‘åˆšä½“ï¼ŒæŠµæŒ¡ç¥å…µæ”»å‡»â€</li><li>å¤„ç†è¿‡ç¨‹ï¼š<ul><li>ä¸‡ç»´è¯è¡¨ä¸­åªæœ‰ç‰¹å®šç»´åº¦æœ‰å€¼ï¼ˆå¦‚103ç»´â€é‡‘åˆšä½“â€ï¼‰</li><li>è®¡ç®—å„å…³é”®è¯çš„BM25å¾—åˆ†</li></ul></li><li>æ¯”è¾ƒç¤ºä¾‹ï¼š<ul><li>â€œé‡‘ç®æ£’â€åœ¨æ®µè½å‡ºç°3æ¬¡ï¼Œå…¨å±€å‡ºç°å°‘ â†’ é«˜åˆ†</li><li>â€œæ‚Ÿç©ºâ€åœ¨æ®µè½å‡ºç°3æ¬¡ï¼Œä½†å…¨å±€å‡ºç°ä¸‡æ¬¡ â†’ ç›¸å¯¹ä½åˆ†</li></ul></li></ul><h2 id="BM25åœ¨å¤§æ¨¡å‹æ—¶ä»£çš„åº”ç”¨ä»·å€¼"><a href="#BM25åœ¨å¤§æ¨¡å‹æ—¶ä»£çš„åº”ç”¨ä»·å€¼" class="headerlink" title="BM25åœ¨å¤§æ¨¡å‹æ—¶ä»£çš„åº”ç”¨ä»·å€¼"></a>BM25åœ¨å¤§æ¨¡å‹æ—¶ä»£çš„åº”ç”¨ä»·å€¼</h2><ul><li>å¿«é€Ÿè¿‡æ»¤ï¼šå¯¹æœªå‡ºç°å…³é”®è¯å¾—åˆ†ä¸º0ï¼Œæ£€ç´¢æ•ˆç‡é«˜</li><li>ç²¾ç¡®åŒ¹é…ï¼šå¯¹å¼ºç‰¹å¾æ ‡ç­¾ï¼ˆå¦‚ç‰¹å®šæ­¦å™¨åï¼‰æ£€ç´¢å‡†ç¡®</li><li>æ··åˆä¼˜åŠ¿ï¼šä¸å¯†é›†åµŒå…¥é…åˆå®ç°å¿«é€Ÿç²¾ç¡®çš„æ··åˆæ£€ç´¢</li></ul><p>ç¤ºä¾‹ä»£ç ï¼šç¨€ç–å‘é‡çš„å®ç°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Timeï¼š2025/8/15 10:01</span></span><br><span class="line"><span class="comment"># @Authorï¼šjinglv</span></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line"><span class="comment"># çŒ¢ç‹²çš„æˆ˜æ–—æ—¥å¿—</span></span><br><span class="line">battle_logs = [</span><br><span class="line">    <span class="string">&quot;çŒ¢ç‹²ï¼Œæ–½å±•ï¼Œçƒˆç„°æ‹³ï¼Œå‡»é€€ï¼Œå¦–æ€ªï¼›éšåå¼€å¯ï¼Œé‡‘åˆšä½“ï¼ŒæŠµæŒ¡ï¼Œç¥å…µï¼Œæ”»å‡»ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å¦–æ€ªï¼Œä½¿ç”¨ï¼Œå¯’å†°ç®­ï¼Œæ”»å‡»ï¼ŒçŒ¢ç‹²ï¼Œä½†è¢«ï¼Œçƒˆç„°æ‹³ï¼Œåå‡»ï¼Œå‡»æºƒã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;çŒ¢ç‹²ï¼Œå¬å”¤ï¼Œçƒˆç„°æ‹³ï¼Œä¸ï¼Œæ¯ç­å’†å“®ï¼Œå‡»è´¥ï¼Œå¦–æ€ªï¼Œéšåï¼Œæ”¶é›†ï¼Œå¦–æ€ªï¼Œç²¾åã€‚&quot;</span></span><br><span class="line">]</span><br><span class="line"><span class="comment"># è¶…å‚æ•°</span></span><br><span class="line">k1 = <span class="number">1.5</span></span><br><span class="line">b = <span class="number">0.75</span></span><br><span class="line"><span class="comment"># æ„å»ºè¯è¡¨</span></span><br><span class="line">vocabulary = <span class="built_in">set</span>(word <span class="keyword">for</span> log <span class="keyword">in</span> battle_logs <span class="keyword">for</span> word <span class="keyword">in</span> log.split(<span class="string">&quot;ï¼Œ&quot;</span>))</span><br><span class="line">vocab_to_idx = &#123;word: idx <span class="keyword">for</span> idx, word <span class="keyword">in</span> <span class="built_in">enumerate</span>(vocabulary)&#125;</span><br><span class="line"><span class="comment"># è®¡ç®—IDF</span></span><br><span class="line">N = <span class="built_in">len</span>(battle_logs)</span><br><span class="line">df = Counter(word <span class="keyword">for</span> log <span class="keyword">in</span> battle_logs <span class="keyword">for</span> word <span class="keyword">in</span> <span class="built_in">set</span>(log.split(<span class="string">&quot;ï¼Œ&quot;</span>)))</span><br><span class="line">idf = &#123;word: math.log((N - df[word] + <span class="number">0.5</span>) / (df[word] + <span class="number">0.5</span>) + <span class="number">1</span>) <span class="keyword">for</span> word <span class="keyword">in</span> vocabulary&#125;</span><br><span class="line"><span class="comment"># æ—¥å¿—é•¿åº¦ä¿¡æ¯</span></span><br><span class="line">avg_log_len = <span class="built_in">sum</span>(<span class="built_in">len</span>(log.split(<span class="string">&quot;ï¼Œ&quot;</span>)) <span class="keyword">for</span> log <span class="keyword">in</span> battle_logs) / N</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># BM25ç¨€ç–åµŒå…¥ç”Ÿæˆ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bm25_sparse_embedding</span>(<span class="params">log</span>):</span><br><span class="line">    tf = Counter(log.split(<span class="string">&quot;ï¼Œ&quot;</span>))</span><br><span class="line">    log_len = <span class="built_in">len</span>(log.split(<span class="string">&quot;ï¼Œ&quot;</span>))</span><br><span class="line">    embedding = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> word, freq <span class="keyword">in</span> tf.items():</span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">in</span> vocabulary:</span><br><span class="line">            idx = vocab_to_idx[word]</span><br><span class="line">            score = idf[word] * (freq * (k1 + <span class="number">1</span>)) / (freq + k1 * (<span class="number">1</span> - b + b * log_len / avg_log_len))</span><br><span class="line">            embedding[idx] = score</span><br><span class="line">    <span class="keyword">return</span> embedding</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆç¨€ç–å‘é‡</span></span><br><span class="line"><span class="keyword">for</span> log <span class="keyword">in</span> battle_logs:</span><br><span class="line">    sparse_embedding = bm25_sparse_embedding(log)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ç¨€ç–åµŒå…¥ï¼š <span class="subst">&#123;sparse_embedding&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼Œå†…å®¹è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¨€ç–åµŒå…¥ï¼š &#123;1: 0.12572760993867385, 21: 0.9235080629006516, 2: 0.12572760993867385, 11: 0.9235080629006516, 10: 0.9235080629006516, 7: 0.9235080629006516, 19: 0.6429294928361478, 12: 0.9235080629006516, 3: 0.9235080629006516, 16: 0.9235080629006516&#125;</span><br></pre></td></tr></table></figure><h3 id="LangChainå®ç°BM25çš„åµŒå…¥æ£€ç´¢"><a href="#LangChainå®ç°BM25çš„åµŒå…¥æ£€ç´¢" class="headerlink" title="LangChainå®ç°BM25çš„åµŒå…¥æ£€ç´¢"></a>LangChainå®ç°BM25çš„åµŒå…¥æ£€ç´¢</h3><p>å®‰è£…åŒ…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install rank_bm25</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Timeï¼š2025/8/15 10:06</span></span><br><span class="line"><span class="comment"># @Authorï¼šjinglv</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">from</span> langchain_community.retrievers <span class="keyword">import</span> BM25Retriever  <span class="comment"># pip install rank_bm25</span></span><br><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Chroma  <span class="comment"># pip install chromadb</span></span><br><span class="line"><span class="keyword">from</span> langchain_core.documents <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line">battle_logs = [</span><br><span class="line">    <span class="string">&quot;çŒ¢ç‹²èº«æŠ«é”å­ç”²ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;çŒ¢ç‹²åœ¨æ— å›è°·é­é‡äº†å¦–æ€ªï¼Œå¦–æ€ªå¼€å§‹æ”»å‡»ï¼ŒçŒ¢ç‹²ä½¿ç”¨é“œäº‘æ£’æŠµæŒ¡ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;çŒ¢ç‹²æ–½å±•çƒˆç„°æ‹³å‡»é€€å¦–æ€ªéšåå¼€å¯é‡‘åˆšä½“æŠµæŒ¡ç¥å…µæ”»å‡»ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å¦–æ€ªä½¿ç”¨å¯’å†°ç®­æ”»å‡»çŒ¢ç‹²ä½†è¢«çƒˆç„°æ‹³åå‡»å‡»æºƒã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;çŒ¢ç‹²å¬å”¤çƒˆç„°æ‹³ä¸æ¯ç­å’†å“®å‡»è´¥å¦–æ€ªéšåæ”¶é›†å¦–æ€ªç²¾åã€‚&quot;</span></span><br><span class="line">]</span><br><span class="line">request = <span class="string">&quot;çŒ¢ç‹²æœ‰ä»€ä¹ˆè£…å¤‡å’Œæ‹›æ•°ï¼Ÿ&quot;</span></span><br><span class="line"></span><br><span class="line">bm25_retriever = BM25Retriever.from_texts(battle_logs)</span><br><span class="line">bm25_response = bm25_retriever.invoke(request)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;BM25æ£€ç´¢ç»“æœï¼š\n<span class="subst">&#123;bm25_response&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">docs = [Document(page_content=log) <span class="keyword">for</span> log <span class="keyword">in</span> battle_logs]</span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. è®¾ç½®åµŒå…¥æ¨¡å‹</span></span><br><span class="line"><span class="keyword">from</span> langchain_huggingface <span class="keyword">import</span> HuggingFaceEmbeddings  <span class="comment"># pip install langchain-huggingface</span></span><br><span class="line"></span><br><span class="line">embeddings = HuggingFaceEmbeddings(</span><br><span class="line">    model_name=<span class="string">&quot;BAAI/bge-small-zh&quot;</span>,</span><br><span class="line">    model_kwargs=&#123;<span class="string">&#x27;device&#x27;</span>: <span class="string">&#x27;cpu&#x27;</span>&#125;,</span><br><span class="line">    encode_kwargs=&#123;<span class="string">&#x27;normalize_embeddings&#x27;</span>: <span class="literal">True</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">chroma_vs = Chroma.from_documents(</span><br><span class="line">    docs,</span><br><span class="line">    embedding=embeddings</span><br><span class="line">    <span class="comment"># embedding=OpenAIEmbeddings(</span></span><br><span class="line">    <span class="comment">#     model=&quot;text-embedding-3-small&quot;,</span></span><br><span class="line">    <span class="comment">#     api_key=os.getenv(&quot;DEEPSEEK_API_KEY&quot;),  # ä»ç¯å¢ƒå˜é‡åŠ è½½API key</span></span><br><span class="line">    <span class="comment">#     base_url=os.getenv(&quot;DEEPSEEK_BASE_URL&quot;)</span></span><br><span class="line">    <span class="comment"># )</span></span><br><span class="line">)</span><br><span class="line">chroma_retriever = chroma_vs.as_retriever()</span><br><span class="line">chroma_response = chroma_retriever.invoke(request)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Chromaæ£€ç´¢ç»“æœï¼š\n<span class="subst">&#123;chroma_response&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># hybrid_response = list(&#123;doc.page_content for doc in bm25_response&#125;) # ç¼ºé”å­ç”²</span></span><br><span class="line"><span class="comment"># hybrid_response = list(&#123;doc.page_content for doc in chroma_response&#125;) # ç¼ºé“œäº‘æ£’</span></span><br><span class="line">hybrid_response = <span class="built_in">list</span>(&#123;doc.page_content <span class="keyword">for</span> doc <span class="keyword">in</span> bm25_response + chroma_response&#125;)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ··åˆæ£€ç´¢ç»“æœï¼š\n<span class="subst">&#123;hybrid_response&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">prompt = ChatPromptTemplate.from_template(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡ï¼Œå›ç­”é—®é¢˜ã€‚å¦‚æœä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œ</span></span><br><span class="line"><span class="string">                è¯·è¯´&quot;æˆ‘æ— æ³•ä»æä¾›çš„ä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ°ç›¸å…³ä¿¡æ¯&quot;ã€‚</span></span><br><span class="line"><span class="string">                ä¸Šä¸‹æ–‡: &#123;context&#125;</span></span><br><span class="line"><span class="string">                é—®é¢˜: &#123;question&#125;</span></span><br><span class="line"><span class="string">                å›ç­”:&quot;&quot;&quot;</span></span><br><span class="line">                                          )</span><br><span class="line"></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=os.getenv(<span class="string">&quot;DEEPSEEK_MODEL_NAME&quot;</span>),  <span class="comment"># DeepSeek API æ”¯æŒçš„æ¨¡å‹åç§°</span></span><br><span class="line">    api_key=os.getenv(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),  <span class="comment"># ä»ç¯å¢ƒå˜é‡åŠ è½½API key</span></span><br><span class="line">    base_url=os.getenv(<span class="string">&quot;DEEPSEEK_BASE_URL&quot;</span>)</span><br><span class="line">)</span><br><span class="line">doc_content = <span class="string">&quot;\n\n&quot;</span>.join(hybrid_response)</span><br><span class="line">answer = llm.invoke(prompt.<span class="built_in">format</span>(question=request, context=doc_content))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;LLMå›ç­”ï¼š\n<span class="subst">&#123;answer.content&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="BGE-â€“-M3æ¨¡å‹"><a href="#BGE-â€“-M3æ¨¡å‹" class="headerlink" title="BGE â€“ M3æ¨¡å‹"></a>BGE â€“ M3æ¨¡å‹</h1><p>ä¸ºä»€ä¹ˆå«ä½œM3ï¼Ÿ</p><ul><li>å¤šåŠŸèƒ½æ€§ï¼ˆMulti-Functionalityï¼‰ï¼šBGE-M3æ¨¡å‹é›†æˆäº†å¯†é›†æ£€ç´¢ã€ç¨€ç–æ£€ç´¢å’Œå¤šå‘é‡æ£€ç´¢3ç§åŠŸèƒ½ï¼Œèƒ½å¤Ÿçµæ´»åº”å¯¹ä¸åŒçš„æ£€ç´¢éœ€æ±‚ï¼Œæ˜¯ç›®å‰é¦–ä¸ªå®ç°ä¸‰åˆä¸€åŠŸèƒ½çš„åµŒå…¥æ¨¡å‹ã€‚</li><li>å¤šè¯­è¨€æ€§ï¼ˆMulti-Lingualityï¼‰ï¼šBGE-M3æ¨¡å‹æ”¯æŒè¶…è¿‡100ç§è¯­è¨€ï¼Œå…·å¤‡å¼ºå¤§çš„å¤šè¯­è¨€å’Œè·¨è¯­è¨€æ£€ç´¢èƒ½åŠ›ã€‚</li><li>å¤šç²’åº¦æ€§ï¼ˆMulti-Granularityï¼‰ï¼šBGE-M3æ¨¡å‹èƒ½å¤Ÿå¤„ç†ä»çŸ­å¥åˆ°é•¿è¾¾8192ä¸ªtokençš„é•¿æ–‡æ¡£ï¼Œæ»¡è¶³ä¸åŒé•¿åº¦æ–‡æœ¬çš„å¤„ç†éœ€æ±‚ï¼Œä¸Šä¸‹æ–‡æ”¯æŒèƒ½åŠ›çªå‡ºã€‚</li></ul><p>BGE â€“ M3å®é™…åº”ç”¨â€”ç¤ºä¾‹ä»£ç å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Timeï¼š2025/8/15 10:20</span></span><br><span class="line"><span class="comment"># @Authorï¼šjinglv</span></span><br><span class="line"><span class="keyword">from</span> FlagEmbedding <span class="keyword">import</span> BGEM3FlagModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    model = BGEM3FlagModel(<span class="string">&quot;BAAI/bge-m3&quot;</span>, use_fp16=<span class="literal">False</span>)</span><br><span class="line">    passage = [<span class="string">&quot;çŒ¢ç‹²æ–½å±•çƒˆç„°æ‹³ï¼Œå‡»é€€å¦–æ€ªï¼›éšåå¼€å¯é‡‘åˆšä½“ï¼ŒæŠµæŒ¡ç¥å…µæ”»å‡»ã€‚&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç¼–ç æ–‡æœ¬ï¼Œè·å–ç¨€ç–åµŒå…¥å’Œå¯†é›†åµŒå…¥</span></span><br><span class="line">    passage_embeddings = model.encode(</span><br><span class="line">        passage,</span><br><span class="line">        return_sparse=<span class="literal">True</span>,  <span class="comment"># è¿”å›ç¨€ç–åµŒå…¥</span></span><br><span class="line">        return_dense=<span class="literal">True</span>,  <span class="comment"># è¿”å›å¯†é›†åµŒå…¥</span></span><br><span class="line">        return_colbert_vecs=<span class="literal">True</span>  <span class="comment"># è¿”å›å¤šå‘é‡åµŒå…¥</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># åˆ†åˆ«æå–ç¨€ç–åµŒå…¥ã€å¯†é›†åµŒå…¥å’Œå¤šå‘é‡åµŒå…¥</span></span><br><span class="line">    dense_vecs = passage_embeddings[<span class="string">&quot;dense_vecs&quot;</span>]</span><br><span class="line">    sparse_vecs = passage_embeddings[<span class="string">&quot;lexical_weights&quot;</span>]</span><br><span class="line">    colbert_vecs = passage_embeddings[<span class="string">&quot;colbert_vecs&quot;</span>]</span><br><span class="line">    <span class="comment"># å±•ç¤ºç¨€ç–åµŒå…¥å’Œå¯†é›†åµŒå…¥çš„ç¤ºä¾‹</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¯†é›†åµŒå…¥ç»´åº¦:&quot;</span>, dense_vecs[<span class="number">0</span>].shape)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¯†é›†åµŒå…¥å‰10ç»´:&quot;</span>, dense_vecs[<span class="number">0</span>][:<span class="number">10</span>])  <span class="comment"># ä»…æ˜¾ç¤ºå‰10ç»´</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç¨€ç–åµŒå…¥æ€»é•¿åº¦:&quot;</span>, <span class="built_in">len</span>(sparse_vecs[<span class="number">0</span>]))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç¨€ç–åµŒå…¥å‰10ä¸ªéé›¶å€¼:&quot;</span>, <span class="built_in">list</span>(sparse_vecs[<span class="number">0</span>].items())[:<span class="number">10</span>])  <span class="comment"># ä»…æ˜¾ç¤ºå‰10ä¸ªéé›¶å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¤šå‘é‡åµŒå…¥ç»´åº¦:&quot;</span>, colbert_vecs[<span class="number">0</span>].shape)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¤šå‘é‡åµŒå…¥å‰2ä¸ª:&quot;</span>, colbert_vecs[<span class="number">0</span>][:<span class="number">2</span>])  <span class="comment"># ä»…æ˜¾ç¤ºå‰2ä¸ªå¤šå‘é‡åµŒå…¥</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼Œè¾“å‡ºå†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Fetching 30 files: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 30/30 [03:36&lt;00:00,  7.20s/it]</span><br><span class="line">You&#x27;re using a XLMRobertaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.</span><br><span class="line">å¯†é›†åµŒå…¥ç»´åº¦: (1024,)</span><br><span class="line">å¯†é›†åµŒå…¥å‰10ç»´: [ 0.01156895  0.02439202 -0.02763914 -0.00984312 -0.04426081 -0.02911922</span><br><span class="line">  0.03953079  0.02165183  0.01074662 -0.03528604]</span><br><span class="line">ç¨€ç–åµŒå…¥æ€»é•¿åº¦: 23</span><br><span class="line">ç¨€ç–åµŒå…¥å‰10ä¸ªéé›¶å€¼: [(&#x27;6&#x27;, np.float32(0.07354035)), (&#x27;28323&#x27;, np.float32(0.07607667)), (&#x27;8869&#x27;, np.float32(0.15832472)), (&#x27;48124&#x27;, np.float32(0.16404548)), (&#x27;213212&#x27;, np.float32(0.20880702)), (&#x27;75133&#x27;, np.float32(0.25368148)), (&#x27;4&#x27;, np.float32(0.05709526)), (&#x27;31833&#x27;, np.float32(0.11104022)), (&#x27;12461&#x27;, np.float32(0.18773066)), (&#x27;101184&#x27;, np.float32(0.18636808))]</span><br><span class="line">å¤šå‘é‡åµŒå…¥ç»´åº¦: (26, 1024)</span><br><span class="line">å¤šå‘é‡åµŒå…¥å‰2ä¸ª: [[-0.05067743  0.00912711 -0.0287432  ...  0.0251329   0.05133016</span><br><span class="line">  -0.00171831]</span><br><span class="line"> [-0.03439403 -0.00773524 -0.01304412 ...  0.01616604  0.01929808</span><br><span class="line">   0.01006441]]</span><br></pre></td></tr></table></figure><ul><li>å…¸å‹è¾“å‡ºç»´åº¦:<ul><li>å¯†é›†åµŒå…¥: 1024ç»´å‘é‡ï¼ˆå¦‚[0.01, -0.82, 0.03,â€¦]ï¼‰</li><li>ç¨€ç–åµŒå…¥: çº¦30ä¸‡ç»´ä¸­å‡ åä¸ªéé›¶å€¼ï¼ˆå¦‚{â€˜6â€™:0.073, â€˜28323â€™:0.076}ï¼‰</li><li>å¤šå‘é‡åµŒå…¥: (tokenæ•°, 1024)çŸ©é˜µï¼ˆå¦‚26ä¸ªtokenç”Ÿæˆ26Ã—1024çŸ©é˜µï¼‰</li></ul></li></ul><h2 id="æ ¸å¿ƒå†…å®¹æ€»ç»“"><a href="#æ ¸å¿ƒå†…å®¹æ€»ç»“" class="headerlink" title="æ ¸å¿ƒå†…å®¹æ€»ç»“"></a>æ ¸å¿ƒå†…å®¹æ€»ç»“</h2><ul><li>æ··åˆæ£€ç´¢ä¼˜åŠ¿:<ul><li>ç¨€ç–æ£€ç´¢: å¿«é€Ÿå®šä½å«å…³é”®è¯æ–‡æ¡£ï¼ˆå¦‚â€çƒˆç„°æ‹³â€ï¼‰</li><li>å¯†é›†æ£€ç´¢: æŒ‰è¯­ä¹‰ç›¸ä¼¼åº¦æ’åºï¼ˆå¦‚â€æˆ˜æ–—æ¿€çƒˆâ€åœºæ™¯ï¼‰</li><li>å¤šå‘é‡æ£€ç´¢: ç²¾ç»†åŒ¹é…tokençº§å…³ç³»ï¼ˆé‡æ’åºåœºæ™¯ï¼‰</li></ul></li><li>å…¸å‹åº”ç”¨åœºæ™¯:<ul><li>å¤šè¯­è¨€åœºæ™¯: å¯†é›†æ£€ç´¢ä¸»å¯¼è·¨è¯­è¨€åŒ¹é…</li><li>é•¿æ–‡æ¡£åœºæ™¯: ç¨€ç–æ£€ç´¢æ•æ‰å…³é”®ä¿¡æ¯</li><li>é«˜ç²¾åº¦éœ€æ±‚: å¤šå‘é‡æ£€ç´¢æå‡æ’åºè´¨é‡</li></ul></li></ul>]]></content>
    
    
    <summary type="html">å­¦ä¹ å¤§æ¨¡å‹RAGç³»ç»Ÿå­¦ä¹ ç¬”è®°ç¬¬åä¸ƒè®²</summary>
    
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>RAGç»„ä»¶--å‘é‡åµŒå…¥ä¹‹å¤šæ¨¡æ€åµŒå…¥æŠ€æœ¯</title>
    <link href="https://jinglv.github.io/2025/08/15/ai/rag/18-embedding-multi/"/>
    <id>https://jinglv.github.io/2025/08/15/ai/rag/18-embedding-multi/</id>
    <published>2025-08-14T16:00:00.000Z</published>
    <updated>2025-08-15T02:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¤šæ¨¡æ€çš„RAGç³»ç»Ÿ"><a href="#å¤šæ¨¡æ€çš„RAGç³»ç»Ÿ" class="headerlink" title="å¤šæ¨¡æ€çš„RAGç³»ç»Ÿ"></a>å¤šæ¨¡æ€çš„RAGç³»ç»Ÿ</h1><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250815103626944.png" alt="image-20250815103626944"></p><h1 id="Visualized-BGEæ¨¡å‹"><a href="#Visualized-BGEæ¨¡å‹" class="headerlink" title="Visualized_BGEæ¨¡å‹"></a>Visualized_BGEæ¨¡å‹</h1><p>GitHubåœ°å€ï¼š<a href="https://github.com/FlagOpen/FlagEmbedding/blob/master/research/visual_bge/README.md">https://github.com/FlagOpen/FlagEmbedding/blob/master/research/visual_bge/README.md</a></p><ul><li><p>å¤šæ¨¡æ€å¤„ç†èƒ½åŠ›ï¼šåœ¨åŒä¸€æ¨¡å‹æ¡†æ¶ä¸‹åŒæ—¶å¤„ç†å›¾åƒå’Œæ–‡æœ¬æ•°æ®ï¼Œæ”¯æŒå›¾ç‰‡å’Œæ–‡å­—çš„åŒæ¨¡æ€ç¼–ç ã€‚</p></li><li><p>ç»Ÿä¸€åµŒå…¥ç©ºé—´ï¼šå°†ä¸åŒæ¨¡æ€çš„æ•°æ®æ˜ å°„åˆ°åŒä¸€å‘é‡ç©ºé—´ï¼Œä¾¿äºè¿›è¡Œè·¨æ¨¡æ€çš„ç›¸ä¼¼åº¦è®¡ç®—ä¸æ£€ç´¢ã€‚</p></li><li><p>è·¨æ¨¡æ€æ£€ç´¢ï¼šå®ç°å›¾æ–‡äº’æœåŠŸèƒ½ï¼Œä¾‹å¦‚æ ¹æ®æ–‡å­—æè¿°æ£€ç´¢ç›¸å…³å›¾ç‰‡ï¼Œæˆ–æ ¹æ®å›¾ç‰‡æ£€ç´¢åŒ¹é…çš„æ–‡å­—æè¿°ã€‚</p></li><li><p>å®‰è£…æ³¨æ„äº‹é¡¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/FlagOpen/FlagEmbedding.git</span><br><span class="line">cd FlagEmbedding/research/visual_bge</span><br><span class="line">pip install -e .</span><br></pre></td></tr></table></figure></li></ul><ul><li>éœ€è¦å•ç‹¬å®‰è£…visual_bgeå­æ¨¡å—ï¼Œä¸èƒ½é€šè¿‡å®‰è£…FlagEmbeddingæ•´ä½“åŒ…è‡ªåŠ¨åŒ…å«</li><li>å¿…é¡»ä»FlagEmbedding/research/visual_bgeç›®å½•è¿›è¡Œå®‰è£…</li><li>æ ¸å¿ƒä¾èµ–åŒ…ï¼štorchvisionã€timmã€einopsã€ftfy â€”  <code>pip install torchvision timm einops ftfy</code></li><li>éå¿…è¦åŒ…ï¼šxformerå’Œapexå¯çœç•¥ï¼Œå¯èƒ½å¼•èµ·å®‰è£…é—®é¢˜</li></ul><ul><li><p>æ¨¡å‹æ”¯æŒï¼š</p><ul><li>ç›®å‰ä»…æ”¯æŒä¸¤ç§åŸºç¡€æ¨¡å‹ï¼šBAAI/bge-base-en-v1.5ï¼ˆ768ç»´ï¼‰å’ŒBAAI/bge-m3ï¼ˆ1024ç»´ï¼‰</li><li>æ¯ä¸ªåŸºç¡€æ¨¡å‹å¯¹åº”ä¸€å¯¹æ–‡æœ¬å’Œè§†è§‰æƒé‡æ–‡ä»¶ï¼ˆçº¦374MBï¼‰</li><li>æƒé‡æ–‡ä»¶éœ€è¦æ‰‹åŠ¨ä¸‹è½½å¹¶æŒ‡å®šè·¯å¾„</li></ul></li><li><p>ç¼–ç æ–¹å¼ï¼š</p><ul><li>æ”¯æŒçº¯å›¾ç‰‡ç¼–ç ã€çº¯æ–‡æœ¬ç¼–ç ä»¥åŠå›¾æ–‡æ··åˆç¼–ç </li><li>é€šè¿‡model.encode()æ–¹æ³•å®ç°ï¼Œå‚æ•°å¯å•ç‹¬æˆ–ç»„åˆä¼ å…¥imageå’Œtext</li></ul></li></ul><h1 id="å¤šæ¨¡æ€åµŒå…¥ç®€å•ç¤ºä¾‹"><a href="#å¤šæ¨¡æ€åµŒå…¥ç®€å•ç¤ºä¾‹" class="headerlink" title="å¤šæ¨¡æ€åµŒå…¥ç®€å•ç¤ºä¾‹"></a>å¤šæ¨¡æ€åµŒå…¥ç®€å•ç¤ºä¾‹</h1><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ç¼–ç å®è·µï¼š<ul><li>çº¯å›¾ç‰‡ç¼–ç ï¼šä»…ä¼ å…¥image_pathå‚æ•°</li><li>å¤šæ¨¡æ€ç¼–ç ï¼šåŒæ—¶ä¼ å…¥image_pathå’Œæè¿°æ–‡æœ¬</li><li>è¾“å‡ºå‘é‡ç»´åº¦ï¼šbase-en-v1.5ä¸º768ç»´ï¼Œm3ä¸º1024ç»´</li></ul></li><li>æƒé‡å‚æ•°è®¾è®¡ï¼š<ul><li>æ··åˆæ£€ç´¢ä¸­weightså‚æ•°æ§åˆ¶ç¨€ç–å’Œç¨ å¯†å‘é‡çš„ç›¸å¯¹é‡è¦æ€§</li><li>æƒé‡å€¼ä¸éœ€è¦æ€»å’Œä¸º1ï¼Œè¡¨ç¤ºçš„æ˜¯æ¯”ä¾‹å…³ç³»ï¼ˆå¦‚0.7:1.0ï¼‰</li><li>å®é™…åº”ç”¨ä¸­å¯æ ¹æ®æ£€ç´¢æ•ˆæœåŠ¨æ€è°ƒæ•´æƒé‡æ¯”ä¾‹</li></ul></li><li>ç¼–ç ç»“æœå·®å¼‚ï¼š<ul><li>çº¯å›¾ç‰‡åµŒå…¥å‘é‡ç¤ºä¾‹å€¼ï¼š[0.81775758, -0.02236984, â€¦]</li><li>å¤šæ¨¡æ€åµŒå…¥å‘é‡ç¤ºä¾‹å€¼ï¼š[0.02968888, -0.02825667, â€¦]</li><li>å‘é‡èŒƒæ•°ï¼šçº¯å›¾ç‰‡ä¸º1.0ï¼Œå¤šæ¨¡æ€ä¸º0.9999999403953552</li></ul></li><li>åº”ç”¨åœºæ™¯ï¼š<ul><li>ç”µå•†æ¨èç³»ç»Ÿï¼šé€šè¿‡å›¾ç‰‡æ£€ç´¢ç›¸ä¼¼äº§å“</li><li>å†…å®¹ç®¡ç†ï¼šå¯¹å›¾æ–‡åšå®¢è¿›è¡Œå¤šæ¨¡æ€ç¼–ç å’Œæ£€ç´¢</li><li>æ¸¸æˆåœºæ™¯æ£€ç´¢ï¼šåŸºäºæˆ˜æ–—åœºæ™¯å›¾ç‰‡æŸ¥æ‰¾ç±»ä¼¼æ¸¸æˆç”»é¢</li></ul></li></ul><h1 id="åµŒå…¥æŠ€æœ¯çš„æœ€æ–°è¿›å±•"><a href="#åµŒå…¥æŠ€æœ¯çš„æœ€æ–°è¿›å±•" class="headerlink" title="åµŒå…¥æŠ€æœ¯çš„æœ€æ–°è¿›å±•"></a>åµŒå…¥æŠ€æœ¯çš„æœ€æ–°è¿›å±•</h1><ul><li><p>å‘å±•æ–¹å‘</p><ul><li><p>å¤šè¯­è¨€ã€å¤šæ¨¡æ€ã€è½»é‡åŒ–ã€æ€§ä»·æ¯”ã€é•¿çª—å£ã€é«˜ç»´åº¦</p></li><li><p>Matryoshka Representation Learning (MRL)</p></li><li><p>é¢†åŸŸç‰¹å®šåµŒå…¥ï¼ˆVoyage AI çš„ voyage-finance-2ï¼‰</p></li><li><p>å›¾åµŒå…¥ï¼ˆçŸ¥è¯†å›¾è°±é›†æˆï¼‰</p></li><li><p>è‡ªé€‚åº”å’Œä¸Šä¸‹æ–‡æ„ŸçŸ¥ embedding / ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›çš„å¢å¼º</p></li><li><p>å±‚æ¬¡åŒ–è¡¨å¾å­¦ä¹ </p></li><li><p>æ›´ç»†è‡´çš„è¯„ä¼°</p></li></ul></li><li><p>ä¸»æµæ–¹å‘ï¼š</p><ul><li>å¤šè¯­è¨€ä¸å¤šæ¨¡æ€æ”¯æŒ</li><li>è½»é‡åŒ–éƒ¨ç½²ä¸æ€§ä»·æ¯”ä¼˜åŒ–</li><li>é•¿ä¸Šä¸‹æ–‡çª—å£å¤„ç†èƒ½åŠ›</li><li>é«˜ç»´åº¦è¡¨å¾èƒ½åŠ›</li></ul></li><li>åˆ›æ–°æŠ€æœ¯ï¼š<ul><li>å¥—å¨ƒå¼åµŒå…¥å­¦ä¹ (MRL)ï¼šåˆ†å±‚çº§å­¦ä¹ ä¸åŒç»´åº¦çš„è¡¨å¾ï¼ˆå¦‚64ç»´ã€512ç»´ã€1024ç»´ï¼‰</li><li>é¢†åŸŸç‰¹å®šåµŒå…¥ï¼šå¦‚é‡‘èä¸“ç”¨æ¨¡å‹voyage-finance-2</li><li>çŸ¥è¯†å›¾è°±é›†æˆï¼šå›¾åµŒå…¥æŠ€æœ¯çš„å¼€å‘åº”ç”¨</li></ul></li><li>å‰æ²¿ç ”ç©¶ï¼š<ul><li>è‡ªé€‚åº”å’Œä¸Šä¸‹æ–‡æ„ŸçŸ¥åµŒå…¥</li><li>å±‚æ¬¡åŒ–è¯­ä¹‰è¡¨å¾å­¦ä¹ </li><li>æ›´ç²¾ç»†çš„è¯„ä¼°æ–¹æ³•è®º</li></ul></li><li>æŠ€æœ¯ç‰¹ç‚¹ï¼š<ul><li>ä¿„ç½—æ–¯å¥—å¨ƒå¼åµŒå…¥å…è®¸å„å–æ‰€éœ€ï¼Œé€‚åº”ä¸åŒè®¡ç®—èµ„æºåœºæ™¯</li><li>å±‚æ¬¡åŒ–è¡¨å¾å¯æ•æ‰ä»æ ‡é¢˜åˆ°ç»†èŠ‚çš„è¯­ä¹‰å±‚æ¬¡</li><li>é¢†åŸŸä¸“ç”¨æ¨¡å‹åœ¨ç‰¹å®šåœºæ™¯è¡¨ç°æ›´ä¼˜</li></ul></li></ul>]]></content>
    
    
    <summary type="html">å­¦ä¹ å¤§æ¨¡å‹RAGç³»ç»Ÿå­¦ä¹ ç¬”è®°ç¬¬åå…«è®²</summary>
    
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>RAGç»„ä»¶--å‘é‡åµŒå…¥ä¹‹å¤§æ¨¡å‹æ—¶ä»£çš„åµŒå…¥æŠ€æœ¯</title>
    <link href="https://jinglv.github.io/2025/08/14/ai/rag/16-embedding-llm/"/>
    <id>https://jinglv.github.io/2025/08/14/ai/rag/16-embedding-llm/</id>
    <published>2025-08-13T16:00:00.000Z</published>
    <updated>2025-08-14T01:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MTEBæ’è¡Œæ¦œ"><a href="#MTEBæ’è¡Œæ¦œ" class="headerlink" title="MTEBæ’è¡Œæ¦œ"></a>MTEBæ’è¡Œæ¦œ</h1><p>Hugging Face MTEBåœ°å€ï¼š<a href="https://huggingface.co/spaces/mteb/leaderboard">https://huggingface.co/spaces/mteb/leaderboard</a></p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250814090707154.png" alt="image-20250814090707154" style="zoom:67%;" /></p><ul><li>æ¨¡å‹ç­›é€‰å·¥å…·: åœ¨å¤§è¯­è¨€æ—¶ä»£åµŒå…¥æ¨¡å‹é€‰æ‹©è¿‡å¤šçš„æƒ…å†µä¸‹ï¼ŒMTEBæ’è¡Œæ¦œå¯ä½œä¸ºåŸºç¡€è¿‡æ»¤å·¥å…·ï¼Œå¸®åŠ©ä»å¼€æºåµŒå…¥æ¨¡å‹ä¸­ç­›é€‰åˆé€‚çš„æ¨¡å‹ã€‚</li><li>å››ç»´åº¦è¯„ä¼°: é€šè¿‡æ¨¡å‹å¤§å°ã€èƒ½åŠ›åˆ†æ•°ã€åµŒå…¥ç»´åº¦å’Œæœ€å¤§tokenæ•°å››ä¸ªç»´åº¦è¿›è¡Œç»¼åˆè¯„ä¼°ã€‚</li></ul><h2 id="æ¨¡å‹å¤§å°ç»´åº¦"><a href="#æ¨¡å‹å¤§å°ç»´åº¦" class="headerlink" title="æ¨¡å‹å¤§å°ç»´åº¦"></a>æ¨¡å‹å¤§å°ç»´åº¦</h2><ul><li>å‚æ•°è§„æ¨¡èŒƒå›´: ä»$1B$ï»¿åˆ°$100B$ï»¿ä¸ç­‰ï¼Œä½†ä¸»æµæ¨¡å‹å¤šåœ¨$10B$ï»¿ä»¥ä¸‹ã€‚</li><li>ç¡¬ä»¶é€‚é…æ€§: ä¸­ç­‰GPUé…ç½®ï¼ˆå¦‚åŒå¡4090+32GBå†…å­˜ï¼‰å³å¯è¿è¡Œå¤§å¤šæ•°ä¸»æµåµŒå…¥æ¨¡å‹ã€‚</li><li>å¼€æºç‰¹æ€§: MTEBæ’è¡Œæ¦œä»…è¯„ä¼°å¼€æºåµŒå…¥æ¨¡å‹ï¼Œä¸åŒ…æ‹¬é—­æºå•†ä¸šæ¨¡å‹ã€‚</li></ul><h2 id="æ¨¡å‹èƒ½åŠ›ç»´åº¦"><a href="#æ¨¡å‹èƒ½åŠ›ç»´åº¦" class="headerlink" title="æ¨¡å‹èƒ½åŠ›ç»´åº¦"></a>æ¨¡å‹èƒ½åŠ›ç»´åº¦</h2><ul><li>è¯„åˆ†æœºåˆ¶: é€šè¿‡58ä¸ªæ•°æ®é›†åœ¨8å¤§ç±»NLPä»»åŠ¡ä¸Šçš„å¹³å‡è¡¨ç°(MAP)è®¡ç®—å¾—å‡ºã€‚</li><li>ä»»åŠ¡è¦†ç›–: åŒ…æ‹¬åˆ†ç±»ã€èšç±»ã€æ£€ç´¢ç­‰å¤šç§ä»»åŠ¡ç±»å‹ï¼Œåæ˜ æ¨¡å‹ç»¼åˆèƒ½åŠ›ã€‚</li><li>ä¸“ä¸šæ¨¡å‹ç‰¹ç‚¹: æŸäº›æ¨¡å‹å¯èƒ½åœ¨ç‰¹å®šä»»åŠ¡ä¸Šè¡¨ç°çªå‡ºï¼Œä½†æ’è¡Œæ¦œæ˜¾ç¤ºçš„æ˜¯å¹³å‡èƒ½åŠ›ã€‚</li></ul><h2 id="åµŒå…¥ç»´åº¦å¤§å°"><a href="#åµŒå…¥ç»´åº¦å¤§å°" class="headerlink" title="åµŒå…¥ç»´åº¦å¤§å°"></a>åµŒå…¥ç»´åº¦å¤§å°</h2><ul><li>å¯è§†åŒ–è¡¨ç¤º: é€šè¿‡æ°”æ³¡å›¾å¤§å°å±•ç¤ºï¼Œç»´åº¦è¶Šå¤§è¡¨ç¤ºèƒ½æ•æ‰æ›´ç»†å¾®çš„ç‰¹å¾å·®å¼‚ã€‚</li><li>å‚æ•°å…³ç³»: é€šå¸¸å‚æ•°è¶Šå¤§çš„æ¨¡å‹æ”¯æŒæ›´å¤§çš„åµŒå…¥ç»´åº¦ï¼Œä½†å­˜åœ¨ä¾‹å¤–æƒ…å†µï¼ˆå¦‚æŸäº›ï»¿$1B$ï»¿å‚æ•°çš„æ¨¡å‹åµŒå…¥ç»´åº¦ç‰¹åˆ«å¤§ï¼‰ã€‚</li><li>å…¸å‹èŒƒå›´: å°æ¨¡å‹å®¶æ—åµŒå…¥ç»´åº¦åå°ï¼Œå¤§æ¨¡å‹å®¶æ—åµŒå…¥ç»´åº¦åå¤§ã€‚</li></ul><h2 id="Max-Tokensç»´åº¦"><a href="#Max-Tokensç»´åº¦" class="headerlink" title="Max Tokensç»´åº¦"></a>Max Tokensç»´åº¦</h2><ul><li>é¢œè‰²ç¼–ç : é€šè¿‡ä¸åŒé¢œè‰²åŒºåˆ†æ¨¡å‹æ”¯æŒçš„æœ€å¤§tokenæ•°ï¼ˆå¦‚7Kã€10Kç­‰ï¼‰ã€‚</li><li>å®é™…åº”ç”¨å»ºè®®: è™½ç„¶æ”¯æŒé•¿ä¸Šä¸‹æ–‡ï¼Œä½†å»ºè®®å°†æ–‡æœ¬åˆ‡åˆ†ä¸º1000tokenä»¥å†…çš„æ®µè½è¿›è¡ŒåµŒå…¥ï¼Œæ›´åˆ©äºè¯­ä¹‰æŠŠæ¡ã€‚</li><li>é‡è¦æ€§: é•¿ä¸Šä¸‹æ–‡æ”¯æŒèƒ½åŠ›å¯¹æŸäº›åº”ç”¨åœºæ™¯ï¼ˆå¦‚æ–‡æ¡£æ•´ä½“åµŒå…¥ï¼‰å¾ˆå…³é”®ã€‚</li></ul><h1 id="MTEBåˆ’åˆ†ä»»åŠ¡ç±»åˆ«-ï¼ˆå…«å¤§ä»»åŠ¡ï¼‰"><a href="#MTEBåˆ’åˆ†ä»»åŠ¡ç±»åˆ«-ï¼ˆå…«å¤§ä»»åŠ¡ï¼‰" class="headerlink" title="MTEBåˆ’åˆ†ä»»åŠ¡ç±»åˆ« ï¼ˆå…«å¤§ä»»åŠ¡ï¼‰"></a>MTEBåˆ’åˆ†ä»»åŠ¡ç±»åˆ« ï¼ˆå…«å¤§ä»»åŠ¡ï¼‰</h1><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250814092155178.png" alt="image-20250814092155178" style="zoom:50%;" /></p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250814092225655.png" alt="image-20250814092225655" style="zoom:50%;" /></p><h2 id="èšç±»"><a href="#èšç±»" class="headerlink" title="èšç±»"></a>èšç±»</h2><ul><li>æ ¸å¿ƒç›®æ ‡: å°†è¯­ä¹‰ç›¸ä¼¼çš„æ–‡æœ¬æ— ç›‘ç£åœ°èšåœ¨ä¸€èµ·ã€‚</li><li>å…¸å‹åº”ç”¨: æ–‡æ¡£ç»„ç»‡ã€ä¸»é¢˜å‘ç°ã€‚</li><li>æ•°æ®é›†ç¤ºä¾‹: Arxivã€Biorxivã€Medrxivç­‰å­¦æœ¯è®ºæ–‡æ•°æ®é›†ï¼Œæµ‹è¯•P2P(è®ºæ–‡å¯¹)ã€S2S(å¥å¯¹)ç­‰èšç±»èƒ½åŠ›ã€‚</li></ul><h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><ul><li>ç›‘ç£å­¦ä¹ : åŸºäºå·²æ ‡æ³¨æ•°æ®è®­ç»ƒï¼Œé¢„æµ‹æ–°æ–‡æœ¬ç±»åˆ«ã€‚</li><li>åº”ç”¨åœºæ™¯: æƒ…æ„Ÿåˆ†æï¼ˆå¦‚IMDBå½±è¯„ï¼‰ã€æ„å›¾è¯†åˆ«ã€è¯é¢˜åˆ†ç±»ã€‚</li><li>æ•°æ®é›†: AmazonPolarityã€Emotionã€Banking77ç­‰ã€‚</li></ul><h2 id="åŒè¯­æŒ–æ˜"><a href="#åŒè¯­æŒ–æ˜" class="headerlink" title="åŒè¯­æŒ–æ˜"></a>åŒè¯­æŒ–æ˜</h2><ul><li>ä»»åŠ¡ç‰¹ç‚¹: è·¨è¯­è¨€å¥å­å¯¹é½ï¼Œç”¨äºæœºå™¨ç¿»è¯‘è®­ç»ƒæ•°æ®è‡ªåŠ¨ç”Ÿæˆã€‚</li><li>æ•°æ®é›†: BUCCã€Tatoebaç­‰åŒè¯­å¹³è¡Œè¯­æ–™åº“ã€‚</li></ul><h2 id="STS"><a href="#STS" class="headerlink" title="STS"></a>STS</h2><ul><li>å›å½’ä»»åŠ¡: è¯„ä¼°ä¸¤ä¸ªå¥å­è¯­ä¹‰ç›¸ä¼¼åº¦ï¼ˆ0-5åˆ†ï¼‰ã€‚</li><li>åº”ç”¨: ç›¸ä¼¼é—®å¥åŒ¹é…ã€å®¢æœé—®ç­”å¯¹åŒ¹é…ã€‚</li><li>æ•°æ®é›†: STS12-16ã€STSBenchmarkç­‰ã€‚</li></ul><h2 id="å¯¹åˆ†ç±»"><a href="#å¯¹åˆ†ç±»" class="headerlink" title="å¯¹åˆ†ç±»"></a>å¯¹åˆ†ç±»</h2><ul><li>å…³ç³»åˆ¤æ–­: è¯†åˆ«æ–‡æœ¬å¯¹é—´ç‰¹å®šå…³ç³»ï¼ˆå¦‚FAQä¸­çš„é—®é¢˜-ç­”æ¡ˆå¯¹ï¼‰ã€‚</li><li>ä¸å¤§æ¨¡å‹å…³ç³»: è¿™ç±»ä»»åŠ¡åœ¨å¤§æ¨¡å‹æ—¶ä»£å·²å˜å¾—ç›¸å¯¹ç®€å•ã€‚</li></ul><h2 id="æ£€ç´¢"><a href="#æ£€ç´¢" class="headerlink" title="æ£€ç´¢"></a>æ£€ç´¢</h2><ul><li>æ ¸å¿ƒåº”ç”¨: RAGç³»ç»Ÿã€æ–‡æ¡£æ£€ç´¢ã€‚</li><li>æ•°æ®é›†è¦†ç›–: HotpotQAã€MSMARCOç­‰ï¼Œæ¶µç›–é—®ç­”ã€ç§‘å­¦æ–‡çŒ®å¤šé¢†åŸŸã€‚</li><li>ä»»åŠ¡æ•´åˆ: å¯åŒ…å«èšç±»ã€åˆ†ç±»ã€STSç­‰å¤šç§å­ä»»åŠ¡ã€‚</li></ul><h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h2><ul><li>è¯„ä¼°æ–¹å¼: é€šè¿‡åµŒå…¥ç›¸ä¼¼åº¦æ¯”è¾ƒç”Ÿæˆæ‘˜è¦ä¸å‚è€ƒæ‘˜è¦çš„ä¸€è‡´æ€§ã€‚</li><li>æ•°æ®é›†: SummEvalç­‰æ‘˜è¦è´¨é‡è¯„ä¼°æ•°æ®é›†ã€‚</li></ul><h2 id="é‡æ’åº"><a href="#é‡æ’åº" class="headerlink" title="é‡æ’åº"></a>é‡æ’åº</h2><ul><li>RAGå…³é”®ç¯èŠ‚: å¯¹å€™é€‰ç­”æ¡ˆè¿›è¡Œç›¸å…³æ€§é‡æ’åºã€‚</li><li>æ•°æ®é›†: AskUbuntuã€StackOverflowç­‰ç¤¾åŒºé—®ç­”æ•°æ®ã€‚</li></ul><h1 id="åµŒå…¥å¼æ¨¡å‹æ’è¡Œæ¦œ"><a href="#åµŒå…¥å¼æ¨¡å‹æ’è¡Œæ¦œ" class="headerlink" title="åµŒå…¥å¼æ¨¡å‹æ’è¡Œæ¦œ"></a>åµŒå…¥å¼æ¨¡å‹æ’è¡Œæ¦œ</h1><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250814092638532.png" alt="image-20250814092638532" style="zoom:50%;" /></p><ul><li>æ¦œå•æ¦‚å†µï¼šå±•ç¤ºå½“å‰é¢†å…ˆçš„åµŒå…¥å¼æ¨¡å‹æ’åï¼ŒåŒ…å«æ¨¡å‹æ€§èƒ½æŒ‡æ ‡å¦‚Zero-shotå‡†ç¡®ç‡ã€å†…å­˜ä½¿ç”¨é‡ç­‰å…³é”®å‚æ•°</li><li>å•†ä¸šä¸å¼€æºåŒºåˆ«ï¼šæ¦œé¦–gemini-embedding-001(Google)ä¸ºå•†ä¸šAPIè°ƒç”¨æ¨¡å‹ï¼Œä¸æä¾›å¼€æºä¸‹è½½</li></ul><p>å…¶ä¸­çš„æ’åç¬¬å…­çš„gte-Qwen2-7B-instructï¼ˆåƒé—®ç³»åˆ—çš„æ¨¡å‹ï¼‰ï¼ŒåŸºäº290äº¿å‚æ•°ï¼Œæ”¯æŒ4096ç»´åµŒå…¥ï¼ŒZero-shotå‡†ç¡®ç‡æœªæ ‡æ³¨(NA)</p><h1 id="OpenAIåµŒå…¥å¼æ¨¡å‹"><a href="#OpenAIåµŒå…¥å¼æ¨¡å‹" class="headerlink" title="OpenAIåµŒå…¥å¼æ¨¡å‹"></a>OpenAIåµŒå…¥å¼æ¨¡å‹</h1><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250814093506745.png" alt="image-20250814093506745" style="zoom:50%;" /></p><ul><li>äº§å“çŸ©é˜µï¼š<ul><li>text-embedding-3-smallï¼šæ€§ä»·æ¯”é«˜(62.5é¡µ/ç¾å…ƒ)ï¼ŒMTEBå¾—åˆ†62.3%</li><li>text-embedding-3-largeï¼šé«˜æ€§èƒ½(9.615é¡µ/ç¾å…ƒ)ï¼ŒMTEBå¾—åˆ†64.6%</li></ul></li><li>æˆæœ¬è®¡ç®—ï¼šå¤„ç†100ä¸‡è¡ŒåŒ»å­¦åè¯æ•°æ®çº¦éœ€1ç¾å…ƒ(smallç‰ˆæ›´ä¾¿å®œ)</li><li>æŠ€æœ¯ä¼˜åŠ¿ï¼šå—ç›ŠäºGPTå®¶æ—è¯­æ–™ç§¯ç´¯ï¼Œæ”¯æŒ8191 tokensé•¿æ–‡æœ¬è¾“å…¥</li></ul><h1 id="BGEåµŒå…¥å¼æ¨¡å‹"><a href="#BGEåµŒå…¥å¼æ¨¡å‹" class="headerlink" title="BGEåµŒå…¥å¼æ¨¡å‹"></a>BGEåµŒå…¥å¼æ¨¡å‹</h1><p>Githubåœ°å€ï¼š<a href="https://github.com/FlagOpen/FlagEmbedding">https://github.com/FlagOpen/FlagEmbedding</a></p><ul><li>å¼€å‘èƒŒæ™¯ï¼šç”±åŒ—äº¬æ™ºæºç ”ç©¶é™¢(FlagOpen)æ¨å‡ºçš„å¼€æºæ£€ç´¢å¢å¼ºå·¥å…·åŒ…</li><li>æ ¸å¿ƒåŠŸèƒ½ï¼š<ul><li>æ”¯æŒå‘é‡/å¯†é›†å‘é‡æ··åˆæ£€ç´¢</li><li>åŒ…å«Embedderå’ŒRerankeråŒæ¨¡å‹ç³»ç»Ÿ</li><li>å¤šè¯­è¨€æ”¯æŒ(å«ä¸“é—¨ä¼˜åŒ–ä¸­æ–‡çš„ç‰ˆæœ¬)</li></ul></li><li>å®‰è£…æ–¹å¼ï¼š</li><li>æœ€æ–°è¿›å±•ï¼šBGE-VLæ”¯æŒå¤šæ¨¡æ€åµŒå…¥ï¼ŒMITè®¸å¯è¯å…è®¸å•†ä¸šä½¿ç”¨</li></ul><h1 id="JinaåµŒå…¥å¼æ¨¡å‹"><a href="#JinaåµŒå…¥å¼æ¨¡å‹" class="headerlink" title="JinaåµŒå…¥å¼æ¨¡å‹"></a>JinaåµŒå…¥å¼æ¨¡å‹</h1><p>å®˜æ–¹ç½‘å€ï¼š<a href="https://jina.ai/models#catalog">https://jina.ai/models#catalog</a></p><ul><li>v3ç‰ˆæœ¬ç‰¹æ€§ï¼š<ul><li>5.7äº¿å‚æ•°</li><li>æ”¯æŒ8192 tokensé•¿æ–‡æœ¬</li><li>è¾“å‡ºç»´åº¦1024(å¯æˆªæ–­è‡³32ç»´)</li></ul></li><li>å•†ä¸šæˆæƒï¼šæä¾›æ ‡å‡†ä¼ä¸šè®¸å¯è¯(5000ç¾å…ƒ/å­£åº¦)å’Œå®šåˆ¶è®­ç»ƒæœåŠ¡</li><li>æŠ€æœ¯äº®ç‚¹ï¼šé‡‡ç”¨LoRAé€‚é…å™¨ï¼Œé’ˆå¯¹ä¸åŒä»»åŠ¡(æ£€ç´¢/èšç±»/åˆ†ç±»)ä¼˜åŒ–</li></ul><h1 id="å…¶ä»–Embeddingæ¨¡å‹çš„ä¾›åº”å•†"><a href="#å…¶ä»–Embeddingæ¨¡å‹çš„ä¾›åº”å•†" class="headerlink" title="å…¶ä»–Embeddingæ¨¡å‹çš„ä¾›åº”å•†"></a>å…¶ä»–Embeddingæ¨¡å‹çš„ä¾›åº”å•†</h1><ul><li>Voyage AIï¼š<a href="https://docs.voyageai.com/docs/embeddings">https://docs.voyageai.com/docs/embeddings</a></li><li>Cohere Embeddingsï¼š<a href="https://docs.cohere.com/v2/docs/embeddings">https://docs.cohere.com/v2/docs/embeddings</a><ul><li>äº§å“å®šä½ï¼šå•†ä¸šAPIæœåŠ¡ï¼Œä¸OpenAIå½¢æˆç«äº‰</li><li>å…¸å‹åº”ç”¨ï¼šè¯­ä¹‰æœç´¢/èšç±»/åˆ†ç±»ä»»åŠ¡</li><li>æ€§èƒ½è¡¨ç°ï¼šå¤„äºè¡Œä¸šå‰åˆ—ä½†éé¡¶å°–æ°´å¹³</li></ul></li><li>å¼€æºæ¨¡å‹Stellaï¼š<a href="https://huggingface.co/models?sort=trending&amp;search=Stella">https://huggingface.co/models?sort=trending&amp;search=Stella</a><ul><li>æ ¸å¿ƒä¼˜åŠ¿ï¼šè½»é‡åŒ–è®¾è®¡(400M/1.5Bå‚æ•°)</li><li>è®­ç»ƒåŸºç¡€ï¼šåŸºäºAlibaba-NLP/gteç³»åˆ—æ¨¡å‹ä¼˜åŒ–</li><li>ä½¿ç”¨åœºæ™¯ï¼šé€‚åˆèµ„æºå—é™ç¯å¢ƒä¸‹çš„æ£€ç´¢ä»»åŠ¡</li><li>å¼€æºåè®®ï¼šMITè®¸å¯è¯å…è®¸è‡ªç”±ä½¿ç”¨</li></ul></li></ul><h1 id="é€‰å‹çš„Tips"><a href="#é€‰å‹çš„Tips" class="headerlink" title="é€‰å‹çš„Tips"></a>é€‰å‹çš„Tips</h1><ul><li>å£ç¢‘é‡è¦æ€§ï¼šç½‘ç»œå£ç¢‘æ˜¯é¦–è¦è€ƒè™‘å› ç´ ï¼Œç”¨æˆ·åŸºæ•°å¤§çš„æ¨¡å‹é€šå¸¸ç¤¾åŒºæ”¯æŒæ›´å¥½ï¼Œé•¿æœŸç»´æŠ¤æ›´æœ‰ä¿éšœ</li><li>è¯„ä¼°ç»´åº¦ï¼š<ul><li>å…·ä½“ä»»åŠ¡é€‚é…æ€§ï¼šéœ€è€ƒå¯Ÿæ¨¡å‹åœ¨ç›®æ ‡åœºæ™¯çš„å®é™…è¡¨ç°</li><li>å®æ“ä½“éªŒï¼šå®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­çš„æ„Ÿå—è‡³å…³é‡è¦</li><li>æˆæƒä¸æˆæœ¬ï¼šéœ€æƒè¡¡å¼€æº/å•†ç”¨ã€ä»·æ ¼ã€è®¡ç®—èµ„æºéœ€æ±‚ã€è¯­è¨€æ”¯æŒç­‰å› ç´ </li></ul></li><li>å£ç¢‘éªŒè¯æ–¹æ³•ï¼šé€šè¿‡æŠ€æœ¯ç¤¾åŒºè®¨è®ºçƒ­åº¦ã€æŒç»­ç»´æŠ¤æƒ…å†µã€ç”¨æˆ·åé¦ˆç­‰ç»´åº¦ç»¼åˆåˆ¤æ–­</li></ul><h2 id="å›½å¤–çš„è®¨è®ºç¤¾åŒº"><a href="#å›½å¤–çš„è®¨è®ºç¤¾åŒº" class="headerlink" title="å›½å¤–çš„è®¨è®ºç¤¾åŒº"></a>å›½å¤–çš„è®¨è®ºç¤¾åŒº</h2><ul><li><p>Redditï¼š<a href="https://www.reddit.com/">https://www.reddit.com/</a></p><ul><li>ä¾‹å¦‚æŸ¥è¯¢æ¨¡å‹r/LocalLLaMAç­‰ä¸“ä¸šæŠ€æœ¯ç¤¾åŒºæ˜¯è·å–çœŸå®ä½¿ç”¨åé¦ˆçš„é‡è¦æ¸ é“</li><li>å…¸å‹è®¨è®ºæ–¹å¼ï¼šå‘èµ·å…·ä½“åº”ç”¨åœºæ™¯çš„æŠ€æœ¯å’¨è¯¢ï¼ˆå¦‚RAGåœºæ™¯ä¸‹çš„embeddingæ¨¡å‹é€‰æ‹©ï¼‰</li></ul></li><li><p>æ¨¡å‹ä½¿ç”¨æ¡ˆä¾‹ï¼š</p><ul><li>all-mpnet-base-v2ï¼šæ—©æœŸç»å…¸é€‰æ‹©ï¼Œé…åˆFAISS/KDTreeæ•ˆæœç¨³å®š</li><li>BGEç³»åˆ—ï¼šè™½benchmarkè¡¨ç°ä¼˜å¼‚ä½†å¯èƒ½å­˜åœ¨è¿‡æ‹ŸåˆMTEBæ•°æ®é›†çš„é—®é¢˜</li><li>åƒé—®/Qwenç³»åˆ—ï¼šéƒ¨åˆ†ç”¨æˆ·åé¦ˆå…¶å®é™…è¡¨ç°ä¼˜äºbenchmarkæŒ‡æ ‡</li></ul></li><li>å°å‹æ¨¡å‹ä»·å€¼ï¼š<ul><li>all-MiniLM-L6-v2ç­‰å°å‹æ¨¡å‹å¯ä½œä¸ºbaselineå‚è€ƒ</li><li>æ–°æ¨¡å‹éœ€è‡³å°‘è¶…è¶Šè¿™äº›åŸºç¡€æ¨¡å‹çš„æ€§èƒ½è¡¨ç°</li></ul></li><li>è¯„ä¼°å»ºè®®ï¼š<ul><li>éœ€ç»“åˆå…·ä½“ä¸šåŠ¡åœºæ™¯æµ‹è¯•ï¼ˆå¦‚æ–°é—»å¤„ç†ã€å®¢æœçŸ¥è¯†åº“ç­‰ä¸åŒåœºæ™¯éœ€æ±‚å·®å¼‚å¤§ï¼‰</li><li>æ³¨æ„chunkå¤§å°ã€æŸ¥è¯¢ç”Ÿæˆæ–¹å¼ç­‰å®æ–½ç»†èŠ‚å¯¹æ•ˆæœçš„å½±å“</li><li>ä¸­æ–‡æ¨¡å‹éœ€ç‰¹åˆ«æ³¨æ„benchmarkåˆ†æ•°ä¸å®é™…æ•ˆæœçš„å·®å¼‚</li></ul></li><li>å…¸å‹æŠ€æœ¯è®¨è®ºï¼š<ul><li>ç»´åº¦é—®é¢˜ï¼šllama-2-7Bçš„4096ç»´å¯èƒ½å› ç»´åº¦ç¨€é‡Šå¯¼è‡´è¿‘é‚»æœç´¢æ•ˆæœä¸‹é™</li><li>æ¨¡å‹ç±»å‹ï¼šåŸºç¡€æ¨¡å‹é€šå¸¸æ¯”å¯¹è¯æ¨¡å‹æ›´é€‚åˆç”Ÿæˆembedding</li><li>è§„æ¨¡å½±å“ï¼šå°è§„æ¨¡æµ‹è¯•(400æ¡)ä¸å¤§è§„æ¨¡åº”ç”¨(4ä¸‡æ¡)å¯èƒ½è¡¨ç°ä¸åŒ</li></ul></li><li>å®ç”¨å·¥å…·é“¾ï¼š<ul><li>å¸¸ç”¨ç»„åˆï¼šSentenceTransformers+FAISS/Qdrant</li><li>è½»é‡æ–¹æ¡ˆï¼šall-MiniLM-L6-v2+HyperDBé€‚åˆæ–‡æ¡£é‡&lt;10ä¸‡çš„åœºæ™¯</li></ul></li></ul><h2 id="æ–‡æœ¬åµŒå…¥æ¨¡å‹è¯„ä¼°ä¸é€‰æ‹©"><a href="#æ–‡æœ¬åµŒå…¥æ¨¡å‹è¯„ä¼°ä¸é€‰æ‹©" class="headerlink" title="æ–‡æœ¬åµŒå…¥æ¨¡å‹è¯„ä¼°ä¸é€‰æ‹©"></a>æ–‡æœ¬åµŒå…¥æ¨¡å‹è¯„ä¼°ä¸é€‰æ‹©</h2><p>ç½‘ä¸Šå…¬å¼€çš„è®ºæ–‡ã€æ–‡ç« ç­‰ï¼Œä¾‹å¦‚ï¼š<a href="https://www.datastax.com/blog/best-embedding-models-information-retrieval-2025">https://www.datastax.com/blog/best-embedding-models-information-retrieval-2025</a></p><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250814095224872.png" alt="image-20250814095224872" style="zoom:50%;" /></p><ul><li>è¯„ä¼°èƒŒæ™¯ï¼šé’ˆå¯¹RAG(æ£€ç´¢å¢å¼ºç”Ÿæˆ)ä»»åŠ¡ï¼Œ2025å¹´æœ€æ–°ç ”ç©¶å¯¹å¤šç§å•†ä¸šå’Œå¼€æºåµŒå…¥æ¨¡å‹è¿›è¡Œäº†ç³»ç»Ÿæ€§è¯„æµ‹</li><li>æµ‹è¯•å¯¹è±¡ï¼šåŒ…å«OpenAIã€Geminiã€Jinaã€Cohereã€Voyageç­‰å•†ä¸šæ¨¡å‹ï¼Œä»¥åŠStellaã€ModernBERTç­‰å¼€æºæ¨¡å‹</li></ul><p>ä»ä»¥ä¸Šæ–‡ç« å’Œå†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€äº›ä¿¡æ¯ï¼š</p><h3 id="æ¨¡å‹å¯¹æ¯”ä¸è¯„ä¼°æ–¹æ³•"><a href="#æ¨¡å‹å¯¹æ¯”ä¸è¯„ä¼°æ–¹æ³•" class="headerlink" title="æ¨¡å‹å¯¹æ¯”ä¸è¯„ä¼°æ–¹æ³•"></a>æ¨¡å‹å¯¹æ¯”ä¸è¯„ä¼°æ–¹æ³•</h3><ul><li>å•†ä¸šæ¨¡å‹ç»„ï¼š<ul><li>OpenAIï¼štext-embedding-3-large(3072ç»´)å’Œsmall(1536ç»´)</li><li>Geminiï¼štext-embedding-004(768ç»´ï¼Œé€šè¿‡APIè·å–)</li><li>ç¬¬ä¸‰æ–¹æ¨¡å‹ï¼šJina v3ã€Cohere v3ã€Voyageç³»åˆ—</li></ul></li><li>å¼€æºæ¨¡å‹ç»„ï¼š<ul><li>Stellaï¼šæµ‹è¯•400Må’Œ1.5Bä¸¤ä¸ªç‰ˆæœ¬ï¼ˆMITè®¸å¯ï¼‰</li><li>ModernBERTï¼šBaseå’ŒLargeå˜ä½“ï¼ŒåŸºäºAnswer.AIæŠ€æœ¯</li></ul></li><li>è¯„ä¼°åˆ›æ–°ç‚¹ï¼š<ul><li>æ•°æ®é›†æ„å»ºï¼šé‡‡ç”¨ViDoReå›¾åƒæœç´¢åŸºå‡†ï¼Œé€šè¿‡GeminiFlash 1.5è¿›è¡ŒOCRè½¬æ¢</li><li>é¿å…æ•°æ®æ³„éœ²ï¼šåˆ»æ„ä¸ä½¿ç”¨å¸¸è§æ–‡æœ¬æ•°æ®é›†ï¼Œç¡®ä¿æ¨¡å‹é¢å¯¹å…¨æ–°æ•°æ®</li><li>å¤šè¯­è¨€æµ‹è¯•ï¼šåŒ…å«è‹±è¯­å’Œæ³•è¯­æ•°æ®ï¼Œæ£€éªŒæ¨¡å‹æ³›åŒ–èƒ½åŠ›</li></ul></li></ul><h3 id="Voyage-3-largeçš„ä¼˜åŠ¿"><a href="#Voyage-3-largeçš„ä¼˜åŠ¿" class="headerlink" title="Voyage-3-largeçš„ä¼˜åŠ¿"></a>Voyage-3-largeçš„ä¼˜åŠ¿</h3><ul><li>æ˜¾è‘—ä¼˜åŠ¿ï¼š<ul><li>åœ¨åµŒå…¥ç›¸å…³æ€§ä»»åŠ¡ä¸­è¡¨ç°çªå‡ºï¼Œæ˜æ˜¾ä¼˜äºå…¶ä»–å•†ä¸šæ¨¡å‹</li><li>æ”¯æŒ2048ç»´é«˜ç²¾åº¦è¾“å‡ºï¼Œé€‚åˆå¯¹è´¨é‡è¦æ±‚ä¸¥æ ¼çš„åœºæ™¯</li></ul></li><li>å›¢é˜ŸèƒŒæ™¯ï¼šç”±é©¬è…¾å®‡å›¢é˜Ÿå¼€å‘ï¼Œåœ¨rerankeræŠ€æœ¯ä¸Šæœ‰æ·±åšç§¯ç´¯</li><li>æ€§ä»·æ¯”é€‰æ‹©ï¼šVoyage-3-lite(512ç»´)åœ¨ä½æˆæœ¬ç«¯è¡¨ç°åŒæ ·å‡ºè‰²</li></ul><h3 id="Gemini-004çš„ç‰¹ç‚¹"><a href="#Gemini-004çš„ç‰¹ç‚¹" class="headerlink" title="Gemini 004çš„ç‰¹ç‚¹"></a>Gemini 004çš„ç‰¹ç‚¹</h3><ul><li>æ ¸å¿ƒä¼˜åŠ¿ï¼š<ul><li>ä»·æ ¼æ¥è¿‘å…è´¹ï¼Œé€Ÿç‡é™åˆ¶åˆç†(1500RPM)</li><li>768ç»´è¾“å‡ºå¹³è¡¡äº†æ€§èƒ½ä¸æˆæœ¬</li></ul></li><li>å±€é™æ€§ï¼š<ul><li>ä»…æ”¯æŒè‹±è¯­å¤„ç†</li><li>æ— æ³•é€šè¿‡ä»˜è´¹æå‡ååé‡</li><li>ä¼ä¸šç‰ˆtext-embedding-005å°šæœªå¼€æ”¾APIè®¿é—®</li></ul></li></ul><h3 id="å¼€æºæ¨¡å‹è¡¨ç°"><a href="#å¼€æºæ¨¡å‹è¡¨ç°" class="headerlink" title="å¼€æºæ¨¡å‹è¡¨ç°"></a>å¼€æºæ¨¡å‹è¡¨ç°</h3><ul><li>Stellaäº®ç‚¹ï¼š<ul><li>400Mç‰ˆæœ¬åœ¨MTEBæ£€ç´¢æ¦œè¡¨ç°ä¼˜å¼‚</li><li>å•†ä¸šå‹å¥½(MITè®¸å¯)ï¼Œå¼ ç›¾å›¢é˜Ÿæä¾›è¯¦ç»†ç™½çš®ä¹¦</li><li>1.5Bç‰ˆæœ¬æœªæ˜¾è‘—æå‡å‡†ç¡®ç‡ï¼Œå»ºè®®ä¼˜å…ˆä½¿ç”¨400M</li></ul></li><li>ModernBERTä¸è¶³ï¼š<ul><li>å®é™…è¡¨ç°ä½äºé¢„æœŸ</li><li>æœŸå¾…ä¸‹ä¸€ä»£æ”¹è¿›ç‰ˆæœ¬</li></ul></li></ul><h3 id="è¯„ä¼°å»ºè®®ä¸å®è·µæ–¹æ³•"><a href="#è¯„ä¼°å»ºè®®ä¸å®è·µæ–¹æ³•" class="headerlink" title="è¯„ä¼°å»ºè®®ä¸å®è·µæ–¹æ³•"></a>è¯„ä¼°å»ºè®®ä¸å®è·µæ–¹æ³•</h3><ul><li>è‡ªåˆ¶æ•°æ®é›†ï¼š<ul><li>é‡è¦æ€§ï¼šé¿å…å…¬å¼€æ•°æ®é›†çš„è®­ç»ƒæ³„éœ²é—®é¢˜</li><li>å®è·µæ–¹æ¡ˆï¼šå³ä½¿å°‘é‡æ•°æ®(å‡ åä¸ªæ ·æœ¬)ä¹Ÿèƒ½è¿›è¡ŒåŸºæœ¬æ•ˆæœéªŒè¯</li></ul></li><li>è¯„ä¼°ç»´åº¦ï¼š<ul><li>å‡†ç¡®æ€§ï¼šä½¿ç”¨æœªè§è¿‡çš„æµ‹è¯•æ•°æ®</li><li>æˆæœ¬æ•ˆç›Šï¼šå‚æ•°è§„æ¨¡ä¸ä»·æ ¼æ¯”å€¼</li><li>è¯­è¨€æ”¯æŒï¼šå¤šè¯­è¨€åœºæ™¯ä¸‹çš„è¡¨ç°</li></ul></li><li>å¤±è´¥æ¡ˆä¾‹ï¼š<ul><li>Jina v3å’ŒCohere v3æ€§ä»·æ¯”ä¸è¶³</li><li>ç›¸åŒé¢„ç®—å¯è·å¾—æ›´å¥½æ€§èƒ½çš„å…¶ä»–æ¨¡å‹</li></ul></li></ul><h1 id="å‘é‡åµŒå…¥åº”ç”¨æ¡ˆä¾‹"><a href="#å‘é‡åµŒå…¥åº”ç”¨æ¡ˆä¾‹" class="headerlink" title="å‘é‡åµŒå…¥åº”ç”¨æ¡ˆä¾‹"></a>å‘é‡åµŒå…¥åº”ç”¨æ¡ˆä¾‹</h1><h2 id="æ¸¸æˆæ¨èç³»ç»Ÿ"><a href="#æ¸¸æˆæ¨èç³»ç»Ÿ" class="headerlink" title="æ¸¸æˆæ¨èç³»ç»Ÿ"></a>æ¸¸æˆæ¨èç³»ç»Ÿ</h2><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics.pairwise <span class="keyword">import</span> cosine_similarity</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–ç”¨æˆ·è¯„ä»·æ•°æ®é›†</span></span><br><span class="line">df = pd.read_csv(<span class="string">&quot;../data/ç­ç¥çºª/ç”¨æˆ·è¯„ä»·.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–æ¸¸æˆæè¿°æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;../data/ç­ç¥çºª/æ¸¸æˆè¯´æ˜.json&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    game_descriptions = json.load(f)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å‡½æ•°è·å–åµŒå…¥å‘é‡ï¼Œæ³¨ï¼štext-embedding-3-smallæ¨¡å‹éœ€è¦ä»˜è´¹ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_embedding</span>(<span class="params">text, model=<span class="string">&quot;text-embedding-3-small&quot;</span></span>):</span><br><span class="line">    response = openai.embeddings.create(</span><br><span class="line">        <span class="built_in">input</span>=[text],</span><br><span class="line">        model=model</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> response.data[<span class="number">0</span>].embedding</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰æ¸¸æˆçš„åµŒå…¥å‘é‡</span></span><br><span class="line">unique_games = df[<span class="string">&#x27;game_title&#x27;</span>].unique().tolist()</span><br><span class="line">target_game = <span class="string">&quot;Killing God: Hu Sun&quot;</span>  <span class="comment"># ç›®æ ‡æ¸¸æˆåç§°æ›´æ”¹</span></span><br><span class="line"><span class="keyword">if</span> target_game <span class="keyword">not</span> <span class="keyword">in</span> unique_games:</span><br><span class="line">    unique_games.append(target_game)  <span class="comment"># ç¡®ä¿ç›®æ ‡æ¸¸æˆåœ¨åˆ—è¡¨ä¸­</span></span><br><span class="line">game_embeddings = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> game <span class="keyword">in</span> unique_games:</span><br><span class="line">    description = game_descriptions[game]</span><br><span class="line">    game_embeddings[game] = np.array(get_embedding(description))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—ç”¨æˆ·è¯„ä»·çš„åµŒå…¥å‘é‡ï¼ˆè¯¥ç”¨æˆ·è¯„ä»·è¿‡çš„æ‰€æœ‰æ¸¸æˆæè¿°åµŒå…¥å‘é‡çš„å¹³å‡å€¼ï¼‰</span></span><br><span class="line">user_vectors = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> user_id, group <span class="keyword">in</span> df.groupby(<span class="string">&quot;user_id&quot;</span>):</span><br><span class="line">    user_game_vecs = []</span><br><span class="line">    <span class="keyword">for</span> idx, row <span class="keyword">in</span> group.iterrows():</span><br><span class="line">        g_title = row[<span class="string">&#x27;game_title&#x27;</span>]</span><br><span class="line">        g_vec = game_embeddings[g_title]</span><br><span class="line">        user_game_vecs.append(g_vec)</span><br><span class="line">    user_vectors[user_id] = np.mean(np.array(user_game_vecs), axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–â€œç­ç¥çºªÂ·çŒ¢ç‹²â€çš„åµŒå…¥å‘é‡</span></span><br><span class="line">target_vector = game_embeddings[target_game]</span><br><span class="line"><span class="comment"># è®¡ç®—æ¯ä¸ªç”¨æˆ·è¯„ä»·çš„åµŒå…¥å‘é‡ä¸ç›®æ ‡æ¸¸æˆçš„åµŒå…¥å‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦</span></span><br><span class="line">results = []</span><br><span class="line"><span class="keyword">for</span> user_id, u_vec <span class="keyword">in</span> user_vectors.items():</span><br><span class="line">    u_vec_reshaped = u_vec.reshape(<span class="number">1</span>, -<span class="number">1</span>)</span><br><span class="line">    t_vec = target_vector.reshape(<span class="number">1</span>, -<span class="number">1</span>)</span><br><span class="line">    similarity = cosine_similarity(u_vec_reshaped, t_vec)[<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">    results.append((user_id, similarity))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’åºå¹¶æ‰¾å‡ºæœ€å¯èƒ½å–œæ¬¢â€œç­ç¥çºªÂ·çŒ¢ç‹²â€çš„ç”¨æˆ·</span></span><br><span class="line">result_df = pd.DataFrame(results, columns=[<span class="string">&quot;user_id&quot;</span>, <span class="string">f&quot;similarity_to_<span class="subst">&#123;target_game&#125;</span>&quot;</span>])</span><br><span class="line">result_df = result_df.sort_values(by=<span class="string">f&quot;similarity_to_<span class="subst">&#123;target_game&#125;</span>&quot;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\næœ€å¯èƒ½å–œæ¬¢<span class="subst">&#123;target_game&#125;</span>çš„å‰5ä½ç”¨æˆ·ï¼š&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result_df.head())</span><br></pre></td></tr></table></figure><ul><li>ç³»ç»Ÿæ¶æ„ï¼šåŸºäºOpenAI Embeddingæ„å»ºçš„æ¸¸æˆæ¨èç³»ç»Ÿï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯æ‰¾å‡ºæœ€å¯èƒ½å–œæ¬¢ç‰¹å®šæ¸¸æˆçš„ç›®æ ‡ç”¨æˆ·</li><li>æ•°æ®å‡†å¤‡ï¼š<ul><li>ç”¨æˆ·è¯„è®ºæ•°æ®ï¼ˆCSVæ ¼å¼ï¼‰ï¼šè®°å½•ç”¨æˆ·å¯¹å„ç±»æ¸¸æˆçš„è¯„ä»·</li><li>æ¸¸æˆæè¿°æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰ï¼šåŒ…å«æ¸¸æˆè¯¦ç»†è¯´æ˜ï¼Œå¦‚æ¡ˆä¾‹ä¸­çš„â€ç­ç¥çºªâ€æ¸¸æˆ</li></ul></li><li>æ ¸å¿ƒç®—æ³•ï¼š<ul><li>å‘é‡ç”Ÿæˆï¼šä½¿ç”¨OpenAIçš„text-embedding-3-smallæ¨¡å‹å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡</li><li>åå¥½å»ºæ¨¡ï¼šé€šè¿‡ç”¨æˆ·è¯„ä»·è¿‡çš„æ¸¸æˆæè¿°å‘é‡çš„å¹³å‡å€¼è¡¨ç¤ºç”¨æˆ·åå¥½</li><li>ç›¸ä¼¼åº¦è®¡ç®—ï¼šé‡‡ç”¨ä½™å¼¦ç›¸ä¼¼åº¦æ¯”è¾ƒç”¨æˆ·åå¥½å‘é‡ä¸ç›®æ ‡æ¸¸æˆå‘é‡</li></ul></li><li>æŠ€æœ¯å®ç°ï¼š<ul><li>ä½¿ç”¨numpyè¿›è¡Œå‘é‡è¿ç®—å’Œå‡å€¼è®¡ç®—</li><li>åˆ©ç”¨pandasè¿›è¡Œæ•°æ®å¤„ç†å’Œç»“æœå±•ç¤º</li><li>é€šè¿‡sklearnçš„cosine_similarityè®¡ç®—ç›¸ä¼¼åº¦</li></ul></li><li>å·¥ä½œæµç¨‹ï¼š<ul><li>åŠ è½½æ‰€æœ‰æ¸¸æˆæè¿°å¹¶ç”ŸæˆåµŒå…¥å‘é‡</li><li>ä¸ºæ¯ä¸ªç”¨æˆ·è®¡ç®—åå¥½å‘é‡ï¼ˆè¯„ä»·æ¸¸æˆå‘é‡çš„å‡å€¼ï¼‰</li><li>è®¡ç®—ç›®æ ‡æ¸¸æˆä¸æ‰€æœ‰ç”¨æˆ·åå¥½çš„ç›¸ä¼¼åº¦</li><li>æŒ‰ç›¸ä¼¼åº¦æ’åºè¾“å‡ºå‰5ä½æ½œåœ¨ç”¨æˆ·</li></ul></li><li>å®è·µå»ºè®®ï¼š<ul><li>å¯æ›¿æ¢OpenAIæ¨¡å‹ä¸ºå›½äº§å¼€æºæ¨¡å‹ï¼ˆå¦‚æ”¯æŒä¸­æ–‡çš„åµŒå…¥æ¨¡å‹ï¼‰</li><li>ç±»ä¼¼æ€è·¯å¯ç”¨äºå…¶ä»–æ¨èåœºæ™¯ï¼ˆå¦‚ç”µå½±ã€å•†å“æ¨èï¼‰</li></ul></li></ul>]]></content>
    
    
    <summary type="html">å­¦ä¹ å¤§æ¨¡å‹RAGç³»ç»Ÿå­¦ä¹ ç¬”è®°ç¬¬åå…­è®²</summary>
    
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>RAGç»„ä»¶--æ–‡æœ¬åˆ†å—ä¹‹æ–¹æ³•å’Œå®ç°</title>
    <link href="https://jinglv.github.io/2025/08/13/ai/rag/12-text-chunk/"/>
    <id>https://jinglv.github.io/2025/08/13/ai/rag/12-text-chunk/</id>
    <published>2025-08-12T16:00:00.000Z</published>
    <updated>2025-08-13T05:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CharacterTextSplitter-æŒ‰å›ºå®šå­—ç¬¦æ•°åˆ†å—"><a href="#CharacterTextSplitter-æŒ‰å›ºå®šå­—ç¬¦æ•°åˆ†å—" class="headerlink" title="CharacterTextSplitter - æŒ‰å›ºå®šå­—ç¬¦æ•°åˆ†å—"></a>CharacterTextSplitter - æŒ‰å›ºå®šå­—ç¬¦æ•°åˆ†å—</h1><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250813133708333.png" alt="image-20250813133708333" style="zoom:67%;" /></p><ul><li>å®ç°æ–¹å¼ï¼šé€šè¿‡CharacterTextSplitteræŒ‡å®šchunk_sizeï¼ˆå¦‚1000å­—ç¬¦ï¼‰å’Œchunk_overlapï¼ˆé‡å å­—ç¬¦æ•°ï¼‰</li><li>ç‰¹ç‚¹ï¼š<ul><li>ç®€å•ç²—æš´ï¼Œç›´æ¥æŒ‰å­—ç¬¦æ•°åˆ‡å‰²</li><li>é»˜è®¤ä»¥æ®µè½ï¼ˆ\n\nï¼‰ä¸ºåˆ†éš”ç¬¦ï¼Œä¹Ÿå¯æŒ‡å®šé€—å·ã€å¥å·ç­‰</li><li>è‹¥æ®µè½è¶…è¿‡è®¾å®šå€¼ï¼ˆå¦‚2000å­—ç¬¦ï¼‰ï¼Œä¼šä¿æŒåŸæ®µè½ä¸åˆ†å—</li></ul></li><li>å±€é™æ€§ï¼šä¸å¤Ÿæ™ºèƒ½ï¼Œå¯èƒ½ç ´åè¯­ä¹‰å®Œæ•´æ€§</li></ul><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.document_loaders <span class="keyword">import</span> TextLoader</span><br><span class="line"><span class="keyword">from</span> langchain_text_splitters <span class="keyword">import</span> CharacterTextSplitter</span><br><span class="line"></span><br><span class="line">loader = TextLoader(<span class="string">&quot;../data/å±±è¥¿æ–‡æ—…/äº‘å†ˆçŸ³çªŸ.txt&quot;</span>)</span><br><span class="line">documents = loader.load()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®åˆ†å—å™¨ï¼ŒæŒ‡å®šå—çš„å¤§å°ä¸º50ä¸ªå­—ç¬¦ï¼Œæ— é‡å </span></span><br><span class="line">text_splitter = CharacterTextSplitter(</span><br><span class="line">    chunk_size=<span class="number">100</span>,  <span class="comment"># æ¯ä¸ªæ–‡æœ¬å—çš„å¤§å°ä¸º50ä¸ªå­—ç¬¦</span></span><br><span class="line">    chunk_overlap=<span class="number">0</span>,  <span class="comment"># æ–‡æœ¬å—ä¹‹é—´æ²¡æœ‰é‡å éƒ¨åˆ†</span></span><br><span class="line">)</span><br><span class="line">chunks = text_splitter.split_documents(documents)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== æ–‡æ¡£åˆ†å—ç»“æœ ===&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i, chunk <span class="keyword">in</span> <span class="built_in">enumerate</span>(chunks, <span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n--- ç¬¬ <span class="subst">&#123;i&#125;</span> ä¸ªæ–‡æ¡£å— ---&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å†…å®¹: <span class="subst">&#123;chunk.page_content&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å…ƒæ•°æ®: <span class="subst">&#123;chunk.metadata&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼Œè¾“å‡ºå†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">=== æ–‡æ¡£åˆ†å—ç»“æœ ===</span><br><span class="line"></span><br><span class="line">--- ç¬¬ 1 ä¸ªæ–‡æ¡£å— ---</span><br><span class="line">å†…å®¹: äº‘å†ˆçŸ³çªŸ</span><br><span class="line">äº‘å†ˆçŸ³çªŸä½äºä¸­å›½åŒ—éƒ¨å±±è¥¿çœå¤§åŒå¸‚è¥¿éƒŠ17å…¬é‡Œå¤„çš„æ­¦å‘¨å±±å—éº“ï¼ŒçŸ³çªŸä¾å±±å¼€å‡¿ï¼Œä¸œè¥¿ç»µå»¶1å…¬é‡Œã€‚å­˜æœ‰ä¸»è¦æ´çªŸ45ä¸ªï¼Œå¤§å°çªŸé¾›252ä¸ªï¼ŒçŸ³é›•é€ åƒ51000ä½™èº¯ï¼Œä¸ºä¸­å›½è§„æ¨¡æœ€å¤§çš„å¤ä»£çŸ³çªŸç¾¤ä¹‹ä¸€ï¼Œä¸æ•¦ç…Œè«é«˜çªŸã€æ´›é˜³é¾™é—¨çŸ³çªŸå’Œå¤©æ°´éº¦ç§¯å±±çŸ³çªŸå¹¶ç§°ä¸ºä¸­å›½å››å¤§çŸ³çªŸè‰ºæœ¯å®åº“ã€‚ 1961å¹´è¢«å›½åŠ¡é™¢å…¬å¸ƒä¸ºå…¨å›½é¦–æ‰¹é‡ç‚¹æ–‡ç‰©ä¿æŠ¤å•ä½ï¼Œ2001å¹´12æœˆ14æ—¥è¢«è”åˆå›½æ•™ç§‘æ–‡ç»„ç»‡åˆ—å…¥ä¸–ç•Œé—äº§åå½•ï¼Œ2007å¹´5æœˆ8æ—¥è¢«å›½å®¶æ—…æ¸¸å±€è¯„ä¸ºé¦–æ‰¹å›½å®¶5Açº§æ—…æ¸¸æ™¯åŒºã€‚</span><br><span class="line">å…ƒæ•°æ®: &#123;&#x27;source&#x27;: &#x27;../data/å±±è¥¿æ–‡æ—…/äº‘å†ˆçŸ³çªŸ.txt&#x27;&#125;</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">--- ç¬¬ 2 ä¸ªæ–‡æ¡£å— ---</span><br><span class="line">å†…å®¹: äº‘å†ˆäº”åæ´</span><br><span class="line">ä½äºäº‘å†ˆçŸ³çªŸä¸­éƒ¨çš„ç¬¬ 9â€”â€”13çªŸã€‚è¿™äº”çªŸå› æ¸…ä»£æ–½æ³¥å½©ç»˜äº‘å†ˆçŸ³çªŸæ™¯è§‚è€Œå¾—åã€‚äº”åæ´é›•é¥°ç»®ä¸½ï¼Œä¸°å¯Œå¤šå½©ï¼Œæ˜¯ç ”ç©¶åŒ—é­å†å²ã€è‰ºæœ¯ã€éŸ³ä¹ã€èˆè¹ˆã€ä¹¦æ³•å’Œå»ºç­‘çš„çè´µèµ„æ–™ï¼Œä¸ºäº‘å†ˆçŸ³çªŸç¾¤çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚</span><br><span class="line">å…ƒæ•°æ®: &#123;&#x27;source&#x27;: &#x27;../data/å±±è¥¿æ–‡æ—…/äº‘å†ˆçŸ³çªŸ.txt&#x27;&#125;</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">--- ç¬¬ 3 ä¸ªæ–‡æ¡£å— ---</span><br><span class="line">å†…å®¹: å¡”æ´</span><br><span class="line">äº‘å†ˆä¸œéƒ¨çªŸç¾¤ï¼ŒæŒ‡äº‘å†ˆçŸ³çªŸä¸œç«¯1â€”â€”4ï¼Œå‡ä¸ºå¡”æ´ã€‚ç¬¬1ã€2çªŸä¸ºåŒæœŸå¼€çš„ä¸€ç»„ï¼Œå‡¿äºå­æ–‡å¸è¿æ´›å‰ï¼ŒçªŸå†…ä¸­å¤®é›•é€ æ–¹å½¢å¡”æŸ±ï¼Œå››é¢å¼€é¾›é€ åƒã€‚ç¬¬ä¸€çªŸä¸»åƒæ˜¯å¼¥å‹’ï¼Œå¡”å—é¢ä¸‹å±‚é›•é‡Šè¿¦å¤šå®åƒï¼Œä¸Šå±‚é›•é‡Šè¿¦åƒã€‚æµ®é›•äº”å±‚å°å¡”ï¼Œæ˜¯ç ”ç©¶åŒ—é­å»ºç­‘çš„å½¢è±¡èµ„æ–™ã€‚ç¬¬äºŒçªŸæ˜¯é‡Šè¿¦åƒï¼Œå¡”å—é¢ä¸‹å±‚é›•é‡Šè¿¦å¤šå®åƒï¼Œä¸Šå±‚é›•ä¸‰ä¸–ä½›ã€‚ä¸¤çªŸå—å£çªŸé—¨ä¸¤ä¾§éƒ½é›•æœ‰ç»´æ‘©ã€æ–‡æ®Šã€‚ç¬¬ä¸‰çªŸä¸ºäº‘å†ˆçŸ³çªŸä¸­è§„æ¨¡æœ€å¤§çš„æ´çªŸï¼Œå‰ç«‹å£é«˜çº¦25ç±³ï¼Œä¼ ä¸ºæ˜™æ›œè¯‘ç»æ¥¼ã€‚</span><br><span class="line">å…ƒæ•°æ®: &#123;&#x27;source&#x27;: &#x27;../data/å±±è¥¿æ–‡æ—…/äº‘å†ˆçŸ³çªŸ.txt&#x27;&#125;</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">--- ç¬¬ 4 ä¸ªæ–‡æ¡£å— ---</span><br><span class="line">å†…å®¹: æ­¦å·å±±</span><br><span class="line">æ­¦å‘¨å±±ï¼Œäº¦åæ­¦å·å±±ï¼Œåœ¨å¤§åŒåŸè¥¿å±±ä¸­ã€‚å®‹ã€Šå¤ªå¹³å¯°å®‡è®°ã€‹å¼•ã€Šå†€å·å›¾ã€‹äº‘ï¼šâ€œæ­¦å‘¨å±±åœ¨éƒ¡è¥¿åŒ—ï¼Œä¸œè¥¿æ•°ç™¾é‡Œï¼Œå—åŒ—äº”åé‡Œã€‚å±±ä¹‹å—é¢ï¼Œåƒä»å£ç«‹ã€‚â€äº‘å†ˆçŸ³çªŸå³å› æ­¦å‘¨å±±å—ç¼˜æ–©å±±å¼€å‡¿ã€‚</span><br><span class="line">å…ƒæ•°æ®: &#123;&#x27;source&#x27;: &#x27;../data/å±±è¥¿æ–‡æ—…/äº‘å†ˆçŸ³çªŸ.txt&#x27;&#125;</span><br><span class="line">...</span><br><span class="line">--- ç¬¬ 11 ä¸ªæ–‡æ¡£å— ---</span><br><span class="line">å†…å®¹: 1ã€å’¨è¯¢ç”µè¯ï¼š0352-3206805ï¼Œæ™¯åŒºç”µç“¶è½¦10å…ƒ/äººã€‚ 2ã€ä¼˜æƒ ç¾¤ä½“ï¼š ï¼ˆ1ï¼‰60å‘¨å²ï¼ˆå«60å‘¨å²ï¼‰ä»¥ä¸Šè€äººï¼ŒæŒæœ¬äººèº«ä»½è¯æˆ–è€å¹´è¯å…ç¥¨ï¼› ï¼ˆ2ï¼‰6å‘¨å²ï¼ˆå«6å‘¨å²ï¼‰ä»¥ä¸‹æˆ– 1.2ç±³ä»¥ä¸‹å„¿ç«¥å…ç¥¨ï¼› ï¼ˆ3ï¼‰6å‘¨å²ï¼ˆä¸å«6å‘¨å²ï¼‰â€”â€”18å‘¨å²ï¼ˆå«18å‘¨å²ï¼‰çš„æœªæˆå¹´äººï¼Œå…¨æ—¥åˆ¶å¤§å­¦æœ¬ç§‘åŠä»¥ä¸‹å­¦å†çš„å­¦ç”Ÿï¼Œå‡­æœ¬äººèº«ä»½è¯ã€å­¦ç”Ÿè¯äº«å—åŠä»·ç¥¨ä¼˜æƒ ã€‚ ï¼ˆ4ï¼‰å…¨æ—¥åˆ¶å¤§å­¦æœ¬ç§‘åŠä»¥å­¦å†å­¦ç”Ÿï¼Œå‡­æœ¬äººèº«ä»½è¯ã€å­¦ç”Ÿè¯äº«å—åŠä»·ç¥¨ä¼˜æƒ ã€‚ ï¼ˆ5ï¼‰æ®‹ç–¾äººæŒæœ¬äººèº«ä»½è¯å’Œç¬¬äºŒä»£ã€Šä¸­åäººæ°‘å…±å’Œå›½æ®‹ç–¾è¯ã€‹å…ç¥¨ï¼›ä¼¤æ®‹å†›äººæŒä¼¤æ®‹å†›äººè¯åŠæœ¬äººèº«ä»½è¯å…ç¥¨ã€‚ ï¼ˆ6ï¼‰ç°å½¹å†›äººå‡­å†›äººä¿éšœå¡å…ç¥¨è¿›å…¥ã€‚ ï¼ˆ7ï¼‰å¯¼æ¸¸äººå‘˜å…ç¥¨ï¼Œéœ€æŒæœ¬äººå¯¼æ¸¸è¯ï¼ˆä¸å«å¯¼æ¸¸èµ„æ ¼è¯ã€ç»ç†èµ„æ ¼è¯ï¼‰ã€æ´¾å›¢å•ã€è¡Œç¨‹è®¡åˆ’å•ã€‚</span><br><span class="line">å…ƒæ•°æ®: &#123;&#x27;source&#x27;: &#x27;../data/å±±è¥¿æ–‡æ—…/äº‘å†ˆçŸ³çªŸ.txt&#x27;&#125;</span><br></pre></td></tr></table></figure><h1 id="RecursiveCharacterTextSplitter-â€“-é€’å½’åˆ†å—"><a href="#RecursiveCharacterTextSplitter-â€“-é€’å½’åˆ†å—" class="headerlink" title="RecursiveCharacterTextSplitter â€“ é€’å½’åˆ†å—"></a>RecursiveCharacterTextSplitter â€“ é€’å½’åˆ†å—</h1><p><img src="https://jing-images.oss-cn-beijing.aliyuncs.com/img/image-20250813134158833.png" alt="image-20250813134158833" style="zoom:50%;" /></p><ul><li>å®ç°åŸç†ï¼š<ul><li>å®šä¹‰ä¼˜å…ˆçº§åˆ†éš”ç¬¦åˆ—è¡¨ï¼ˆå¦‚[â€œ\n\nâ€, â€œ.â€, â€œ,â€, â€œ â€œ]ï¼‰</li><li>å…ˆå°è¯•ç¬¬ä¸€ä¸ªåˆ†éš”ç¬¦ï¼Œè‹¥å—è¿‡å¤§åˆ™å°è¯•ä¸‹ä¸€ä¸ª</li></ul></li><li>ä¼˜åŠ¿ï¼š<ul><li>åˆ‡å‰²æ›´ç²¾ç»†ï¼ˆå¯ç»†åŒ–åˆ°å¥å­ã€çŸ­è¯­çº§åˆ«ï¼‰</li><li>é€šè¿‡å¤šçº§åˆ†éš”ç¬¦ä¿è¯å—å¤§å°æ¥è¿‘è®¾å®šå€¼</li></ul></li><li>æ³¨æ„äº‹é¡¹ï¼š<ul><li>åˆ†éš”ç¬¦ä¸å®œè¿‡ç»†ï¼ˆå¦‚ç©ºæ ¼ï¼‰ï¼Œå¦åˆ™ä¼šç ´åè¯­ä¹‰</li><li>è‹±æ–‡ä¸­â€.â€éœ€æ³¨æ„åŒºåˆ†å°æ•°ç‚¹å’Œå¥å·</li></ul></li><li>å¯¹æ¯”å›ºå®šåˆ†å—ï¼š<ul><li>ç›¸åŒè®¾å®šä¸‹ï¼Œé€’å½’åˆ†å—æ•°æ›´å¤šï¼ˆå¦‚100å­—ç¬¦è®¾å®šäº§ç”Ÿ22å— vs å›ºå®šåˆ†å—11å—ï¼‰</li><li>ä½†è¿‡åº¦åˆ†å‰²å¯èƒ½å¯¼è‡´å…³é”®ä¿¡æ¯æ–­è£‚ï¼ˆå¦‚ä»·æ ¼â€1.5å…ƒâ€è¢«æ‹†åˆ†ä¸ºâ€1â€å’Œâ€.5å…ƒâ€ï¼‰</li></ul></li></ul><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.document_loaders <span class="keyword">import</span> TextLoader</span><br><span class="line"><span class="keyword">from</span> langchain_text_splitters <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"></span><br><span class="line">loader = TextLoader(<span class="string">&quot;../data/å±±è¥¿æ–‡æ—…/äº‘å†ˆçŸ³çªŸ.txt&quot;</span>)</span><br><span class="line">documents = loader.load()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰åˆ†å‰²ç¬¦åˆ—è¡¨ï¼ŒæŒ‰ä¼˜å…ˆçº§ä¾æ¬¡ä½¿ç”¨</span></span><br><span class="line">separators = [<span class="string">&quot;\n\n&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="string">&quot;ï¼Œ&quot;</span>, <span class="string">&quot; &quot;</span>] <span class="comment"># . æ˜¯å¥å·ï¼Œï¼Œ æ˜¯é€—å·ï¼Œ æ˜¯ç©ºæ ¼</span></span><br><span class="line"><span class="comment"># åˆ›å»ºé€’å½’åˆ†å—å™¨ï¼Œå¹¶ä¼ å…¥åˆ†å‰²ç¬¦åˆ—è¡¨</span></span><br><span class="line">text_splitter = RecursiveCharacterTextSplitter(</span><br><span class="line">    chunk_size=<span class="number">100</span>,</span><br><span class="line">    chunk_overlap=<span class="number">10</span>,</span><br><span class="line">    separators=separators</span><br><span class="line">)</span><br><span class="line">chunks = text_splitter.split_documents(documents)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== æ–‡æ¡£åˆ†å—ç»“æœ ===&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i, chunk <span class="keyword">in</span> <span class="built_in">enumerate</span>(chunks, <span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n--- ç¬¬ <span class="subst">&#123;i&#125;</span> ä¸ªæ–‡æ¡£å— ---&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å†…å®¹: <span class="subst">&#123;chunk.page_content&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å…ƒæ•°æ®: <span class="subst">&#123;chunk.metadata&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼Œè¾“å‡ºå†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">=== æ–‡æ¡£åˆ†å—ç»“æœ ===</span><br><span class="line"></span><br><span class="line">--- ç¬¬ 1 ä¸ªæ–‡æ¡£å— ---</span><br><span class="line">å†…å®¹: äº‘å†ˆçŸ³çªŸ</span><br><span class="line">äº‘å†ˆçŸ³çªŸä½äºä¸­å›½åŒ—éƒ¨å±±è¥¿çœå¤§åŒå¸‚è¥¿éƒŠ17å…¬é‡Œå¤„çš„æ­¦å‘¨å±±å—éº“ï¼ŒçŸ³çªŸä¾å±±å¼€å‡¿ï¼Œä¸œè¥¿ç»µå»¶1å…¬é‡Œã€‚å­˜æœ‰ä¸»è¦æ´çªŸ45ä¸ªï¼Œå¤§å°çªŸé¾›252ä¸ªï¼ŒçŸ³é›•é€ åƒ51000ä½™èº¯ï¼Œä¸ºä¸­å›½è§„æ¨¡æœ€å¤§çš„å¤ä»£çŸ³çªŸç¾¤ä¹‹ä¸€</span><br><span class="line">å…ƒæ•°æ®: &#123;&#x27;source&#x27;: &#x27;../data/å±±è¥¿æ–‡æ—…/äº‘å†ˆçŸ³çªŸ.txt&#x27;&#125;</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">--- ç¬¬ 2 ä¸ªæ–‡æ¡£å— ---</span><br><span class="line">å†…å®¹: ï¼Œä¸æ•¦ç…Œè«é«˜çªŸã€æ´›é˜³é¾™é—¨çŸ³çªŸå’Œå¤©æ°´éº¦ç§¯å±±çŸ³çªŸå¹¶ç§°ä¸ºä¸­å›½å››å¤§çŸ³çªŸè‰ºæœ¯å®åº“ã€‚ 1961å¹´è¢«å›½åŠ¡é™¢å…¬å¸ƒä¸ºå…¨å›½é¦–æ‰¹é‡ç‚¹æ–‡ç‰©ä¿æŠ¤å•ä½ï¼Œ2001å¹´12æœˆ14æ—¥è¢«è”åˆå›½æ•™ç§‘æ–‡ç»„ç»‡åˆ—å…¥ä¸–ç•Œé—äº§åå½•</span><br><span class="line">å…ƒæ•°æ®: &#123;&#x27;source&#x27;: &#x27;../data/å±±è¥¿æ–‡æ—…/äº‘å†ˆçŸ³çªŸ.txt&#x27;&#125;</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">--- ç¬¬ 3 ä¸ªæ–‡æ¡£å— ---</span><br><span class="line">å†…å®¹: ï¼Œ2007å¹´5æœˆ8æ—¥è¢«å›½å®¶æ—…æ¸¸å±€è¯„ä¸ºé¦–æ‰¹å›½å®¶5Açº§æ—…æ¸¸æ™¯åŒºã€‚</span><br><span class="line">å…ƒæ•°æ®: &#123;&#x27;source&#x27;: &#x27;../data/å±±è¥¿æ–‡æ—…/äº‘å†ˆçŸ³çªŸ.txt&#x27;&#125;</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">--- ç¬¬ 4 ä¸ªæ–‡æ¡£å— ---</span><br><span class="line">å†…å®¹: äº‘å†ˆäº”åæ´</span><br><span class="line">ä½äºäº‘å†ˆçŸ³çªŸä¸­éƒ¨çš„ç¬¬ 9â€”â€”13çªŸã€‚è¿™äº”çªŸå› æ¸…ä»£æ–½æ³¥å½©ç»˜äº‘å†ˆçŸ³çªŸæ™¯è§‚è€Œå¾—åã€‚äº”åæ´é›•é¥°ç»®ä¸½ï¼Œä¸°å¯Œå¤šå½©ï¼Œæ˜¯ç ”ç©¶åŒ—é­å†å²ã€è‰ºæœ¯ã€éŸ³ä¹ã€èˆè¹ˆã€ä¹¦æ³•å’Œå»ºç­‘çš„çè´µèµ„æ–™</span><br><span class="line">å…ƒæ•°æ®: &#123;&#x27;source&#x27;: &#x27;../data/å±±è¥¿æ–‡æ—…/äº‘å†ˆçŸ³çªŸ.txt&#x27;&#125;</span><br><span class="line">--------------------------------------------------</span><br><span class="line">...</span><br><span class="line">--- ç¬¬ 22 ä¸ªæ–‡æ¡£å— ---</span><br><span class="line">å†…å®¹: ï¼Œéœ€æŒæœ¬äººå¯¼æ¸¸è¯ï¼ˆä¸å«å¯¼æ¸¸èµ„æ ¼è¯ã€ç»ç†èµ„æ ¼è¯ï¼‰ã€æ´¾å›¢å•ã€è¡Œç¨‹è®¡åˆ’å•ã€‚</span><br><span class="line">å…ƒæ•°æ®: &#123;&#x27;source&#x27;: &#x27;../data/å±±è¥¿æ–‡æ—…/äº‘å†ˆçŸ³çªŸ.txt&#x27;&#125;</span><br><span class="line">--------------------------------------------------</span><br></pre></td></tr></table></figure><h1 id="åˆ†å—çš„é‡è¦æ€§"><a href="#åˆ†å—çš„é‡è¦æ€§" class="headerlink" title="åˆ†å—çš„é‡è¦æ€§"></a>åˆ†å—çš„é‡è¦æ€§</h1><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"></span><br><span class="line">load_dotenv()   </span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> llama_index.llms.openai <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> llama_index.embeddings.openai <span class="keyword">import</span> OpenAIEmbedding</span><br><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> VectorStoreIndex</span><br><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> Settings</span><br><span class="line"><span class="keyword">from</span> llama_index.readers.file <span class="keyword">import</span> PDFReader</span><br><span class="line"><span class="keyword">from</span> llama_index.core.node_parser <span class="keyword">import</span> SentenceSplitter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">embed_model = OpenAIEmbedding(model=<span class="string">&quot;text-embedding-3-small&quot;</span>)</span><br><span class="line">llm = OpenAI(</span><br><span class="line">    model=os.getenv(<span class="string">&quot;DEEPSEEK_MODEL_NAME&quot;</span>),  <span class="comment"># DeepSeek API æ”¯æŒçš„æ¨¡å‹åç§°</span></span><br><span class="line">    api_key=os.getenv(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),  <span class="comment"># ä»ç¯å¢ƒå˜é‡åŠ è½½API key</span></span><br><span class="line">    api_base=os.getenv(<span class="string">&quot;DEEPSEEK_BASE_URL&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">Settings.embed_model = embed_model</span><br><span class="line">Settings.llm = llm</span><br><span class="line">Settings.node_parser = SentenceSplitter(chunk_size=<span class="number">250</span>, chunk_overlap=<span class="number">20</span>) <span class="comment"># 50, 100, 250å°†å¾—åˆ°ä¸åŒçš„ç»“æœï¼Œä¸ºä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load PDF using standard PDFReader</span></span><br><span class="line">loader = PDFReader()</span><br><span class="line">documents = loader.load_data(</span><br><span class="line">    file=<span class="string">&quot;../data/å¤æ‚PDF/uber_10q_march_2022_page26.pdf&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create index directly from documents</span></span><br><span class="line">index = VectorStoreIndex.from_documents(documents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create query engine</span></span><br><span class="line">query_engine = index.as_query_engine(</span><br><span class="line">    similarity_top_k=<span class="number">3</span>,</span><br><span class="line">    verbose=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">query = <span class="string">&quot;how much is the Loss from operations for 2022?&quot;</span></span><br><span class="line"></span><br><span class="line">response = query_engine.query(query)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n************LlamaIndex Query Response************&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display retrieved chunks</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n************Retrieved Text Chunks************&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i, source_node <span class="keyword">in</span> <span class="built_in">enumerate</span>(response.source_nodes):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\nChunk <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Text content:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(source_node.text)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br></pre></td></tr></table></figure><p>è°ƒæ•´å—çš„å¤§å°</p><ul><li>å…³é”®å‘ç°ï¼š<ul><li>100å­—ç¬¦åˆ†å—ï¼šè¿”å›é”™è¯¯ç­”æ¡ˆ$1.938Bï¼ˆæ— æ„ä¹‰æ•°å€¼ï¼‰</li><li>150å­—ç¬¦åˆ†å—ï¼šè¿”å›$1.524Bï¼ˆ2021å¹´æ­£ç¡®å€¼ï¼Œä½†éé—®é¢˜è¦æ±‚çš„2022å¹´ï¼‰</li><li>250å­—ç¬¦åˆ†å—ï¼šæ­£ç¡®è¿”å›$482Mï¼ˆ2022å¹´å®é™…å€¼ï¼‰</li></ul></li><li>åŸç†åˆ†æï¼š<ul><li>è¿‡å°åˆ†å—å‰²è£‚è¡¨æ ¼æ•°æ®å…³è”æ€§</li><li>é€‚å½“åˆ†å—ä¿ç•™å®Œæ•´è¡¨æ ¼ç»“æ„ï¼Œä½¿æ¨¡å‹èƒ½æ­£ç¡®å¯¹åº”å¹´ä»½ä¸æ•°å€¼</li><li>è¿‡å¤§åˆ†å—ï¼ˆå¦‚2500å­—ç¬¦ï¼‰å¯èƒ½å¼•å…¥å¹²æ‰°ä¿¡æ¯</li></ul></li></ul><h1 id="åŸºäºç‰¹å®šæ ¼å¼ï¼ˆå¦‚ä»£ç ï¼‰åˆ†å—"><a href="#åŸºäºç‰¹å®šæ ¼å¼ï¼ˆå¦‚ä»£ç ï¼‰åˆ†å—" class="headerlink" title="åŸºäºç‰¹å®šæ ¼å¼ï¼ˆå¦‚ä»£ç ï¼‰åˆ†å—"></a>åŸºäºç‰¹å®šæ ¼å¼ï¼ˆå¦‚ä»£ç ï¼‰åˆ†å—</h1><ul><li>æ™®é€šåˆ†å—é—®é¢˜ï¼š<ul><li>å‡½æ•°å®šä¹‰è¢«å¼ºè¡Œæ‹†åˆ†</li><li>ç±»æˆå‘˜å˜é‡ä¸æ–¹æ³•åˆ†ç¦»</li></ul></li><li>è¯­è¨€ä¸“ç”¨åˆ†å—ï¼š<ul><li>æŒ‰classå’Œdefè‡ªç„¶åˆ†å‰²</li><li>ä¿ç•™å®Œæ•´ç±»ç»“æ„ï¼ˆå¦‚CombatSystemç±»å®Œæ•´åŒ…å«æ‰€æœ‰æ–¹æ³•ï¼‰</li><li>æ”¯æŒå¤šç§è¯­è¨€ï¼ˆPython/Java/SQLç­‰ï¼‰çš„è¯­æ³•æ„ŸçŸ¥åˆ†å‰²</li></ul></li></ul><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_text_splitters <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"><span class="keyword">from</span> langchain_text_splitters <span class="keyword">import</span> Language</span><br><span class="line"></span><br><span class="line">separators = RecursiveCharacterTextSplitter.get_separators_for_language(Language.JS)</span><br><span class="line"><span class="built_in">print</span>(separators)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_text_splitters <span class="keyword">import</span> (</span><br><span class="line">    Language,</span><br><span class="line">    RecursiveCharacterTextSplitter,</span><br><span class="line">)</span><br><span class="line">GAME_CODE = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">class CombatSystem:</span></span><br><span class="line"><span class="string">   def __init__(self):</span></span><br><span class="line"><span class="string">       self.health = 100</span></span><br><span class="line"><span class="string">       self.stamina = 100</span></span><br><span class="line"><span class="string">       self.state = &quot;IDLE&quot;</span></span><br><span class="line"><span class="string">       self.attack_patterns = &#123;</span></span><br><span class="line"><span class="string">           &quot;NORMAL&quot;: 10,</span></span><br><span class="line"><span class="string">           &quot;SPECIAL&quot;: 30,</span></span><br><span class="line"><span class="string">           &quot;ULTIMATE&quot;: 50</span></span><br><span class="line"><span class="string">       &#125;</span></span><br><span class="line"><span class="string">   def update(self, delta_time):</span></span><br><span class="line"><span class="string">       self._update_stats(delta_time)</span></span><br><span class="line"><span class="string">       self._handle_combat()</span></span><br><span class="line"><span class="string">   def _update_stats(self, delta_time):</span></span><br><span class="line"><span class="string">       self.stamina = min(100, self.stamina + 5 * delta_time)</span></span><br><span class="line"><span class="string">   def _handle_combat(self):</span></span><br><span class="line"><span class="string">       if self.state == &quot;ATTACKING&quot;:</span></span><br><span class="line"><span class="string">           self._execute_attack()</span></span><br><span class="line"><span class="string">   def _execute_attack(self):</span></span><br><span class="line"><span class="string">       if self.stamina &gt;= self.attack_patterns[&quot;SPECIAL&quot;]:</span></span><br><span class="line"><span class="string">           damage = 50</span></span><br><span class="line"><span class="string">           self.stamina -= self.attack_patterns[&quot;SPECIAL&quot;]</span></span><br><span class="line"><span class="string">           return damage</span></span><br><span class="line"><span class="string">       return self.attack_patterns[&quot;NORMAL&quot;]</span></span><br><span class="line"><span class="string">class InventorySystem:</span></span><br><span class="line"><span class="string">   def __init__(self):</span></span><br><span class="line"><span class="string">       self.items = &#123;&#125;</span></span><br><span class="line"><span class="string">       self.capacity = 20</span></span><br><span class="line"><span class="string">       self.gold = 0</span></span><br><span class="line"><span class="string">   def add_item(self, item_id, quantity):</span></span><br><span class="line"><span class="string">       if len(self.items) &lt; self.capacity:</span></span><br><span class="line"><span class="string">           if item_id in self.items:</span></span><br><span class="line"><span class="string">               self.items[item_id] += quantity</span></span><br><span class="line"><span class="string">           else:</span></span><br><span class="line"><span class="string">               self.items[item_id] = quantity</span></span><br><span class="line"><span class="string">   def remove_item(self, item_id, quantity):</span></span><br><span class="line"><span class="string">       if item_id in self.items:</span></span><br><span class="line"><span class="string">           self.items[item_id] -= quantity</span></span><br><span class="line"><span class="string">           if self.items[item_id] &lt;= 0:</span></span><br><span class="line"><span class="string">               del self.items[item_id]</span></span><br><span class="line"><span class="string">   def get_item_count(self, item_id):</span></span><br><span class="line"><span class="string">       return self.items.get(item_id, 0)</span></span><br><span class="line"><span class="string">class QuestSystem:</span></span><br><span class="line"><span class="string">   def __init__(self):</span></span><br><span class="line"><span class="string">       self.active_quests = &#123;&#125;</span></span><br><span class="line"><span class="string">       self.completed_quests = set()</span></span><br><span class="line"><span class="string">       self.quest_log = []</span></span><br><span class="line"><span class="string">   def add_quest(self, quest_id, quest_data):</span></span><br><span class="line"><span class="string">       if quest_id not in self.active_quests:</span></span><br><span class="line"><span class="string">           self.active_quests[quest_id] = quest_data</span></span><br><span class="line"><span class="string">           self.quest_log.append(f&quot;Started quest: &#123;quest_data[&#x27;name&#x27;]&#125;&quot;)</span></span><br><span class="line"><span class="string">   def complete_quest(self, quest_id):</span></span><br><span class="line"><span class="string">       if quest_id in self.active_quests:</span></span><br><span class="line"><span class="string">           self.completed_quests.add(quest_id)</span></span><br><span class="line"><span class="string">           del self.active_quests[quest_id]</span></span><br><span class="line"><span class="string">   def get_active_quests(self):</span></span><br><span class="line"><span class="string">       return list(self.active_quests.keys())</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">python_splitter = RecursiveCharacterTextSplitter.from_language(</span><br><span class="line">   language=Language.PYTHON,  <span class="comment"># æŒ‡å®šç¼–ç¨‹è¯­è¨€ä¸ºPython</span></span><br><span class="line">   chunk_size=<span class="number">1000</span>,</span><br><span class="line">   chunk_overlap=<span class="number">0</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">python_docs = python_splitter.create_documents([GAME_CODE])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== ä»£ç åˆ†å—ç»“æœ ===&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i, chunk <span class="keyword">in</span> <span class="built_in">enumerate</span>(python_docs, <span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n--- ç¬¬ <span class="subst">&#123;i&#125;</span> ä¸ªä»£ç å— ---&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å†…å®¹:\n<span class="subst">&#123;chunk.page_content&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å…ƒæ•°æ®: <span class="subst">&#123;chunk.metadata&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼Œè¾“å‡ºå†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;\nfunction &#x27;, &#x27;\nconst &#x27;, &#x27;\nlet &#x27;, &#x27;\nvar &#x27;, &#x27;\nclass &#x27;, &#x27;\nif &#x27;, &#x27;\nfor &#x27;, &#x27;\nwhile &#x27;, &#x27;\nswitch &#x27;, &#x27;\ncase &#x27;, &#x27;\ndefault &#x27;, &#x27;\n\n&#x27;, &#x27;\n&#x27;, &#x27; &#x27;, &#x27;&#x27;]</span><br><span class="line"></span><br><span class="line">=== ä»£ç åˆ†å—ç»“æœ ===</span><br><span class="line"></span><br><span class="line">--- ç¬¬ 1 ä¸ªä»£ç å— ---</span><br><span class="line">å†…å®¹:</span><br><span class="line">class CombatSystem:</span><br><span class="line">   def __init__(self):</span><br><span class="line">       self.health = 100</span><br><span class="line">       self.stamina = 100</span><br><span class="line">       self.state = &quot;IDLE&quot;</span><br><span class="line">       self.attack_patterns = &#123;</span><br><span class="line">           &quot;NORMAL&quot;: 10,</span><br><span class="line">           &quot;SPECIAL&quot;: 30,</span><br><span class="line">           &quot;ULTIMATE&quot;: 50</span><br><span class="line">       &#125;</span><br><span class="line">   def update(self, delta_time):</span><br><span class="line">       self._update_stats(delta_time)</span><br><span class="line">       self._handle_combat()</span><br><span class="line">   def _update_stats(self, delta_time):</span><br><span class="line">       self.stamina = min(100, self.stamina + 5 * delta_time)</span><br><span class="line">   def _handle_combat(self):</span><br><span class="line">       if self.state == &quot;ATTACKING&quot;:</span><br><span class="line">           self._execute_attack()</span><br><span class="line">   def _execute_attack(self):</span><br><span class="line">       if self.stamina &gt;= self.attack_patterns[&quot;SPECIAL&quot;]:</span><br><span class="line">           damage = 50</span><br><span class="line">           self.stamina -= self.attack_patterns[&quot;SPECIAL&quot;]</span><br><span class="line">           return damage</span><br><span class="line">       return self.attack_patterns[&quot;NORMAL&quot;]</span><br><span class="line">å…ƒæ•°æ®: &#123;&#125;</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">--- ç¬¬ 2 ä¸ªä»£ç å— ---</span><br><span class="line">å†…å®¹:</span><br><span class="line">class InventorySystem:</span><br><span class="line">   def __init__(self):</span><br><span class="line">       self.items = &#123;&#125;</span><br><span class="line">       self.capacity = 20</span><br><span class="line">       self.gold = 0</span><br><span class="line">   def add_item(self, item_id, quantity):</span><br><span class="line">       if len(self.items) &lt; self.capacity:</span><br><span class="line">           if item_id in self.items:</span><br><span class="line">               self.items[item_id] += quantity</span><br><span class="line">           else:</span><br><span class="line">               self.items[item_id] = quantity</span><br><span class="line">   def remove_item(self, item_id, quantity):</span><br><span class="line">       if item_id in self.items:</span><br><span class="line">           self.items[item_id] -= quantity</span><br><span class="line">           if self.items[item_id] &lt;= 0:</span><br><span class="line">               del self.items[item_id]</span><br><span class="line">   def get_item_count(self, item_id):</span><br><span class="line">       return self.items.get(item_id, 0)</span><br><span class="line">å…ƒæ•°æ®: &#123;&#125;</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">--- ç¬¬ 3 ä¸ªä»£ç å— ---</span><br><span class="line">å†…å®¹:</span><br><span class="line">class QuestSystem:</span><br><span class="line">   def __init__(self):</span><br><span class="line">       self.active_quests = &#123;&#125;</span><br><span class="line">       self.completed_quests = set()</span><br><span class="line">       self.quest_log = []</span><br><span class="line">   def add_quest(self, quest_id, quest_data):</span><br><span class="line">       if quest_id not in self.active_quests:</span><br><span class="line">           self.active_quests[quest_id] = quest_data</span><br><span class="line">           self.quest_log.append(f&quot;Started quest: &#123;quest_data[&#x27;name&#x27;]&#125;&quot;)</span><br><span class="line">   def complete_quest(self, quest_id):</span><br><span class="line">       if quest_id in self.active_quests:</span><br><span class="line">           self.completed_quests.add(quest_id)</span><br><span class="line">           del self.active_quests[quest_id]</span><br><span class="line">   def get_active_quests(self):</span><br><span class="line">       return list(self.active_quests.keys())</span><br><span class="line">å…ƒæ•°æ®: &#123;&#125;</span><br><span class="line">--------------------------------------------------</span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure><h1 id="è¯­ä¹‰åˆ†å—"><a href="#è¯­ä¹‰åˆ†å—" class="headerlink" title="è¯­ä¹‰åˆ†å—"></a>è¯­ä¹‰åˆ†å—</h1><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> SimpleDirectoryReader</span><br><span class="line"><span class="keyword">from</span> llama_index.core.node_parser <span class="keyword">import</span> (</span><br><span class="line">    SentenceSplitter,</span><br><span class="line">    SemanticSplitterNodeParser,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># from llama_index.embeddings.openai import OpenAIEmbedding </span></span><br><span class="line"><span class="keyword">from</span> llama_index.embeddings.huggingface <span class="keyword">import</span> HuggingFaceEmbedding </span><br><span class="line">embed_model = HuggingFaceEmbedding(model_name=<span class="string">&quot;BAAI/bge-small-zh&quot;</span>) <span class="comment"># åŠ è½½æœ¬åœ°åµŒå…¥æ¨¡å‹</span></span><br><span class="line"></span><br><span class="line">documents = SimpleDirectoryReader(input_files=[<span class="string">&quot;../data/é»‘æ‚Ÿç©º/é»‘æ‚Ÿç©ºwiki.txt&quot;</span>]).load_data()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¯­ä¹‰åˆ†å—å™¨</span></span><br><span class="line">splitter = SemanticSplitterNodeParser(</span><br><span class="line">    buffer_size=<span class="number">3</span>,  <span class="comment"># ç¼“å†²åŒºå¤§å°</span></span><br><span class="line">    breakpoint_percentile_threshold=<span class="number">90</span>, <span class="comment"># æ–­ç‚¹ç™¾åˆ†ä½é˜ˆå€¼</span></span><br><span class="line">    embed_model=embed_model     <span class="comment"># ä½¿ç”¨çš„åµŒå…¥æ¨¡å‹</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># åˆ›å»ºåŸºç¡€å¥å­åˆ†å—å™¨ï¼ˆä½œä¸ºå¯¹ç…§ï¼‰</span></span><br><span class="line">base_splitter = SentenceSplitter(</span><br><span class="line">    <span class="comment"># chunk_size=512</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨è¯­ä¹‰åˆ†å—å™¨å¯¹æ–‡æ¡£è¿›è¡Œåˆ†å—</span></span><br><span class="line">semantic_nodes = splitter.get_nodes_from_documents(documents)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== è¯­ä¹‰åˆ†å—ç»“æœ ===&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;è¯­ä¹‰åˆ†å—å™¨ç”Ÿæˆçš„å—æ•°ï¼š<span class="subst">&#123;<span class="built_in">len</span>(semantic_nodes)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i, node <span class="keyword">in</span> <span class="built_in">enumerate</span>(semantic_nodes, <span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n--- ç¬¬ <span class="subst">&#123;i&#125;</span> ä¸ªè¯­ä¹‰å— ---&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å†…å®¹:\n<span class="subst">&#123;node.text&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨åŸºç¡€å¥å­åˆ†å—å™¨å¯¹æ–‡æ¡£è¿›è¡Œåˆ†å—</span></span><br><span class="line">base_nodes = base_splitter.get_nodes_from_documents(documents)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== åŸºç¡€å¥å­åˆ†å—ç»“æœ ===&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;åŸºç¡€å¥å­åˆ†å—å™¨ç”Ÿæˆçš„å—æ•°ï¼š<span class="subst">&#123;<span class="built_in">len</span>(base_nodes)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i, node <span class="keyword">in</span> <span class="built_in">enumerate</span>(base_nodes, <span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n--- ç¬¬ <span class="subst">&#123;i&#125;</span> ä¸ªå¥å­å— ---&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å†…å®¹:\n<span class="subst">&#123;node.text&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br></pre></td></tr></table></figure><ul><li>buffer_sizeå‚æ•°:<ul><li>é»˜è®¤å€¼ä¸º1ï¼Œæ§åˆ¶è¯„ä¼°è¯­ä¹‰ç›¸ä¼¼åº¦æ—¶ç»„åˆçš„å¥å­æ•°é‡</li><li>è®¾ç½®ä¸º1æ—¶æ¯ä¸ªå¥å­å•ç‹¬è€ƒè™‘</li><li>è®¾ç½®ä¸º3æ—¶æ¯3ä¸ªå¥å­ä½œä¸ºä¸€ç»„è¯„ä¼°ç›¸ä¼¼åº¦</li></ul></li><li>breakpoint_percentile_thresholdå‚æ•°:<ul><li>é»˜è®¤å€¼ä¸º95ï¼Œæ§åˆ¶åˆ›å»ºåˆ†å‰²ç‚¹çš„é˜ˆå€¼</li><li>è¡¨ç¤ºä½™å¼¦ä¸ç›¸ä¼¼åº¦çš„ç™¾åˆ†ä½æ•°å€¼</li><li>æ•°å€¼è¶Šå°ç”Ÿæˆçš„èŠ‚ç‚¹è¶Šå¤šï¼ˆæ›´å®¹æ˜“è¾¾åˆ°åˆ†å‰²å€¼ï¼‰</li><li>æ•°å€¼è¶Šå¤§ç”Ÿæˆçš„èŠ‚ç‚¹è¶Šå°‘ï¼ˆéœ€è¦æ›´å¤§ä¸ç›¸ä¼¼åº¦æ‰ä¼šåˆ†å‰²ï¼‰</li></ul></li></ul><p>å‚æ•°ç»„åˆå½±å“:</p><ul><li><p>buffer_sizeï¼šé»˜è®¤å€¼ä¸º1</p><ul><li>è¿™ä¸ªå‚æ•°æ§åˆ¶è¯„ä¼°è¯­ä¹‰ç›¸ä¼¼åº¦æ—¶ï¼Œå°†å¤šå°‘ä¸ªå¥å­ç»„åˆåœ¨ä¸€èµ·å½“è®¾ç½®ä¸º1æ—¶ï¼Œæ¯ä¸ªå¥å­ä¼šè¢«å•ç‹¬è€ƒè™‘<br>å½“è®¾ç½®å¤§äº1æ—¶ï¼Œä¼šå°†å¤šä¸ªå¥å­ç»„åˆåœ¨ä¸€èµ·è¿›è¡Œè¯„ä¼°ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½®ä¸º3ï¼Œå°±ä¼šå°†æ¯3ä¸ªå¥å­ä½œä¸ºä¸€ä¸ªç»„æ¥è¯„ä¼°è¯­ä¹‰ç›¸ä¼¼åº¦</li></ul></li><li><p>breakpoint_percentile_thresholdï¼šé»˜è®¤å€¼ä¸º95</p><ul><li>è¿™ä¸ªå‚æ•°æ§åˆ¶ä½•æ—¶åœ¨å¥å­ç»„ä¹‹é—´åˆ›å»ºåˆ†å‰²ç‚¹,å®ƒè¡¨ç¤ºä½™å¼¦ä¸ç›¸ä¼¼åº¦çš„ç™¾åˆ†ä½æ•°é˜ˆå€¼,å½“å¥å­ç»„ä¹‹é—´çš„ä¸ç›¸ä¼¼åº¦è¶…è¿‡è¿™ä¸ªé˜ˆå€¼æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹<ul><li>æ•°å€¼è¶Šå°ï¼Œç”Ÿæˆçš„èŠ‚ç‚¹å°±è¶Šå¤šï¼ˆå› ä¸ºæ›´å®¹æ˜“è¾¾åˆ°åˆ†å‰²é˜ˆå€¼ï¼‰</li><li>æ•°å€¼è¶Šå¤§ï¼Œç”Ÿæˆçš„èŠ‚ç‚¹å°±è¶Šå°‘ï¼ˆå› ä¸ºéœ€è¦æ›´å¤§çš„ä¸ç›¸ä¼¼åº¦æ‰ä¼šåˆ†å‰²ï¼‰</li></ul></li></ul></li><li><p>è¿™ä¸¤ä¸ªå‚æ•°å…±åŒå½±å“æ–‡æœ¬çš„åˆ†å‰²æ•ˆæœï¼š</p><ul><li><p>buffer_size å†³å®šäº†è¯„ä¼°è¯­ä¹‰ç›¸ä¼¼åº¦çš„ç²’åº¦</p></li><li><p>breakpoint_percentile_threshold å†³å®šäº†åˆ†å‰²çš„ä¸¥æ ¼ç¨‹åº¦</p></li></ul></li></ul><ul><li><p>ä¾‹å¦‚ï¼š</p><ul><li>å¦‚æœ buffer_size=2 ä¸” breakpoint_percentile_threshold=90ï¼šæ¯2ä¸ªå¥å­ä¼šè¢«ç»„åˆåœ¨ä¸€èµ·,å½“ç»„åˆä¹‹é—´çš„ä¸ç›¸ä¼¼åº¦è¶…è¿‡90%æ—¶å°±ä¼šåˆ†å‰²,è¿™ä¼šäº§ç”Ÿç›¸å¯¹è¾ƒå¤šçš„èŠ‚ç‚¹</li><li>å¦‚æœ buffer_size=3 ä¸” breakpoint_percentile_threshold=98ï¼šæ¯3ä¸ªå¥å­ä¼šè¢«ç»„åˆåœ¨ä¸€èµ·,éœ€è¦æ›´å¤§çš„ä¸ç›¸ä¼¼åº¦æ‰ä¼šåˆ†å‰²,è¿™ä¼šäº§ç”Ÿç›¸å¯¹è¾ƒå°‘çš„èŠ‚ç‚¹</li></ul></li></ul><h1 id="åŸºç¡€å¥å­åˆ†å—ä¸è¯­ä¹‰åˆ†å—ç‰¹ç‚¹"><a href="#åŸºç¡€å¥å­åˆ†å—ä¸è¯­ä¹‰åˆ†å—ç‰¹ç‚¹" class="headerlink" title="åŸºç¡€å¥å­åˆ†å—ä¸è¯­ä¹‰åˆ†å—ç‰¹ç‚¹"></a>åŸºç¡€å¥å­åˆ†å—ä¸è¯­ä¹‰åˆ†å—ç‰¹ç‚¹</h1><ul><li>åŸºç¡€å¥å­åˆ†å—ç‰¹ç‚¹:<ul><li>æŒ‰å›ºå®šå­—ç¬¦æ•°æœºæ¢°åˆ’åˆ†</li><li>ä¸è€ƒè™‘å†…å®¹è¯­ä¹‰è¿è´¯æ€§</li><li>å®ç°ç®€å•ä½†å¯èƒ½åˆ‡æ–­è¯­ä¹‰å…³è”</li></ul></li><li>è¯­ä¹‰åˆ†å—ç‰¹ç‚¹:<ul><li>åŸºäºå†…å®¹è¯­ä¹‰è‡ªåŠ¨åˆ’åˆ†</li><li>è¯†åˆ«ä¸»é¢˜è¾¹ç•Œå½¢æˆè‡ªç„¶æ®µè½</li><li>é€‚åˆå†…å®¹ç»“æ„å¤æ‚çš„æ–‡æ¡£</li></ul></li></ul><h1 id="ä½¿ç”¨UnstructuredåŸºäºæ–‡æ¡£ç»“æ„åˆ†å—"><a href="#ä½¿ç”¨UnstructuredåŸºäºæ–‡æ¡£ç»“æ„åˆ†å—" class="headerlink" title="ä½¿ç”¨UnstructuredåŸºäºæ–‡æ¡£ç»“æ„åˆ†å—"></a>ä½¿ç”¨UnstructuredåŸºäºæ–‡æ¡£ç»“æ„åˆ†å—</h1><p>åŸºäºå¯¹æ–‡æ¡£è¯­ä¹‰ç»“æ„çš„è¯†åˆ«ï¼Œè€Œéç®€å•åœ°æ ¹æ®ç©ºè¡Œæˆ–æ¢è¡Œç¬¦æ¥æ‹†åˆ†æ–‡æœ¬ã€‚</p><ul><li>Basicç­–ç•¥ å°†æ–‡æœ¬å…ƒç´ é¡ºåºåˆå¹¶åˆ°åŒä¸€ä¸ªåˆ†å—å†…ï¼Œç›´åˆ°è¾¾åˆ°æœ€å¤§å­—ç¬¦æ•°ï¼ˆmax_charactersï¼‰æˆ–è½¯é™åˆ¶ï¼ˆnew_after_n_charsï¼‰ã€‚å¦‚æœå•ä¸ªå…ƒç´ ï¼ˆå¦‚ä¸€æ®µç‰¹åˆ«é•¿çš„æ­£æ–‡æˆ–ä¸€å¼ å¾ˆå¤§çš„è¡¨æ ¼ï¼‰æœ¬èº«è¶…è¿‡äº†æœ€å¤§å­—ç¬¦æ•°ï¼Œåˆ™ä¼šå¯¹è¯¥å…ƒç´ è¿›è¡ŒäºŒæ¬¡æ‹†åˆ†ã€‚è¡¨æ ¼å…ƒç´ ä¼šè¢«è§†ä¸ºç‹¬ç«‹çš„åˆ†å—ï¼›å¦‚æœè¡¨æ ¼è¿‡å¤§ï¼Œä¹Ÿä¼šè¢«æ‹†åˆ†ä¸ºå¤šä¸ªTableChunkã€‚å¯ä»¥é€šè¿‡overlapä¸overlap_allç­‰å‚æ•°è®¾ç½®åˆ†å—é‡å ã€‚</li><li>By Titleç­–ç•¥ åœ¨ä¿ç•™Basicç­–ç•¥çš„åŸºç¡€è¡Œä¸ºçš„åŒæ—¶ï¼Œä¼šåœ¨æ£€æµ‹åˆ°æ–°çš„æ ‡é¢˜ï¼ˆTitleå…ƒç´ ï¼‰åç«‹åˆ»å…³é—­å½“å‰åˆ†å—ï¼Œå¹¶å¼€å¯ä¸€ä¸ªæ–°çš„åˆ†å—ã€‚å¯ä»¥é€šè¿‡multipage_sectionså’Œcombine_text_under_n_charsç­‰å‚æ•°è¿›ä¸€æ­¥æ§åˆ¶å¦‚ä½•åˆå¹¶æˆ–æ‹†åˆ†è·¨é¡µç‰‡æ®µã€çŸ­å°ç‰‡æ®µç­‰ã€‚</li></ul><p>é€šè¿‡APIè°ƒç”¨Unstructuredæ—¶ï¼Œè¿˜æœ‰ä»¥ä¸‹ä¸¤ç§é¢å¤–çš„æ™ºèƒ½åˆ†å—ç­–ç•¥ã€‚</p><ul><li>lBy Pageï¼šç¡®ä¿æ¯é¡µçš„å†…å®¹ç‹¬ç«‹åˆ†å—ã€‚</li><li>lBy Similarityï¼šåˆ©ç”¨åµŒå…¥æ¨¡å‹å°†ä¸»é¢˜ç›¸ä¼¼çš„å…ƒç´ ç»„åˆæˆå—ã€‚</li></ul><p>å‚è€ƒå­¦ä¹ åœ°å€ï¼š<a href="https://docs.unstructured.io/api-reference/partition/chunking">https://docs.unstructured.io/api-reference/partition/chunking</a></p>]]></content>
    
    
    <summary type="html">å­¦ä¹ å¤§æ¨¡å‹RAGç³»ç»Ÿå­¦ä¹ ç¬”è®°ç¬¬åäºŒè®²</summary>
    
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>RAGç»„ä»¶--æ•°æ®å¯¼å…¥ä¹‹è§£æpdfä¸­çš„è¡¨æ ¼æ•°æ®</title>
    <link href="https://jinglv.github.io/2025/08/13/ai/rag/10-pdf-table-parsing/"/>
    <id>https://jinglv.github.io/2025/08/13/ai/rag/10-pdf-table-parsing/</id>
    <published>2025-08-12T16:00:00.000Z</published>
    <updated>2025-08-13T01:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>PDFæ˜¯ä¸€ä¸ª<strong>å¸¦è¡¨æ ¼çš„ç»“æ„åŒ–æ•°æ®</strong>ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨SimpleDirectoryReaderåŠ è½½å¹¶ç”¨SentenceSplitterè¿›è¡Œåˆ†å—åï¼Œä¿¡æ¯å¯èƒ½è¢«ç ´åï¼Œä»è€Œå¯¼è‡´é—®ç­”æ•ˆæœä¸ä½³ã€‚</p><ul><li>é‡è¦æ€§ï¼šè§£æPDFè¡¨æ ¼æ•°æ®æ˜¯å®é™…éœ€æ±‚ä¸­æœ€å…·æŒ‘æˆ˜æ€§çš„éƒ¨åˆ†ï¼Œéœ€è¦ä¿æŒè¡¨æ ¼æ•°æ®ç»“æ„çš„å®Œæ•´æ€§æ‰èƒ½ç¡®ä¿é—®ç­”ç³»ç»Ÿç»™å‡ºç²¾å‡†ç­”æ¡ˆã€‚</li><li>éš¾ç‚¹ï¼šPDFè¡¨æ ¼æ˜¯ç»“æ„åŒ–æ•°æ®å’Œéç»“æ„åŒ–æ•°æ®çš„æ··åˆä½“ï¼Œéœ€è¦å°†è¡¨æ ¼å†…å®¹ä¸ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¦‚å¹´ä»½æ ‡é¢˜ï¼‰æ­£ç¡®å…³è”æ‰èƒ½å‡†ç¡®å›ç­”é—®é¢˜ã€‚</li></ul><h1 id="é€šè¿‡Camelotå·¥å…·æå–è¡¨æ ¼æ•°æ®"><a href="#é€šè¿‡Camelotå·¥å…·æå–è¡¨æ ¼æ•°æ®" class="headerlink" title="é€šè¿‡Camelotå·¥å…·æå–è¡¨æ ¼æ•°æ®"></a>é€šè¿‡Camelotå·¥å…·æå–è¡¨æ ¼æ•°æ®</h1><ul><li>åŠŸèƒ½ç‰¹ç‚¹ï¼š<ul><li>è€ç‰ŒPDFè¡¨æ ¼æå–å·¥å…·ï¼Œå¯ç›´æ¥å°†è¡¨æ ¼ä¿å­˜ä¸ºCSVæ ¼å¼</li><li>èƒ½å®Œæ•´æå–å¤šä¸ªè¡¨æ ¼æ•°æ®ï¼ˆä»»åŠ¡1ï¼‰</li><li>ä½†æ— æ³•è‡ªåŠ¨å…³è”è¡¨æ ¼ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆä»»åŠ¡2ï¼‰</li></ul></li><li>å®‰è£…è¦æ±‚ï¼š<ul><li>éœ€è¦å…ˆå®‰è£…Ghostscriptï¼šsudo apt-get install ghostscript / brew install ghostscript</li><li>ç„¶åå®‰è£…PythonåŒ…ï¼špip install ghostscript å’Œ  pip install  camelot-py</li><li>å…¼å®¹æ€§é—®é¢˜ï¼šä¸éƒ¨åˆ†PDFé˜…è¯»å™¨ä¸å…¼å®¹ï¼Œå»ºè®®åˆ›å»ºç‹¬ç«‹ç¯å¢ƒä½¿ç”¨</li></ul></li></ul><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> camelot</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># from ctypes.util import find_library</span></span><br><span class="line"><span class="comment"># find_library(&quot;gs&quot;)</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">pdf_path = <span class="string">&quot;../data/å¤æ‚PDF/billionaires_page-1-5.pdf&quot;</span></span><br><span class="line"></span><br><span class="line">start_time = time.time()</span><br><span class="line">tables = camelot.read_pdf(pdf_path, pages=<span class="string">&quot;all&quot;</span>)</span><br><span class="line">end_time = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;PDFè¡¨æ ¼è§£æè€—æ—¶: <span class="subst">&#123;end_time - start_time:<span class="number">.2</span>f&#125;</span>ç§’&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬æ¢æ‰€æœ‰è¡¨æ ¼ä¸º DataFrame</span></span><br><span class="line"><span class="keyword">if</span> tables:</span><br><span class="line">    <span class="comment"># éå†æ‰€æœ‰è¡¨æ ¼</span></span><br><span class="line">    <span class="keyword">for</span> i, table <span class="keyword">in</span> <span class="built_in">enumerate</span>(tables, <span class="number">1</span>):</span><br><span class="line">        <span class="comment"># å°†è¡¨æ ¼è½¬æ¢ä¸º DataFrame</span></span><br><span class="line">        df = table.df</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ‰“å°å½“å‰è¡¨æ ¼æ•°æ®</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nè¡¨æ ¼ <span class="subst">&#123;i&#125;</span> æ•°æ®:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(df)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nè¡¨æ ¼ <span class="subst">&#123;i&#125;</span> åŸºæœ¬ä¿¡æ¯:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(df.info())</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ä¿å­˜åˆ°CSVæ–‡ä»¶</span></span><br><span class="line">        csv_filename = <span class="string">f&quot;output/billionaires_table_<span class="subst">&#123;i&#125;</span>.csv&quot;</span></span><br><span class="line">        df.to_csv(csv_filename, index=<span class="literal">False</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nè¡¨æ ¼ <span class="subst">&#123;i&#125;</span> æ•°æ®å·²ä¿å­˜åˆ° <span class="subst">&#123;csv_filename&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼Œè¾“å‡ºå†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">PDFè¡¨æ ¼è§£æè€—æ—¶: 2.89ç§’</span><br><span class="line"></span><br><span class="line">è¡¨æ ¼ 1 æ•°æ®:</span><br><span class="line">      0                                           1</span><br><span class="line">0  Icon                                 Description</span><br><span class="line">1        Has not changed from the previous ranking.</span><br><span class="line">2          Has increased from the previous ranking.</span><br><span class="line">3          Has decreased from the previous ranking.</span><br><span class="line"></span><br><span class="line">è¡¨æ ¼ 1 åŸºæœ¬ä¿¡æ¯:</span><br><span class="line">&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span><br><span class="line">RangeIndex: 4 entries, 0 to 3</span><br><span class="line">Data columns (total 2 columns):</span><br><span class="line"> #   Column  Non-Null Count  Dtype </span><br><span class="line">---  ------  --------------  ----- </span><br><span class="line"> 0   0       4 non-null      object</span><br><span class="line"> 1   1       4 non-null      object</span><br><span class="line">dtypes: object(2)</span><br><span class="line">memory usage: 196.0+ bytes</span><br><span class="line">None</span><br><span class="line"></span><br><span class="line">è¡¨æ ¼ 1 æ•°æ®å·²ä¿å­˜åˆ° output/billionaires_table_1.csv</span><br><span class="line"></span><br><span class="line">è¡¨æ ¼ 2 æ•°æ®:</span><br><span class="line">      0                          1                 2    3               4  \</span><br><span class="line">...</span><br><span class="line">memory usage: 660.0+ bytes</span><br><span class="line">None</span><br><span class="line"></span><br><span class="line">è¡¨æ ¼ 6 æ•°æ®å·²ä¿å­˜åˆ° output/billionaires_table_6.csv</span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure><ul><li>åŸºæœ¬ç”¨æ³•ï¼š<ul><li>ä½¿ç”¨camelot.read_pdf()æ–¹æ³•è¯»å–PDFè¡¨æ ¼</li><li>å¯ä»¥æŒ‡å®špages=â€allâ€å‚æ•°æå–æ‰€æœ‰é¡µé¢çš„è¡¨æ ¼</li><li>æå–ç»“æœå¯ç›´æ¥è½¬æ¢ä¸ºpandas DataFrameæ ¼å¼</li></ul></li><li>æ€§èƒ½è¡¨ç°ï¼š<ul><li>è§£æ5é¡µPDFè€—æ—¶2.89ç§’</li><li>èƒ½å‡†ç¡®æå–ç»“æ„å®Œæ•´çš„è¡¨æ ¼æ•°æ®</li></ul></li><li>è¾“å‡ºæ ¼å¼ï¼š<ul><li>æ”¯æŒå°†è¡¨æ ¼æ•°æ®ä¿å­˜ä¸ºCSVæ–‡ä»¶ï¼ˆä»£ç ç¤ºä¾‹ä¸­åœ¨outputç›®å½•ä¸‹ä¿å­˜è¾“å‡ºçš„csvæ–‡ä»¶ï¼‰</li><li>æä¾›è¡¨æ ¼åŸºæœ¬ä¿¡æ¯è¾“å‡ºåŠŸèƒ½</li></ul></li><li>å±€é™æ€§ï¼š<ul><li>æ— æ³•æå–éæ ‡å‡†è¡¨æ ¼ï¼ˆå¦‚è¾¹ç¼˜è¡¨æ ¼ï¼‰</li><li>ä¸å…¶ä»–PythonåŒ…å¯èƒ½å­˜åœ¨ç¯å¢ƒå†²çª</li></ul></li></ul><h1 id="é€šè¿‡PDFPlumberå·¥å…·æå–è¡¨æ ¼æ•°æ®"><a href="#é€šè¿‡PDFPlumberå·¥å…·æå–è¡¨æ ¼æ•°æ®" class="headerlink" title="é€šè¿‡PDFPlumberå·¥å…·æå–è¡¨æ ¼æ•°æ®"></a>é€šè¿‡PDFPlumberå·¥å…·æå–è¡¨æ ¼æ•°æ®</h1><ul><li>ä¼˜åŠ¿ï¼š<ul><li>æå–æ•ˆç‡å’Œå‡†ç¡®åº¦ç•¥ä¼˜äºCamelot</li><li>å¤„ç†é€Ÿåº¦è¾ƒå¿«</li></ul></li><li>å±€é™æ€§ï¼šä¸Camelotç±»ä¼¼ï¼Œä»…ä¸“æ³¨äºè¡¨æ ¼å†…å®¹æå–ï¼Œä¸å¤„ç†ä¸Šä¸‹æ–‡å…³è”</li><li>é€‚ç”¨åœºæ™¯ï¼šé€‚åˆåªéœ€è¦æå–è¡¨æ ¼å†…å®¹ï¼Œä¸å…³å¿ƒä¸Šä¸‹æ–‡ä¿¡æ¯çš„ç®€å•é¡¹ç›®</li></ul><h2 id="æå–PDFè¡¨æ ¼"><a href="#æå–PDFè¡¨æ ¼" class="headerlink" title="æå–PDFè¡¨æ ¼"></a>æå–PDFè¡¨æ ¼</h2><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pdfplumber</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®°å½•å¼€å§‹æ—¶é—´</span></span><br><span class="line">start_time = time.time()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€PDFæ–‡ä»¶</span></span><br><span class="line">pdf = pdfplumber.<span class="built_in">open</span>(<span class="string">&quot;../data/å¤æ‚PDF/billionaires_page-1-5.pdf&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†æ¯ä¸€é¡µ</span></span><br><span class="line"><span class="keyword">for</span> page <span class="keyword">in</span> pdf.pages:</span><br><span class="line">    <span class="comment"># æå–è¡¨æ ¼</span></span><br><span class="line">    tables = page.extract_tables()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°è¡¨æ ¼</span></span><br><span class="line">    <span class="keyword">if</span> tables:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;åœ¨ç¬¬ <span class="subst">&#123;page.page_number&#125;</span> é¡µæ‰¾åˆ° <span class="subst">&#123;<span class="built_in">len</span>(tables)&#125;</span> ä¸ªè¡¨æ ¼&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># éå†è¯¥é¡µçš„æ‰€æœ‰è¡¨æ ¼</span></span><br><span class="line">        <span class="keyword">for</span> i, table <span class="keyword">in</span> <span class="built_in">enumerate</span>(tables):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\nå¤„ç†ç¬¬ <span class="subst">&#123;i+<span class="number">1</span>&#125;</span> ä¸ªè¡¨æ ¼:&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># å°†è¡¨æ ¼è½¬æ¢ä¸ºDataFrame</span></span><br><span class="line">            df = pd.DataFrame(table)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># å¦‚æœç¬¬ä¸€è¡ŒåŒ…å«åˆ—åï¼Œå¯ä»¥è®¾ç½®ä¸ºåˆ—å</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(df) &gt; <span class="number">0</span>:</span><br><span class="line">                df.columns = df.iloc[<span class="number">0</span>]</span><br><span class="line">                df = df.iloc[<span class="number">1</span>:]  <span class="comment"># åˆ é™¤é‡å¤çš„åˆ—åè¡Œ</span></span><br><span class="line">                </span><br><span class="line">            <span class="built_in">print</span>(df)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­PDF</span></span><br><span class="line">pdf.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®°å½•ç»“æŸæ—¶é—´å¹¶è®¡ç®—æ€»è€—æ—¶</span></span><br><span class="line">end_time = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\nPDFè¡¨æ ¼æå–æ€»è€—æ—¶: <span class="subst">&#123;end_time - start_time:<span class="number">.2</span>f&#125;</span>ç§’&quot;</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼Œè¾“å‡ºå†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ç¬¬ 1 é¡µæ‰¾åˆ° 1 ä¸ªè¡¨æ ¼</span><br><span class="line"></span><br><span class="line">å¤„ç†ç¬¬ 1 ä¸ªè¡¨æ ¼:</span><br><span class="line">0  List of the world&#x27;s billionaires, ranked in order of net worth</span><br><span class="line">1   The net worth of the world&#x27;s billionaires incr...            </span><br><span class="line">2                                 Publication details            </span><br><span class="line">3    Publisher Whale Media Investments\nForbes family            </span><br><span class="line">4                                  Publication Forbes            </span><br><span class="line">5                       First published March 1987[1]            </span><br><span class="line">6                    Latest publication April 4, 2023            </span><br><span class="line">7                      Current list details (2023)[2]            </span><br><span class="line">8                          Wealthiest Bernard Arnault            </span><br><span class="line">9                      Net worth (1st) US$211 billion            </span><br><span class="line">10          Number of 2,640 (from 2668)\nbillionaires            </span><br><span class="line">11  Total list net worth US$12.2 trillion (from US...            </span><br><span class="line">12                                Number of women 337            </span><br><span class="line">13                       New members to the 150\nlist            </span><br><span class="line">14  Forbes: The World&#x27;s Billionaires website (http...            </span><br><span class="line">--------------------------------------------------</span><br><span class="line">åœ¨ç¬¬ 2 é¡µæ‰¾åˆ° 1 ä¸ªè¡¨æ ¼</span><br><span class="line"></span><br><span class="line">å¤„ç†ç¬¬ 1 ä¸ªè¡¨æ ¼:</span><br><span class="line">0 Icon                                 Description</span><br><span class="line">1       Has not changed from the previous ranking.</span><br><span class="line">2         Has increased from the previous ranking.</span><br><span class="line">...</span><br><span class="line">10               Alphabet Inc.  </span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">PDFè¡¨æ ¼æå–æ€»è€—æ—¶: 0.38ç§’</span><br></pre></td></tr></table></figure><ul><li>æ€§èƒ½ä¼˜åŠ¿ï¼š<ul><li>è§£æç›¸åŒ5é¡µPDFä»…éœ€0.38ç§’</li><li>é€Ÿåº¦æ˜¯camelotçš„3-4å€</li></ul></li><li>æå–èƒ½åŠ›ï¼š<ul><li>èƒ½æå–æ‰€æœ‰ç±»å‹çš„è¡¨æ ¼ï¼ŒåŒ…æ‹¬è¾¹ç¼˜è¡¨æ ¼</li><li>æå–ç»“æœåŒæ ·å¯è½¬æ¢ä¸ºDataFrame</li></ul></li><li>ç¯å¢ƒå…¼å®¹æ€§ï¼š<ul><li>å®‰è£…ç®€å•ï¼Œä¸å…¶ä»–åŒ…å†²çªè¾ƒå°‘</li><li>å¯ç›´æ¥ä¸LlamaIndexç­‰å·¥å…·é›†æˆ</li></ul></li><li>é—®ç­”åº”ç”¨ï¼š<ul><li>æå–çš„è¡¨æ ¼æ•°æ®å¯ç”¨äºæ„å»ºé—®ç­”ç³»ç»Ÿ</li><li>ä½†ç¼ºä¹ä¸Šä¸‹æ–‡å…³è”å¯èƒ½å¯¼è‡´å›ç­”ä¸å‡†ç¡®</li></ul></li></ul><h2 id="æå–PDFè¡¨æ ¼å¹¶é—®ç­”"><a href="#æå–PDFè¡¨æ ¼å¹¶é—®ç­”" class="headerlink" title="æå–PDFè¡¨æ ¼å¹¶é—®ç­”"></a>æå–PDFè¡¨æ ¼å¹¶é—®ç­”</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pdfplumber</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> VectorStoreIndex</span><br><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line">pdf_path = <span class="string">&quot;../data/å¤æ‚PDF/billionaires_page-1-5.pdf&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€ PDF å¹¶è§£æè¡¨æ ¼</span></span><br><span class="line"><span class="keyword">with</span> pdfplumber.<span class="built_in">open</span>(pdf_path) <span class="keyword">as</span> pdf:</span><br><span class="line">    tables = []</span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> pdf.pages:</span><br><span class="line">        table = page.extract_table()</span><br><span class="line">        <span class="keyword">if</span> table:</span><br><span class="line">            tables.append(table)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬æ¢æ‰€æœ‰è¡¨æ ¼ä¸º DataFrame å¹¶æ„å»ºæ–‡æ¡£</span></span><br><span class="line">documents: <span class="type">List</span>[Document] = []</span><br><span class="line"><span class="keyword">if</span> tables:</span><br><span class="line">    <span class="comment"># éå†æ‰€æœ‰è¡¨æ ¼</span></span><br><span class="line">    <span class="keyword">for</span> i, table <span class="keyword">in</span> <span class="built_in">enumerate</span>(tables, <span class="number">1</span>):</span><br><span class="line">        <span class="comment"># å°†è¡¨æ ¼è½¬æ¢ä¸º DataFrame</span></span><br><span class="line">        df = pd.DataFrame(table)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ä¿å­˜åˆ°CSVæ–‡ä»¶</span></span><br><span class="line">        <span class="comment"># csv_filename = f&quot;billionaires_table_&#123;i&#125;.csv&quot;</span></span><br><span class="line">        <span class="comment"># df.to_csv(csv_filename, index=False)</span></span><br><span class="line">        <span class="comment"># print(f&quot;\nè¡¨æ ¼ &#123;i&#125; æ•°æ®å·²ä¿å­˜åˆ° &#123;csv_filename&#125;&quot;)</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å°†DataFrameè½¬æ¢ä¸ºæ–‡æœ¬</span></span><br><span class="line">        text = df.to_string()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åˆ›å»ºDocumentå¯¹è±¡</span></span><br><span class="line">        doc = Document(text=text, metadata=&#123;<span class="string">&quot;source&quot;</span>: <span class="string">f&quot;è¡¨æ ¼<span class="subst">&#123;i&#125;</span>&quot;</span>&#125;)</span><br><span class="line">        documents.append(doc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºç´¢å¼•</span></span><br><span class="line">index = VectorStoreIndex.from_documents(documents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæŸ¥è¯¢å¼•æ“</span></span><br><span class="line">query_engine = index.as_query_engine()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹é—®ç­”</span></span><br><span class="line">questions = [</span><br><span class="line">    <span class="string">&quot;2023å¹´è°æ˜¯æœ€å¯Œæœ‰çš„äºº?&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æœ€å¹´è½»çš„å¯Œè±ªæ˜¯è°?&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n===== é—®ç­”æ¼”ç¤º =====&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> question <span class="keyword">in</span> questions:</span><br><span class="line">    response = query_engine.query(question)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\né—®é¢˜: <span class="subst">&#123;question&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å›ç­”: <span class="subst">&#123;response&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="é€šè¿‡Unstructuredæå–è¡¨æ ¼æ ‡é¢˜"><a href="#é€šè¿‡Unstructuredæå–è¡¨æ ¼æ ‡é¢˜" class="headerlink" title="é€šè¿‡Unstructuredæå–è¡¨æ ¼æ ‡é¢˜"></a>é€šè¿‡Unstructuredæå–è¡¨æ ¼æ ‡é¢˜</h1><ul><li>æ ¸å¿ƒä¼˜åŠ¿ï¼š<ul><li>ä¸ä»…èƒ½æå–è¡¨æ ¼å†…å®¹ï¼Œè¿˜èƒ½è·å–è¡¨æ ¼å…ƒæ•°æ®å’Œçˆ¶èŠ‚ç‚¹ä¿¡æ¯</li><li>å¯å°†è¡¨æ ¼è½¬æ¢ä¸ºHTMLæˆ–æ–‡æœ¬æ ¼å¼ï¼Œä¿æŒä¸€å®šç»“æ„</li></ul></li><li>ä¼˜åŒ–ç­–ç•¥ï¼š<ul><li>ä½¿ç”¨cleanersè¿‡æ»¤é¡µçœ‰é¡µè„š</li><li>é€šè¿‡coordinateså»é™¤å¹²æ‰°åŒºåŸŸ</li><li>åˆ©ç”¨metadataè¯†åˆ«å¹¶æ’é™¤æ— å…³ä¿¡æ¯</li></ul></li><li>å±€é™æ€§ï¼šå½“æ ‡é¢˜å’Œè¡¨æ ¼ä¸åœ¨åŒä¸€é¡µæ—¶ï¼Œå…³è”å‡†ç¡®æ€§ä¸‹é™</li><li>æ³¨æ„ç‚¹ï¼š<ul><li>è¡¨æ ¼ä¸­å¯èƒ½åŒ…å«å¤šå¹´ä»½çš„æ•°æ®ï¼Œæ¯å¼ è¡¨ç»“æ„ç›¸ä¼¼ä½†å¹´ä»½ä¸åŒ</li><li>è¡¨æ ¼å¯èƒ½è·¨é¡µï¼Œå¢åŠ æ ‡é¢˜å…³è”éš¾åº¦</li></ul></li><li>å…³é”®æŒ‘æˆ˜ï¼š<ul><li>å¿…é¡»æ­£ç¡®è¯†åˆ«è¡¨æ ¼å¯¹åº”çš„å¹´ä»½æ‰èƒ½å›ç­”å‡†ç¡®é—®é¢˜</li><li>é¡µçœ‰é¡µè„šä¿¡æ¯å¯èƒ½å¹²æ‰°æ ‡é¢˜è¯†åˆ«</li></ul></li><li>è§£å†³æ–¹æ¡ˆï¼š<ul><li>åˆ©ç”¨Unstructuredçš„parent_idå­—æ®µå»ºç«‹çˆ¶å­æ–‡æ¡£å…³ç³»</li><li>é€šè¿‡coordinatesä¼˜åŒ–æ’é™¤å¹²æ‰°åŒºåŸŸ</li></ul></li></ul><h2 id="è¡¨æ ¼æå–"><a href="#è¡¨æ ¼æå–" class="headerlink" title="è¡¨æ ¼æå–"></a>è¡¨æ ¼æå–</h2><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> unstructured.partition.pdf <span class="keyword">import</span> partition_pdf</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½ç¯å¢ƒå˜é‡</span></span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¡®ä¿å·¥ä½œç›®å½•æ­£ç¡®</span></span><br><span class="line"><span class="comment"># è·å–è„šæœ¬æ‰€åœ¨ç›®å½•çš„çˆ¶ç›®å½•ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(os.getcwd())</span><br><span class="line">script_dir = Path(<span class="string">&quot;/Users/jinglv/PycharmProjects/llm-rag-system&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> script_dir.exists():</span><br><span class="line">    os.chdir(script_dir)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å·¥ä½œç›®å½•è®¾ç½®ä¸º: <span class="subst">&#123;os.getcwd()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥ LlamaIndex ç›¸å…³æ¨¡å—</span></span><br><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> Settings</span><br><span class="line"><span class="keyword">from</span> llama_index.llms.openai <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> llama_index.embeddings.openai <span class="keyword">import</span> OpenAIEmbedding</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¨å±€è®¾ç½®</span></span><br><span class="line">Settings.llm = OpenAI(</span><br><span class="line">    model=os.getenv(<span class="string">&quot;DEEPSEEK_MODEL_NAME&quot;</span>),  <span class="comment"># DeepSeek API æ”¯æŒçš„æ¨¡å‹åç§°</span></span><br><span class="line">    api_key=os.getenv(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),  <span class="comment"># ä»ç¯å¢ƒå˜é‡åŠ è½½API key</span></span><br><span class="line">    base_url=os.getenv(<span class="string">&quot;DEEPSEEK_BASE_URL&quot;</span>)</span><br><span class="line">)</span><br><span class="line">Settings.embed_model = OpenAIEmbedding(model=<span class="string">&quot;text-embedding-3-small&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£æ PDF ç»“æ„ï¼Œæå–æ–‡æœ¬å’Œè¡¨æ ¼</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œç¡®ä¿ä»é¡¹ç›®æ ¹ç›®å½•å¼€å§‹</span></span><br><span class="line">file_path = <span class="string">&quot;data/å¤æ‚PDF/billionaires_page-1-5.pdf&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(file_path):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;é”™è¯¯: æ–‡ä»¶ä¸å­˜åœ¨ - <span class="subst">&#123;file_path&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å½“å‰å·¥ä½œç›®å½•: <span class="subst">&#123;os.getcwd()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯·ç¡®ä¿:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;1. åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œè„šæœ¬&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;2. PDFæ–‡ä»¶è·¯å¾„æ­£ç¡®&quot;</span>)</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ­£åœ¨å¤„ç†æ–‡ä»¶: <span class="subst">&#123;file_path&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">elements = partition_pdf(</span><br><span class="line">    file_path,</span><br><span class="line">    strategy=<span class="string">&quot;hi_res&quot;</span>,  <span class="comment"># ä½¿ç”¨é«˜ç²¾åº¦ç­–ç•¥</span></span><br><span class="line">)  <span class="comment"># è§£æPDFæ–‡æ¡£</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªå…ƒç´ IDåˆ°å…ƒç´ çš„æ˜ å°„</span></span><br><span class="line">element_map = &#123;element.<span class="built_in">id</span>: element <span class="keyword">for</span> element <span class="keyword">in</span> elements <span class="keyword">if</span> <span class="built_in">hasattr</span>(element, <span class="string">&#x27;id&#x27;</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> elements:</span><br><span class="line">    <span class="keyword">if</span> element.category == <span class="string">&quot;Table&quot;</span>: <span class="comment"># åªæ‰“å°è¡¨æ ¼æ•°æ®    </span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nè¡¨æ ¼æ•°æ®:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¡¨æ ¼å…ƒæ•°æ®:&quot;</span>, <span class="built_in">vars</span>(element.metadata))  <span class="comment"># ä½¿ç”¨vars()æ˜¾ç¤ºæ‰€æœ‰å…ƒæ•°æ®å±æ€§</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¡¨æ ¼å†…å®¹:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(element.text)  <span class="comment"># æ‰“å°è¡¨æ ¼æ–‡æœ¬å†…å®¹</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è·å–å¹¶æ‰“å°çˆ¶èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">        parent_id = <span class="built_in">getattr</span>(element.metadata, <span class="string">&#x27;parent_id&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> parent_id <span class="keyword">and</span> parent_id <span class="keyword">in</span> element_map:</span><br><span class="line">            parent_element = element_map[parent_id]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\nçˆ¶èŠ‚ç‚¹ä¿¡æ¯:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;ç±»å‹: <span class="subst">&#123;parent_element.category&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;å†…å®¹: <span class="subst">&#123;parent_element.text&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(parent_element, <span class="string">&#x27;metadata&#x27;</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;çˆ¶èŠ‚ç‚¹å…ƒæ•°æ®: <span class="subst">&#123;<span class="built_in">vars</span>(parent_element.metadata)&#125;</span>&quot;</span>)  <span class="comment"># åŒæ ·ä½¿ç”¨vars()æ˜¾ç¤ºæ‰€æœ‰å…ƒæ•°æ®</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;æœªæ‰¾åˆ°çˆ¶èŠ‚ç‚¹ (ID: <span class="subst">&#123;parent_id&#125;</span>)&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">text_elements = [el <span class="keyword">for</span> el <span class="keyword">in</span> elements <span class="keyword">if</span> el.category == <span class="string">&quot;Text&quot;</span>]</span><br><span class="line">table_elements = [el <span class="keyword">for</span> el <span class="keyword">in</span> elements <span class="keyword">if</span> el.category == <span class="string">&quot;Table&quot;</span>]</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼Œè¾“å‡ºå†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/Users/jinglv/PycharmProjects/llm-rag-system</span><br><span class="line">å·¥ä½œç›®å½•è®¾ç½®ä¸º: /Users/jinglv/PycharmProjects/llm-rag-system</span><br><span class="line">æ­£åœ¨å¤„ç†æ–‡ä»¶: data/å¤æ‚PDF/billionaires_page-1-5.pdf</span><br><span class="line">Warning: No languages specified, defaulting to English.</span><br><span class="line"></span><br><span class="line">è¡¨æ ¼æ•°æ®:</span><br><span class="line">è¡¨æ ¼å…ƒæ•°æ®: &#123;&#x27;detection_class_prob&#x27;: 0.5629849433898926, &#x27;coordinates&#x27;: CoordinatesMetadata(points=((np.float64(839.0340576171875), np.float64(1001.4764404296875)), (np.float64(839.0340576171875), np.float64(1920.586669921875)), (np.float64(1587.2479248046875), np.float64(1920.586669921875)), (np.float64(1587.2479248046875), np.float64(1001.4764404296875))), system=&lt;unstructured.documents.coordinates.PixelSpace object at 0x15b8e27b0&gt;), &#x27;links&#x27;: [&#123;&#x27;text&#x27;: &quot;Forbes : The World &#x27; s Billionaires website ( https :// www . forb&quot;, &#x27;url&#x27;: &#x27;https://www.forbes.com/billionaires/&#x27;, &#x27;start_index&#x27;: 0&#125;, &#123;&#x27;text&#x27;: &quot;Forbes : The World &#x27; s Billionaires website ( https :// www . forb&quot;, &#x27;url&#x27;: &#x27;https://www.forbes.com/billionaires/&#x27;, &#x27;start_index&#x27;: 0&#125;], &#x27;last_modified&#x27;: &#x27;2025-07-16T19:30:42&#x27;, &#x27;_known_field_names&#x27;: frozenset(&#123;&#x27;filename&#x27;, &#x27;file_directory&#x27;, &#x27;attached_to_filename&#x27;, &#x27;link_texts&#x27;, &#x27;image_url&#x27;, &#x27;emphasized_text_tags&#x27;, &#x27;link_start_indexes&#x27;, &#x27;sent_to&#x27;, &#x27;signature&#x27;, &#x27;cc_recipient&#x27;, &#x27;key_value_pairs&#x27;, &#x27;image_mime_type&#x27;, &#x27;page_name&#x27;, &#x27;coordinates&#x27;, &#x27;detection_class_prob&#x27;, &#x27;subject&#x27;, &#x27;parent_id&#x27;, &#x27;url&#x27;, &#x27;detection_origin&#x27;, &#x27;header_footer_type&#x27;, &#x27;link_urls&#x27;, &#x27;bcc_recipient&#x27;, &#x27;table_as_cells&#x27;, &#x27;emphasized_text_contents&#x27;, &#x27;image_base64&#x27;, &#x27;is_continuation&#x27;, &#x27;category_depth&#x27;, &#x27;orig_elements&#x27;, &#x27;image_path&#x27;, &#x27;data_source&#x27;, &#x27;email_message_id&#x27;, &#x27;filetype&#x27;, &#x27;page_number&#x27;, &#x27;text_as_html&#x27;, &#x27;last_modified&#x27;, &#x27;links&#x27;, &#x27;sent_from&#x27;, &#x27;languages&#x27;&#125;), &#x27;filetype&#x27;: &#x27;application/pdf&#x27;, &#x27;languages&#x27;: [&#x27;eng&#x27;], &#x27;page_number&#x27;: 1, &#x27;file_directory&#x27;: &#x27;data/å¤æ‚PDF&#x27;, &#x27;filename&#x27;: &#x27;billionaires_page-1-5.pdf&#x27;, &#x27;parent_id&#x27;: &#x27;b379afb3fd875896f879cc4cfc441305&#x27;&#125;</span><br><span class="line">è¡¨æ ¼å†…å®¹:</span><br><span class="line">Publisher Whale Media Investments Forbes family Publication First published Forbes March 1987[1] Latest publication April 4, 2023 Current list details (2023)[2] Wealthiest Bernard Arnault Net worth (1st) US$211 billion Number of billionaires 2,640 (from 2668) Total list net worth value US$12.2 trillion (from US$ 12.7 trillion) Number of women 337 New members to the 150 list Forbes: The World&#x27;s Billionaires website (https://www.forb es.com/billionaires/)</span><br><span class="line"></span><br><span class="line">çˆ¶èŠ‚ç‚¹ä¿¡æ¯:</span><br><span class="line">ç±»å‹: Title</span><br><span class="line">å†…å®¹: Methodology</span><br><span class="line">çˆ¶èŠ‚ç‚¹å…ƒæ•°æ®: &#123;&#x27;detection_class_prob&#x27;: 0.7953538298606873, &#x27;coordinates&#x27;: CoordinatesMetadata(points=((np.float64(98.62982255709053), np.float64(1510.925048828125)), (np.float64(98.62982255709053), np.float64(1569.5582275390625)), (np.float64(435.21123011467625), np.float64(1569.5582275390625)), (np.float64(435.21123011467625), np.float64(1510.925048828125))), system=&lt;unstructured.documents.coordinates.PixelSpace object at 0x15b8e0620&gt;), &#x27;links&#x27;: [], &#x27;last_modified&#x27;: &#x27;2025-07-16T19:30:42&#x27;, &#x27;_known_field_names&#x27;: frozenset(&#123;&#x27;filename&#x27;, &#x27;file_directory&#x27;, &#x27;attached_to_filename&#x27;, &#x27;link_texts&#x27;, &#x27;image_url&#x27;, &#x27;emphasized_text_tags&#x27;, &#x27;link_start_indexes&#x27;, &#x27;sent_to&#x27;, &#x27;signature&#x27;, &#x27;cc_recipient&#x27;, &#x27;key_value_pairs&#x27;, &#x27;image_mime_type&#x27;, &#x27;page_name&#x27;, &#x27;coordinates&#x27;, &#x27;detection_class_prob&#x27;, &#x27;subject&#x27;, &#x27;parent_id&#x27;, &#x27;url&#x27;, &#x27;detection_origin&#x27;, &#x27;header_footer_type&#x27;, &#x27;link_urls&#x27;, &#x27;bcc_recipient&#x27;, &#x27;table_as_cells&#x27;, &#x27;emphasized_text_contents&#x27;, &#x27;image_base64&#x27;, &#x27;is_continuation&#x27;, &#x27;category_depth&#x27;, &#x27;orig_elements&#x27;, &#x27;image_path&#x27;, &#x27;data_source&#x27;, &#x27;email_message_id&#x27;, &#x27;filetype&#x27;, &#x27;page_number&#x27;, &#x27;text_as_html&#x27;, &#x27;last_modified&#x27;, &#x27;links&#x27;, &#x27;sent_from&#x27;, &#x27;languages&#x27;&#125;), &#x27;filetype&#x27;: &#x27;application/pdf&#x27;, &#x27;languages&#x27;: [&#x27;eng&#x27;], &#x27;page_number&#x27;: 1, &#x27;file_directory&#x27;: &#x27;data/å¤æ‚PDF&#x27;, &#x27;filename&#x27;: &#x27;billionaires_page-1-5.pdf&#x27;&#125;</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">è¡¨æ ¼æ•°æ®:</span><br><span class="line">è¡¨æ ¼å…ƒæ•°æ®: &#123;&#x27;detection_class_prob&#x27;: 0.8833286762237549, &#x27;coordinates&#x27;: CoordinatesMetadata(points=((np.float64(102.6220932006836), np.float64(929.1338500976562)), (np.float64(102.6220932006836), np.float64(1154.2158203125)), (np.float64(765.6319580078125), np.float64(1154.2158203125)), (np.float64(765.6319580078125), np.float64(929.1338500976562))), system=&lt;unstructured.documents.coordinates.PixelSpace object at 0x15b8e1340&gt;), &#x27;links&#x27;: [], &#x27;last_modified&#x27;: &#x27;2025-07-16T19:30:42&#x27;, &#x27;_known_field_names&#x27;: frozenset(&#123;&#x27;filename&#x27;, &#x27;file_directory&#x27;, &#x27;attached_to_filename&#x27;, &#x27;link_texts&#x27;, &#x27;image_url&#x27;, &#x27;emphasized_text_tags&#x27;, &#x27;link_start_indexes&#x27;, &#x27;sent_to&#x27;, &#x27;signature&#x27;, &#x27;cc_recipient&#x27;, &#x27;key_value_pairs&#x27;, &#x27;image_mime_type&#x27;, &#x27;page_name&#x27;, &#x27;coordinates&#x27;, &#x27;detection_class_prob&#x27;, &#x27;subject&#x27;, &#x27;parent_id&#x27;, &#x27;url&#x27;, &#x27;detection_origin&#x27;, &#x27;header_footer_type&#x27;, &#x27;link_urls&#x27;, &#x27;bcc_recipient&#x27;, &#x27;table_as_cells&#x27;, &#x27;emphasized_text_contents&#x27;, &#x27;image_base64&#x27;, &#x27;is_continuation&#x27;, &#x27;category_depth&#x27;, &#x27;orig_elements&#x27;, &#x27;image_path&#x27;, &#x27;data_source&#x27;, &#x27;email_message_id&#x27;, &#x27;filetype&#x27;, &#x27;page_number&#x27;, &#x27;text_as_html&#x27;, &#x27;last_modified&#x27;, &#x27;links&#x27;, &#x27;sent_from&#x27;, &#x27;languages&#x27;&#125;), &#x27;filetype&#x27;: &#x27;application/pdf&#x27;, &#x27;languages&#x27;: [&#x27;eng&#x27;], &#x27;page_number&#x27;: 2, &#x27;file_directory&#x27;: &#x27;data/å¤æ‚PDF&#x27;, &#x27;filename&#x27;: &#x27;billionaires_page-1-5.pdf&#x27;, &#x27;parent_id&#x27;: &#x27;feb0e76147077250a13cdb0f842659a3&#x27;&#125;</span><br><span class="line">è¡¨æ ¼å†…å®¹:</span><br><span class="line">Icon Description Has not changed from the previous ranking. Has increased from the previous ranking. Has decreased from the previous ranking.</span><br><span class="line"></span><br><span class="line">çˆ¶èŠ‚ç‚¹ä¿¡æ¯:</span><br><span class="line">ç±»å‹: Title</span><br><span class="line">å†…å®¹: Legend</span><br><span class="line">çˆ¶èŠ‚ç‚¹å…ƒæ•°æ®: &#123;&#x27;detection_class_prob&#x27;: 0.7951710224151611, &#x27;coordinates&#x27;: CoordinatesMetadata(points=((np.float64(96.45149230957031), np.float64(847.3286743164062)), (np.float64(96.45149230957031), np.float64(897.3561401367188)), (np.float64(236.98038987264118), np.float64(897.3561401367188)), (np.float64(236.98038987264118), np.float64(847.3286743164062))), system=&lt;unstructured.documents.coordinates.PixelSpace object at 0x15b8e3590&gt;), &#x27;links&#x27;: [], &#x27;last_modified&#x27;: &#x27;2025-07-16T19:30:42&#x27;, &#x27;_known_field_names&#x27;: frozenset(&#123;&#x27;filename&#x27;, &#x27;file_directory&#x27;, &#x27;attached_to_filename&#x27;, &#x27;link_texts&#x27;, &#x27;image_url&#x27;, &#x27;emphasized_text_tags&#x27;, &#x27;link_start_indexes&#x27;, &#x27;sent_to&#x27;, &#x27;signature&#x27;, &#x27;cc_recipient&#x27;, &#x27;key_value_pairs&#x27;, &#x27;image_mime_type&#x27;, &#x27;page_name&#x27;, &#x27;coordinates&#x27;, &#x27;detection_class_prob&#x27;, &#x27;subject&#x27;, &#x27;parent_id&#x27;, &#x27;url&#x27;, &#x27;detection_origin&#x27;, &#x27;header_footer_type&#x27;, &#x27;link_urls&#x27;, &#x27;bcc_recipient&#x27;, &#x27;table_as_cells&#x27;, &#x27;emphasized_text_contents&#x27;, &#x27;image_base64&#x27;, &#x27;is_continuation&#x27;, &#x27;category_depth&#x27;, &#x27;orig_elements&#x27;, &#x27;image_path&#x27;, &#x27;data_source&#x27;, &#x27;email_message_id&#x27;, &#x27;filetype&#x27;, &#x27;page_number&#x27;, &#x27;text_as_html&#x27;, &#x27;last_modified&#x27;, &#x27;links&#x27;, &#x27;sent_from&#x27;, &#x27;languages&#x27;&#125;), &#x27;filetype&#x27;: &#x27;application/pdf&#x27;, &#x27;languages&#x27;: [&#x27;eng&#x27;], &#x27;page_number&#x27;: 2, &#x27;file_directory&#x27;: &#x27;data/å¤æ‚PDF&#x27;, &#x27;filename&#x27;: &#x27;billionaires_page-1-5.pdf&#x27;, &#x27;parent_id&#x27;: &#x27;759e1c4a2a3cf37f98db95d0877208f1&#x27;&#125;</span><br><span class="line">...</span><br><span class="line">ç±»å‹: Title</span><br><span class="line">å†…å®¹: 2019</span><br><span class="line">çˆ¶èŠ‚ç‚¹å…ƒæ•°æ®: &#123;&#x27;detection_class_prob&#x27;: 0.7982921600341797, &#x27;coordinates&#x27;: CoordinatesMetadata(points=((np.float64(95.56612396240234), np.float64(971.339599609375)), (np.float64(95.56612396240234), np.float64(1019.1573486328125)), (np.float64(188.0115203857422), np.float64(1019.1573486328125)), (np.float64(188.0115203857422), np.float64(971.339599609375))), system=&lt;unstructured.documents.coordinates.PixelSpace object at 0x15b8012b0&gt;), &#x27;links&#x27;: [], &#x27;last_modified&#x27;: &#x27;2025-07-16T19:30:42&#x27;, &#x27;_known_field_names&#x27;: frozenset(&#123;&#x27;filename&#x27;, &#x27;file_directory&#x27;, &#x27;attached_to_filename&#x27;, &#x27;link_texts&#x27;, &#x27;image_url&#x27;, &#x27;emphasized_text_tags&#x27;, &#x27;link_start_indexes&#x27;, &#x27;sent_to&#x27;, &#x27;signature&#x27;, &#x27;cc_recipient&#x27;, &#x27;key_value_pairs&#x27;, &#x27;image_mime_type&#x27;, &#x27;page_name&#x27;, &#x27;coordinates&#x27;, &#x27;detection_class_prob&#x27;, &#x27;subject&#x27;, &#x27;parent_id&#x27;, &#x27;url&#x27;, &#x27;detection_origin&#x27;, &#x27;header_footer_type&#x27;, &#x27;link_urls&#x27;, &#x27;bcc_recipient&#x27;, &#x27;table_as_cells&#x27;, &#x27;emphasized_text_contents&#x27;, &#x27;image_base64&#x27;, &#x27;is_continuation&#x27;, &#x27;category_depth&#x27;, &#x27;orig_elements&#x27;, &#x27;image_path&#x27;, &#x27;data_source&#x27;, &#x27;email_message_id&#x27;, &#x27;filetype&#x27;, &#x27;page_number&#x27;, &#x27;text_as_html&#x27;, &#x27;last_modified&#x27;, &#x27;links&#x27;, &#x27;sent_from&#x27;, &#x27;languages&#x27;&#125;), &#x27;filetype&#x27;: &#x27;application/pdf&#x27;, &#x27;languages&#x27;: [&#x27;eng&#x27;], &#x27;page_number&#x27;: 5, &#x27;file_directory&#x27;: &#x27;data/å¤æ‚PDF&#x27;, &#x27;filename&#x27;: &#x27;billionaires_page-1-5.pdf&#x27;, &#x27;parent_id&#x27;: &#x27;a69407466af63af128c0512ca7f72190&#x27;&#125;</span><br><span class="line">--------------------------------------------------</span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure><ul><li>è¡¨æ ¼æå–æ–¹æ³•ï¼šé€šè¿‡element.category==â€Tableâ€ç­›é€‰è¡¨æ ¼å…ƒç´ ï¼Œä½¿ç”¨vars(element.metadata)æ˜¾ç¤ºå…ƒæ•°æ®ï¼Œelement.textè·å–è¡¨æ ¼å†…å®¹</li><li>çˆ¶èŠ‚ç‚¹æŸ¥æ‰¾ï¼šé€šè¿‡parent_idè·å–è¡¨æ ¼çš„çˆ¶èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¯åˆ¤æ–­è¡¨æ ¼æ‰€å±ä¸Šä¸‹æ–‡å…³ç³»</li><li>å®é™…åº”ç”¨é—®é¢˜ï¼š2019å¹´è¡¨æ ¼èƒ½å‡†ç¡®æ‰¾åˆ°çˆ¶èŠ‚ç‚¹â€2019â€æ ‡é¢˜ï¼Œä½†2018å¹´è¡¨æ ¼ä¼šè¢«é”™è¯¯å…³è”åˆ°é¡µçœ‰â€The Worldâ€™s Billionaires - Wikipediaâ€ï¼ˆéœ€è¦æ¶ˆé™¤é¡µçœ‰é¡µè„šï¼‰</li><li>æ»‘åŠ¨çª—å£ç­–ç•¥ï¼šæå–è¡¨æ ¼å…ƒç´ åï¼Œå‘ä¸ŠæŠ“å–å‰3ä¸ªèŠ‚ç‚¹å†…å®¹ï¼Œå°è¯•è·¨è¶Šé¡µçœ‰é¡µè„šæ‰¾åˆ°æ­£ç¡®æ ‡é¢˜å¹´ä»½</li><li>ä¼˜åŒ–å»ºè®®ï¼šéœ€è¦å®šä½åæ ‡æ¶ˆé™¤é¡µçœ‰é¡µè„šï¼Œæ•´åˆè¿ç»­é¡µé¢ï¼Œå»ºç«‹titleä¸è·¨é¡µè¡¨æ ¼çš„å…³è”</li></ul><h2 id="è¡¨æ ¼æå–-ä¸Šä¸‹æ–‡"><a href="#è¡¨æ ¼æå–-ä¸Šä¸‹æ–‡" class="headerlink" title="è¡¨æ ¼æå– + ä¸Šä¸‹æ–‡"></a>è¡¨æ ¼æå– + ä¸Šä¸‹æ–‡</h2><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">from</span> unstructured.partition.pdf <span class="keyword">import</span> partition_pdf</span><br><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> Settings</span><br><span class="line"><span class="keyword">from</span> llama_index.llms.openai <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> llama_index.embeddings.openai <span class="keyword">import</span> OpenAIEmbedding</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½ç¯å¢ƒå˜é‡</span></span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¨å±€è®¾ç½®</span></span><br><span class="line">Settings.llm = OpenAI(</span><br><span class="line">    model=os.getenv(<span class="string">&quot;DEEPSEEK_MODEL_NAME&quot;</span>),  <span class="comment"># DeepSeek API æ”¯æŒçš„æ¨¡å‹åç§°</span></span><br><span class="line">    api_key=os.getenv(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),  <span class="comment"># ä»ç¯å¢ƒå˜é‡åŠ è½½API key</span></span><br><span class="line">    base_url=os.getenv(<span class="string">&quot;DEEPSEEK_BASE_URL&quot;</span>)</span><br><span class="line">)</span><br><span class="line">Settings.embed_model = OpenAIEmbedding(model=<span class="string">&quot;text-embedding-3-small&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£æ PDF ç»“æ„ï¼Œæå–æ–‡æœ¬å’Œè¡¨æ ¼</span></span><br><span class="line">file_path = <span class="string">&quot;data/å¤æ‚PDF/billionaires_page-1-5.pdf&quot;</span>  <span class="comment"># ä¿®æ”¹ä¸ºä½ çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">elements = partition_pdf(</span><br><span class="line">    file_path,</span><br><span class="line">    strategy=<span class="string">&quot;hi_res&quot;</span>,  <span class="comment"># ä½¿ç”¨é«˜ç²¾åº¦ç­–ç•¥</span></span><br><span class="line">)  <span class="comment"># è§£æPDFæ–‡æ¡£</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªå…ƒç´ IDåˆ°å…ƒç´ çš„æ˜ å°„</span></span><br><span class="line">element_map = &#123;element.<span class="built_in">id</span>: element <span class="keyword">for</span> element <span class="keyword">in</span> elements <span class="keyword">if</span> <span class="built_in">hasattr</span>(element, <span class="string">&#x27;id&#x27;</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªå…ƒç´ ç´¢å¼•åˆ°å…ƒç´ çš„æ˜ å°„</span></span><br><span class="line">element_index_map = &#123;i: element <span class="keyword">for</span> i, element <span class="keyword">in</span> <span class="built_in">enumerate</span>(elements)&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, element <span class="keyword">in</span> <span class="built_in">enumerate</span>(elements):</span><br><span class="line">    <span class="keyword">if</span> element.category == <span class="string">&quot;Table&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nè¡¨æ ¼æ•°æ®:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¡¨æ ¼å…ƒæ•°æ®:&quot;</span>, <span class="built_in">vars</span>(element.metadata))  <span class="comment"># ä½¿ç”¨vars()æ˜¾ç¤ºæ‰€æœ‰å…ƒæ•°æ®å±æ€§</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¡¨æ ¼å†…å®¹:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(element.text)  <span class="comment"># æ‰“å°è¡¨æ ¼æ–‡æœ¬å†…å®¹</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è·å–å¹¶æ‰“å°çˆ¶èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">        parent_id = <span class="built_in">getattr</span>(element.metadata, <span class="string">&#x27;parent_id&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> parent_id <span class="keyword">and</span> parent_id <span class="keyword">in</span> element_map:</span><br><span class="line">            parent_element = element_map[parent_id]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\nçˆ¶èŠ‚ç‚¹ä¿¡æ¯:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;ç±»å‹: <span class="subst">&#123;parent_element.category&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;å†…å®¹: <span class="subst">&#123;parent_element.text&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(parent_element, <span class="string">&#x27;metadata&#x27;</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;çˆ¶èŠ‚ç‚¹å…ƒæ•°æ®: <span class="subst">&#123;<span class="built_in">vars</span>(parent_element.metadata)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;æœªæ‰¾åˆ°çˆ¶èŠ‚ç‚¹ (ID: <span class="subst">&#123;parent_id&#125;</span>)&quot;</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="comment"># æ‰“å°è¡¨æ ¼å‰3ä¸ªèŠ‚ç‚¹çš„å†…å®¹</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nè¡¨æ ¼å‰3ä¸ªèŠ‚ç‚¹å†…å®¹:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="number">0</span>, i-<span class="number">3</span>), i):</span><br><span class="line">            prev_element = element_index_map.get(j)</span><br><span class="line">            <span class="keyword">if</span> prev_element:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;èŠ‚ç‚¹ <span class="subst">&#123;j&#125;</span> (<span class="subst">&#123;prev_element.category&#125;</span>):&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(prev_element.text)</span><br><span class="line">                </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">text_elements = [el <span class="keyword">for</span> el <span class="keyword">in</span> elements <span class="keyword">if</span> el.category == <span class="string">&quot;Text&quot;</span>]</span><br><span class="line">table_elements = [el <span class="keyword">for</span> el <span class="keyword">in</span> elements <span class="keyword">if</span> el.category == <span class="string">&quot;Table&quot;</span>]</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼Œè¾“å‡ºå†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">è¡¨æ ¼æ•°æ®:</span><br><span class="line">è¡¨æ ¼å…ƒæ•°æ®: &#123;&#x27;detection_class_prob&#x27;: 0.5629849433898926, &#x27;coordinates&#x27;: CoordinatesMetadata(points=((np.float64(839.0340576171875), np.float64(1001.4764404296875)), (np.float64(839.0340576171875), np.float64(1920.586669921875)), (np.float64(1587.2479248046875), np.float64(1920.586669921875)), (np.float64(1587.2479248046875), np.float64(1001.4764404296875))), system=&lt;unstructured.documents.coordinates.PixelSpace object at 0x15b5252b0&gt;), &#x27;links&#x27;: [&#123;&#x27;text&#x27;: &quot;Forbes : The World &#x27; s Billionaires website ( https :// www . forb&quot;, &#x27;url&#x27;: &#x27;https://www.forbes.com/billionaires/&#x27;, &#x27;start_index&#x27;: 0&#125;, &#123;&#x27;text&#x27;: &quot;Forbes : The World &#x27; s Billionaires website ( https :// www . forb&quot;, &#x27;url&#x27;: &#x27;https://www.forbes.com/billionaires/&#x27;, &#x27;start_index&#x27;: 0&#125;], &#x27;last_modified&#x27;: &#x27;2025-07-16T19:30:42&#x27;, &#x27;_known_field_names&#x27;: frozenset(&#123;&#x27;filename&#x27;, &#x27;file_directory&#x27;, &#x27;attached_to_filename&#x27;, &#x27;link_texts&#x27;, &#x27;image_url&#x27;, &#x27;emphasized_text_tags&#x27;, &#x27;link_start_indexes&#x27;, &#x27;sent_to&#x27;, &#x27;signature&#x27;, &#x27;cc_recipient&#x27;, &#x27;key_value_pairs&#x27;, &#x27;image_mime_type&#x27;, &#x27;page_name&#x27;, &#x27;coordinates&#x27;, &#x27;detection_class_prob&#x27;, &#x27;subject&#x27;, &#x27;parent_id&#x27;, &#x27;url&#x27;, &#x27;detection_origin&#x27;, &#x27;header_footer_type&#x27;, &#x27;link_urls&#x27;, &#x27;bcc_recipient&#x27;, &#x27;table_as_cells&#x27;, &#x27;emphasized_text_contents&#x27;, &#x27;image_base64&#x27;, &#x27;is_continuation&#x27;, &#x27;category_depth&#x27;, &#x27;orig_elements&#x27;, &#x27;image_path&#x27;, &#x27;data_source&#x27;, &#x27;email_message_id&#x27;, &#x27;filetype&#x27;, &#x27;page_number&#x27;, &#x27;text_as_html&#x27;, &#x27;last_modified&#x27;, &#x27;links&#x27;, &#x27;sent_from&#x27;, &#x27;languages&#x27;&#125;), &#x27;filetype&#x27;: &#x27;application/pdf&#x27;, &#x27;languages&#x27;: [&#x27;eng&#x27;], &#x27;page_number&#x27;: 1, &#x27;file_directory&#x27;: &#x27;data/å¤æ‚PDF&#x27;, &#x27;filename&#x27;: &#x27;billionaires_page-1-5.pdf&#x27;, &#x27;parent_id&#x27;: &#x27;b379afb3fd875896f879cc4cfc441305&#x27;&#125;</span><br><span class="line">è¡¨æ ¼å†…å®¹:</span><br><span class="line">Publisher Whale Media Investments Forbes family Publication First published Forbes March 1987[1] Latest publication April 4, 2023 Current list details (2023)[2] Wealthiest Bernard Arnault Net worth (1st) US$211 billion Number of billionaires 2,640 (from 2668) Total list net worth value US$12.2 trillion (from US$ 12.7 trillion) Number of women 337 New members to the 150 list Forbes: The World&#x27;s Billionaires website (https://www.forb es.com/billionaires/)</span><br><span class="line"></span><br><span class="line">çˆ¶èŠ‚ç‚¹ä¿¡æ¯:</span><br><span class="line">ç±»å‹: Title</span><br><span class="line">å†…å®¹: Methodology</span><br><span class="line">çˆ¶èŠ‚ç‚¹å…ƒæ•°æ®: &#123;&#x27;detection_class_prob&#x27;: 0.7953538298606873, &#x27;coordinates&#x27;: CoordinatesMetadata(points=((np.float64(98.62982255709053), np.float64(1510.925048828125)), (np.float64(98.62982255709053), np.float64(1569.5582275390625)), (np.float64(435.21123011467625), np.float64(1569.5582275390625)), (np.float64(435.21123011467625), np.float64(1510.925048828125))), system=&lt;unstructured.documents.coordinates.PixelSpace object at 0x15b5266f0&gt;), &#x27;links&#x27;: [], &#x27;last_modified&#x27;: &#x27;2025-07-16T19:30:42&#x27;, &#x27;_known_field_names&#x27;: frozenset(&#123;&#x27;filename&#x27;, &#x27;file_directory&#x27;, &#x27;attached_to_filename&#x27;, &#x27;link_texts&#x27;, &#x27;image_url&#x27;, &#x27;emphasized_text_tags&#x27;, &#x27;link_start_indexes&#x27;, &#x27;sent_to&#x27;, &#x27;signature&#x27;, &#x27;cc_recipient&#x27;, &#x27;key_value_pairs&#x27;, &#x27;image_mime_type&#x27;, &#x27;page_name&#x27;, &#x27;coordinates&#x27;, &#x27;detection_class_prob&#x27;, &#x27;subject&#x27;, &#x27;parent_id&#x27;, &#x27;url&#x27;, &#x27;detection_origin&#x27;, &#x27;header_footer_type&#x27;, &#x27;link_urls&#x27;, &#x27;bcc_recipient&#x27;, &#x27;table_as_cells&#x27;, &#x27;emphasized_text_contents&#x27;, &#x27;image_base64&#x27;, &#x27;is_continuation&#x27;, &#x27;category_depth&#x27;, &#x27;orig_elements&#x27;, &#x27;image_path&#x27;, &#x27;data_source&#x27;, &#x27;email_message_id&#x27;, &#x27;filetype&#x27;, &#x27;page_number&#x27;, &#x27;text_as_html&#x27;, &#x27;last_modified&#x27;, &#x27;links&#x27;, &#x27;sent_from&#x27;, &#x27;languages&#x27;&#125;), &#x27;filetype&#x27;: &#x27;application/pdf&#x27;, &#x27;languages&#x27;: [&#x27;eng&#x27;], &#x27;page_number&#x27;: 1, &#x27;file_directory&#x27;: &#x27;data/å¤æ‚PDF&#x27;, &#x27;filename&#x27;: &#x27;billionaires_page-1-5.pdf&#x27;&#125;</span><br><span class="line"></span><br><span class="line">è¡¨æ ¼å‰3ä¸ªèŠ‚ç‚¹å†…å®¹:</span><br><span class="line">èŠ‚ç‚¹ 12 (Title):</span><br><span class="line">Methodology</span><br><span class="line">èŠ‚ç‚¹ 13 (NarrativeText):</span><br><span class="line">Each year, Forbes employs a team of over 50 reporters from a variety of countries to track the activity of the world&#x27;s wealthiest individuals[7] and sometimes groups or families â€“ who share wealth. Preliminary surveys are sent to those who may qualify for the list. According to Forbes, they received three types of responses â€“ some people try to inflate their wealth, others cooperate but leave out details,</span><br><span class="line">èŠ‚ç‚¹ 14 (UncategorizedText):</span><br><span class="line">Publication details</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">è¡¨æ ¼æ•°æ®:</span><br><span class="line">è¡¨æ ¼å…ƒæ•°æ®: &#123;&#x27;detection_class_prob&#x27;: 0.8833286762237549, &#x27;coordinates&#x27;: CoordinatesMetadata(points=((np.float64(102.6220932006836), np.float64(929.1338500976562)), (np.float64(102.6220932006836), np.float64(1154.2158203125)), (np.float64(765.6319580078125), np.float64(1154.2158203125)), (np.float64(765.6319580078125), np.float64(929.1338500976562))), system=&lt;unstructured.documents.coordinates.PixelSpace object at 0x15b61dd60&gt;), &#x27;links&#x27;: [], &#x27;last_modified&#x27;: &#x27;2025-07-16T19:30:42&#x27;, &#x27;_known_field_names&#x27;: frozenset(&#123;&#x27;filename&#x27;, &#x27;file_directory&#x27;, &#x27;attached_to_filename&#x27;, &#x27;link_texts&#x27;, &#x27;image_url&#x27;, &#x27;emphasized_text_tags&#x27;, &#x27;link_start_indexes&#x27;, &#x27;sent_to&#x27;, &#x27;signature&#x27;, &#x27;cc_recipient&#x27;, &#x27;key_value_pairs&#x27;, &#x27;image_mime_type&#x27;, &#x27;page_name&#x27;, &#x27;coordinates&#x27;, &#x27;detection_class_prob&#x27;, &#x27;subject&#x27;, &#x27;parent_id&#x27;, &#x27;url&#x27;, &#x27;detection_origin&#x27;, &#x27;header_footer_type&#x27;, &#x27;link_urls&#x27;, &#x27;bcc_recipient&#x27;, &#x27;table_as_cells&#x27;, &#x27;emphasized_text_contents&#x27;, &#x27;image_base64&#x27;, &#x27;is_continuation&#x27;, &#x27;category_depth&#x27;, &#x27;orig_elements&#x27;, &#x27;image_path&#x27;, &#x27;data_source&#x27;, &#x27;email_message_id&#x27;, &#x27;filetype&#x27;, &#x27;page_number&#x27;, &#x27;text_as_html&#x27;, &#x27;last_modified&#x27;, &#x27;links&#x27;, &#x27;sent_from&#x27;, &#x27;languages&#x27;&#125;), &#x27;filetype&#x27;: &#x27;application/pdf&#x27;, &#x27;languages&#x27;: [&#x27;eng&#x27;], &#x27;page_number&#x27;: 2, &#x27;file_directory&#x27;: &#x27;data/å¤æ‚PDF&#x27;, &#x27;filename&#x27;: &#x27;billionaires_page-1-5.pdf&#x27;, &#x27;parent_id&#x27;: &#x27;feb0e76147077250a13cdb0f842659a3&#x27;&#125;</span><br><span class="line">è¡¨æ ¼å†…å®¹:</span><br><span class="line">Icon Description Has not changed from the previous ranking. Has increased from the previous ranking. Has decreased from the previous ranking.</span><br><span class="line">...</span><br><span class="line">2019</span><br><span class="line">èŠ‚ç‚¹ 54 (NarrativeText):</span><br><span class="line">In the 33rd annual Forbes list of the world&#x27;s billionaires, the list included 2,153 billionaires with a total net wealth of $8.7 trillion, down 55 members and $400 billion from 2018.[14] The U.S. continued to have the most billionaires in the world, with a record of 609, while China dropped to 324 (when not including Hong Kong, Macau and Taiwan).[14]</span><br><span class="line">--------------------------------------------------</span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure><h1 id="é€šè¿‡è°ƒç”¨LlamaParseræ¥è§£æè¡¨æ ¼"><a href="#é€šè¿‡è°ƒç”¨LlamaParseræ¥è§£æè¡¨æ ¼" class="headerlink" title="é€šè¿‡è°ƒç”¨LlamaParseræ¥è§£æè¡¨æ ¼"></a>é€šè¿‡è°ƒç”¨LlamaParseræ¥è§£æè¡¨æ ¼</h1><ul><li>æ ¸å¿ƒåŠŸèƒ½ï¼š<ul><li>è‡ªåŠ¨å°†è¡¨æ ¼è½¬æ¢ä¸ºmarkdownæ ¼å¼</li><li>å°è¯•è¯†åˆ«å¹¶æ·»åŠ è¡¨æ ¼æ ‡é¢˜</li><li>ä¿æŒè¡¨æ ¼ç»“æ„åŒ–è¾“å‡º</li></ul></li><li>APIå‚æ•°ï¼š<ul><li>preserve_layout_alignment_across_pages=Trueå¤„ç†è·¨é¡µè¡¨æ ¼</li><li>take_screenshot=Trueå¯è·å–é¡µé¢æˆªå›¾è¾…åŠ©åˆ†æ</li></ul></li><li>å±€é™æ€§ï¼š<ul><li>éœ€è¦è°ƒç”¨APIï¼Œå¯èƒ½äº§ç”Ÿè´¹ç”¨</li><li>æ ‡é¢˜è¯†åˆ«ä»å­˜åœ¨è¯¯åˆ¤æƒ…å†µï¼ˆå¦‚å°†é¡µçœ‰è¯¯è®¤ä¸ºå¹´ä»½ï¼‰</li></ul></li></ul><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">from</span> llama_index.llms.openai <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> llama_index.embeddings.openai <span class="keyword">import</span> OpenAIEmbedding</span><br><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> Settings</span><br><span class="line"><span class="keyword">from</span> llama_parse <span class="keyword">import</span> LlamaParse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½ç¯å¢ƒå˜é‡ï¼ˆç¡®ä¿æœ‰OpenAI APIå¯†é’¥ï¼‰</span></span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®åŸºç¡€æ¨¡å‹</span></span><br><span class="line">embed_model = OpenAIEmbedding(model=<span class="string">&quot;text-embedding-3-small&quot;</span>)</span><br><span class="line">llm = OpenAI(</span><br><span class="line">    model=os.getenv(<span class="string">&quot;DEEPSEEK_MODEL_NAME&quot;</span>),  <span class="comment"># DeepSeek API æ”¯æŒçš„æ¨¡å‹åç§°</span></span><br><span class="line">    api_key=os.getenv(<span class="string">&quot;DEEPSEEK_API_KEY&quot;</span>),  <span class="comment"># ä»ç¯å¢ƒå˜é‡åŠ è½½API key</span></span><br><span class="line">    base_url=os.getenv(<span class="string">&quot;DEEPSEEK_BASE_URL&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">Settings.llm = llm</span><br><span class="line">Settings.embed_model = embed_model</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰PDFè·¯å¾„</span></span><br><span class="line">pdf_path = <span class="string">&quot;data/å¤æ‚PDF/billionaires_page-1-5.pdf&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®°å½•å¼€å§‹æ—¶é—´</span></span><br><span class="line">start_time = time.time()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨LlamaParseè§£æPDF, éœ€è¦ä»˜è´¹ï¼Œæ³¨æ„æ•°æ®å®‰å…¨ä½¿ç”¨</span></span><br><span class="line">documents = LlamaParse(result_type=<span class="string">&quot;markdown&quot;</span>).load_data(pdf_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®°å½•ç»“æŸæ—¶é—´</span></span><br><span class="line">end_time = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;PDFè§£æè€—æ—¶: <span class="subst">&#123;end_time - start_time:<span class="number">.2</span>f&#125;</span>ç§’&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°è§£æç»“æœ</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nè§£æåçš„æ–‡æ¡£å†…å®¹:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(documents, <span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\næ–‡æ¡£ <span class="subst">&#123;i&#125;</span> å†…å®¹:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(doc.text)</span><br></pre></td></tr></table></figure><ul><li>æ ¸å¿ƒèƒ½åŠ›ï¼šä¸“ä¸ºLLMä¼˜åŒ–çš„æ–‡æ¡£è§£æå¹³å°ï¼Œå¤„ç†å«è¡¨æ ¼/å›¾è¡¨/å›¾åƒçš„å¤æ‚æ–‡æ¡£</li><li>é¡µçœ‰é¡µè„šå¤„ç†ï¼šæä¾›æ¶ˆé™¤é¡µçœ‰é¡µè„šçš„é…ç½®é€‰é¡¹ï¼Œå¯æ”¹å–„è·¨é¡µè¡¨æ ¼çš„è¯†åˆ«å‡†ç¡®ç‡</li><li>ç”Ÿäº§ç¯å¢ƒé€‚ç”¨ï¼šæ¯å‘¨å¤„ç†1000ä¸‡+æ–‡æ¡£ï¼Œæ”¯æŒä¼ä¸šçº§åº”ç”¨åœºæ™¯</li></ul><h1 id="å·¥å…·å¯¹æ¯”åŠé€‰æ‹©å»ºè®®"><a href="#å·¥å…·å¯¹æ¯”åŠé€‰æ‹©å»ºè®®" class="headerlink" title="å·¥å…·å¯¹æ¯”åŠé€‰æ‹©å»ºè®®"></a>å·¥å…·å¯¹æ¯”åŠé€‰æ‹©å»ºè®®</h1><ul><li>ç®€å•è¡¨æ ¼æå–ï¼šCamelotæˆ–PDFPlumber</li><li>éœ€è¦ä¸Šä¸‹æ–‡å…³è”ï¼šUnstructuredæˆ–LlamaParser</li><li>è·¨é¡µå¤æ‚è¡¨æ ¼ï¼šä¼˜å…ˆè€ƒè™‘LlamaParser</li></ul>]]></content>
    
    
    <summary type="html">å­¦ä¹ å¤§æ¨¡å‹RAGç³»ç»Ÿå­¦ä¹ ç¬”è®°ç¬¬åè®²</summary>
    
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="å¤§æ¨¡å‹RAGç³»ç»Ÿ" scheme="https://jinglv.github.io/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8BRAG%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
</feed>
