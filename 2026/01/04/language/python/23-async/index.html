<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jinglv.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="å­¦ä¹ Pythonå­¦ä¹ ç¬”è®°ç¬¬äºŒåä¸‰è®²">
<meta property="og:type" content="article">
<meta property="og:title" content="å¼‚æ­¥ç¼–ç¨‹">
<meta property="og:url" content="https://jinglv.github.io/2026/01/04/language/python/23-async/index.html">
<meta property="og:site_name" content="Jean&#39;s Blog">
<meta property="og:description" content="å­¦ä¹ Pythonå­¦ä¹ ç¬”è®°ç¬¬äºŒåä¸‰è®²">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2026-01-03T16:00:00.000Z">
<meta property="article:modified_time" content="2026-01-04T01:30:00.000Z">
<meta property="article:author" content="Jean Lv">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jinglv.github.io/2026/01/04/language/python/23-async/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>å¼‚æ­¥ç¼–ç¨‹ | Jean's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Jean's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Jean's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ä¸€ä¸ªä¸“æ³¨è½¯ä»¶æµ‹è¯•å¼€å‘æŠ€æœ¯çš„ä¸ªäººåšå®¢</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jinglv.github.io/2026/01/04/language/python/23-async/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Jean Lv">
      <meta itemprop="description" content="æ¶‰çŒçš„ä¸»è¦ç¼–ç¨‹è¯­è¨€Javaã€Python, é¢†åŸŸè½¯ä»¶æµ‹è¯•ã€AIæµ‹è¯•å¼€å‘ç›¸å…³">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jean's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          å¼‚æ­¥ç¼–ç¨‹
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-04 00:00:00 / ä¿®æ”¹æ—¶é—´ï¼š09:30:00" itemprop="dateCreated datePublished" datetime="2026-01-04T00:00:00+08:00">2026-01-04</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
            <div class="post-description">å­¦ä¹ Pythonå­¦ä¹ ç¬”è®°ç¬¬äºŒåä¸‰è®²</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="å¼‚æ­¥å‡½æ•°-åç¨‹å‡½æ•°"><a href="#å¼‚æ­¥å‡½æ•°-åç¨‹å‡½æ•°" class="headerlink" title="å¼‚æ­¥å‡½æ•°(åç¨‹å‡½æ•°)"></a>å¼‚æ­¥å‡½æ•°(åç¨‹å‡½æ•°)</h1><h2 id="asyncå’Œåç¨‹å‡½æ•°"><a href="#asyncå’Œåç¨‹å‡½æ•°" class="headerlink" title="asyncå’Œåç¨‹å‡½æ•°"></a>asyncå’Œåç¨‹å‡½æ•°</h2><ul>
<li>åœ¨ Python ä¸­ï¼Œ<strong>åç¨‹æ˜¯å¯æš‚åœçš„å‡½æ•°</strong>ï¼Œå®šä¹‰æ–¹å¼ä¸º <code>async def</code>ã€‚</li>
<li>å¦‚æœç›´æ¥è°ƒç”¨ï¼Œ å®ƒä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª <code>coroutine</code> (åç¨‹)å¯¹è±¡ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">say_hello</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¼€å§‹æ‰§è¡Œsay helloè¿™ä¸ªä»»åŠ¡&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello&quot;</span></span><br></pre></td></tr></table></figure>
<p>ä¸èƒ½ç›´æ¥è°ƒç”¨åç¨‹å‡½æ•°è·å¾—ç»“æœï¼Œå¿…é¡»ä½¿ç”¨ <code>await</code> æˆ–äº‹ä»¶å¾ªç¯è°ƒåº¦ã€‚</p>
<p><strong>await</strong> <strong>å’Œå¯ç­‰å¾…å¯¹è±¡</strong></p>
<p>åœ¨ Python å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œ<code>await</code> åé¢å¿…é¡»æ˜¯å¯ç­‰å¾…å¯¹è±¡ï¼Œå³ï¼š</p>
<p>å®ç°äº† <code>__await__()</code> æ–¹æ³•çš„å¯¹è±¡ï¼Œç§°ä¸º awaitableï¼ˆå¯ç­‰å¾…å¯¹è±¡ï¼‰</p>
<p><strong>Python ä¸­çš„ä¸‰ç§åŸç”Ÿ awaitable ç±»å‹</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>ç¤ºä¾‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>åç¨‹å¯¹è±¡</td>
<td>ç”± <code>async def</code>è°ƒç”¨è¿”å›</td>
<td>æœ€å¸¸è§çš„ awaitable</td>
</tr>
<tr>
<td>Task å¯¹è±¡</td>
<td><code>asyncio.create_task()</code>çš„è¿”å›å€¼</td>
<td>åŒ…è£…åç¨‹ä¸ºå¹¶å‘ä»»åŠ¡</td>
</tr>
<tr>
<td>Future å¯¹è±¡</td>
<td><code>asyncio.Future()</code></td>
<td>åº•å±‚æœºåˆ¶ï¼Œæ‰‹åŠ¨æ§åˆ¶ç»“æœ</td>
</tr>
</tbody>
</table>
</div>
<h2 id="åç¨‹çš„è°ƒç”¨æ–¹å¼"><a href="#åç¨‹çš„è°ƒç”¨æ–¹å¼" class="headerlink" title="åç¨‹çš„è°ƒç”¨æ–¹å¼"></a>åç¨‹çš„è°ƒç”¨æ–¹å¼</h2><p><strong>é”™è¯¯è°ƒç”¨æ–¹å¼</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = say_hello()  <span class="comment"># è¿”å› coroutine å¯¹è±¡ï¼Œä¸ä¼šæ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>
<p><strong>æ­£ç¡®è°ƒç”¨æ–¹å¼ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ <code>await</code>ï¼ˆä»…é™åœ¨ <code>async def</code> ä¸­ä½¿ç”¨ï¼‰</li>
<li>æˆ–ç”¨ <code>asyncio.run()</code> åœ¨é¡¶å±‚è¿è¡Œï¼Œasyncioå¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒåº“</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    result = <span class="keyword">await</span> say_hello()</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>
<h2 id="å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæ¶æ„åŠæµç¨‹"><a href="#å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæ¶æ„åŠæµç¨‹" class="headerlink" title="å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæ¶æ„åŠæµç¨‹"></a>å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæ¶æ„åŠæµç¨‹</h2><pre class="mermaid">graph TB
    subgraph "Pythonå¼‚æ­¥ç¼–ç¨‹æ¶æ„"
        A[åº”ç”¨å±‚] --> B[åç¨‹ Coroutines]
        A --> C[ä»»åŠ¡ Tasks]
        A --> D[Futureå¯¹è±¡]

        B --> E[asyncio è¿è¡Œæ—¶]
        C --> E
        D --> E

        E --> F[äº‹ä»¶å¾ªç¯ Event Loop]

        F --> G[é€‰æ‹©å™¨ Selector]
        F --> H[ä»»åŠ¡è°ƒåº¦å™¨]
        F --> I[å›è°ƒç®¡ç†å™¨]

        G --> J[æ“ä½œç³»ç»ŸI/Oå¤šè·¯å¤ç”¨]

        H --> K[å°±ç»ªé˜Ÿåˆ— Ready Queue]
        H --> L[å®šæ—¶å™¨é˜Ÿåˆ— Timer Queue]
        H --> M[å®Œæˆé˜Ÿåˆ— Done Queue]

        J --> N[ç½‘ç»œI/Oäº‹ä»¶]
        J --> O[æ–‡ä»¶I/Oäº‹ä»¶]
        J --> P[å­è¿›ç¨‹äº‹ä»¶]
    end

    subgraph "åç¨‹æ‰§è¡ŒçŠ¶æ€æœº"
        Q[åç¨‹çŠ¶æ€] --> R[æœªå¯åŠ¨ CREATED]
        R --> S[è¿è¡Œä¸­ RUNNING]
        S --> T[æŒ‚èµ· SUSPENDED]
        T --> S
        S --> U[å®Œæˆ FINISHED]
        T --> V[å¼‚å¸¸ EXCEPTION]
    end</pre>

<pre class="mermaid">flowchart TD
    A[å¼‚æ­¥ç¨‹åºå¯åŠ¨] --> B[åˆ›å»ºäº‹ä»¶å¾ªç¯]
    B --> C[è¿è¡Œä¸»åç¨‹<br>asyncio.run]

    C --> D[åç¨‹è°ƒç”¨æ ˆåˆå§‹åŒ–]
    D --> E[åˆ›å»ºTaskåŒ…è£…ä¸»åç¨‹]

    E --> F[äº‹ä»¶å¾ªç¯å¼€å§‹è¿è¡Œ<br>loop.run_until_complete]

    F --> G{å°±ç»ªé˜Ÿåˆ—æ£€æŸ¥}
    G -->|æœ‰ä»»åŠ¡| H[å–å‡ºTaskæ‰§è¡Œ]
    G -->|ç©º| I[ç­‰å¾…I/Oäº‹ä»¶]

    H --> J[æ‰§è¡ŒTask._step]

    J --> K{åç¨‹çŠ¶æ€}
    K -->|ç¬¬ä¸€æ¬¡æ‰§è¡Œ| L[coro.sendNoneå¯åŠ¨]
    K -->|æ¢å¤æ‰§è¡Œ| M[coro.sendç»“æœ<br>æˆ– coro.throwå¼‚å¸¸]

    L --> N{æ‰§è¡Œç»“æœ}
    M --> N

    N -->|è¿”å›æ–°awaitable| O[å¤„ç†åµŒå¥—await]
    N -->|StopIteration| P[Taskå®Œæˆè®¾ç½®ç»“æœ]
    N -->|å¼‚å¸¸| Q[Taskå®Œæˆè®¾ç½®å¼‚å¸¸]

    O --> R{awaitableç±»å‹åˆ†æ}
    R -->|åç¨‹| S[é€’å½’åˆ›å»ºå­Task]
    R -->|Future/Task| T[æ·»åŠ å›è°ƒç­‰å¾…å®Œæˆ]
    R -->|å…¶ä»–| U[è½¬æ¢ä¸ºFuture]

    S --> V[æ–°TaskåŠ å…¥å°±ç»ªé˜Ÿåˆ—]
    T --> W[å½“å‰Taskæš‚åœç­‰å¾…]
    U --> W

    W --> X[äº‹ä»¶å¾ªç¯ç»§ç»­<br>æ‰§è¡Œå…¶ä»–ä»»åŠ¡]

    P --> Y[Taskæ ‡è®°ä¸ºå®Œæˆ]
    Q --> Y

    Y --> Z[è§¦å‘å›è°ƒé“¾]

    Z --> AA[æ¸…ç†èµ„æº]

    X --> G

    I --> AB[è°ƒç”¨select/poll/epoll<br>ç­‰å¾…I/Oäº‹ä»¶]
    AB --> AC[I/Oäº‹ä»¶å°±ç»ª]
    AC --> AD[å¯¹åº”Futureè®¾ç½®ç»“æœ]
    AD --> AE[ç›¸å…³TaskåŠ å…¥å°±ç»ªé˜Ÿåˆ—]
    AE --> G

    subgraph "å¹¶å‘æ‰§è¡Œæ¨¡å¼"
        AF[å¤šä¸ªTaskå¹¶å‘] --> AG[æ—¶é—´ç‰‡è½®è½¬]
        AG --> AH[é‡åˆ°awaitè®©å‡ºæ§åˆ¶æƒ]
        AH --> AI[äº‹ä»¶å¾ªç¯è°ƒåº¦ä¸‹ä¸€ä¸ªTask]
        AI --> AJ[I/Oå®Œæˆæ—¶æ¢å¤æ‰§è¡Œ]
    end</pre>



<h2 id="åç¨‹æ‰§è¡Œå¹¶å‘"><a href="#åç¨‹æ‰§è¡Œå¹¶å‘" class="headerlink" title="åç¨‹æ‰§è¡Œå¹¶å‘"></a>åç¨‹æ‰§è¡Œå¹¶å‘</h2><h3 id="asyncio-create-task"><a href="#asyncio-create-task" class="headerlink" title="asyncio.create_task()"></a>asyncio.create_task()</h3><p>æå‰è°ƒåº¦å¤šä¸ªåç¨‹å¹¶å‘æ‰§è¡Œ </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    task1 = asyncio.create_task(say_hello())</span><br><span class="line">    task2 = asyncio.create_task(say_hello())</span><br><span class="line">    <span class="keyword">await</span> task1</span><br><span class="line">    <span class="keyword">await</span> task2</span><br></pre></td></tr></table></figure>
<p><code>asyncio.create_task()</code> æ˜¯ Python å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒå‡½æ•°ä¹‹ä¸€ï¼Œç”¨äºå°†åç¨‹åŒ…è£…ä¸º Task å¯¹è±¡å¹¶è°ƒåº¦æ‰§è¡Œã€‚</p>
<p>æ‰§è¡Œæµç¨‹è¯¦è§£</p>
<pre class="mermaid">flowchart TD
    A[è°ƒç”¨ asyncio.create_task] --> B{å‚æ•°æœ‰æ•ˆæ€§æ£€æŸ¥}
    B -->|æ— æ•ˆ| C[æŠ›å‡ºTypeErrorå¼‚å¸¸]
    B -->|æœ‰æ•ˆ| D[è·å–å½“å‰äº‹ä»¶å¾ªç¯]

    D --> E[åˆ›å»ºTaskå¯¹è±¡]

    E --> F[åˆå§‹åŒ–Task]
    F --> G[è®¾ç½®åç¨‹å¯¹è±¡]
    F --> H[è®¾ç½®çŠ¶æ€ä¸ºPENDING]
    F --> I[åˆ›å»ºFutureå¯¹è±¡]
    F --> J[æ³¨å†Œå›è°ƒå‡½æ•°]

    J --> K[è°ƒåº¦Taskæ‰§è¡Œ]

    K --> L[å°†TaskåŠ å…¥å°±ç»ªé˜Ÿåˆ—]

    L --> M[äº‹ä»¶å¾ªç¯å¼€å§‹è°ƒåº¦]
    M --> N{äº‹ä»¶å¾ªç¯æ˜¯å¦è¿è¡Œ}
    N -->|æ˜¯| O[æ‰§è¡ŒTask._stepæ–¹æ³•]
    N -->|å¦| P[ç­‰å¾…äº‹ä»¶å¾ªç¯å¯åŠ¨]

    O --> Q{åç¨‹æ‰§è¡ŒçŠ¶æ€}
    Q -->|ç¬¬ä¸€æ¬¡æ‰§è¡Œ| R[å‘é€Noneå¯åŠ¨åç¨‹]
    Q -->|åç»­æ¢å¤| S[å‘é€ç»“æœæˆ–å¼‚å¸¸]

    R --> T{åç¨‹æ‰§è¡Œç»“æœ}
    S --> T

    T -->|è¿”å›awaitableå¯¹è±¡| U[å¤„ç†awaitableå¯¹è±¡]
    T -->|æŠ›å‡ºStopIteration| V[åç¨‹æ‰§è¡Œå®Œæˆ]
    T -->|æŠ›å‡ºå…¶ä»–å¼‚å¸¸| W[è®¾ç½®Taskå¼‚å¸¸]

    U --> X{awaitableå¯¹è±¡ç±»å‹}
    X -->|Futureæˆ–Task| Y[æ·»åŠ å®Œæˆå›è°ƒ]
    X -->|åç¨‹| Z[é€’å½’åˆ›å»ºå­Task]
    X -->|å…¶ä»–ç±»å‹| AA[è½¬æ¢ä¸ºFutureå¯¹è±¡]

    Y --> AB[æš‚åœå½“å‰Taskæ‰§è¡Œ]
    Z --> AB
    AA --> AB

    AB --> AC[äº‹ä»¶å¾ªç¯ç»§ç»­å…¶ä»–ä»»åŠ¡]

    V --> AD[TaskçŠ¶æ€å˜ä¸ºFINISHED]
    W --> AD

    AD --> AE[æ‰§è¡Œå®Œæˆå›è°ƒå‡½æ•°]

    AE --> AF[æ¸…ç†Taskèµ„æº]
    AF --> AG[Taskæ‰§è¡Œå®Œæˆ]

    AC --> M</pre>



<h3 id="asyncio-gather"><a href="#asyncio-gather" class="headerlink" title="asyncio.gather()"></a>asyncio.gather()</h3><p>æ‰¹é‡åˆ›å»ºåç¨‹ä»»åŠ¡,å¹¶å‘æ‰§è¡Œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">     <span class="keyword">await</span> asyncio.gather(say_hello(),say_hello())</span><br></pre></td></tr></table></figure>
<p><code>asyncio.gather()</code> æ˜¯ Python å¼‚æ­¥ç¼–ç¨‹ä¸­ç”¨äºå¹¶å‘è¿è¡Œå¤šä¸ªå¯ç­‰å¾…å¯¹è±¡çš„æ ¸å¿ƒå‡½æ•°ï¼Œå®ƒæ”¶é›†æ‰€æœ‰ç»“æœå¹¶ä»¥åˆ—è¡¨å½¢å¼è¿”å›ï¼Œä¿æŒåŸå§‹é¡ºåºã€‚</p>
<p>æ‰§è¡Œæµç¨‹è¯¦è§£</p>
<pre class="mermaid">flowchart TD
    A[è°ƒç”¨ asyncio.gather<br>*aws, return_exceptions=False] --> B[åˆ›å»º _GatheringFuture å¯¹è±¡]

    B --> C{æ£€æŸ¥å‚æ•°}
    C -->|æ— å‚æ•°| D[è¿”å›ç©ºçš„å·²å®Œæˆ Future]
    C -->|æœ‰å‚æ•°| E[åˆå§‹åŒ–ç»“æœå®¹å™¨å’Œè®¡æ•°å™¨]

    E --> F[éå†æ‰€æœ‰å¯ç­‰å¾…å¯¹è±¡ aws]

    F --> G{æ˜¯å¦ä¸ºåç¨‹æˆ– Future?}
    G -->|åç¨‹| H[åŒ…è£…ä¸º Task<br>ensure_future]
    G -->|Future| I[ç›´æ¥ä½¿ç”¨]
    G -->|å…¶ä»–| J[è½¬æ¢ä¸º Future]

    H --> K[è®¾ç½®å›è°ƒå‡½æ•°]
    I --> K
    J --> K

    K --> L[ä¸ºæ¯ä¸ª Future æ·»åŠ <br>_done_callback å›è°ƒ]

    L --> M[å°†æ‰€æœ‰å†…éƒ¨ Future<br>ä¿å­˜åˆ° _children é›†åˆ]

    M --> N{æ‰€æœ‰ Future å·²åˆ›å»º?}
    N -->|å¦| F
    N -->|æ˜¯| O[è¿”å› _GatheringFuture<br>ç»™è°ƒç”¨è€…]

    O --> P{_GatheringFuture æ˜¯å¦è¢«å–æ¶ˆ?}
    P -->|æ˜¯| Q[å–æ¶ˆæ‰€æœ‰å­ Future]
    P -->|å¦| R[ç­‰å¾…æ‰€æœ‰å­ Future å®Œæˆ]

    subgraph "å›è°ƒå¤„ç†æµç¨‹ (å¹¶è¡Œæ‰§è¡Œ)"
        direction LR
        S[å­ Future å®Œæˆ] --> T[æ‰§è¡Œ _done_callback]

        T --> U{å­ Future æ˜¯å¦æœ‰å¼‚å¸¸?}
        U -->|æ˜¯| V{return_exceptions å‚æ•°?}
        V -->|True| W[å°†å¼‚å¸¸ä½œä¸ºç»“æœä¿å­˜]
        V -->|False| X[å–æ¶ˆæ‰€æœ‰å…¶ä»–å­ Future]
        U -->|å¦| Y[å°†ç»“æœä¿å­˜åˆ°å¯¹åº”ä½ç½®]

        X --> Z[è®¾ç½® _GatheringFuture å¼‚å¸¸]
        W --> AA[æ›´æ–°å®Œæˆè®¡æ•°å™¨]
        Y --> AA

        AA --> AB{æ‰€æœ‰å­ Future å·²å®Œæˆ?}
        AB -->|æ˜¯| AC[è®¾ç½® _GatheringFuture ç»“æœ]
        AB -->|å¦| AD[ç»§ç»­ç­‰å¾…å…¶ä»–]
    end

    Q --> AE[_GatheringFuture è¢«å–æ¶ˆ]
    Z --> AE
    AC --> AF[_GatheringFuture å®Œæˆ<br>è¿”å›ç»“æœåˆ—è¡¨]

    R --> S
    AD --> R</pre>



<h1 id="è¿­ä»£å™¨å’Œå¼‚æ­¥è¿­ä»£å™¨"><a href="#è¿­ä»£å™¨å’Œå¼‚æ­¥è¿­ä»£å™¨" class="headerlink" title="è¿­ä»£å™¨å’Œå¼‚æ­¥è¿­ä»£å™¨"></a>è¿­ä»£å™¨å’Œå¼‚æ­¥è¿­ä»£å™¨</h1><h2 id="ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ</h2><ul>
<li><p>è¿­ä»£å™¨å¯¹è±¡éœ€è¦å®ç°ï¼š</p>
<ul>
<li><p><code>__iter__()</code> â†’ è¿”å›è¿­ä»£å™¨è‡ªèº«</p>
</li>
<li><p><code>__next__()</code> â†’ æ¯æ¬¡è¿­ä»£è¿”å›ä¸€ä¸ªå€¼ï¼Œç»“æŸæ—¶æŠ›å‡º <code>StopIteration</code></p>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SyncCounter</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, <span class="built_in">max</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.count = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.<span class="built_in">max</span> = <span class="built_in">max</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.count &gt;= <span class="variable language_">self</span>.<span class="built_in">max</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        <span class="variable language_">self</span>.count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.count</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> SyncCounter(<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(num)</span><br></pre></td></tr></table></figure>
<h2 id="ä»€ä¹ˆæ˜¯å¼‚æ­¥è¿­ä»£å™¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¼‚æ­¥è¿­ä»£å™¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¼‚æ­¥è¿­ä»£å™¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¼‚æ­¥è¿­ä»£å™¨ï¼Ÿ</h2><ul>
<li><p>éœ€è¦å®ç°ä¸¤ä¸ªå¼‚æ­¥æ–¹æ³•ï¼š</p>
<ul>
<li><p><code>__aiter__()</code> â†’ è¿”å›å¼‚æ­¥è¿­ä»£å™¨å¯¹è±¡ï¼ˆä¸€èˆ¬ä¸º selfï¼‰</p>
</li>
<li><p><code>__anext__()</code> â†’ ä½¿ç”¨ <code>await</code> è¿”å›ä¸‹ä¸€ä¸ªå€¼ï¼›ç»“æŸæ—¶æŠ›å‡º <code>StopAsyncIteration</code></p>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncCounter</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, <span class="built_in">max</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.count = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.<span class="built_in">max</span> = <span class="built_in">max</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__aiter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">__anext__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.count &gt;= <span class="variable language_">self</span>.<span class="built_in">max</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopAsyncIteration</span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.count</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">for</span> i <span class="keyword">in</span> AsyncCounter(<span class="number">3</span>):</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>
<h2 id="LangChainä¸­å¼‚æ­¥è¿­ä»£å™¨åº”ç”¨"><a href="#LangChainä¸­å¼‚æ­¥è¿­ä»£å™¨åº”ç”¨" class="headerlink" title="LangChainä¸­å¼‚æ­¥è¿­ä»£å™¨åº”ç”¨"></a>LangChainä¸­å¼‚æ­¥è¿­ä»£å™¨åº”ç”¨</h2><p><code>.astream()</code>æ–¹æ³•æ‰§è¡Œè¿”å›çš„å°±æ˜¯å¼‚æ­¥è¿­ä»£å™¨</p>
<ul>
<li>å½“ä½ è¿è¡Œä¸€ä¸ªå¤šè½®å¯¹è¯ã€å†³ç­–é“¾ã€æˆ– Agent å›¾è°±æ—¶ï¼Œå¯ä»¥é€šè¿‡ <code>.astream()</code> ä»¥â€œäº‹ä»¶æµâ€çš„å½¢å¼å¼‚æ­¥è·å–æ¯ä¸ªèŠ‚ç‚¹çš„ä¸­é—´çŠ¶æ€æˆ–è¾“å‡ºã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">run_stream</span>(<span class="params">app, <span class="built_in">input</span></span>):</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">for</span> event <span class="keyword">in</span> app.astream(<span class="built_in">input</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ğŸ“¦ å½“å‰çŠ¶æ€ç‰‡æ®µï¼š&quot;</span>, event)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨æ–¹å¼</span></span><br><span class="line">asyncio.run(run_stream(app, &#123;<span class="string">&quot;input&quot;</span>: <span class="string">&quot;å¼€å§‹æ‰§è¡Œ&quot;</span>&#125;))</span><br></pre></td></tr></table></figure>
<h1 id="ç”Ÿæˆå™¨å’Œå¼‚æ­¥ç”Ÿæˆå™¨"><a href="#ç”Ÿæˆå™¨å’Œå¼‚æ­¥ç”Ÿæˆå™¨" class="headerlink" title="ç”Ÿæˆå™¨å’Œå¼‚æ­¥ç”Ÿæˆå™¨"></a>ç”Ÿæˆå™¨å’Œå¼‚æ­¥ç”Ÿæˆå™¨</h1><h2 id="åŒæ­¥ç”Ÿæˆå™¨"><a href="#åŒæ­¥ç”Ÿæˆå™¨" class="headerlink" title="åŒæ­¥ç”Ÿæˆå™¨"></a>åŒæ­¥ç”Ÿæˆå™¨</h2><ul>
<li>ä½¿ç”¨ <code>yield</code> å®šä¹‰ç”Ÿæˆå™¨å‡½æ•°</li>
<li>æ¯æ¬¡ <code>next()</code> ä¼šä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œ</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">countdown</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">yield</span> n</span><br><span class="line">        n -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> countdown(<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(num)</span><br></pre></td></tr></table></figure>
<h2 id="å¼‚æ­¥ç”Ÿæˆå™¨çš„è¯­æ³•ä¸æœºåˆ¶"><a href="#å¼‚æ­¥ç”Ÿæˆå™¨çš„è¯­æ³•ä¸æœºåˆ¶" class="headerlink" title="å¼‚æ­¥ç”Ÿæˆå™¨çš„è¯­æ³•ä¸æœºåˆ¶"></a>å¼‚æ­¥ç”Ÿæˆå™¨çš„è¯­æ³•ä¸æœºåˆ¶</h2><ul>
<li>ä½¿ç”¨ <code>async def</code> + <code>yield</code></li>
<li>ç”¨ <code>async for</code> æ¥æ¶ˆè´¹</li>
<li>åœ¨ <code>yield</code> ä¹‹é—´å¯ä½¿ç”¨ <code>await</code> æ‰§è¡Œå¼‚æ­¥æ“ä½œ</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">async_countdown</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">yield</span> n</span><br><span class="line">        n -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">for</span> value <span class="keyword">in</span> async_countdown(<span class="number">3</span>):</span><br><span class="line">        <span class="built_in">print</span>(value)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>
<h1 id="å¼‚æ­¥ç”Ÿæˆå™¨-vs-å¼‚æ­¥è¿­ä»£å™¨"><a href="#å¼‚æ­¥ç”Ÿæˆå™¨-vs-å¼‚æ­¥è¿­ä»£å™¨" class="headerlink" title="å¼‚æ­¥ç”Ÿæˆå™¨ vs å¼‚æ­¥è¿­ä»£å™¨"></a>å¼‚æ­¥ç”Ÿæˆå™¨ vs å¼‚æ­¥è¿­ä»£å™¨</h1><div class="table-container">
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>å¼‚æ­¥è¿­ä»£å™¨ï¼ˆæ‰‹å†™ç±»ï¼‰</th>
<th>å¼‚æ­¥ç”Ÿæˆå™¨ï¼ˆå‡½æ•°å¼ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¼–å†™æ–¹å¼</td>
<td>ç±» + <code>__anext__()</code></td>
<td><code>async def</code> + <code>yield</code></td>
</tr>
<tr>
<td>æ˜¯å¦ç®€æ´</td>
<td>âŒ å¤æ‚</td>
<td>âœ… ç®€æ´</td>
</tr>
<tr>
<td>æ¨èä½¿ç”¨åœºæ™¯</td>
<td>æ§åˆ¶çŠ¶æ€è¾ƒå¤æ‚çš„å¼‚æ­¥è¿­ä»£</td>
<td>å¼‚æ­¥æ•°æ®æµã€åˆ†é¡µç­‰</td>
</tr>
</tbody>
</table>
</div>
<h1 id="ä¸Šä¸‹æ–‡ç®¡ç†å™¨å’Œå¼‚æ­¥ä¸Šä¸‹æ–‡"><a href="#ä¸Šä¸‹æ–‡ç®¡ç†å™¨å’Œå¼‚æ­¥ä¸Šä¸‹æ–‡" class="headerlink" title="ä¸Šä¸‹æ–‡ç®¡ç†å™¨å’Œå¼‚æ­¥ä¸Šä¸‹æ–‡"></a>ä¸Šä¸‹æ–‡ç®¡ç†å™¨å’Œå¼‚æ­¥ä¸Šä¸‹æ–‡</h1><h2 id="ä¸Šä¸‹æ–‡ç®¡ç†å™¨"><a href="#ä¸Šä¸‹æ–‡ç®¡ç†å™¨" class="headerlink" title="ä¸Šä¸‹æ–‡ç®¡ç†å™¨"></a>ä¸Šä¸‹æ–‡ç®¡ç†å™¨</h2><p><strong>ä½œç”¨</strong></p>
<ul>
<li>ç®¡ç†èµ„æºçš„ç”³è¯·ä¸é‡Šæ”¾</li>
<li>é€šè¿‡ <code>with</code> è¯­å¥ä¿è¯èµ„æºè‡ªåŠ¨å…³é—­ï¼ˆæ–‡ä»¶ã€æ•°æ®åº“è¿æ¥ç­‰ï¼‰</li>
</ul>
<p><strong>è¯­æ³•</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;file.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br></pre></td></tr></table></figure>
<p><strong>è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ç®¡ç†å™¨</strong></p>
<ul>
<li>å®ç° <code>__enter__()</code> å’Œ <code>__exit__()</code> æ–¹æ³•</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyContext</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¿›å…¥ä¸Šä¸‹æ–‡&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;é€€å‡ºä¸Šä¸‹æ–‡ï¼Œé‡Šæ”¾èµ„æº&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> MyContext() <span class="keyword">as</span> ctx:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¤„ç†ä¸­...&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨åŸºç¡€"><a href="#å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨åŸºç¡€" class="headerlink" title="å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨åŸºç¡€"></a>å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨åŸºç¡€</h2><p><strong>ä½œç”¨</strong></p>
<ul>
<li>å¤„ç†å¼‚æ­¥èµ„æºçš„ç”³è¯·å’Œé‡Šæ”¾</li>
<li>ç”¨äºå¼‚æ­¥ I/O æ“ä½œã€æ•°æ®åº“è¿æ¥æ± ã€HTTP å®¢æˆ·ç«¯ç­‰</li>
</ul>
<p><strong>è¯­æ³•</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.get(<span class="string">&#x27;https://example.com&#x27;</span>) <span class="keyword">as</span> resp:</span><br><span class="line">        data = <span class="keyword">await</span> resp.text()</span><br></pre></td></tr></table></figure>
<p><strong>è‡ªå®šä¹‰å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨</strong></p>
<ul>
<li>å®ç° <code>__aenter__()</code> å’Œ <code>__aexit__()</code> å¼‚æ­¥æ–¹æ³•</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncContext</span>:</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">__aenter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å¼‚æ­¥è¿›å…¥ä¸Šä¸‹æ–‡&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">__aexit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å¼‚æ­¥é€€å‡ºä¸Šä¸‹æ–‡ï¼Œé‡Šæ”¾èµ„æº&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> AsyncContext() <span class="keyword">as</span> ctx:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å¼‚æ­¥å¤„ç†ä¸­...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"># Python</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/12/31/ai/langchain/7-langchain-Built-in-Middleware/" rel="prev" title="LangChainå†…ç½®ä¸­é—´ä»¶æ¡ˆä¾‹">
      <i class="fa fa-chevron-left"></i> LangChainå†…ç½®ä¸­é—´ä»¶æ¡ˆä¾‹
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0-%E5%8D%8F%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="nav-number">1.</span> <span class="nav-text">å¼‚æ­¥å‡½æ•°(åç¨‹å‡½æ•°)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#async%E5%92%8C%E5%8D%8F%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="nav-number">1.1.</span> <span class="nav-text">asyncå’Œåç¨‹å‡½æ•°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%8F%E7%A8%8B%E7%9A%84%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-number">1.2.</span> <span class="nav-text">åç¨‹çš„è°ƒç”¨æ–¹å¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84%E5%8F%8A%E6%B5%81%E7%A8%8B"><span class="nav-number">1.3.</span> <span class="nav-text">å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæ¶æ„åŠæµç¨‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%8F%E7%A8%8B%E6%89%A7%E8%A1%8C%E5%B9%B6%E5%8F%91"><span class="nav-number">1.4.</span> <span class="nav-text">åç¨‹æ‰§è¡Œå¹¶å‘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#asyncio-create-task"><span class="nav-number">1.4.1.</span> <span class="nav-text">asyncio.create_task()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#asyncio-gather"><span class="nav-number">1.4.2.</span> <span class="nav-text">asyncio.gather()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%92%8C%E5%BC%82%E6%AD%A5%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="nav-number">2.</span> <span class="nav-text">è¿­ä»£å™¨å’Œå¼‚æ­¥è¿­ä»£å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%BF%AD%E4%BB%A3%E5%99%A8%EF%BC%9F"><span class="nav-number">2.1.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BC%82%E6%AD%A5%E8%BF%AD%E4%BB%A3%E5%99%A8%EF%BC%9F"><span class="nav-number">2.2.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯å¼‚æ­¥è¿­ä»£å™¨ï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LangChain%E4%B8%AD%E5%BC%82%E6%AD%A5%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%BA%94%E7%94%A8"><span class="nav-number">2.3.</span> <span class="nav-text">LangChainä¸­å¼‚æ­¥è¿­ä»£å™¨åº”ç”¨</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E5%92%8C%E5%BC%82%E6%AD%A5%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-number">3.</span> <span class="nav-text">ç”Ÿæˆå™¨å’Œå¼‚æ­¥ç”Ÿæˆå™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-number">3.1.</span> <span class="nav-text">åŒæ­¥ç”Ÿæˆå™¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E7%94%9F%E6%88%90%E5%99%A8%E7%9A%84%E8%AF%AD%E6%B3%95%E4%B8%8E%E6%9C%BA%E5%88%B6"><span class="nav-number">3.2.</span> <span class="nav-text">å¼‚æ­¥ç”Ÿæˆå™¨çš„è¯­æ³•ä¸æœºåˆ¶</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E7%94%9F%E6%88%90%E5%99%A8-vs-%E5%BC%82%E6%AD%A5%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="nav-number">4.</span> <span class="nav-text">å¼‚æ­¥ç”Ÿæˆå™¨ vs å¼‚æ­¥è¿­ä»£å™¨</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8C%E5%BC%82%E6%AD%A5%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-number">5.</span> <span class="nav-text">ä¸Šä¸‹æ–‡ç®¡ç†å™¨å’Œå¼‚æ­¥ä¸Šä¸‹æ–‡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-number">5.1.</span> <span class="nav-text">ä¸Šä¸‹æ–‡ç®¡ç†å™¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%9F%BA%E7%A1%80"><span class="nav-number">5.2.</span> <span class="nav-text">å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨åŸºç¡€</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jean Lv"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Jean Lv</p>
  <div class="site-description" itemprop="description">æ¶‰çŒçš„ä¸»è¦ç¼–ç¨‹è¯­è¨€Javaã€Python, é¢†åŸŸè½¯ä»¶æµ‹è¯•ã€AIæµ‹è¯•å¼€å‘ç›¸å…³</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">165</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jean Lv</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>











<script data-pjax>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.0/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'neutral',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


    <div id="pjax">
  

  

  

    </div>
</body>
</html>
